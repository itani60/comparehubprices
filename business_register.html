<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Business Registration</title>
  <link rel="stylesheet" href="assets/fontawesome-6.0.0/css/all.css" />
  <style>
    :root {
      --bg: #f4f6fb;
      --card: #ffffff;
      --text: #0f172a;
      --muted: #64748b;
      --border: #e2e8f0;
      --primary: #2563eb;
      --primary-soft: rgba(37, 99, 235, 0.12);
      --danger: #dc2626;
      --success: #16a34a;
      --shadow: 0 18px 40px rgba(15, 23, 42, 0.08);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background: var(--bg) url("assets/images/background.png") center / cover no-repeat fixed;
      color: var(--text);
    }

    .page {
      min-height: 100vh;
      padding: 40px 16px 64px;
      position: relative;
      overflow: hidden;
    }

    .page::before {
      content: "";
      position: absolute;
      inset: 0;
      background: linear-gradient(180deg, rgba(5, 10, 20, 0.78) 0%, rgba(5, 10, 20, 0.62) 45%, rgba(5, 10, 20, 0.84) 100%);
      z-index: 0;
      pointer-events: none;
    }

    .page::after {
      content: "";
      position: absolute;
      width: 520px;
      height: 520px;
      right: -160px;
      top: -180px;
      background: radial-gradient(circle, rgba(37, 99, 235, 0.35), transparent 70%);
      opacity: 0.9;
      z-index: 0;
      pointer-events: none;
    }

    .shell {
      width: min(960px, 96vw);
      margin: 0 auto;
      position: relative;
      z-index: 1;
    }

    .form-card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 22px;
      padding: 28px;
      box-shadow: var(--shadow);
    }

    .form-header {
      text-align: center;
      margin-bottom: 20px;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      gap: 6px;
    }

    .form-header .logo-img {
      height: 140px;
      width: auto;
      max-width: 260px;
      object-fit: contain;
    }

    .header-text h1 {
      margin: 0;
      font-size: 1.2rem;
      font-weight: 700;
      color: var(--text);
    }

    .header-text p {
      margin: 4px 0 0;
      font-size: 0.85rem;
      color: var(--muted);
    }

    form {
      display: grid;
      gap: 20px;
    }

    .section-card {
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 18px;
      display: grid;
      gap: 16px;
    }

    .section-header h2 {
      margin: 0;
      font-size: 1.1rem;
    }

    .section-header p {
      margin: 6px 0 0;
      color: var(--muted);
      font-size: 0.9rem;
    }

    .field-grid {
      display: grid;
      gap: 14px;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    }

    label {
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--text);
      display: block;
      margin-bottom: 6px;
    }

    .label-row {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      flex-wrap: nowrap;
      line-height: 1;
    }

    .label-row label {
      margin-bottom: 0;
    }

    .label-divider {
      color: var(--muted);
      font-weight: 600;
      line-height: 1;
    }

    .label-note {
      font-size: 0.7rem;
      color: var(--muted);
      margin-left: 4px;
    }

    .mini-toggle {
      border: 1px solid var(--border);
      background: var(--primary);
      color: #fff;
      font-size: 0.7rem;
      padding: 2px 8px;
      line-height: 1.1;
      border-radius: 999px;
      cursor: pointer;
      transition: border-color 0.2s, color 0.2s, background 0.2s;
    }

    .mini-toggle.active {
      border-color: var(--primary);
      background: #1d4ed8;
      color: #fff;
    }

    .form-hint {
      margin: 4px 0 0;
      font-size: 0.8rem;
      color: var(--muted);
    }

    .co-owner-list {
      display: grid;
      gap: 10px;
    }

    .co-owner-row {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr auto;
      gap: 10px;
      align-items: center;
    }

    .co-owner-row input {
      flex: 1;
    }

    .co-owner-btn {
      border: 1px solid var(--border);
      background: #fff;
      color: var(--text);
      border-radius: 8px;
      padding: 8px 12px;
      font-size: 0.85rem;
      cursor: pointer;
      transition: border-color 0.2s, color 0.2s, background 0.2s;
    }

    .co-owner-btn:hover {
      border-color: var(--primary);
      color: var(--primary);
    }

    .remove-co-owner {
      border-color: #fecaca;
      color: #dc2626;
      background: #fff5f5;
    }

    .remove-co-owner:hover {
      border-color: #dc2626;
      color: #b91c1c;
    }

    .add-co-owner {
      align-self: flex-start;
    }

    .input-wrapper {
      position: relative;
    }

    input,
    select,
    textarea {
      width: 100%;
      padding: 12px 14px;
      border: 1px solid var(--border);
      border-radius: 12px;
      font-size: 0.95rem;
      outline: none;
      transition: border-color 0.2s, box-shadow 0.2s;
      background: #fff;
      font-family: inherit;
    }

    input:focus,
    select:focus,
    textarea:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 4px var(--primary-soft);
    }

    .toggle-password {
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--muted);
      cursor: pointer;
      width: 26px;
      height: 26px;
      display: grid;
      place-items: center;
      border-radius: 50%;
      background: #fff;
      box-shadow: 0 0 0 1px var(--border);
    }

    input.has-toggle {
      padding-right: 44px;
    }

    .input-field {
      position: relative;
    }

    .custom-select {
      position: relative;
    }

    .custom-select-trigger {
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      padding: 12px 14px;
      border: 1px solid var(--border);
      border-radius: 12px;
      background: #fff;
      font-size: 0.95rem;
      font-family: inherit;
      font-weight: 500;
      color: var(--text);
      cursor: pointer;
      transition: border-color 0.2s, box-shadow 0.2s;
    }

    .custom-select-trigger:focus-visible {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 4px var(--primary-soft);
    }

    .custom-select-panel {
      position: absolute;
      left: 0;
      right: 0;
      top: calc(100% + 8px);
      background: #fff;
      border: 1px solid var(--border);
      border-radius: 12px;
      box-shadow: var(--shadow);
      padding: 6px;
      display: none;
      z-index: 20;
    }

    .custom-select-panel.open {
      display: grid;
      gap: 4px;
    }

    .custom-option {
      border: none;
      background: transparent;
      text-align: left;
      padding: 10px 12px;
      border-radius: 10px;
      font-size: 0.9rem;
      font-weight: 500;
      cursor: pointer;
      color: var(--text);
    }

    .custom-option:hover,
    .custom-option.selected {
      background: var(--primary-soft);
      color: var(--primary);
    }

    .upload-card {
      border: 1px dashed var(--border);
      border-radius: 14px;
      padding: 16px;
      display: grid;
      gap: 6px;
      background: #f8fafc;
    }

    .upload-row {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: center;
    }

    .upload-btn {
      background: var(--primary);
      color: #fff;
      border: none;
      padding: 10px 16px;
      border-radius: 10px;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
    }

    .upload-name {
      color: var(--muted);
      font-size: 0.9rem;
    }

    .requirements {
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 14px;
      background: #f8fafc;
      display: grid;
      gap: 8px;
      font-size: 0.9rem;
    }

    .requirements .title {
      font-weight: 600;
      color: var(--text);
      margin-bottom: 2px;
    }

    .requirement {
      display: flex;
      align-items: center;
      gap: 10px;
      color: var(--muted);
    }

    .req-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: #e2e8f0;
      border: 1px solid #cbd5f5;
      flex-shrink: 0;
    }

    .requirement.valid {
      color: var(--success);
    }

    .requirement.valid .req-dot {
      background: var(--success);
      border-color: var(--success);
    }

    .requirement.invalid {
      color: var(--danger);
    }

    .requirement.invalid .req-dot {
      background: var(--danger);
      border-color: var(--danger);
    }

    .strength {
      display: grid;
      gap: 8px;
    }

    .strength-bar {
      height: 8px;
      border-radius: 999px;
      background: #e2e8f0;
      overflow: hidden;
    }

    .strength-bar span {
      display: block;
      height: 100%;
      width: 0;
      background: var(--danger);
      transition: width 0.2s ease, background 0.2s ease;
    }

    .strength-label {
      font-size: 0.85rem;
      color: var(--muted);
    }

    .checkbox-row {
      display: flex;
      gap: 10px;
      align-items: flex-start;
      font-size: 0.85rem;
      color: var(--muted);
    }

    .checkbox-row input {
      width: auto;
      margin-top: 2px;
    }

    .actions {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
    }

    button {
      border: none;
      padding: 12px 18px;
      border-radius: 12px;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
    }

    .btn-primary {
      background: var(--primary);
      color: #fff;
    }

    .btn-link {
      border: none;
      background: none;
      color: var(--muted);
      font-size: 0.85rem;
      cursor: pointer;
      text-decoration: underline;
    }

    .btn-outline {
      background: #fff;
      border: 1px solid var(--border);
      color: var(--text);
    }

    .footer-note {
      font-size: 0.85rem;
      color: var(--muted);
      text-align: center;
    }

    .form-alert {
      display: none;
      padding: 12px 14px;
      border-radius: 10px;
      font-size: 0.9rem;
      border: 1px solid transparent;
      margin-bottom: 16px;
      text-align: center;
    }

    .form-alert.show {
      display: block;
    }

    .form-alert.error {
      background: rgba(239, 68, 68, 0.08);
      border-color: rgba(239, 68, 68, 0.35);
      color: #991b1b;
    }

    .form-alert.success {
      background: rgba(34, 197, 94, 0.08);
      border-color: rgba(34, 197, 94, 0.35);
      color: #065f46;
    }

    .verify-section {
      display: none;
      margin-top: 12px;
      text-align: center;
      gap: 16px;
    }

    .verify-section.active {
      display: grid;
    }

    .verify-section h2 {
      margin: 0 0 6px;
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--text);
    }

    .verify-section p {
      margin: 0;
      font-size: 0.85rem;
      color: var(--muted);
    }

    .otp-grid {
      display: grid;
      grid-template-columns: repeat(6, 44px);
      gap: 10px;
      justify-content: center;
    }

    .otp-box {
      width: 44px;
      height: 52px;
      border: 1px solid var(--border);
      border-radius: 12px;
      background: #fff;
      text-align: center;
      font-size: 1.2rem;
      font-weight: 600;
      color: var(--text);
      transition: 0.2s;
    }

    .otp-box:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 4px var(--primary-soft);
    }

    .verify-actions {
      display: grid;
      gap: 12px;
    }

    .is-hidden {
      display: none !important;
    }

    .muted {
      color: var(--muted);
    }

    @media (max-width: 768px) {
      .page {
        padding: 24px 12px 40px;
      }

      .shell {
        width: 100%;
      }

      .form-card {
        width: 100%;
        margin: 0;
        padding: 20px;
        border-radius: 18px;
      }

      .section-card {
        padding: 16px;
        border-radius: 14px;
      }

      .section-header h2 {
        font-size: 1rem;
      }

      .section-header p {
        font-size: 0.85rem;
      }

      .form-header {
        margin-bottom: 14px;
      }

      .form-header .logo-img {
        height: 120px;
        max-width: 220px;
      }

      .header-text h1 {
        font-size: 1rem;
      }

      .header-text p {
        font-size: 0.8rem;
      }

      .field-grid {
        grid-template-columns: 1fr;
      }

      input,
      select,
      textarea {
        font-size: 0.9rem;
      }

      .actions {
        flex-direction: column;
      }

      .actions button {
        width: 100%;
      }
    }

    @media (max-width: 480px) {
      .shell {
        width: 100%;
      }

      .form-card {
        width: 100%;
        margin: 0;
        padding: 16px;
      }

      .section-card {
        padding: 14px;
      }

      .form-header {
        margin-bottom: 12px;
      }

      .form-header .logo-img {
        height: 105px;
        max-width: 200px;
      }

      .header-text h1 {
        font-size: 0.95rem;
      }

      .header-text p {
        font-size: 0.75rem;
      }

      .upload-row {
        flex-direction: column;
        align-items: flex-start;
      }

      .co-owner-row {
        grid-template-columns: 1fr;
        align-items: stretch;
      }

      .mini-toggle {
        padding: 2px 6px;
        font-size: 0.65rem;
      }

      .otp-grid {
        grid-template-columns: repeat(6, 36px);
        gap: 6px;
      }

      .otp-box {
        width: 36px;
        height: 46px;
      }
    }
  </style>
</head>
<body>
  <div class="page">
    <div class="shell">
      <div class="form-card">
        <div class="form-header">
          <div class="brand-logo">
            <img src="assets/logo/busines_logo.png" alt="CompareHubPrices" class="logo-img" />
          </div>
        <div class="header-text">
          <h1>Register Your Business</h1>
          <p>Create a business account to showcase your products and reach more customers</p>
        </div>
      </div>
      <div class="form-alert" id="formAlert" role="alert" aria-live="polite"></div>
      <form id="businessRegisterForm" autocomplete="off">
          <div class="section-card">
            <div class="section-header">
              <h2>Owner details</h2>
              <p>Tell us who is managing this business account.</p>
            </div>
            <div class="field-grid">
              <div>
                <label for="firstName">First name</label>
                <input id="firstName" type="text" placeholder="" required autocomplete="off" />
              </div>
              <div>
                <label for="lastName">Last name</label>
                <input id="lastName" type="text" placeholder="" required autocomplete="off" />
              </div>
            </div>
          </div>

          <div class="section-card">
            <div class="section-header">
              <h2>Business profile</h2>
              <p>Use the public information customers will see.</p>
            </div>
            <div class="field-grid">
              <div>
                <label for="businessName">Business name</label>
                <input id="businessName" type="text" placeholder="" required autocomplete="off" />
              </div>
              <div>
                <label for="businessType">Business type</label>
                <div class="custom-select" id="businessTypeSelect">
                  <input type="hidden" id="businessType" required />
                  <button type="button" class="custom-select-trigger" aria-haspopup="listbox" aria-expanded="false">
                    <span class="trigger-text">Select type</span>
                    <span class="chevron">▾</span>
                  </button>
                  <div class="custom-select-panel" role="listbox" aria-hidden="true">
                    <button type="button" class="custom-option" role="option" data-value="Retail">Retail</button>
                    <button type="button" class="custom-option" role="option" data-value="Restaurant">Restaurant</button>
                    <button type="button" class="custom-option" role="option" data-value="Services">Services</button>
                    <button type="button" class="custom-option" role="option" data-value="Beauty and wellness">Beauty and wellness</button>
                    <button type="button" class="custom-option" role="option" data-value="Home and garden">Home and garden</button>
                  </div>
                </div>
              </div>
              <div>
                <label for="businessNumber">Business contact number</label>
                <input id="businessNumber" type="tel" placeholder="" required autocomplete="off" />
              </div>
              <div>
                <label for="businessEmail">Business email</label>
                <input id="businessEmail" type="email" placeholder="" required autocomplete="off" />
              </div>
            </div>
            <div>
              <label>Co-owners (Optional)</label>
              <p class="form-hint">Enter names only.</p>
              <div class="co-owner-list" id="coOwnersList">
                <div class="co-owner-row">
                  <input type="text" class="co-owner-input" placeholder="Full name" autocomplete="off" />
                  <input type="email" class="co-owner-input" placeholder="Email" autocomplete="off" />
                  <input type="tel" class="co-owner-input" placeholder="Phone number" autocomplete="off" />
                  <button type="button" class="co-owner-btn remove-co-owner">Remove</button>
                </div>
              </div>
              <button type="button" class="co-owner-btn add-co-owner" id="addCoOwnerBtn">
                Add another name
              </button>
            </div>
          </div>

          <div class="section-card">
            <div class="section-header">
              <h2>Business address</h2>
              <p>Used for verification and location-based search.</p>
            </div>
            <div class="field-grid">
              <div>
                <label for="street">Street address</label>
                <input id="street" type="text" placeholder="" required autocomplete="off" />
              </div>
              <div>
                <label for="addressLine2">Address line 2</label>
                <input id="addressLine2" type="text" placeholder="" autocomplete="off" />
              </div>
              <div>
                <div class="label-row">
                  <label id="suburbLabel" for="suburb">Suburb</label>
                  <span class="label-divider">/</span>
                  <button type="button" class="mini-toggle" id="placeToggle">Village</button>
                  <span class="label-note">press to change</span>
                </div>
                <input id="suburb" type="text" placeholder="" required autocomplete="off" />
                <input type="hidden" id="placeType" value="suburb" />
              </div>
              <div>
                <label for="town">Town</label>
                <input id="town" type="text" placeholder="" required autocomplete="off" />
              </div>
              <div>
                <label for="province">Province</label>
                <div class="custom-select" id="provinceSelect">
                  <input type="hidden" id="province" required />
                  <button type="button" class="custom-select-trigger" aria-haspopup="listbox" aria-expanded="false">
                    <span class="trigger-text">Select province</span>
                    <span class="chevron">▾</span>
                  </button>
                  <div class="custom-select-panel" role="listbox" aria-hidden="true">
                    <button type="button" class="custom-option" role="option" data-value="Eastern Cape">Eastern Cape</button>
                    <button type="button" class="custom-option" role="option" data-value="Free State">Free State</button>
                    <button type="button" class="custom-option" role="option" data-value="Gauteng">Gauteng</button>
                    <button type="button" class="custom-option" role="option" data-value="KwaZulu-Natal">KwaZulu-Natal</button>
                    <button type="button" class="custom-option" role="option" data-value="Limpopo">Limpopo</button>
                    <button type="button" class="custom-option" role="option" data-value="Mpumalanga">Mpumalanga</button>
                    <button type="button" class="custom-option" role="option" data-value="Northern Cape">Northern Cape</button>
                    <button type="button" class="custom-option" role="option" data-value="North West">North West</button>
                    <button type="button" class="custom-option" role="option" data-value="Western Cape">Western Cape</button>
                  </div>
                </div>
              </div>
              <div>
                <label for="postalCode">Postal code</label>
                <input id="postalCode" type="text" placeholder="" required autocomplete="off" />
              </div>
            </div>
          </div>

          <div class="section-card">
            <div class="section-header">
              <h2>Account security</h2>
              <p>Create a strong password for your business account.</p>
            </div>
            <div class="field-grid">
              <div class="input-wrapper">
                <label for="password">Password</label>
                <div class="input-field">
                  <input id="password" class="has-toggle" type="password" placeholder="Create a password" required autocomplete="new-password" />
                  <i class="fas fa-eye toggle-password" data-toggle="password"></i>
                </div>
              </div>
              <div class="input-wrapper">
                <label for="confirmPassword">Confirm password</label>
                <div class="input-field">
                  <input id="confirmPassword" class="has-toggle" type="password" placeholder="Repeat password" required autocomplete="new-password" />
                  <i class="fas fa-eye toggle-password" data-toggle="confirmPassword"></i>
                </div>
              </div>
            </div>
            <div class="requirements" id="passwordRequirements">
              <div class="strength">
                <div class="strength-bar"><span id="strengthBar"></span></div>
                <div class="strength-label" id="strengthLabel">Password strength: --</div>
              </div>
              <div class="title">Password must contain:</div>
              <div class="requirement" data-rule="length"><span class="req-dot"></span>At least 8 characters</div>
              <div class="requirement" data-rule="uppercase"><span class="req-dot"></span>One uppercase letter</div>
              <div class="requirement" data-rule="lowercase"><span class="req-dot"></span>One lowercase letter</div>
              <div class="requirement" data-rule="number"><span class="req-dot"></span>One number</div>
              <div class="requirement" data-rule="special"><span class="req-dot"></span>One special character</div>
              <div class="requirement" data-rule="match"><span class="req-dot"></span>Passwords match</div>
            </div>
          </div>

          <div class="section-card">
            <label class="checkbox-row">
              <input type="checkbox" required />
              <span>I agree to the Terms of Service and Privacy Policy.</span>
            </label>
          </div>

          <div class="actions">
            <button class="btn-primary" type="submit">Create account</button>
          </div>

          <div class="footer-note">
            Already have an account? <a href="login.html">Sign in here</a>
          </div>
        </form>

        <div class="verify-section" id="verifySection">
          <div>
            <h2>Verify your business account</h2>
            <p>OTP has been sent to <span id="verifyEmail">your email</span>.</p>
          </div>

          <div class="otp-grid" role="group" aria-label="Verification code">
            <input type="text" class="otp-box" inputmode="numeric" maxlength="1" aria-label="Digit 1" autocomplete="off" />
            <input type="text" class="otp-box" inputmode="numeric" maxlength="1" aria-label="Digit 2" autocomplete="off" />
            <input type="text" class="otp-box" inputmode="numeric" maxlength="1" aria-label="Digit 3" autocomplete="off" />
            <input type="text" class="otp-box" inputmode="numeric" maxlength="1" aria-label="Digit 4" autocomplete="off" />
            <input type="text" class="otp-box" inputmode="numeric" maxlength="1" aria-label="Digit 5" autocomplete="off" />
            <input type="text" class="otp-box" inputmode="numeric" maxlength="1" aria-label="Digit 6" autocomplete="off" />
          </div>

          <div class="verify-actions">
            <button class="btn-primary" type="button" id="verifyAccountBtn">Verify account</button>
            <button class="btn-link" type="button" id="resendOtpBtn">Resend code</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="assets/scripts/business-auth.js"></script>
  <script>
    const passwordInput = document.getElementById('password');
    const confirmPasswordInput = document.getElementById('confirmPassword');
    const strengthBar = document.getElementById('strengthBar');
    const strengthLabel = document.getElementById('strengthLabel');

    function updateRequirement(rule, valid) {
      const row = document.querySelector(`.requirement[data-rule="${rule}"]`);
      if (!row) return;
      row.classList.toggle('valid', valid);
      row.classList.toggle('invalid', !valid);
    }

    function evaluatePassword() {
      const pwd = passwordInput.value || '';
      const confirm = confirmPasswordInput.value || '';

      const rules = {
        length: pwd.length >= 8,
        uppercase: /[A-Z]/.test(pwd),
        lowercase: /[a-z]/.test(pwd),
        number: /[0-9]/.test(pwd),
        special: /[^A-Za-z0-9]/.test(pwd),
        match: pwd.length > 0 && pwd === confirm,
      };

      let score = 0;
      Object.values(rules).forEach((ok) => {
        if (ok) score += 1;
      });

      updateRequirement('length', rules.length);
      updateRequirement('uppercase', rules.uppercase);
      updateRequirement('lowercase', rules.lowercase);
      updateRequirement('number', rules.number);
      updateRequirement('special', rules.special);
      updateRequirement('match', rules.match);

      const strengthPct = Math.round((score / 6) * 100);
      strengthBar.style.width = `${strengthPct}%`;

      let label = 'Too weak';
      let color = '#dc2626';
      if (score >= 5) {
        label = 'Great';
        color = '#16a34a';
      } else if (score >= 4) {
        label = 'Strong';
        color = '#22c55e';
      } else if (score >= 3) {
        label = 'Fair';
        color = '#f59e0b';
      } else if (score >= 2) {
        label = 'Weak';
        color = '#f97316';
      }

      strengthBar.style.background = color;
      strengthLabel.textContent = `Password strength: ${label}`;
    }

    passwordInput.addEventListener('input', evaluatePassword);
    confirmPasswordInput.addEventListener('input', evaluatePassword);

    const initCustomSelect = (selectId) => {
      const select = document.getElementById(selectId);
      if (!select) return;

      const trigger = select.querySelector('.custom-select-trigger');
      const panel = select.querySelector('.custom-select-panel');
      const options = Array.from(select.querySelectorAll('.custom-option'));
      const hiddenInput = select.querySelector('input[type="hidden"]');

      const closeSelect = () => {
        panel.classList.remove('open');
        trigger.setAttribute('aria-expanded', 'false');
        panel.setAttribute('aria-hidden', 'true');
      };

      trigger.addEventListener('click', (event) => {
        event.stopPropagation();
        const isOpen = panel.classList.toggle('open');
        trigger.setAttribute('aria-expanded', String(isOpen));
        panel.setAttribute('aria-hidden', String(!isOpen));
      });

      options.forEach((option) => {
        option.addEventListener('click', () => {
          const value = option.dataset.value || option.textContent.trim();
          hiddenInput.value = value;
          trigger.querySelector('.trigger-text').textContent = value;
          options.forEach((opt) => opt.classList.remove('selected'));
          option.classList.add('selected');
          closeSelect();
        });
      });

      document.addEventListener('click', (event) => {
        if (!select.contains(event.target)) {
          closeSelect();
        }
      });
    };

    initCustomSelect('businessTypeSelect');
    initCustomSelect('provinceSelect');

    document.querySelectorAll('.toggle-password').forEach((toggle) => {
      toggle.addEventListener('click', () => {
        const targetId = toggle.dataset.toggle;
        const input = document.getElementById(targetId);
        if (!input) return;
        input.type = input.type === 'password' ? 'text' : 'password';
        toggle.classList.toggle('fa-eye');
        toggle.classList.toggle('fa-eye-slash');
      });
    });

    const suburbLabel = document.getElementById('suburbLabel');
    const placeToggle = document.getElementById('placeToggle');
    const suburbInput = document.getElementById('suburb');
    const placeTypeInput = document.getElementById('placeType');

    if (suburbLabel && placeToggle && suburbInput && placeTypeInput) {
      let isVillage = false;

      const updatePlace = () => {
        if (isVillage) {
          suburbLabel.textContent = 'Village';
          placeToggle.textContent = 'Suburb';
          suburbInput.placeholder = '';
          placeTypeInput.value = 'village';
          placeToggle.classList.add('active');
        } else {
          suburbLabel.textContent = 'Suburb';
          placeToggle.textContent = 'Village';
          suburbInput.placeholder = '';
          placeTypeInput.value = 'suburb';
          placeToggle.classList.remove('active');
        }
      };

      placeToggle.addEventListener('click', () => {
        isVillage = !isVillage;
        updatePlace();
      });

      updatePlace();
    }

    const coOwnersList = document.getElementById('coOwnersList');
    const addCoOwnerBtn = document.getElementById('addCoOwnerBtn');

    if (coOwnersList && addCoOwnerBtn) {
      const maxCoOwners = 3;
      const createCoOwnerRow = () => {
        const row = document.createElement('div');
        row.className = 'co-owner-row';

        const nameInput = document.createElement('input');
        nameInput.type = 'text';
        nameInput.className = 'co-owner-input';
        nameInput.placeholder = 'Full name';

        const emailInput = document.createElement('input');
        emailInput.type = 'email';
        emailInput.className = 'co-owner-input';
        emailInput.placeholder = 'Email';

        const phoneInput = document.createElement('input');
        phoneInput.type = 'tel';
        phoneInput.className = 'co-owner-input';
        phoneInput.placeholder = 'Phone number';

        const removeBtn = document.createElement('button');
        removeBtn.type = 'button';
        removeBtn.className = 'co-owner-btn remove-co-owner';
        removeBtn.textContent = 'Remove';

        row.appendChild(nameInput);
        row.appendChild(emailInput);
        row.appendChild(phoneInput);
        row.appendChild(removeBtn);
        return row;
      };

      const updateRemoveButtons = () => {
        const rows = coOwnersList.querySelectorAll('.co-owner-row');
        rows.forEach((row) => {
          const btn = row.querySelector('.remove-co-owner');
          if (!btn) return;
          const isOnly = rows.length === 1;
          btn.disabled = isOnly;
          btn.style.visibility = isOnly ? 'hidden' : 'visible';
        });
      };

      const updateAddButton = () => {
        const count = coOwnersList.querySelectorAll('.co-owner-row').length;
        addCoOwnerBtn.disabled = count >= maxCoOwners;
        addCoOwnerBtn.textContent = count >= maxCoOwners ? 'Maximum 3 names' : 'Add another name';
      };

      addCoOwnerBtn.addEventListener('click', () => {
        const count = coOwnersList.querySelectorAll('.co-owner-row').length;
        if (count >= maxCoOwners) return;
        const row = createCoOwnerRow();
        coOwnersList.appendChild(row);
        updateRemoveButtons();
        updateAddButton();
        row.querySelector('.co-owner-input')?.focus();
      });

      coOwnersList.addEventListener('click', (event) => {
        const removeBtn = event.target.closest('.remove-co-owner');
        if (!removeBtn) return;
        const rows = coOwnersList.querySelectorAll('.co-owner-row');
        if (rows.length === 1) {
          const input = rows[0].querySelector('.co-owner-input');
          if (input) input.value = '';
          return;
        }
        removeBtn.closest('.co-owner-row')?.remove();
        updateRemoveButtons();
        updateAddButton();
      });

      updateRemoveButtons();
      updateAddButton();
    }

    const businessForm = document.getElementById('businessRegisterForm');
    const verifySection = document.getElementById('verifySection');
    const verifyEmail = document.getElementById('verifyEmail');
    const formAlert = document.getElementById('formAlert');
    const businessEmailInput = document.getElementById('businessEmail');
    const townInput = document.getElementById('town');
    const otpInputs = Array.from(document.querySelectorAll('.otp-box'));
    const verifyAccountBtn = document.getElementById('verifyAccountBtn');
    const resendOtpBtn = document.getElementById('resendOtpBtn');

    const SUPABASE_URL = 'https://gttsyowogmdzwqitaskr.supabase.co';
    const SUPABASE_ANON_KEY =
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imd0dHN5b3dvZ21kendxaXRhc2tyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg4NzY2NzQsImV4cCI6MjA4NDQ1MjY3NH0.p3QDWmk2LgkGE082CJWkIthSeerYFhajHxiQFqklaZk';
    const REGISTRATION_API_URL = `${SUPABASE_URL}/functions/v1/business-registration-auth`;
    const HOME_REDIRECT = 'home_main.html';
    let pendingLogin = null;

    const showAlert = (message, type = 'error') => {
      if (!formAlert) return;
      formAlert.textContent = message;
      formAlert.className = `form-alert show ${type}`;
    };

    const clearAlert = () => {
      if (!formAlert) return;
      formAlert.textContent = '';
      formAlert.className = 'form-alert';
    };

    const readJsonSafe = async (response) => {
      const text = await response.text().catch(() => '');
      if (!text) return {};
      try {
        return JSON.parse(text);
      } catch {
        return { error: text };
      }
    };

    const setVerifyEmail = (value) => {
      if (!verifyEmail) return;
      const clean = (value || '').trim();
      verifyEmail.textContent = clean || 'your email';
    };

    if (verifyEmail) {
      const params = new URLSearchParams(window.location.search);
      const emailParam = (params.get('email') || '').trim();
      if (emailParam) {
        setVerifyEmail(emailParam);
      }
    }

    if (businessForm) {
      businessForm.addEventListener('submit', async (event) => {
        event.preventDefault();
        clearAlert();
        evaluatePassword();
        if (!businessForm.checkValidity()) {
          businessForm.reportValidity();
          return;
        }
        const businessTypeValue = document.getElementById('businessType')?.value?.trim();
        if (!businessTypeValue) {
          showAlert('Please select a business type.');
          document.querySelector('#businessTypeSelect .custom-select-trigger')?.focus();
          return;
        }
        const provinceValue = document.getElementById('province')?.value?.trim();
        if (!provinceValue) {
          showAlert('Please select a province.');
          document.querySelector('#provinceSelect .custom-select-trigger')?.focus();
          return;
        }
        const submitBtn = businessForm.querySelector('button[type="submit"]');
        if (submitBtn) submitBtn.disabled = true;

        try {
          const firstName = document.getElementById('firstName')?.value.trim();
          const lastName = document.getElementById('lastName')?.value.trim();
          const businessName = document.getElementById('businessName')?.value.trim();
          const businessType = businessTypeValue;
          const businessNumber = document.getElementById('businessNumber')?.value.trim();
          const email = businessEmailInput?.value.trim();
          const streetAddress = document.getElementById('street')?.value.trim();
          const addressLine2 = document.getElementById('addressLine2')?.value.trim();
          const suburbValue = suburbInput?.value.trim();
          const placeType = placeTypeInput?.value || 'suburb';
          const town = townInput?.value.trim();
          const province = provinceValue;
          const postalCode = document.getElementById('postalCode')?.value.trim();
          const password = document.getElementById('password')?.value;
          const confirmPassword = document.getElementById('confirmPassword')?.value;

          if (!email) {
            throw new Error('Business email is required.');
          }
          if (password !== confirmPassword) {
            throw new Error('Passwords do not match.');
          }
          pendingLogin = { email, password };

          const suburb = placeType === 'suburb' ? suburbValue : '';
          const village = placeType === 'village' ? suburbValue : '';

          const coOwners = Array.from(document.querySelectorAll('.co-owner-row'))
            .map((row) => {
              const inputs = row.querySelectorAll('input');
              return {
                name: inputs[0]?.value.trim() || '',
                email: inputs[1]?.value.trim() || '',
                phone: inputs[2]?.value.trim() || '',
              };
            })
            .filter((owner) => owner.name || owner.email || owner.phone);

          const response = await fetch(REGISTRATION_API_URL, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              apikey: SUPABASE_ANON_KEY,
              Authorization: `Bearer ${SUPABASE_ANON_KEY}`,
            },
            body: JSON.stringify({
              action: 'signup',
              email,
              password,
              firstName,
              lastName,
              businessName,
              businessNumber,
              streetAddress,
              addressLine2,
              suburb,
              village,
              town,
              province,
              postalCode,
              businessType,
              coOwners,
            }),
          });

          const result = await readJsonSafe(response);
          if (!response.ok) {
            throw new Error(result?.error || result?.message || 'Registration failed.');
          }

          setVerifyEmail(email);
          businessForm.classList.add('is-hidden');
          if (verifySection) {
            verifySection.classList.add('active');
          }
          if (otpInputs.length) {
            otpInputs[0].focus();
          }
          showAlert('Registration successful. Check your email for the verification code.', 'success');
        } catch (err) {
          showAlert(err?.message || 'Registration failed.');
        } finally {
          if (submitBtn) submitBtn.disabled = false;
        }
      });
    }

    const getOtpValue = () => otpInputs.map((input) => input.value.trim()).join('');

    if (verifyAccountBtn) {
      verifyAccountBtn.addEventListener('click', async () => {
        clearAlert();
        const email = businessEmailInput?.value.trim();
        const otpCode = getOtpValue();

        if (!email || !otpCode) {
          showAlert('Email and verification code are required.');
          return;
        }

        verifyAccountBtn.disabled = true;
        try {
          const response = await fetch(REGISTRATION_API_URL, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              apikey: SUPABASE_ANON_KEY,
              Authorization: `Bearer ${SUPABASE_ANON_KEY}`,
            },
            body: JSON.stringify({
              action: 'verifyOTP',
              email,
              otpCode,
            }),
          });

          const result = await readJsonSafe(response);
          if (!response.ok) {
            throw new Error(result?.error || result?.message || 'Verification failed.');
          }
          if (!window.businessAuth?.login) {
            throw new Error('Auto login is not available.');
          }
          const loginEmail = pendingLogin?.email || email;
          const loginPassword = pendingLogin?.password || '';
          if (!loginPassword) {
            throw new Error('Missing password for auto login.');
          }
          showAlert('Email verified. Logging you in...', 'success');
          await window.businessAuth.login({
            email: loginEmail,
            password: loginPassword,
            redirectTo: HOME_REDIRECT,
          });
        } catch (err) {
          showAlert(err?.message || 'Verification failed.');
        } finally {
          verifyAccountBtn.disabled = false;
        }
      });
    }

    if (resendOtpBtn) {
      resendOtpBtn.addEventListener('click', async () => {
        clearAlert();
        const email = businessEmailInput?.value.trim();
        if (!email) {
          showAlert('Please enter your email first.');
          return;
        }

        resendOtpBtn.disabled = true;
        try {
          const response = await fetch(REGISTRATION_API_URL, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              apikey: SUPABASE_ANON_KEY,
              Authorization: `Bearer ${SUPABASE_ANON_KEY}`,
            },
            body: JSON.stringify({
              action: 'resendOTP',
              email,
            }),
          });
          const result = await readJsonSafe(response);
          if (!response.ok) {
            throw new Error(result?.error || result?.message || 'Failed to resend code.');
          }
          showAlert('Verification code resent. Check your email.', 'success');
        } catch (err) {
          showAlert(err?.message || 'Failed to resend code.');
        } finally {
          resendOtpBtn.disabled = false;
        }
      });
    }

    if (otpInputs.length) {
      otpInputs.forEach((input, index) => {
        input.addEventListener('input', (event) => {
          const value = event.target.value.replace(/\\D/g, '');
          event.target.value = value;
          if (value && index < otpInputs.length - 1) {
            otpInputs[index + 1].focus();
          }
        });

        input.addEventListener('keydown', (event) => {
          if (event.key === 'Backspace' && !event.target.value && index > 0) {
            otpInputs[index - 1].focus();
          }
        });

        input.addEventListener('paste', (event) => {
          const paste = (event.clipboardData || window.clipboardData).getData('text');
          if (!paste) return;
          const digits = paste.replace(/\\D/g, '').slice(0, otpInputs.length);
          if (!digits) return;
          event.preventDefault();
          digits.split('').forEach((digit, i) => {
            otpInputs[i].value = digit;
          });
          otpInputs[Math.min(digits.length, otpInputs.length - 1)].focus();
        });
      });
    }
  </script>
</body>
</html>
