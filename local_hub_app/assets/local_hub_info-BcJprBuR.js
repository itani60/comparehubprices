import{r as l,j as s,c as xs,R as fs}from"./localHub-Byr6UtYB.js";import{g as ms,l as _,a as bs,n as B,L as js,b as Ns,R as gs,c as ys,d as ks,e as vs,f as Cs,h as Rs}from"./localHubInfoApi-B062UKbq.js";const hs=[{value:"recent",label:"Most Recent"},{value:"highest",label:"Highest Rated"},{value:"lowest",label:"Lowest Rated"}];function _s(d,o,p){return Math.max(o,Math.min(p,d))}function Ss(d){const o=d.length||0,p=o===0?0:d.reduce((f,m)=>f+(Number(m.rating)||0),0)/o,x={1:0,2:0,3:0,4:0,5:0};return d.forEach(f=>{const m=_s(Math.round(Number(f.rating)||0),1,5);x[m]+=1}),{total:o,avg:p,counts:x}}function Is({rating:d}){return s.jsx("div",{className:"rev-stars","aria-label":`${d} stars`,children:Array.from({length:5},(o,p)=>p<d?s.jsx("i",{className:"fas fa-star"},p):s.jsx("i",{className:"far fa-star"},p))})}function Ls({reviews:d,ratingSummary:o,onReport:p,onHelpful:x,onReportReview:f}){var L;const[m,y]=l.useState("recent"),[h,k]=l.useState(!1),[E,O]=l.useState(()=>new Map),j=l.useRef(null);l.useEffect(()=>{function t(c){j.current&&(j.current.contains(c.target)||k(!1))}return document.addEventListener("click",t),()=>document.removeEventListener("click",t)},[]);const v=l.useMemo(()=>Array.isArray(d)?d:[],[d]),C=l.useMemo(()=>{const t=[...v];return m==="highest"?t.sort((c,u)=>u.rating-c.rating||u.timestamp-c.timestamp):m==="lowest"?t.sort((c,u)=>c.rating-u.rating||u.timestamp-c.timestamp):t.sort((c,u)=>u.timestamp-c.timestamp),t},[v,m]),N=l.useMemo(()=>Ss(v),[v]),S=o&&typeof o.avg=="number"?o.avg:N.avg,I=o&&typeof o.total=="number"?o.total:N.total,F=S?S.toFixed(1):"0.0",U=l.useMemo(()=>{const t=I||1;return[5,4,3,2,1].map(c=>{const u=o&&o.counts?Number(o.counts[c]||0):N.counts[c]||0,b=`${Math.round(u/t*100)}%`;return{star:c,count:u,width:b}})},[o,N,I]);return s.jsxs("section",{className:"collCard",children:[s.jsxs("div",{className:"collHead collHeadRow",children:[s.jsxs("span",{children:[s.jsx("i",{className:"fas fa-star"})," Reviews"]}),s.jsxs("div",{className:"sort-box",ref:j,children:[s.jsx("span",{children:"Sort by:"}),s.jsxs("div",{className:`custom-dropdown ${h?"active":""}`,children:[s.jsxs("div",{className:"dropdown-trigger",role:"button",tabIndex:0,onClick:t=>{t.stopPropagation(),k(c=>!c)},onKeyDown:t=>{(t.key==="Enter"||t.key===" ")&&k(c=>!c)},children:[s.jsx("span",{children:((L=hs.find(t=>t.value===m))==null?void 0:L.label)||"Most Recent"}),s.jsx("i",{className:"fas fa-chevron-down"})]}),s.jsx("div",{className:"dropdown-menu",children:hs.map(t=>s.jsxs("div",{className:`dropdown-item ${t.value===m?"selected":""}`,onClick:()=>{y(t.value),k(!1)},children:[t.label," ",s.jsx("i",{className:"fas fa-check"})]},t.value))})]})]})]}),s.jsxs("div",{className:"rating-summary-card",children:[s.jsxs("div",{className:"summary-left",children:[s.jsx("span",{className:"big-num",children:F}),s.jsx("div",{className:"stars",children:Array.from({length:5},(t,c)=>s.jsx("i",{className:"fas fa-star",style:{color:"#fbbf24"}},c))}),s.jsxs("span",{className:"total-text",children:["Based on ",I," Reviews"]})]}),s.jsx("div",{className:"summary-bars",children:U.map(t=>s.jsxs("div",{className:"bar-row",children:[s.jsxs("span",{className:"bar-label",children:[t.star," ",s.jsx("i",{className:"fas fa-star",style:{color:"#fbbf24",fontSize:9}})]}),s.jsx("div",{className:"bar-bg",children:s.jsx("div",{className:"bar-fill",style:{width:t.width}})}),s.jsx("span",{className:"bar-count",children:t.count})]},t.star))})]}),s.jsx("div",{className:"rev-container",children:C.length?C.map(t=>{const c=E.get(t.id)||0;return s.jsxs("div",{className:"review-row",children:[s.jsx("div",{className:"rev-avatar",children:t.avatarUrl?s.jsx("img",{src:t.avatarUrl,alt:"User"}):t.initials}),s.jsxs("div",{style:{flex:1},children:[s.jsxs("div",{className:"rev-header",children:[s.jsx("span",{className:"rev-name",children:t.name}),s.jsx("span",{className:"rev-date",children:t.dateLabel})]}),s.jsx(Is,{rating:t.rating}),s.jsx("p",{className:"rev-text",children:t.text}),s.jsxs("div",{className:"rev-actions",children:[s.jsxs("button",{type:"button",className:"btn-link-action",onClick:async()=>{try{await(x==null?void 0:x(t.id)),O(u=>{const b=new Map(u);return b.set(t.id,(b.get(t.id)||0)+1),b})}catch{}},children:[s.jsx("i",{className:"far fa-thumbs-up"})," Helpful"," ",s.jsxs("span",{style:{opacity:.7},children:["(",Number(t.helpful||0)+c,")"]})]}),s.jsxs("button",{type:"button",className:"btn-link-action",onClick:()=>f==null?void 0:f(t.id),children:[s.jsx("i",{className:"far fa-flag"})," Report"]})]})]})]},t.id)}):s.jsx("div",{style:{padding:14,color:"var(--muted)",fontWeight:800},children:"No reviews yet."})})]})}function Bs(){var W,T,z,P,$,K,V,G,Y,q,J,Q,X,Z,w,M,ss,as,es,ts,ns;const[d,o]=l.useState(!0),[p,x]=l.useState(""),[f,m]=l.useState(null),[y,h]=l.useState(""),[k,E]=l.useState(!1),[O,j]=l.useState(!1),[v,C]=l.useState(!1),[N,S]=l.useState(""),[I,F]=l.useState(!1),[U,L]=l.useState(!1),[t,c]=l.useState([]),[u,b]=l.useState(0);function A(e,n=0){c(e),b(n),L(!0)}l.useEffect(()=>{let e=null;if(y)return e=setTimeout(()=>h(""),4e3),()=>{e&&clearTimeout(e)}},[y]);async function R({signal:e}={}){const n=ms();if(!n){m(null),o(!1);return}o(!0),x("");try{const i=await Cs({businessId:n,signal:e});m(Rs(i))}catch(i){if(e!=null&&e.aborted)return;m(null),x(i instanceof Error?i.message:"Failed to load business details.")}finally{if(e!=null&&e.aborted)return;o(!1)}}if(l.useEffect(()=>{const e=new AbortController;return R({signal:e.signal}),()=>e.abort()},[]),!ms())return s.jsx("div",{className:"page",children:s.jsx("div",{className:"frame",children:s.jsxs("section",{className:"aboutCard",style:{borderColor:"#fecaca"},children:[s.jsx("div",{className:"aboutHead",style:{color:"#b91c1c"},children:"Missing business_id"}),s.jsx("div",{className:"aboutBody",children:"Open this page with `?business_id=...`."})]})})});const a=f;return s.jsxs("div",{className:"page",children:[s.jsxs("div",{className:"frame",children:[y?s.jsx("div",{style:{marginBottom:12,fontWeight:900,color:"#0f172a"},children:y}):null,p?s.jsxs("section",{className:"aboutCard",style:{borderColor:"#fecaca"},children:[s.jsx("div",{className:"aboutHead",style:{color:"#b91c1c"},children:"Failed to load business details"}),s.jsx("div",{className:"aboutBody",children:p})]}):null,s.jsxs("section",{className:"topCard",children:[s.jsx("div",{className:"topRow",children:s.jsxs("div",{className:"brand",children:[s.jsx("div",{className:"logo",children:s.jsx("img",{src:(a==null?void 0:a.logoUrl)||"",alt:"Logo"})}),s.jsxs("div",{className:"btxt",children:[s.jsx("h1",{children:(a==null?void 0:a.businessName)||(d?"Loading...":"Business")}),s.jsxs("div",{className:"addr",children:[s.jsxs("svg",{className:"pin",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("path",{d:"M12 21s7-4.35 7-11a7 7 0 1 0-14 0c0 6.65 7 11 7 11z"}),s.jsx("circle",{cx:"12",cy:"10",r:"2.5"})]}),(a==null?void 0:a.addressLine)||(d?"Loading...":"Address not provided")]}),s.jsxs("div",{className:"stats-row",children:[s.jsxs("div",{className:"stats-item",children:[s.jsx("span",{className:"stats-val",children:((W=a==null?void 0:a.stats)==null?void 0:W.followers)??0})," Followers"]}),s.jsxs("div",{className:"stats-item",children:[s.jsx("span",{className:"stats-val",children:(T=a==null?void 0:a.stats)!=null&&T.reviewCount?a.stats.averageRating.toFixed(1):"0.0"})," ","Rating"]}),s.jsxs("div",{className:"stats-item",children:[s.jsx("span",{className:"stats-val",children:((z=a==null?void 0:a.stats)==null?void 0:z.likes)??0})," Likes"]}),s.jsxs("div",{className:"stats-item",children:[s.jsx("span",{className:"stats-val",children:((P=a==null?void 0:a.stats)==null?void 0:P.reviewCount)??0})," Reviews"]})]})]})]})}),s.jsxs("div",{className:"actions",children:[s.jsxs("button",{type:"button",className:"btn primary",disabled:!(a!=null&&a.businessId)||d,onClick:async()=>{var e;if(a!=null&&a.businessId)try{const n=!((e=a==null?void 0:a.viewer)!=null&&e.isFollowing);await _({action:n?"follow_business":"unfollow_business",payload:{business_id:a.businessId}}),h(n?"Following":"Unfollowed"),await R()}catch(n){h(n instanceof Error?n.message:"Failed to update follow.")}},children:[s.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:s.jsx("path",{d:"M20 6L9 17l-5-5"})}),($=a==null?void 0:a.viewer)!=null&&$.isFollowing?"Following":"Follow"]}),s.jsxs("button",{type:"button",className:"btn",onClick:()=>E(!0),children:[s.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:s.jsx("path",{d:"M12 17.3l-6.2 3.7 1.7-7L2 8.9l7.2-.6L12 2l2.8 6.3 7.2.6-5.5 5.1 1.7 7z"})}),"Rate"]}),s.jsxs("a",{href:bs({recipientId:a==null?void 0:a.businessId,recipientName:a==null?void 0:a.businessName}),className:"btn",children:[s.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:s.jsx("path",{d:"M21 15a4 4 0 0 1-4 4H7l-4 3V7a4 4 0 0 1 4-4h10a4 4 0 0 1 4 4z"})}),"Chat"]}),s.jsxs("button",{type:"button",className:"btn",onClick:()=>alert("Share"),children:[s.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("circle",{cx:"18",cy:"5",r:"3"}),s.jsx("circle",{cx:"6",cy:"12",r:"3"}),s.jsx("circle",{cx:"18",cy:"19",r:"3"}),s.jsx("path",{d:"M8.6 13.5l6.8 3.9M15.4 6.6L8.6 10.5"})]}),"Share"]}),s.jsxs("button",{type:"button",className:"btn danger",onClick:()=>j(!0),children:[s.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("path",{d:"M4 22V4"}),s.jsx("path",{d:"M4 4h13l-1.5 4L17 12H4"})]}),"Report"]})]})]}),s.jsxs("section",{className:"aboutCard",children:[s.jsxs("div",{className:"aboutHead",children:["About ",(a==null?void 0:a.businessName)||"Business"]}),s.jsx("div",{className:"aboutBody",children:d?"Loading...":(a==null?void 0:a.aboutText)||"No description provided."}),s.jsxs("div",{style:{marginTop:12},children:[s.jsx("div",{className:"aboutHead",children:"Connect with us"}),s.jsxs("div",{className:"social-flex",style:{padding:0,gap:10},children:[s.jsx("a",{href:B("facebook",(K=a==null?void 0:a.social)==null?void 0:K.facebook),className:"social-item fb",onClick:e=>{var n;(n=a==null?void 0:a.social)!=null&&n.facebook||e.preventDefault()},style:{display:(V=a==null?void 0:a.social)!=null&&V.facebook?"":"none"},target:"_blank",rel:"noopener",children:s.jsx("i",{className:"fab fa-facebook-f"})}),s.jsx("a",{href:B("twitter",((G=a==null?void 0:a.social)==null?void 0:G.instagram)||((Y=a==null?void 0:a.social)==null?void 0:Y.twitter)),className:"social-item tw",onClick:e=>{var n,i;(n=a==null?void 0:a.social)!=null&&n.instagram||(i=a==null?void 0:a.social)!=null&&i.twitter||e.preventDefault()},style:{display:(q=a==null?void 0:a.social)!=null&&q.instagram||(J=a==null?void 0:a.social)!=null&&J.twitter?"":"none"},target:"_blank",rel:"noopener",children:s.jsx("i",{className:(Q=a==null?void 0:a.social)!=null&&Q.instagram?"fab fa-instagram":"fa-brands fa-x-twitter"})}),s.jsx("a",{href:B("whatsapp",(X=a==null?void 0:a.social)==null?void 0:X.whatsapp),className:"social-item wa",onClick:e=>{var n;(n=a==null?void 0:a.social)!=null&&n.whatsapp||e.preventDefault()},style:{display:(Z=a==null?void 0:a.social)!=null&&Z.whatsapp?"":"none"},target:"_blank",rel:"noopener",children:s.jsx("i",{className:"fab fa-whatsapp"})}),s.jsx("a",{href:B("tiktok",(w=a==null?void 0:a.social)==null?void 0:w.tiktok),className:"social-item tt",onClick:e=>{var n;(n=a==null?void 0:a.social)!=null&&n.tiktok||e.preventDefault()},style:{display:(M=a==null?void 0:a.social)!=null&&M.tiktok?"":"none"},target:"_blank",rel:"noopener",children:s.jsx("i",{className:"fab fa-tiktok"})}),s.jsx("a",{href:B("instagram",(ss=a==null?void 0:a.social)==null?void 0:ss.instagram),className:"social-item ig",onClick:e=>{var n;(n=a==null?void 0:a.social)!=null&&n.instagram||e.preventDefault()},style:{display:(as=a==null?void 0:a.social)!=null&&as.instagram?"":"none"},target:"_blank",rel:"noopener",children:s.jsx("i",{className:"fab fa-instagram"})})]})]})]}),s.jsxs("section",{className:"collCard",children:[s.jsx("div",{className:"collHead",children:"Featured Collections"}),s.jsx("div",{className:"prodGrid",children:((a==null?void 0:a.products)||[]).map(e=>s.jsxs("div",{className:"prodCard",role:"group",children:[s.jsx("div",{className:"prodImg",style:{cursor:"zoom-in"},onClick:()=>A(e.images,0),role:"button",tabIndex:0,onKeyDown:n=>{(n.key==="Enter"||n.key===" ")&&A(e.images,0)},children:s.jsx("img",{src:e.cover,alt:e.title})}),s.jsxs("div",{className:"prodInfo",children:[s.jsx("div",{className:"prodName",children:e.title}),s.jsx("div",{className:"product-meta-row",children:s.jsx("div",{className:"product-actions",children:(()=>{var ls,os,ds;const n=e.title||"Product",i=((ls=a==null?void 0:a.productReactions)==null?void 0:ls[n])||{},rs=Number(i==null?void 0:i.total)||0,H=i!=null&&i.by_reaction&&typeof i.by_reaction=="object"?i.by_reaction:{},D=((ds=(os=a==null?void 0:a.viewer)==null?void 0:os.productReactions)==null?void 0:ds[n])||"",cs=["ðŸ‘","â¤ï¸","ðŸ”¥"],ps=cs.map(r=>({reaction:r,count:Number((H==null?void 0:H[r])??0)||0})).filter(r=>r.count>0).sort((r,g)=>g.count-r.count).slice(0,3).map(r=>r.reaction),is=rs>0;return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"reaction-container",children:[s.jsx("div",{className:"reactions-popover small-popover",children:cs.map(r=>s.jsx("span",{className:`emoji ${D===r?"active":""}`,onClick:async g=>{g.preventDefault(),g.stopPropagation();try{await _({action:"react_product",payload:{business_id:a==null?void 0:a.businessId,product_key:n,reaction:r,force_set:!0}}),await R()}catch(us){h(us instanceof Error?us.message:"Failed to react.")}},title:r,"aria-label":`React ${r}`,children:r},r))}),s.jsxs("div",{className:"btn-with-count",children:[s.jsx("button",{type:"button",className:"small-btn",onClick:async r=>{r.preventDefault(),r.stopPropagation();try{await _({action:"react_product",payload:{business_id:a==null?void 0:a.businessId,product_key:n,reaction:D||"â¤ï¸",force_set:!1}}),await R()}catch(g){h(g instanceof Error?g.message:"Failed to react.")}},"aria-label":"React",children:D?s.jsx("span",{className:"my-reaction-emoji",children:D}):s.jsx("i",{className:"far fa-heart"})}),is?s.jsx("div",{className:"emoji-stack",children:ps.map(r=>s.jsx("span",{children:r},r))}):null,is?s.jsx("span",{className:"reaction-count",children:rs}):null]})]}),s.jsx("button",{type:"button",className:"small-btn",title:"Share",onClick:r=>{r.preventDefault(),r.stopPropagation(),h("Share not implemented yet.")},children:s.jsx("i",{className:"fas fa-share-nodes"})})]})})()})})]})]},e.title))})]}),s.jsx(js,{address:(a==null?void 0:a.addressLine)||""}),s.jsx(Ls,{reviews:(a==null?void 0:a.reviews)||[],ratingSummary:{total:((es=a==null?void 0:a.stats)==null?void 0:es.reviewCount)??0,avg:((ts=a==null?void 0:a.stats)==null?void 0:ts.averageRating)??0,counts:((ns=a==null?void 0:a.stats)==null?void 0:ns.ratingBreakdown)||null},onReport:()=>j(!0),onHelpful:async e=>{e&&(await _({action:"set_review_helpful",payload:{review_id:e,helpful:!0}}),await R())},onReportReview:e=>{S(String(e||"")),C(!0)}})]}),s.jsx(Ns,{open:U,slides:t,index:u,onPrev:()=>b(e=>(e-1+t.length)%t.length),onNext:()=>b(e=>(e+1)%t.length),onClose:()=>L(!1)}),s.jsx(gs,{open:v,onClose:()=>C(!1),busy:I,onSubmit:async({reason:e,details:n})=>{if(N){F(!0);try{await _({action:"report_review",payload:{review_id:N,reason:e||"other",details:n||""}}),h("Review reported. Thank you."),C(!1),S("")}catch(i){h(i instanceof Error?i.message:"Failed to submit report.")}finally{F(!1)}}}}),s.jsx(ys,{open:O,onClose:()=>j(!1),businessId:(a==null?void 0:a.businessId)||"",onSubmit:async({businessId:e,reason:n,details:i})=>{await ks({businessId:e,reportKind:"business",reason:n,details:i}),h("Report received. Our team will review this business shortly.")}}),s.jsx(vs,{open:k,onClose:()=>E(!1),businessId:(a==null?void 0:a.businessId)||"",onSubmit:async({businessId:e,rating:n,content:i})=>{await _({action:"upsert_review",payload:{business_id:e,rating:n,content:i}}),h("Success! Your review has been submitted."),await R()}})]})}xs.createRoot(document.getElementById("root")).render(s.jsx(fs.StrictMode,{children:s.jsx(Bs,{})}));
