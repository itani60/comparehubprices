import{r,j as e,s as U,f as q,c as J,R as X}from"./localHub-6K9F_3ke.js";function Y({slides:t}){const[c,o]=r.useState(0),g=r.useMemo(()=>Array.isArray(t)?t:[],[t]),u=r.useRef(null);if(g.length===0)return null;const p=g.length,s=100/p;return r.useEffect(()=>{o(0)},[p]),r.useEffect(()=>{if(p<=1)return;function m(){u.current||(u.current=setInterval(()=>{o(v=>(v+1)%p)},1e4))}function f(){u.current&&(clearInterval(u.current),u.current=null)}return m(),()=>f()},[p]),e.jsxs("div",{className:"carousel",onMouseEnter:()=>{u.current&&(clearInterval(u.current),u.current=null)},onMouseLeave:()=>{p<=1||u.current||(u.current=setInterval(()=>{o(m=>(m+1)%p)},1e4))},children:[e.jsx("div",{className:"carousel-inner",style:{width:`${p*100}%`,transform:`translateX(-${c*s}%)`},children:g.map((m,f)=>e.jsx("div",{className:"carousel-slide",style:{width:`${s}%`,flex:`0 0 ${s}%`},children:e.jsx("img",{src:m.url,alt:m.alt,onError:v=>{var x;v.currentTarget.onerror=null;const y=m&&typeof m.fallbackUrl=="string"?m.fallbackUrl:((x=g[0])==null?void 0:x.url)||"";v.currentTarget.src=y}})},`${m.url}-${f}`))}),e.jsx("div",{className:"carousel-dots",children:g.map((m,f)=>e.jsx("span",{className:`dot ${f===c?"active":""}`,onClick:()=>o(f)},f))})]})}function Q(t){const c=Number(t);if(!Number.isFinite(c)||c<=0)return null;const o=Math.max(0,Math.min(5,Math.round(c)));return Array.from({length:o},(g,u)=>e.jsx("i",{className:"fa-solid fa-star"},u))}function ee({business:t}){const c=Number(t.rating),o=Number.isFinite(c)&&c>0,g=r.useMemo(()=>`https://ui-avatars.com/api/?name=${encodeURIComponent(t.name||"")}&background=random&color=fff`,[t.name]),u=r.useMemo(()=>{const s=typeof t.logo=="string"?t.logo.trim():"";return s.length?s:g},[g,t.logo]),p=r.useMemo(()=>{const s=(t==null?void 0:t.name)||"Business",m=U({title:s,subtitle:"No product image"}),f=U({title:s,subtitle:"Image unavailable"}),v=Array.isArray(t.images)?t.images.filter(l=>typeof l=="string"&&l.trim().length>0):typeof t.image=="string"&&t.image.trim().length>0?[t.image.trim()]:[],y=Array.from(new Set(v)),x=[];for(let l=0;l<Math.min(4,y.length);l++)x.push(y[l]);for(;x.length<4;)x.push(m);return x.map((l,k)=>({url:l,alt:`${s} product image`,fallbackUrl:f,isPlaceholder:l===m}))},[t.image,t.images,t.name]);return e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"biz-header",children:[e.jsx("img",{src:u,alt:`${t.name} logo`,className:"biz-avatar",onError:s=>{s.currentTarget.onerror=null,s.currentTarget.src=g}}),e.jsxs("div",{children:[e.jsx("div",{className:"biz-name",children:t.name}),e.jsxs("div",{className:"biz-rating",children:[o?Q(c):e.jsx("span",{style:{fontWeight:800,opacity:.7},children:"No ratings yet"}),o?e.jsxs("span",{children:["(",c.toFixed(1),")"]}):null]}),e.jsxs("div",{className:"badge",children:[e.jsx("i",{className:"fa-solid fa-tags"}),t.category]})]})]}),e.jsx(Y,{slides:p}),e.jsxs("div",{className:"biz-address",children:[e.jsx("i",{className:"fa-solid fa-location-dot",style:{alignSelf:"flex-start",marginTop:3}}),e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:600},children:t.address}),e.jsxs("div",{style:{fontSize:"0.8em",opacity:.8},children:[t.suburb,", ",t.city]}),e.jsx("div",{style:{fontSize:"0.8em",opacity:.8},children:t.province})]})]}),e.jsx("a",{href:`/local_hub_app/local_hub_info.html?business_id=${encodeURIComponent(t.id||"")}`,className:"view-details-btn",onClick:s=>{var f,v;(v=(f=window.matchMedia)==null?void 0:f.call(window,"(max-width: 640px)"))!=null&&v.matches&&(s.preventDefault(),window.location.href=`/local_hub_app/local_hub_info_mobile.html?business_id=${encodeURIComponent(t.id||"")}`)},children:e.jsx("span",{children:"View Details"})})]})}function O(t){return typeof t=="string"?{value:t,label:t}:t}function R({id:t,label:c,value:o,items:g,allOption:u,onChange:p,containerClassName:s="filter-box",labelClassName:m="filter-label"}){const f=r.useRef(null),[v,y]=r.useState(!1),x=r.useMemo(()=>(g||[]).map(O),[g]),l=r.useMemo(()=>O(u),[u]),k=r.useMemo(()=>{const h=x.find(N=>N.value===o);return(h==null?void 0:h.label)??l.label},[l.label,x,o]);r.useEffect(()=>{function h(N){f.current&&(f.current.contains(N.target)||y(!1))}return document.addEventListener("click",h),()=>document.removeEventListener("click",h)},[]);function S(h){p(h),y(!1)}return e.jsxs("div",{className:s,style:{zIndex:v?3:1},children:[c?e.jsx("label",{className:m,htmlFor:t,children:c}):null,e.jsxs("div",{className:`custom-dropdown ${v?"active":""}`,ref:f,children:[e.jsxs("button",{id:t,type:"button",className:"custom-dropdown-btn","aria-haspopup":"listbox","aria-expanded":v,onClick:h=>{h.stopPropagation(),y(N=>!N)},children:[e.jsx("span",{children:k}),e.jsx("i",{className:"fas fa-chevron-down"})]}),e.jsxs("div",{className:"custom-dropdown-menu",role:"listbox","aria-label":c,children:[e.jsx("div",{className:`custom-dropdown-item ${o===l.value?"selected":""}`,role:"option","aria-selected":o===l.value,onClick:()=>S(l.value),children:l.label}),x.map(h=>e.jsx("div",{className:`custom-dropdown-item ${o===h.value?"selected":""}`,role:"option","aria-selected":o===h.value,onClick:()=>S(h.value),children:h.label},h.value))]})]})]})}const I={limpopo:["Tzaneen","Louis Trichardt","Polokwane","Lephalale","Mokopane","Modimolle","Musina","Phalaborwa","Bela-Bela","Thohoyandou","Thabazimbi","Giyani","Lebowakgomo","Seshego","Burgersfort","Malamulele","Vuwani","Sibasa","Mphephu"],gauteng:["Johannesburg","Vereeniging","Heidelberg","Pretoria","Krugersdorp","Centurion","Thokoza","Randfontein","Carletonville","Alberton","Vanderbijlpark","Soweto","Springs","Thembisa","Boksburg","Randburg","Benoni","Bophelong","Alexandra","Mamelodi","Tsakani","Duduza","Refilwe","Vosloorus","Wattville","Sebokeng","Hammanskraal","Evaton","Khutsong","Katlehong","Kagiso","Zithobeni","Reiger Park","Midrand","Sharpeville","Muldersdrift","Roodepoort","Meyerton"],"western-cape":["Cape Town","Stellenbosch","Paarl","Franschhoek","George","Mossel Bay","Knysna","Hermanus","Worcester","Somerset West","Bellville","Claremont"],"kwazulu-natal":["Durban","Pietermaritzburg","Umhlanga","Pinetown","Richards Bay","Newcastle","Ladysmith","Empangeni","Ballito","Margate"],"eastern-cape":["Gqeberha","Port Elizabeth","East London","Mthatha","Grahamstown","King William's Town","Jeffreys Bay","Uitenhage"],mpumalanga:["Mbombela","Nelspruit","Witbank","eMalahleni","Middelburg","Secunda","White River","Hazyview"],"north-west":["Mahikeng","Rustenburg","Klerksdorp","Potchefstroom","Brits","Zeerust","Lichtenburg"],"free-state":["Bloemfontein","Welkom","Sasolburg","Bethlehem","Kroonstad","Parys","Harrismith"],"northern-cape":["Kimberley","Upington","Springbok","Kuruman","De Aar","Port Nolloth"]},D=50,te=[{value:"relevance",label:"Relevance"},{value:"rating_desc",label:"Highest Rated"},{value:"reviews_desc",label:"Most Reviews"},{value:"name_asc",label:"Name (A-Z)"}];function K(t){return String(t||"").trim().toLowerCase().replace(/\s+/g,"-")}function ae(t){return String(t||"").split("-").filter(Boolean).map(c=>c.charAt(0).toUpperCase()+c.slice(1)).join(" ")}function re(){const[t,c]=r.useState([]),[o,g]=r.useState(!0),[u,p]=r.useState(!1),[s,m]=r.useState(""),[f,v]=r.useState(!1),[y,x]=r.useState(""),[l,k]=r.useState(""),[S,h]=r.useState(""),[N,W]=r.useState(""),[C,H]=r.useState("relevance"),[L,E]=r.useState(0),[P,_]=r.useState(!0),z=r.useRef(null),A=r.useRef(!1);async function $({nextOffset:a=0,append:d=!1,signal:n}={}){if(!A.current){A.current=!0,d?p(!0):g(!0);try{const i=await q({limit:D,offset:a,signal:n}),b=Array.isArray(i)?i:[];_(b.length===D),d?(c(j=>{const M=new Set((j||[]).map(w=>w==null?void 0:w.id).filter(Boolean)),B=[...j||[]];for(const w of b)!(w!=null&&w.id)||M.has(w.id)||B.push(w);return B}),E(j=>j+b.length)):(c(b),E(b.length))}catch(i){if(n!=null&&n.aborted)return;d||c([]),m(i instanceof Error?i.message:"Failed to load businesses."),_(!1)}finally{A.current=!1,d||g(!1),p(!1)}}}r.useEffect(()=>{const a=new AbortController;return m(""),_(!0),E(0),$({nextOffset:0,append:!1,signal:a.signal}),()=>a.abort()},[]),r.useEffect(()=>{if(!z.current||!P)return;const a=z.current,d=new IntersectionObserver(n=>{const i=n[0];i!=null&&i.isIntersecting&&(o||u||s||$({nextOffset:L,append:!0}))},{root:null,rootMargin:"600px 0px",threshold:0});return d.observe(a),()=>d.disconnect()},[P,s,o,u,L]);const V=r.useMemo(()=>Object.keys(I).sort().map(a=>({value:a,label:ae(a)})),[]),G=r.useMemo(()=>[...new Set(t.map(a=>a.category))].filter(Boolean).sort(),[t]),T=r.useMemo(()=>[...new Set(Object.values(I).flat())].filter(Boolean).sort(),[]),Z=r.useMemo(()=>{if(!l){const d=T,n=[...new Set(t.map(i=>i.city))].filter(Boolean).sort();return[...new Set([...d,...n])].sort()}const a=I[l]||[];return a.length?a.slice().sort():[...new Set(t.filter(d=>K(d.province)===l).map(d=>d.city))].filter(Boolean).sort()},[T,t,l]),F=r.useMemo(()=>{const a=y.trim().toLowerCase();let d=t.filter(n=>{const i=!a||n.name.toLowerCase().includes(a)||(n.tags||"").toLowerCase().includes(a),b=!l||K(n.province)===l,j=!S||n.city===S,M=!N||n.category===N;return i&&b&&j&&M});return C==="rating_desc"?d=[...d].sort((n,i)=>{const b=(n==null?void 0:n.rating)==null?NaN:Number(n.rating),j=(i==null?void 0:i.rating)==null?NaN:Number(i.rating),M=Number.isFinite(b)?b:-1;return(Number.isFinite(j)?j:-1)-M}):C==="reviews_desc"?d=[...d].sort((n,i)=>{const b=(n==null?void 0:n.reviews)==null?NaN:Number(n.reviews),j=(i==null?void 0:i.reviews)==null?NaN:Number(i.reviews),M=Number.isFinite(b)?b:-1;return(Number.isFinite(j)?j:-1)-M}):C==="name_asc"&&(d=[...d].sort((n,i)=>n.name.localeCompare(i.name))),d},[t,N,S,l,y,C]);return e.jsxs("div",{className:"container",children:[e.jsx("div",{className:"header-logo",children:e.jsx("img",{src:"/local_hub_app/logo/localhub.png",alt:"LocalHub"})}),s?e.jsxs("div",{className:"empty-state",style:{display:"block"},children:[e.jsx("i",{className:"fas fa-triangle-exclamation",style:{fontSize:"3rem",marginBottom:20,opacity:.2}}),e.jsx("h3",{children:"Failed to load businesses"}),e.jsx("p",{children:s}),e.jsx("p",{style:{opacity:.7,marginTop:10},children:"Check your internet connection and refresh the page."})]}):null,e.jsxs("div",{className:`search-sort-grid ${f?"":"filters-hidden"}`,children:[e.jsxs("div",{className:"search-box",children:[e.jsxs("div",{className:"input-group",style:{flex:1},children:[e.jsx("input",{type:"text",className:"form-control",value:y,onChange:a=>x(a.target.value),placeholder:"Search businesses, services...",disabled:o}),e.jsx("button",{type:"button",className:"btn-search","aria-label":"Search",children:e.jsx("i",{className:"fas fa-search"})})]}),e.jsx("div",{className:"filter-row",children:e.jsxs("button",{type:"button",className:`filter-icon-btn ${f?"active":""}`,title:"Toggle Filters",onClick:()=>v(a=>!a),disabled:o,children:[e.jsx("i",{className:"fas fa-filter"})," Filters"]})})]}),e.jsxs("div",{className:"filters-row",children:[e.jsx(R,{id:"provinceDropdown",label:"Province:",value:l,allOption:{value:"",label:"All Provinces"},items:V,onChange:a=>{k(a),h("")}}),e.jsx(R,{id:"locationDropdown",label:"Location:",value:S,allOption:{value:"",label:"All Locations"},items:Z.map(a=>({value:a,label:a})),onChange:h}),e.jsx(R,{id:"categoryDropdown",label:"Category:",value:N,allOption:{value:"",label:"All Categories"},items:G.map(a=>({value:a,label:a})),onChange:W}),e.jsx(R,{id:"sortDropdown",label:"Sort by:",value:C,allOption:{value:"relevance",label:"Relevance"},items:te.filter(a=>a.value!=="relevance"),onChange:H,containerClassName:"sort-box",labelClassName:"sort-label"})]})]}),e.jsxs("div",{className:"business-grid",children:[o?e.jsxs("div",{className:"empty-state",style:{display:"block"},children:[e.jsx("i",{className:"fas fa-spinner",style:{fontSize:"3rem",marginBottom:20,opacity:.2}}),e.jsx("h3",{children:"Loading businesses..."}),e.jsx("p",{children:"Please wait a moment."})]}):null,!o&&!s?F.map(a=>e.jsx(ee,{business:a},a.id)):null,!o&&!s&&F.length===0?e.jsxs("div",{className:"empty-state",style:{display:"block"},children:[e.jsx("i",{className:"fas fa-search",style:{fontSize:"3rem",marginBottom:20,opacity:.2}}),e.jsx("h3",{children:"No results found"}),e.jsx("p",{children:"Try adjusting your search or filters."})]}):null]}),!o&&!s?e.jsxs("div",{className:"load-more-wrap",children:[u?e.jsxs("div",{className:"load-more-status",children:[e.jsx("i",{className:"fas fa-spinner fa-spin"})," Loading more..."]}):P?e.jsx("button",{type:"button",className:"load-more-btn",onClick:()=>$({nextOffset:L,append:!0}),children:"Load more"}):t.length?e.jsx("div",{className:"load-more-status",children:"Youâ€™re all caught up."}):null,e.jsx("div",{ref:z,style:{height:1}})]}):null]})}J.createRoot(document.getElementById("root")).render(e.jsx(X.StrictMode,{children:e.jsx(re,{})}));
