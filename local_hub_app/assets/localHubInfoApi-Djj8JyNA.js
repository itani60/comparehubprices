import{r as h,j as s,s as P,g as L}from"./localHub-8HcfkriN.js";function q({open:t,slides:e,index:a,onPrev:r,onNext:i,onClose:l}){const o=h.useMemo(()=>Array.isArray(e)?e:[],[e]),c=o[a]||o[0],m=o.length>1,d=h.useRef("");return h.useEffect(()=>{if(!t)return;d.current=document.body.style.overflow||"",document.body.style.overflow="hidden";function u(p){p.key==="Escape"&&(l==null||l()),m&&(p.key==="ArrowRight"&&(i==null||i()),p.key==="ArrowLeft"&&(r==null||r()))}return document.addEventListener("keydown",u),()=>{document.removeEventListener("keydown",u),document.body.style.overflow=d.current,d.current=""}},[m,l,i,r,t]),t?s.jsxs("div",{className:"modal-overlay active",onClick:l,role:"dialog","aria-modal":"true",children:[s.jsx("button",{type:"button",className:"lightbox-close",id:"closeLightbox",onClick:u=>{u.stopPropagation(),l==null||l()},"aria-label":"Close",children:s.jsx("i",{className:"fas fa-times"})}),m?s.jsxs(s.Fragment,{children:[s.jsx("button",{type:"button",className:"lightbox-nav prev",onClick:u=>{u.stopPropagation(),r==null||r()},"aria-label":"Previous",children:s.jsx("i",{className:"fas fa-chevron-left"})}),s.jsx("button",{type:"button",className:"lightbox-nav next",onClick:u=>{u.stopPropagation(),i==null||i()},"aria-label":"Next",children:s.jsx("i",{className:"fas fa-chevron-right"})})]}):null,s.jsx("div",{className:"lightbox-content",onClick:u=>u.stopPropagation(),children:s.jsx("img",{src:c,alt:"Preview"})}),m?s.jsxs("div",{className:"lightbox-counter",id:"lightboxCounter",children:[Math.min(a+1,o.length)," / ",o.length||1]}):null]}):null}function K({open:t,onClose:e,businessId:a,onSubmit:r}){const[i,l]=h.useState(0),[o,c]=h.useState(""),[m,d]=h.useState(!1),[u,p]=h.useState(""),w=h.useMemo(()=>i>0&&!!a&&!m,[a,m,i]);return t?s.jsx("div",{className:"modal-overlay active",id:"rateModal",onClick:e,role:"dialog","aria-modal":"true","aria-label":"Rate your experience",children:s.jsxs("div",{className:"modal-content rate-modal",onClick:b=>b.stopPropagation(),children:[s.jsx("button",{type:"button",className:"modal-close",onClick:e,"aria-label":"Close",children:s.jsx("i",{className:"fas fa-times"})}),s.jsxs("div",{className:"modal-header",children:[s.jsx("h3",{className:"modal-title",style:{color:"var(--text)"},children:"Rate your experience"}),s.jsx("p",{className:"modal-subtitle",children:"We appreciate your feedback!"})]}),s.jsxs("div",{className:"modal-body",children:[s.jsx("div",{className:"rating-stars",id:"starContainer",children:Array.from({length:5},(b,j)=>{const v=j+1,_=v<=i;return s.jsx("i",{className:`fas fa-star${_?" active":""}`,"data-value":v,role:"button",tabIndex:0,"aria-label":`${v} star`,onClick:()=>l(v),onKeyDown:f=>{(f.key==="Enter"||f.key===" ")&&l(v)}},v)})}),s.jsx("textarea",{className:"report-textarea",value:o,onChange:b=>c(b.target.value),placeholder:"Write your thoughts here...",id:"reviewText",style:{height:120}}),u?s.jsx("div",{className:"rate-modal-error",children:u}):null,s.jsx("button",{type:"button",className:"btn-submit",id:"submitReview",disabled:!w,onClick:async()=>{if(a){d(!0),p("");try{await(r==null?void 0:r({businessId:a,rating:i,content:o})),l(0),c(""),e==null||e()}catch(b){p(b instanceof Error?b.message:"Failed to submit review.")}finally{d(!1)}}},children:m?"Posting...":"Post Review"})]})]})}):null}const I=[{value:"spam",label:"Spam or misleading content"},{value:"inappropriate",label:"Inappropriate content"},{value:"fraud",label:"Fraud or scam activity"},{value:"other",label:"Other issues"}];function G({open:t,onClose:e,businessId:a,onSubmit:r}){const[i,l]=h.useState("spam"),[o,c]=h.useState(""),[m,d]=h.useState(null),[u,p]=h.useState(""),[w,b]=h.useState(!1),[j,v]=h.useState(""),_=h.useMemo(()=>!!i&&!!a&&!w,[a,w,i]);return t?s.jsx("div",{className:"modal-overlay active",id:"reportModal",onClick:e,role:"dialog","aria-modal":"true","aria-label":"Report Business",children:s.jsxs("div",{className:"modal-content report-modal",onClick:f=>f.stopPropagation(),children:[s.jsx("button",{type:"button",className:"modal-close",onClick:e,"aria-label":"Close",children:s.jsx("i",{className:"fas fa-times"})}),s.jsxs("div",{className:"modal-header",children:[s.jsx("h3",{className:"modal-title",children:"Report Business"}),s.jsx("p",{className:"modal-subtitle",children:"Help us understand what's happening."})]}),s.jsxs("div",{className:"modal-body",children:[s.jsx("div",{className:"report-options",children:I.map(f=>s.jsxs("label",{className:`report-option ${i===f.value?"selected":""}`,children:[s.jsx("input",{type:"radio",name:"report_reason",value:f.value,checked:i===f.value,onChange:()=>l(f.value)}),s.jsx("span",{className:"report-radio-custom"}),s.jsx("span",{children:f.label})]},f.value))}),s.jsx("textarea",{className:"report-textarea",placeholder:"Provide additional details (optional)...",id:"reportDetails",value:o,onChange:f=>c(f.target.value)}),s.jsxs("div",{className:"upload-container",children:[s.jsxs("div",{className:"upload-box",id:"uploadBox",children:[s.jsx("i",{className:"fas fa-camera"}),s.jsx("p",{children:"Tap to upload evidence"}),s.jsx("input",{type:"file",id:"reportImage",accept:"image/*",onChange:f=>{var g;const k=((g=f.target.files)==null?void 0:g[0])||null;if(d(k),v(""),!k){p("");return}const y=new FileReader;y.onload=A=>{var C;return p(String(((C=A.target)==null?void 0:C.result)||""))},y.readAsDataURL(k)}})]}),s.jsxs("div",{className:"upload-preview",id:"imagePreview",style:{display:u?"block":"none"},children:[s.jsx("img",{src:u||"",alt:"preview",id:"previewImg"}),s.jsx("button",{type:"button",className:"remove-img",id:"removeImg","aria-label":"Remove image",onClick:()=>{d(null),p("")},children:s.jsx("i",{className:"fas fa-times"})})]})]}),j?s.jsx("div",{className:"report-modal-error",children:j}):null,s.jsx("button",{type:"button",className:"btn-report-submit",id:"submitReport",disabled:!_,onClick:async()=>{if(!a)return;const k=!!m?" (evidence attached in UI)":"";b(!0),v("");try{await(r==null?void 0:r({businessId:a,reason:i,details:`${o}${k}`.trim()})),c(""),d(null),p(""),e==null||e()}catch(y){v(y instanceof Error?y.message:"Failed to submit report.")}finally{b(!1)}},children:w?"Submitting...":"Submit Report"})]})]})}):null}function J({address:t}){const e=h.useMemo(()=>`https://www.google.com/maps?q=${encodeURIComponent(t||"Johannesburg, Gauteng")}&output=embed`,[t]);return s.jsxs("section",{className:"collCard",children:[s.jsxs("div",{className:"collHead",children:[s.jsx("i",{className:"fas fa-map-marked-alt"})," Our Location"]}),s.jsx("div",{className:"map-box",children:s.jsx("iframe",{src:e,width:"100%",height:"100%",style:{border:0},allowFullScreen:!0,loading:"lazy",referrerPolicy:"no-referrer-when-downgrade",title:"Map"})})]})}const M=[{value:"spam",label:"Spam or misleading"},{value:"offensive",label:"Inappropriate or offensive"},{value:"fake",label:"Fake or biased review"}];function V({open:t,onClose:e,onSubmit:a,busy:r}){const[i,l]=h.useState("spam"),[o,c]=h.useState(""),m=h.useMemo(()=>!!i&&!r,[r,i]);return t?s.jsx("div",{className:"modal-overlay active",onClick:e,role:"dialog","aria-modal":"true","aria-label":"Report Review",children:s.jsxs("div",{className:"modal-content",onClick:d=>d.stopPropagation(),children:[s.jsx("button",{type:"button",className:"modal-close",onClick:e,"aria-label":"Close",children:s.jsx("i",{className:"fas fa-times"})}),s.jsxs("div",{className:"modal-header",children:[s.jsx("h3",{className:"modal-title",style:{color:"#ff4757"},children:"Report Review"}),s.jsx("p",{className:"modal-subtitle",children:"Why are you reporting this review?"})]}),s.jsxs("div",{className:"modal-body",children:[s.jsx("div",{style:{display:"grid",gap:10},children:M.map(d=>s.jsxs("label",{style:{display:"flex",alignItems:"center",gap:10,padding:"10px 12px",borderRadius:12,border:"1px solid rgba(229,231,235,.9)",cursor:"pointer"},children:[s.jsx("input",{type:"radio",name:"review_report_reason",value:d.value,checked:i===d.value,onChange:()=>l(d.value)}),s.jsx("span",{style:{fontWeight:900},children:d.label})]},d.value))}),s.jsx("textarea",{value:o,onChange:d=>c(d.target.value),placeholder:"More details...",rows:4,style:{width:"100%",borderRadius:12,border:"1px solid rgba(229,231,235,.9)",padding:10,fontFamily:"inherit",marginTop:12}}),s.jsx("button",{type:"button",className:"btn danger",disabled:!m,onClick:async()=>{await(a==null?void 0:a({reason:i,details:o})),c(""),l("spam")},style:{justifyContent:"center",width:"100%",marginTop:12},children:r?"Submitting...":"Submit Report"})]})]})}):null}function B(){try{return typeof navigator<"u"&&typeof navigator.share=="function"}catch{return!1}}async function F(t){var a;const e=String(t||"");if(!e)return!1;try{if((a=navigator==null?void 0:navigator.clipboard)!=null&&a.writeText)return await navigator.clipboard.writeText(e),!0}catch{}try{const r=document.createElement("textarea");r.value=e,r.setAttribute("readonly","readonly"),r.style.position="fixed",r.style.top="-9999px",r.style.left="-9999px",document.body.appendChild(r),r.select();const i=document.execCommand("copy");return document.body.removeChild(r),i}catch{return!1}}async function Q({title:t,text:e,url:a}){const r={title:t?String(t):void 0,text:e?String(e):void 0,url:a?String(a):void 0},i=r.url||"";if(B())try{return await navigator.share(r),{ok:!0,method:"share"}}catch(o){if(o&&typeof o=="object"&&"name"in o&&String(o.name)==="AbortError")return{ok:!0,method:"canceled"}}const l=await F(i||window.location.href);return{ok:l,method:l?"copy":"none"}}function X({baseUrl:t,businessId:e,isMobile:a}){try{const r=t?String(t):"",i=e?String(e):"",l=a?"local_hub_info_mobile.html":"local_hub_info.html",o=new URL(`${r}${l}`,window.location.href);return i&&o.searchParams.set("business_id",i),o.toString()}catch{return window.location.href}}function R(t){try{const a=`; ${document.cookie}`.split(`; ${t}=`);return a.length===2?a.pop().split(";").shift():""}catch{return""}}function Y(){try{return new URL(window.location.href).searchParams.get("business_id")||""}catch{return""}}function D(t){try{const e=new Date(t);return Number.isNaN(e.getTime())?"":e.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})}catch{return""}}function H(t){var i,l;const e=String(t||"").trim().split(/\s+/).filter(Boolean);if(!e.length)return"U";const a=((i=e[0])==null?void 0:i[0])||"",r=e.length>1&&((l=e[e.length-1])==null?void 0:l[0])||"";return(a+r).toUpperCase()||"U"}function Z(t,e){const a=typeof e=="string"?e.trim():"";if(!a)return"";if(/^https?:\/\//i.test(a))return a;if(t==="whatsapp"){const i=a.replace(/[^\d]/g,"");return i?`https://wa.me/${i}`:""}const r=a.replace(/^@/,"");return r?t==="facebook"?`https://www.facebook.com/${r}`:t==="twitter"?`https://x.com/${r}`:t==="instagram"?`https://www.instagram.com/${r}`:t==="tiktok"?`https://www.tiktok.com/@${r}`:"":""}function ee({recipientId:t,recipientName:e}){try{const a=window.location.hostname,i=a==="localhost"||a==="127.0.0.1"||a===""?`http://${a||"localhost"}:5173/`:`${window.location.origin}/chat-hub/`,l=new URL(i);return t&&l.searchParams.set("recipientId",String(t)),e&&l.searchParams.set("recipientName",String(e)),l.toString()}catch{return"http://localhost:5173/"}}async function te({businessId:t,signal:e}={}){const a=String(t||"").trim();if(!a)throw new Error("Missing business_id in the URL.");const{url:r,anonKey:i}=L(),l=`${r}/functions/v1/local_hub?business_id=${encodeURIComponent(a)}`,o=R("standard_session_id")||"",c=R("business_session_id")||"",m=o||c,d=await fetch(l,{method:"GET",credentials:"include",headers:{apikey:i,Authorization:`Bearer ${i}`,"Content-Type":"application/json",...m?{"x-access-token":m,"x-session-id":m}:{}},signal:e}),u=await d.json().catch(()=>({}));if(!d.ok){const p=typeof(u==null?void 0:u.error)=="string"?u.error:`Failed to load business details (HTTP ${d.status})`;throw new Error(p)}return u||null}function z(){const t=R("standard_session_id"),e=R("standard_csrf_token");if(t&&e)return{sessionId:t,csrfToken:e};const a=R("business_session_id"),r=R("business_csrf_token");return a&&r?{sessionId:a,csrfToken:r}:null}async function O({action:t,payload:e={},signal:a}={}){const r=z();if(!r)throw new Error("Please log in to continue.");const{url:i,anonKey:l}=L(),o=await fetch(`${i}/functions/v1/local_hub`,{method:"POST",headers:{"Content-Type":"application/json",apikey:l,Authorization:`Bearer ${l}`,"x-access-token":r.sessionId,"x-csrf-token":r.csrfToken},body:JSON.stringify({action:t,...e||{}}),signal:a}),c=await o.json().catch(()=>({}));if(!o.ok){const m=typeof(c==null?void 0:c.error)=="string"?c.error:`Request failed (HTTP ${o.status})`;throw new Error(m)}return c}async function se({businessId:t,reason:e,details:a,signal:r}={}){if(!t)throw new Error("Missing business id.");if(!e)throw new Error("Please select a reason.");return await O({action:"report_business",payload:{business_id:t,reason:e,details:a},signal:r})}function ae(t){const e=(t==null?void 0:t.post)||null,a=t!=null&&t.stats&&typeof t.stats=="object"?t.stats:{},r=Array.isArray(t==null?void 0:t.reviews)?t.reviews:[],i=t!=null&&t.viewer&&typeof t.viewer=="object"?t.viewer:null,l=t!=null&&t.product_reactions&&typeof t.product_reactions=="object"?t.product_reactions:{},o=e!=null&&e.content&&typeof e.content=="object"?e.content:{},c=o!=null&&o.business&&typeof o.business=="object"?o.business:{},m=c.businessName||c.name||"Business",d=typeof c.businessLogo=="string"?c.businessLogo.trim():"",u=`https://ui-avatars.com/api/?name=${encodeURIComponent(m)}&background=random&color=fff`,p=c.streetAddress||c.businessAddress||c.address||"",w=c.suburb||"",b=c.city||"",j=c.province||"",_=[p,w,b,j].map(n=>String(n||"").trim()).filter(Boolean).join(", "),f=typeof(c==null?void 0:c.description)=="string"?c.description.trim():typeof(o==null?void 0:o.description)=="string"?o.description.trim():"",y=(Array.isArray(o==null?void 0:o.products)?o.products:[]).map(n=>{const S=typeof(n==null?void 0:n.name)=="string"&&n.name.trim()?n.name.trim():typeof(n==null?void 0:n.title)=="string"&&n.title.trim()?n.title.trim():"Product",U=Array.isArray(n==null?void 0:n.images)?n.images.filter(x=>typeof x=="string"&&x.trim()).map(x=>x.trim()):[],$=P({title:m,subtitle:S}),N=U.length?U.slice(0,10):[$];return{title:S,images:N,cover:N[0]||$}}),g=c.socials&&typeof c.socials=="object"&&c.socials||c.socialMedia&&typeof c.socialMedia=="object"&&c.socialMedia||c.social&&typeof c.social=="object"&&c.social||{},A={facebook:g.facebook||g.fb||"",twitter:g.twitter||g.x||"",whatsapp:g.whatsapp||g.wa||g.phone||"",tiktok:g.tiktok||g.tt||"",instagram:g.instagram||g.ig||""},C=r.map(n=>{const S=typeof(n==null?void 0:n.author_name)=="string"&&n.author_name.trim()?n.author_name.trim():typeof(n==null?void 0:n.authorName)=="string"&&n.authorName.trim()?n.authorName.trim():"Anonymous User",U=String((n==null?void 0:n.id)||""),$=Number(n==null?void 0:n.rating)||0,N=(n==null?void 0:n.created_at)||(n==null?void 0:n.updated_at)||"",x=N?Date.parse(N):0,T=typeof(n==null?void 0:n.content)=="string"?n.content:"",E=Number(n==null?void 0:n.helpful_count)||0;return{id:U,name:S,initials:H(S),avatarUrl:"",dateLabel:D(N)||"",timestamp:Number.isFinite(x)?x:0,rating:$,text:T,helpful:E}});return{businessId:(e==null?void 0:e.business_id)||(e==null?void 0:e.businessId)||(e==null?void 0:e.id)||"",businessName:m,logoUrl:d||u,addressLine:_||"Address not provided",aboutText:f||"No description provided yet.",social:A,products:y,productReactions:l,stats:{followers:Number(a.followers)||0,likes:Number(a.likes)||0,reviewCount:Number(a.review_count)||0,averageRating:typeof a.average_rating=="number"?a.average_rating:Number(a.average_rating)||0,profileViews:Number(a.profile_views)||0,profileImpressions:Number(a.profile_impressions)||0,productViews:Number(a.product_views)||0,ratingBreakdown:a.rating_breakdown&&typeof a.rating_breakdown=="object"?a.rating_breakdown:null},reviews:C,viewer:i?{isFollowing:!!i.isFollowing,myReviewId:i.myReviewId?String(i.myReviewId):null,productReactions:i.productReactions&&typeof i.productReactions=="object"?i.productReactions:{}}:null,raw:t}}export{J as L,V as R,z as a,ee as b,X as c,q as d,G as e,K as f,Y as g,te as h,ae as i,O as l,Z as n,se as r,Q as s};
