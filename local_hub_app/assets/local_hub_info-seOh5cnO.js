import{r as l,j as s,a as ys,b as xs,c as gs,R as vs}from"./localHub-Ddi82mor.js";import{g as A,l as v,a as ps,b as Cs,c as js,s as fs,t as bs,d as Rs,n as E,L as ws,e as Is,R as _s,f as Ss,r as Ls,h as Bs,i as Es,j as Hs}from"./localHubInfoApi-DWGnuHbr.js";const Ns=[{value:"recent",label:"Most Recent"},{value:"highest",label:"Highest Rated"},{value:"lowest",label:"Lowest Rated"}];function Fs(d,i,x){return Math.max(i,Math.min(x,d))}function Ds(d){const i=d.length||0,x=i===0?0:d.reduce((f,m)=>f+(Number(m.rating)||0),0)/i,j={1:0,2:0,3:0,4:0,5:0};return d.forEach(f=>{const m=Fs(Math.round(Number(f.rating)||0),1,5);j[m]+=1}),{total:i,avg:x,counts:j}}function $s({rating:d}){return s.jsx("div",{className:"rev-stars","aria-label":`${d} stars`,children:Array.from({length:5},(i,x)=>x<d?s.jsx("i",{className:"fas fa-star"},x):s.jsx("i",{className:"far fa-star"},x))})}function Os({reviews:d,ratingSummary:i,onReport:x,onHelpful:j,onReportReview:f}){var L;const[m,C]=l.useState("recent"),[u,R]=l.useState(!1),[H,O]=l.useState(()=>new Map),k=l.useRef(null);l.useEffect(()=>{function n(o){k.current&&(k.current.contains(o.target)||R(!1))}return document.addEventListener("click",n),()=>document.removeEventListener("click",n)},[]);const w=l.useMemo(()=>Array.isArray(d)?d:[],[d]),I=l.useMemo(()=>{const n=[...w];return m==="highest"?n.sort((o,h)=>h.rating-o.rating||h.timestamp-o.timestamp):m==="lowest"?n.sort((o,h)=>o.rating-h.rating||h.timestamp-o.timestamp):n.sort((o,h)=>h.timestamp-o.timestamp),n},[w,m]),y=l.useMemo(()=>Ds(w),[w]),_=i&&typeof i.avg=="number"?i.avg:y.avg,S=i&&typeof i.total=="number"?i.total:y.total,F=_?_.toFixed(1):"0.0",P=l.useMemo(()=>{const n=S||1;return[5,4,3,2,1].map(o=>{const h=i&&i.counts?Number(i.counts[o]||0):y.counts[o]||0,b=`${Math.round(h/n*100)}%`;return{star:o,count:h,width:b}})},[i,y,S]);return s.jsxs("section",{className:"collCard",children:[s.jsxs("div",{className:"collHead collHeadRow",children:[s.jsxs("span",{children:[s.jsx("i",{className:"fas fa-star"})," Reviews"]}),s.jsxs("div",{className:"sort-box",ref:k,children:[s.jsx("span",{children:"Sort by:"}),s.jsxs("div",{className:`custom-dropdown ${u?"active":""}`,children:[s.jsxs("div",{className:"dropdown-trigger",role:"button",tabIndex:0,onClick:n=>{n.stopPropagation(),R(o=>!o)},onKeyDown:n=>{(n.key==="Enter"||n.key===" ")&&R(o=>!o)},children:[s.jsx("span",{children:((L=Ns.find(n=>n.value===m))==null?void 0:L.label)||"Most Recent"}),s.jsx("i",{className:"fas fa-chevron-down"})]}),s.jsx("div",{className:"dropdown-menu",children:Ns.map(n=>s.jsxs("div",{className:`dropdown-item ${n.value===m?"selected":""}`,onClick:()=>{C(n.value),R(!1)},children:[n.label," ",s.jsx("i",{className:"fas fa-check"})]},n.value))})]})]})]}),s.jsxs("div",{className:"rating-summary-card",children:[s.jsxs("div",{className:"summary-left",children:[s.jsx("span",{className:"big-num",children:F}),s.jsx("div",{className:"stars",children:Array.from({length:5},(n,o)=>s.jsx("i",{className:"fas fa-star",style:{color:"#fbbf24"}},o))}),s.jsxs("span",{className:"total-text",children:["Based on ",S," Reviews"]})]}),s.jsx("div",{className:"summary-bars",children:P.map(n=>s.jsxs("div",{className:"bar-row",children:[s.jsxs("span",{className:"bar-label",children:[n.star," ",s.jsx("i",{className:"fas fa-star",style:{color:"#fbbf24",fontSize:9}})]}),s.jsx("div",{className:"bar-bg",children:s.jsx("div",{className:"bar-fill",style:{width:n.width}})}),s.jsx("span",{className:"bar-count",children:n.count})]},n.star))})]}),s.jsx("div",{className:"rev-container",children:I.length?I.map(n=>{const o=H.get(n.id)||0;return s.jsxs("div",{className:"review-row",children:[s.jsx("div",{className:"rev-avatar",children:n.avatarUrl?s.jsx("img",{src:n.avatarUrl,alt:"User"}):n.initials}),s.jsxs("div",{style:{flex:1},children:[s.jsxs("div",{className:"rev-header",children:[s.jsx("span",{className:"rev-name",children:n.name}),s.jsx("span",{className:"rev-date",children:n.dateLabel})]}),s.jsx($s,{rating:n.rating}),s.jsx("p",{className:"rev-text",children:n.text}),s.jsxs("div",{className:"rev-actions",children:[s.jsxs("button",{type:"button",className:"btn-link-action",onClick:async()=>{try{await(j==null?void 0:j(n.id)),O(h=>{const b=new Map(h);return b.set(n.id,(b.get(n.id)||0)+1),b})}catch{}},children:[s.jsx("i",{className:"far fa-thumbs-up"})," Helpful"," ",s.jsxs("span",{style:{opacity:.7},children:["(",Number(n.helpful||0)+o,")"]})]}),s.jsxs("button",{type:"button",className:"btn-link-action",onClick:()=>f==null?void 0:f(n.id),children:[s.jsx("i",{className:"far fa-flag"})," Report"]})]})]})]},n.id)}):s.jsx("div",{style:{padding:14,color:"var(--muted)",fontWeight:800},children:"No reviews yet."})})]})}function Ps(){return s.jsxs("div",{className:"lh-skeleton",children:[s.jsxs("section",{className:"topCard",children:[s.jsx("div",{className:"topRow",children:s.jsxs("div",{className:"brand",children:[s.jsx("div",{className:"logo",children:s.jsx("div",{className:"sk sk-circle w-100 h-100"})}),s.jsxs("div",{className:"btxt",style:{width:"100%"},children:[s.jsx("div",{className:"sk sk-rect w-220 h-16"}),s.jsx("div",{style:{height:8}}),s.jsx("div",{className:"sk sk-rect w-420 h-12"}),s.jsxs("div",{className:"stats-row",style:{marginTop:12},children:[s.jsx("div",{className:"sk sk-pill w-120 h-14"}),s.jsx("div",{className:"sk sk-pill w-120 h-14"}),s.jsx("div",{className:"sk sk-pill w-120 h-14"}),s.jsx("div",{className:"sk sk-pill w-120 h-14"})]})]})]})}),s.jsxs("div",{className:"actions",style:{marginTop:14},children:[s.jsx("div",{className:"sk sk-btn w-110 h-44"}),s.jsx("div",{className:"sk sk-btn w-110 h-44"}),s.jsx("div",{className:"sk sk-btn w-110 h-44"}),s.jsx("div",{className:"sk sk-btn w-110 h-44"}),s.jsx("div",{className:"sk sk-btn w-110 h-44 sk-danger"})]})]}),s.jsxs("section",{className:"aboutCard",children:[s.jsx("div",{className:"sk sk-rect w-220 h-14"}),s.jsx("div",{style:{height:12}}),s.jsx("div",{className:"sk sk-rect w-full h-12"}),s.jsx("div",{style:{height:10}}),s.jsx("div",{className:"sk sk-rect w-full h-12"}),s.jsx("div",{style:{height:10}}),s.jsx("div",{className:"sk sk-rect w-420 h-12"}),s.jsxs("div",{className:"social-flex",style:{marginTop:12},children:[s.jsx("div",{className:"sk sk-rect w-52 h-52"}),s.jsx("div",{className:"sk sk-rect w-52 h-52"}),s.jsx("div",{className:"sk sk-rect w-52 h-52"}),s.jsx("div",{className:"sk sk-rect w-52 h-52"}),s.jsx("div",{className:"sk sk-rect w-52 h-52"})]})]}),s.jsxs("section",{className:"collCard",children:[s.jsx("div",{className:"sk sk-rect w-220 h-14"}),s.jsx("div",{className:"prodGrid",style:{marginTop:12},children:Array.from({length:4},(d,i)=>s.jsxs("div",{className:"prodCard",children:[s.jsx("div",{className:"sk sk-rect w-full h-150"}),s.jsxs("div",{style:{padding:12,display:"grid",gap:10},children:[s.jsx("div",{className:"sk sk-rect w-180 h-12"}),s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:10},children:[s.jsx("div",{className:"sk sk-pill w-140 h-36"}),s.jsx("div",{className:"sk sk-rect w-36 h-36"})]})]})]},i))})]}),s.jsxs("section",{className:"collCard",children:[s.jsx("div",{className:"sk sk-rect w-180 h-14"}),s.jsx("div",{style:{height:12}}),s.jsx("div",{className:"sk sk-rect w-full h-280"})]}),s.jsxs("section",{className:"reviewsCard",children:[s.jsx("div",{className:"sk sk-rect w-180 h-14"}),s.jsx("div",{className:"rev-container",style:{marginTop:12},children:Array.from({length:2},(d,i)=>s.jsxs("div",{className:"review-row",children:[s.jsx("div",{className:"sk sk-circle w-44 h-44"}),s.jsxs("div",{style:{flex:1,display:"grid",gap:10},children:[s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:10},children:[s.jsx("div",{className:"sk sk-rect w-180 h-12"}),s.jsx("div",{className:"sk sk-rect w-120 h-10"})]}),s.jsx("div",{className:"sk sk-pill w-160 h-12"}),s.jsx("div",{className:"sk sk-rect w-full h-40"}),s.jsxs("div",{style:{display:"flex",gap:10,flexWrap:"wrap"},children:[s.jsx("div",{className:"sk sk-pill w-140 h-34"}),s.jsx("div",{className:"sk sk-pill w-140 h-34"})]})]})]},i))})]})]})}function Ts(){var W,V,K,G,Y,q,J,Q,X,Z,M,ss,es,as,ts,ns,rs,is,cs,ls;const[d,i]=l.useState(!0),[x,j]=l.useState(""),[f,m]=l.useState(null),[C,u]=l.useState(""),[R,H]=l.useState(!1),[O,k]=l.useState(!1),[w,I]=l.useState(!1),[y,_]=l.useState(""),[S,F]=l.useState(!1),[P,L]=l.useState(!1),[n,o]=l.useState([]),[h,b]=l.useState(0);function U(a,t=0){o(a),b(t),L(!0)}l.useEffect(()=>{let a=null;if(C)return a=setTimeout(()=>u(""),4e3),()=>{a&&clearTimeout(a)}},[C]);async function g({signal:a}={}){const t=A();if(!t){m(null),i(!1);return}i(!0),j("");try{const r=await Es({businessId:t,signal:a});m(Hs(r))}catch(r){if(a!=null&&a.aborted)return;m(null),j(r instanceof Error?r.message:"Failed to load business details.")}finally{if(a!=null&&a.aborted)return;i(!1)}}l.useEffect(()=>{const a=new AbortController;return g({signal:a.signal}),()=>a.abort()},[]),l.useEffect(()=>{const a=A();a&&ys({businessId:a})},[]);const T=A();if(!T)return s.jsx("div",{className:"page",children:s.jsx("div",{className:"frame",children:s.jsxs("section",{className:"aboutCard",style:{borderColor:"#fecaca"},children:[s.jsx("div",{className:"aboutHead",style:{color:"#b91c1c"},children:"Missing business_id"}),s.jsx("div",{className:"aboutBody",children:"Open this page with `?business_id=...`."})]})})});const e=f,z=d&&!e&&!x;return s.jsxs("div",{className:"page",children:[s.jsxs("div",{className:"frame",children:[C?s.jsx("div",{style:{marginBottom:12,fontWeight:900,color:"#0f172a"},children:C}):null,x?s.jsxs("section",{className:"aboutCard",style:{borderColor:"#fecaca"},children:[s.jsx("div",{className:"aboutHead",style:{color:"#b91c1c"},children:"Failed to load business details"}),s.jsx("div",{className:"aboutBody",children:x})]}):null,z?s.jsx(Ps,{}):null,z?null:s.jsxs(s.Fragment,{children:[s.jsxs("section",{className:"topCard",children:[s.jsx("div",{className:"topRow",children:s.jsxs("div",{className:"brand",children:[s.jsx("div",{className:"logo",children:s.jsx("img",{src:(e==null?void 0:e.logoUrl)||"",alt:"Logo"})}),s.jsxs("div",{className:"btxt",children:[s.jsxs("h1",{className:"bizName",children:[s.jsx("span",{className:"bizNameText",children:(e==null?void 0:e.businessName)||(d?"Loading...":"Business")}),e!=null&&e.isVerified?s.jsxs("svg",{className:"verified-badge",width:"18",height:"18",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",role:"img","aria-label":"Verified business",title:"Verified business",children:[s.jsx("rect",{width:"24",height:"24",fill:"#000000",opacity:"0"}),s.jsxs("g",{transform:"translate(12 12) scale(0.42)",children:[s.jsx("polygon",{points:"5.62,-21 9.05,-15.69 15.37,-15.38 15.69,-9.06 21,-5.63 18.12,0 21,5.62 15.69,9.05 15.38,15.37 9.06,15.69 5.63,21 0,18.12 -5.62,21 -9.05,15.69 -15.37,15.38 -15.69,9.06 -21,5.63 -18.12,0 -21,-5.62 -15.69,-9.05 -15.38,-15.37 -9.06,-15.69 -5.63,-21 0,-18.12",fill:"#42a5f5",fillRule:"nonzero"}),s.jsx("g",{transform:"translate(-0.01 0.51)",children:s.jsx("polygon",{points:"-2.6,6.74 -9.09,0.25 -6.97,-1.87 -2.56,2.53 7,-6.74 9.09,-4.59",fill:"#ffffff",fillRule:"nonzero"})})]})]}):null]}),s.jsxs("div",{className:"addr",children:[s.jsxs("svg",{className:"pin",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("path",{d:"M12 21s7-4.35 7-11a7 7 0 1 0-14 0c0 6.65 7 11 7 11z"}),s.jsx("circle",{cx:"12",cy:"10",r:"2.5"})]}),(e==null?void 0:e.addressLine)||(d?"Loading...":"Address not provided")]}),s.jsxs("div",{className:"stats-row",children:[s.jsxs("div",{className:"stats-item",children:[s.jsx("span",{className:"stats-val",children:((W=e==null?void 0:e.stats)==null?void 0:W.followers)??0})," Followers"]}),s.jsxs("div",{className:"stats-item",children:[s.jsx("span",{className:"stats-val",children:(V=e==null?void 0:e.stats)!=null&&V.reviewCount?e.stats.averageRating.toFixed(1):"0.0"})," ","Rating"]}),s.jsxs("div",{className:"stats-item",children:[s.jsx("span",{className:"stats-val",children:((K=e==null?void 0:e.stats)==null?void 0:K.likes)??0})," Likes"]}),s.jsxs("div",{className:"stats-item",children:[s.jsx("span",{className:"stats-val",children:((G=e==null?void 0:e.stats)==null?void 0:G.reviewCount)??0})," Reviews"]})]})]})]})}),s.jsxs("div",{className:"actions",children:[s.jsxs("button",{type:"button",className:`btn follow${(Y=e==null?void 0:e.viewer)!=null&&Y.isFollowing?" following":""}`,disabled:!(e!=null&&e.businessId)||d,onClick:async()=>{var a;if(e!=null&&e.businessId)try{const t=!((a=e==null?void 0:e.viewer)!=null&&a.isFollowing);await v({action:t?"follow_business":"unfollow_business",payload:{business_id:e.businessId}}),u(t?"Following":"Unfollowed"),await g()}catch(t){u(t instanceof Error?t.message:"Failed to update follow.")}},children:[s.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"}),s.jsx("circle",{cx:"9",cy:"7",r:"4"}),s.jsx("path",{d:"M16 11l2 2 4-4"})]}),(q=e==null?void 0:e.viewer)!=null&&q.isFollowing?"Following":"Follow"]}),s.jsxs("button",{type:"button",className:"btn rate",onClick:()=>H(!0),children:[s.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:s.jsx("path",{d:"M12 17.3l-6.2 3.7 1.7-7L2 8.9l7.2-.6L12 2l2.8 6.3 7.2.6-5.5 5.1 1.7 7z"})}),"Rate"]}),s.jsxs("a",{href:Cs({recipientId:e==null?void 0:e.businessId,recipientName:e==null?void 0:e.businessName}),className:"btn chat",onClick:a=>{ps()||(a.preventDefault(),u("Please log in to continue."))},children:[s.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:s.jsx("path",{d:"M21 15a4 4 0 0 1-4 4H7l-4 3V7a4 4 0 0 1 4-4h10a4 4 0 0 1 4 4z"})}),"Chat"]}),s.jsxs("button",{type:"button",className:"btn share",onClick:async()=>{const a=js({baseUrl:"/local_hub_app/",businessId:e==null?void 0:e.businessId,isMobile:!1}),t=await fs({title:e!=null&&e.businessName?`${e.businessName} â€¢ LocalHub`:"LocalHub",text:e!=null&&e.businessName?`Check out ${e.businessName} on LocalHub.`:"Check this out on LocalHub.",url:a});(t.method==="copy"||t.method==="share")&&await bs({businessId:e==null?void 0:e.businessId,method:t.method,url:a}),t.method==="copy"?u("Link copied."):t.method==="share"&&u("Shared.")},children:[s.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("circle",{cx:"18",cy:"5",r:"3"}),s.jsx("circle",{cx:"6",cy:"12",r:"3"}),s.jsx("circle",{cx:"18",cy:"19",r:"3"}),s.jsx("path",{d:"M8.6 13.5l6.8 3.9M15.4 6.6L8.6 10.5"})]}),"Share"]}),s.jsxs("button",{type:"button",className:"btn save",disabled:!(e!=null&&e.businessId)||d,onClick:async()=>{var t;if(!(e!=null&&e.businessId))return;if(!ps()){u("Please log in to continue.");return}try{const r=!((t=e==null?void 0:e.viewer)!=null&&t.isSaved);await v({action:r?"save_business":"unsave_business",payload:{business_id:e.businessId}}),u(r?"Saved":"Removed from saved"),await g()}catch(r){u(r instanceof Error?r.message:"Failed to update save.")}},children:[s.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:s.jsx("path",{d:"M6 3h12a2 2 0 0 1 2 2v16l-8-4-8 4V5a2 2 0 0 1 2-2z"})}),(J=e==null?void 0:e.viewer)!=null&&J.isSaved?"Saved":"Save"]}),s.jsxs("button",{type:"button",className:"btn report",onClick:()=>k(!0),children:[s.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("path",{d:"M4 22V4"}),s.jsx("path",{d:"M4 4h13l-1.5 4L17 12H4"})]}),"Report"]})]})]}),s.jsxs("section",{className:"aboutCard",children:[s.jsxs("div",{className:"aboutHead",children:["About ",(e==null?void 0:e.businessName)||"Business"]}),s.jsx("div",{className:"aboutBody",children:d?"Loading...":(()=>{const a=Rs((e==null?void 0:e.aboutText)||"");return a.length?s.jsx("div",{className:"aboutRich",children:a.map((t,r)=>t.type==="heading"?s.jsx("div",{className:"aboutHeading",children:t.text},`h-${r}`):t.type==="list"?s.jsx("ul",{className:"aboutList",children:t.items.map((D,B)=>s.jsx("li",{children:D},`li-${r}-${B}`))},`l-${r}`):s.jsx("p",{className:"aboutPara",children:t.text},`p-${r}`))}):"No description provided."})()}),s.jsxs("div",{style:{marginTop:12},children:[s.jsx("div",{className:"aboutHead",children:"Connect with us"}),s.jsxs("div",{className:"social-flex",style:{padding:0,gap:10},children:[s.jsx("a",{href:E("facebook",(Q=e==null?void 0:e.social)==null?void 0:Q.facebook),className:"social-item fb",onClick:a=>{var t;(t=e==null?void 0:e.social)!=null&&t.facebook||a.preventDefault()},style:{display:(X=e==null?void 0:e.social)!=null&&X.facebook?"":"none"},target:"_blank",rel:"noopener",children:s.jsx("i",{className:"fab fa-facebook-f"})}),s.jsx("a",{href:E("twitter",(Z=e==null?void 0:e.social)==null?void 0:Z.twitter),className:"social-item tw",onClick:a=>{var t;(t=e==null?void 0:e.social)!=null&&t.twitter||a.preventDefault()},style:{display:(M=e==null?void 0:e.social)!=null&&M.twitter?"":"none"},target:"_blank",rel:"noopener",children:s.jsx("i",{className:"fa-brands fa-x-twitter"})}),s.jsx("a",{href:E("whatsapp",(ss=e==null?void 0:e.social)==null?void 0:ss.whatsapp),className:"social-item wa",onClick:a=>{var t;(t=e==null?void 0:e.social)!=null&&t.whatsapp||a.preventDefault()},style:{display:(es=e==null?void 0:e.social)!=null&&es.whatsapp?"":"none"},target:"_blank",rel:"noopener",children:s.jsx("i",{className:"fab fa-whatsapp"})}),s.jsx("a",{href:E("tiktok",(as=e==null?void 0:e.social)==null?void 0:as.tiktok),className:"social-item tt",onClick:a=>{var t;(t=e==null?void 0:e.social)!=null&&t.tiktok||a.preventDefault()},style:{display:(ts=e==null?void 0:e.social)!=null&&ts.tiktok?"":"none"},target:"_blank",rel:"noopener",children:s.jsx("i",{className:"fab fa-tiktok"})}),s.jsx("a",{href:E("instagram",(ns=e==null?void 0:e.social)==null?void 0:ns.instagram),className:"social-item ig",onClick:a=>{var t;(t=e==null?void 0:e.social)!=null&&t.instagram||a.preventDefault()},style:{display:(rs=e==null?void 0:e.social)!=null&&rs.instagram?"":"none"},target:"_blank",rel:"noopener",children:s.jsx("i",{className:"fab fa-instagram"})})]})]})]}),s.jsxs("section",{className:"collCard",children:[s.jsx("div",{className:"collHead",children:"Our Gallery"}),s.jsx("div",{className:"prodGrid",children:((e==null?void 0:e.products)||[]).map(a=>s.jsxs("div",{className:"prodCard",role:"group",children:[s.jsx("div",{className:"prodImg",style:{cursor:"zoom-in"},onClick:()=>{xs({businessId:(e==null?void 0:e.businessId)||T,productKey:a.title||"Product"}),U(a.images,0)},role:"button",tabIndex:0,onKeyDown:t=>{(t.key==="Enter"||t.key===" ")&&(xs({businessId:(e==null?void 0:e.businessId)||T,productKey:a.title||"Product"}),U(a.images,0))},children:s.jsx("img",{src:a.cover,alt:a.title})}),s.jsxs("div",{className:"prodInfo",children:[s.jsx("div",{className:"prodName",children:a.title}),s.jsx("div",{className:"product-meta-row",children:s.jsx("div",{className:"product-actions",children:(()=>{var us,hs,ms;const t=a.title||"Product",r=((us=e==null?void 0:e.productReactions)==null?void 0:us[t])||{},D=Number(r==null?void 0:r.total)||0,B=r!=null&&r.by_reaction&&typeof r.by_reaction=="object"?r.by_reaction:{},$=((ms=(hs=e==null?void 0:e.viewer)==null?void 0:hs.productReactions)==null?void 0:ms[t])||"",os=["ðŸ‘","â¤ï¸","ðŸ”¥"],ks=os.map(c=>({reaction:c,count:Number((B==null?void 0:B[c])??0)||0})).filter(c=>c.count>0).sort((c,p)=>p.count-c.count).slice(0,3).map(c=>c.reaction),ds=D>0;return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"reaction-container",children:[s.jsx("div",{className:"reactions-popover small-popover",children:os.map(c=>s.jsx("span",{className:`emoji ${$===c?"active":""}`,onClick:async p=>{p.preventDefault(),p.stopPropagation();try{await v({action:"react_product",payload:{business_id:e==null?void 0:e.businessId,product_key:t,reaction:c,force_set:!0}}),await g()}catch(N){u(N instanceof Error?N.message:"Failed to react.")}},title:c,"aria-label":`React ${c}`,children:c},c))}),s.jsxs("div",{className:"btn-with-count",children:[s.jsx("button",{type:"button",className:"small-btn",onClick:async c=>{c.preventDefault(),c.stopPropagation();try{await v({action:"react_product",payload:{business_id:e==null?void 0:e.businessId,product_key:t,reaction:$||"â¤ï¸",force_set:!1}}),await g()}catch(p){u(p instanceof Error?p.message:"Failed to react.")}},"aria-label":"React",children:$?s.jsx("span",{className:"my-reaction-emoji",children:$}):s.jsx("i",{className:"far fa-heart"})}),ds?s.jsx("div",{className:"emoji-stack",children:ks.map(c=>s.jsx("span",{children:c},c))}):null,ds?s.jsx("span",{className:"reaction-count",children:D}):null]})]}),s.jsx("button",{type:"button",className:"small-btn",title:"Share",onClick:c=>{c.preventDefault(),c.stopPropagation(),(async()=>{const p=js({baseUrl:"/local_hub_app/",businessId:e==null?void 0:e.businessId,isMobile:!1}),N=await fs({title:e!=null&&e.businessName?`${e.businessName} â€¢ LocalHub`:"LocalHub",text:a!=null&&a.title?`Check out "${a.title}" on LocalHub.`:"Check this out on LocalHub.",url:p});(N.method==="copy"||N.method==="share")&&await bs({businessId:e==null?void 0:e.businessId,method:N.method,url:p}),N.method==="copy"?u("Link copied."):N.method==="share"&&u("Shared.")})()},children:s.jsx("i",{className:"fas fa-share-nodes"})})]})})()})})]})]},a.title))})]}),s.jsx(ws,{address:(e==null?void 0:e.addressLine)||""}),s.jsx(Os,{reviews:(e==null?void 0:e.reviews)||[],ratingSummary:{total:((is=e==null?void 0:e.stats)==null?void 0:is.reviewCount)??0,avg:((cs=e==null?void 0:e.stats)==null?void 0:cs.averageRating)??0,counts:((ls=e==null?void 0:e.stats)==null?void 0:ls.ratingBreakdown)||null},onReport:()=>k(!0),onHelpful:async a=>{a&&(await v({action:"set_review_helpful",payload:{review_id:a,helpful:!0}}),await g())},onReportReview:a=>{_(String(a||"")),I(!0)}})]})]}),s.jsx(Is,{open:P,slides:n,index:h,onPrev:()=>b(a=>(a-1+n.length)%n.length),onNext:()=>b(a=>(a+1)%n.length),onClose:()=>L(!1)}),s.jsx(_s,{open:w,onClose:()=>I(!1),busy:S,onSubmit:async({reason:a,details:t})=>{if(y){F(!0);try{await v({action:"report_review",payload:{review_id:y,reason:a||"other",details:t||""}}),u("Review reported. Thank you."),I(!1),_("")}catch(r){u(r instanceof Error?r.message:"Failed to submit report.")}finally{F(!1)}}}}),s.jsx(Ss,{open:O,onClose:()=>k(!1),businessId:(e==null?void 0:e.businessId)||"",onSubmit:async({businessId:a,reason:t,details:r})=>{await Ls({businessId:a,reason:t,details:r}),u("Report received. Our team will review this business shortly.")}}),s.jsx(Bs,{open:R,onClose:()=>H(!1),businessId:(e==null?void 0:e.businessId)||"",onSubmit:async({businessId:a,rating:t,content:r})=>{await v({action:"upsert_review",payload:{business_id:a,rating:t,content:r}}),u("Success! Your review has been submitted."),await g()}})]})}gs.createRoot(document.getElementById("root")).render(s.jsx(vs.StrictMode,{children:s.jsx(Ts,{})}));
