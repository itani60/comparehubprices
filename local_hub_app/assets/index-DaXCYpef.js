import{r as l,j as e,s as k,f as T,c as U,R as D}from"./localHub-Byr6UtYB.js";function I({slides:a}){const[c,n]=l.useState(0),h=l.useMemo(()=>Array.isArray(a)?a:[],[a]),r=l.useRef(null);if(h.length===0)return null;const m=h.length,p=100/m;return l.useEffect(()=>{n(0)},[m]),l.useEffect(()=>{if(m<=1)return;function o(){r.current||(r.current=setInterval(()=>{n(f=>(f+1)%m)},1e4))}function d(){r.current&&(clearInterval(r.current),r.current=null)}return o(),()=>d()},[m]),e.jsxs("div",{className:"carousel",onMouseEnter:()=>{r.current&&(clearInterval(r.current),r.current=null)},onMouseLeave:()=>{m<=1||r.current||(r.current=setInterval(()=>{n(o=>(o+1)%m)},1e4))},children:[e.jsx("div",{className:"carousel-inner",style:{width:`${m*100}%`,transform:`translateX(-${c*p}%)`},children:h.map((o,d)=>e.jsx("div",{className:"carousel-slide",style:{width:`${p}%`,flex:`0 0 ${p}%`},children:e.jsx("img",{src:o.url,alt:o.alt,onError:f=>{var b;f.currentTarget.onerror=null;const s=o&&typeof o.fallbackUrl=="string"?o.fallbackUrl:((b=h[0])==null?void 0:b.url)||"";f.currentTarget.src=s}})},`${o.url}-${d}`))}),e.jsx("div",{className:"carousel-dots",children:h.map((o,d)=>e.jsx("span",{className:`dot ${d===c?"active":""}`,onClick:()=>n(d)},d))})]})}function K(a){const c=Math.floor(Number(a)||0);return Array.from({length:Math.max(0,Math.min(5,c))},(n,h)=>e.jsx("i",{className:"fa-solid fa-star"},h))}function O({business:a}){const c=l.useMemo(()=>`https://ui-avatars.com/api/?name=${encodeURIComponent(a.name||"")}&background=random&color=fff`,[a.name]),n=l.useMemo(()=>{const r=typeof a.logo=="string"?a.logo.trim():"";return r.length?r:c},[c,a.logo]),h=l.useMemo(()=>{const r=(a==null?void 0:a.name)||"Business",m=k({title:r,subtitle:"No product image"}),p=k({title:r,subtitle:"Image unavailable"}),o=Array.isArray(a.images)?a.images.filter(s=>typeof s=="string"&&s.trim().length>0):typeof a.image=="string"&&a.image.trim().length>0?[a.image.trim()]:[],d=Array.from(new Set(o)),f=[];for(let s=0;s<Math.min(4,d.length);s++)f.push(d[s]);for(;f.length<4;)f.push(m);return f.map((s,b)=>({url:s,alt:`${r} product image`,fallbackUrl:p,isPlaceholder:s===m}))},[a.image,a.images,a.name]);return e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"biz-header",children:[e.jsx("img",{src:n,alt:`${a.name} logo`,className:"biz-avatar",onError:r=>{r.currentTarget.onerror=null,r.currentTarget.src=c}}),e.jsxs("div",{children:[e.jsx("div",{className:"biz-name",children:a.name}),e.jsxs("div",{className:"biz-rating",children:[K(a.rating),e.jsxs("span",{children:["(",a.rating,")"]})]}),e.jsxs("div",{className:"badge",children:[e.jsx("i",{className:"fa-solid fa-tags"}),a.category]})]})]}),e.jsx(I,{slides:h}),e.jsxs("div",{className:"biz-address",children:[e.jsx("i",{className:"fa-solid fa-location-dot",style:{alignSelf:"flex-start",marginTop:3}}),e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:600},children:a.address}),e.jsxs("div",{style:{fontSize:"0.8em",opacity:.8},children:[a.suburb,", ",a.city]}),e.jsx("div",{style:{fontSize:"0.8em",opacity:.8},children:a.province})]})]}),e.jsx("a",{href:`/local_hub_app/local_hub_info.html?business_id=${encodeURIComponent(a.id||"")}`,className:"view-details-btn",onClick:r=>{var p,o;(o=(p=window.matchMedia)==null?void 0:p.call(window,"(max-width: 640px)"))!=null&&o.matches&&(r.preventDefault(),window.location.href=`/local_hub_app/local_hub_info_mobile.html?business_id=${encodeURIComponent(a.id||"")}`)},children:e.jsx("span",{children:"View Details"})})]})}function B(a){return typeof a=="string"?{value:a,label:a}:a}function N({id:a,label:c,value:n,items:h,allOption:r,onChange:m,containerClassName:p="filter-box",labelClassName:o="filter-label"}){const d=l.useRef(null),[f,s]=l.useState(!1),b=l.useMemo(()=>(h||[]).map(B),[h]),v=l.useMemo(()=>B(r),[r]),w=l.useMemo(()=>{const u=b.find(x=>x.value===n);return(u==null?void 0:u.label)??v.label},[v.label,b,n]);l.useEffect(()=>{function u(x){d.current&&(d.current.contains(x.target)||s(!1))}return document.addEventListener("click",u),()=>document.removeEventListener("click",u)},[]);function j(u){m(u),s(!1)}return e.jsxs("div",{className:p,style:{zIndex:f?3:1},children:[c?e.jsx("label",{className:o,htmlFor:a,children:c}):null,e.jsxs("div",{className:`custom-dropdown ${f?"active":""}`,ref:d,children:[e.jsxs("button",{id:a,type:"button",className:"custom-dropdown-btn","aria-haspopup":"listbox","aria-expanded":f,onClick:u=>{u.stopPropagation(),s(x=>!x)},children:[e.jsx("span",{children:w}),e.jsx("i",{className:"fas fa-chevron-down"})]}),e.jsxs("div",{className:"custom-dropdown-menu",role:"listbox","aria-label":c,children:[e.jsx("div",{className:`custom-dropdown-item ${n===v.value?"selected":""}`,role:"option","aria-selected":n===v.value,onClick:()=>j(v.value),children:v.label}),b.map(u=>e.jsx("div",{className:`custom-dropdown-item ${n===u.value?"selected":""}`,role:"option","aria-selected":n===u.value,onClick:()=>j(u.value),children:u.label},u.value))]})]})]})}const S={limpopo:["Tzaneen","Louis Trichardt","Polokwane","Lephalale","Mokopane","Modimolle","Musina","Phalaborwa","Bela-Bela","Thohoyandou","Thabazimbi","Giyani","Lebowakgomo","Seshego","Burgersfort","Malamulele","Vuwani","Sibasa","Mphephu"],gauteng:["Johannesburg","Vereeniging","Heidelberg","Pretoria","Krugersdorp","Centurion","Thokoza","Randfontein","Carletonville","Alberton","Vanderbijlpark","Soweto","Springs","Thembisa","Boksburg","Randburg","Benoni","Bophelong","Alexandra","Mamelodi","Tsakani","Duduza","Refilwe","Vosloorus","Wattville","Sebokeng","Hammanskraal","Evaton","Khutsong","Katlehong","Kagiso","Zithobeni","Reiger Park","Midrand","Sharpeville","Muldersdrift","Roodepoort","Meyerton"],"western-cape":["Cape Town","Stellenbosch","Paarl","Franschhoek","George","Mossel Bay","Knysna","Hermanus","Worcester","Somerset West","Bellville","Claremont"],"kwazulu-natal":["Durban","Pietermaritzburg","Umhlanga","Pinetown","Richards Bay","Newcastle","Ladysmith","Empangeni","Ballito","Margate"],"eastern-cape":["Gqeberha","Port Elizabeth","East London","Mthatha","Grahamstown","King William's Town","Jeffreys Bay","Uitenhage"],mpumalanga:["Mbombela","Nelspruit","Witbank","eMalahleni","Middelburg","Secunda","White River","Hazyview"],"north-west":["Mahikeng","Rustenburg","Klerksdorp","Potchefstroom","Brits","Zeerust","Lichtenburg"],"free-state":["Bloemfontein","Welkom","Sasolburg","Bethlehem","Kroonstad","Parys","Harrismith"],"northern-cape":["Kimberley","Upington","Springbok","Kuruman","De Aar","Port Nolloth"]},W=[{value:"relevance",label:"Relevance"},{value:"rating_desc",label:"Highest Rated"},{value:"reviews_desc",label:"Most Reviews"},{value:"name_asc",label:"Name (A-Z)"}];function R(a){return String(a||"").trim().toLowerCase().replace(/\s+/g,"-")}function F(a){return String(a||"").split("-").filter(Boolean).map(c=>c.charAt(0).toUpperCase()+c.slice(1)).join(" ")}function H(){const[a,c]=l.useState([]),[n,h]=l.useState(!0),[r,m]=l.useState(""),[p,o]=l.useState(!1),[d,f]=l.useState(""),[s,b]=l.useState(""),[v,w]=l.useState(""),[j,u]=l.useState(""),[x,L]=l.useState("relevance");l.useEffect(()=>{const t=new AbortController;return h(!0),m(""),T({limit:200,offset:0,signal:t.signal}).then(i=>c(Array.isArray(i)?i:[])).catch(i=>{t.signal.aborted||(c([]),m(i instanceof Error?i.message:"Failed to load businesses."))}).finally(()=>{t.signal.aborted||h(!1)}),()=>t.abort()},[]);const z=l.useMemo(()=>Object.keys(S).sort().map(t=>({value:t,label:F(t)})),[]),_=l.useMemo(()=>[...new Set(a.map(t=>t.category))].filter(Boolean).sort(),[a]),M=l.useMemo(()=>[...new Set(Object.values(S).flat())].filter(Boolean).sort(),[]),A=l.useMemo(()=>{if(!s){const i=M,g=[...new Set(a.map(y=>y.city))].filter(Boolean).sort();return[...new Set([...i,...g])].sort()}const t=S[s]||[];return t.length?t.slice().sort():[...new Set(a.filter(i=>R(i.province)===s).map(i=>i.city))].filter(Boolean).sort()},[M,a,s]),C=l.useMemo(()=>{const t=d.trim().toLowerCase();let i=a.filter(g=>{const y=!t||g.name.toLowerCase().includes(t)||(g.tags||"").toLowerCase().includes(t),P=!s||R(g.province)===s,$=!v||g.city===v,E=!j||g.category===j;return y&&P&&$&&E});return x==="rating_desc"?i=[...i].sort((g,y)=>y.rating-g.rating):x==="reviews_desc"?i=[...i].sort((g,y)=>y.reviews-g.reviews):x==="name_asc"&&(i=[...i].sort((g,y)=>g.name.localeCompare(y.name))),i},[a,j,v,s,d,x]);return e.jsxs("div",{className:"container",children:[e.jsx("div",{className:"header-logo",children:e.jsx("img",{src:"/local_hub_app/logo/localhub.png",alt:"LocalHub"})}),r?e.jsxs("div",{className:"empty-state",style:{display:"block"},children:[e.jsx("i",{className:"fas fa-triangle-exclamation",style:{fontSize:"3rem",marginBottom:20,opacity:.2}}),e.jsx("h3",{children:"Failed to load businesses"}),e.jsx("p",{children:r}),e.jsx("p",{style:{opacity:.7,marginTop:10},children:"Check your internet connection and refresh the page."})]}):null,e.jsxs("div",{className:`search-sort-grid ${p?"":"filters-hidden"}`,children:[e.jsxs("div",{className:"search-box",children:[e.jsxs("div",{className:"input-group",style:{flex:1},children:[e.jsx("input",{type:"text",className:"form-control",value:d,onChange:t=>f(t.target.value),placeholder:"Search businesses, services...",disabled:n}),e.jsx("button",{type:"button",className:"btn-search","aria-label":"Search",children:e.jsx("i",{className:"fas fa-search"})})]}),e.jsx("button",{type:"button",className:`filter-icon-btn ${p?"active":""}`,title:"Toggle Filters",onClick:()=>o(t=>!t),disabled:n,children:e.jsx("i",{className:"fas fa-filter"})})]}),e.jsx(N,{id:"provinceDropdown",label:"Province:",value:s,allOption:{value:"",label:"All Provinces"},items:z,onChange:t=>{b(t),w("")}}),e.jsx(N,{id:"locationDropdown",label:"Location:",value:v,allOption:{value:"",label:"All Locations"},items:A.map(t=>({value:t,label:t})),onChange:w}),e.jsx(N,{id:"categoryDropdown",label:"Category:",value:j,allOption:{value:"",label:"All Categories"},items:_.map(t=>({value:t,label:t})),onChange:u}),e.jsx(N,{id:"sortDropdown",label:"Sort by:",value:x,allOption:{value:"relevance",label:"Relevance"},items:W.filter(t=>t.value!=="relevance"),onChange:L,containerClassName:"sort-box",labelClassName:"sort-label"})]}),e.jsxs("div",{className:"business-grid",children:[n?e.jsxs("div",{className:"empty-state",style:{display:"block"},children:[e.jsx("i",{className:"fas fa-spinner",style:{fontSize:"3rem",marginBottom:20,opacity:.2}}),e.jsx("h3",{children:"Loading businesses..."}),e.jsx("p",{children:"Please wait a moment."})]}):null,!n&&!r?C.map(t=>e.jsx(O,{business:t},t.id)):null,!n&&!r&&C.length===0?e.jsxs("div",{className:"empty-state",style:{display:"block"},children:[e.jsx("i",{className:"fas fa-search",style:{fontSize:"3rem",marginBottom:20,opacity:.2}}),e.jsx("h3",{children:"No results found"}),e.jsx("p",{children:"Try adjusting your search or filters."})]}):null]})]})}U.createRoot(document.getElementById("root")).render(e.jsx(D.StrictMode,{children:e.jsx(H,{})}));
