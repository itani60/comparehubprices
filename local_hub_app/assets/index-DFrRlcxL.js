import{r as s,j as r,s as H,t as Y,f as me,c as ge,R as fe}from"./localHub-8HcfkriN.js";function he({slides:e}){const[o,n]=s.useState(0),g=s.useMemo(()=>Array.isArray(e)?e:[],[e]),d=s.useRef(null);if(g.length===0)return null;const f=g.length,S=100/f;return s.useEffect(()=>{n(0)},[f]),s.useEffect(()=>{if(f<=1)return;function p(){d.current||(d.current=setInterval(()=>{n(v=>(v+1)%f)},1e4))}function c(){d.current&&(clearInterval(d.current),d.current=null)}return p(),()=>c()},[f]),r.jsxs("div",{className:"carousel",onMouseEnter:()=>{d.current&&(clearInterval(d.current),d.current=null)},onMouseLeave:()=>{f<=1||d.current||(d.current=setInterval(()=>{n(p=>(p+1)%f)},1e4))},children:[r.jsx("div",{className:"carousel-inner",style:{width:`${f*100}%`,transform:`translateX(-${o*S}%)`},children:g.map((p,c)=>r.jsx("div",{className:"carousel-slide",style:{width:`${S}%`,flex:`0 0 ${S}%`},children:r.jsx("img",{src:p.url,alt:p.alt,onError:v=>{var M;v.currentTarget.onerror=null;const y=p&&typeof p.fallbackUrl=="string"?p.fallbackUrl:((M=g[0])==null?void 0:M.url)||"";v.currentTarget.src=y}})},`${p.url}-${c}`))}),r.jsx("div",{className:"carousel-dots",children:g.map((p,c)=>r.jsx("span",{className:`dot ${c===o?"active":""}`,onClick:()=>n(c)},c))})]})}const te="lh_profile_impressions_v1";let T;function re(){if(T||(T=new Set,typeof window>"u"))return T;try{const e=window.sessionStorage.getItem(te),o=e?JSON.parse(e):[];Array.isArray(o)&&o.forEach(n=>{typeof n=="string"&&n.trim().length&&T.add(n)})}catch{}return T}function Z(e){return e?re().has(String(e)):!1}function X(e){if(!e)return;const o=re(),n=String(e);if(!o.has(n)&&(o.add(n),!(typeof window>"u")))try{window.sessionStorage.setItem(te,JSON.stringify(Array.from(o)))}catch{}}function pe(e){const o=Number(e);if(!Number.isFinite(o)||o<=0)return null;const n=Math.max(1,Math.min(5,Math.round(o))),g=5-n;return[...Array.from({length:n},(d,f)=>r.jsx("i",{className:"fa-solid fa-star"},`filled-${f}`)),...Array.from({length:g},(d,f)=>r.jsx("i",{className:"fa-regular fa-star"},`empty-${f}`))]}function ve({business:e}){const o=(e==null?void 0:e.name)||"Business",n=Number(e.rating),g=Number.isFinite(n)&&n>0,d=(e==null?void 0:e.businessType)||(e==null?void 0:e.category)||"Services",f=!!(e!=null&&e.isVerified||e!=null&&e.verified||e!=null&&e.is_verified),S="/local_hub_app/images/verified-badge.svg",p=s.useRef(null),c=s.useRef(null),v=s.useMemo(()=>`https://ui-avatars.com/api/?name=${encodeURIComponent(o)}&background=random&color=fff`,[o]),y=s.useMemo(()=>{const u=typeof e.logo=="string"?e.logo.trim():"";return u.length?u:v},[v,e.logo]),M=s.useMemo(()=>{const u=H({title:o,subtitle:"No product image"}),N=H({title:o,subtitle:"Image unavailable"}),h=Array.isArray(e.images)?e.images.filter(x=>typeof x=="string"&&x.trim().length>0):typeof e.image=="string"&&e.image.trim().length>0?[e.image.trim()]:[],w=Array.from(new Set(h)),i=[];for(let x=0;x<Math.min(4,w.length);x++)i.push(w[x]);for(;i.length<4;)i.push(u);return i.map((x,L)=>({url:x,alt:`${o} product image`,fallbackUrl:N,isPlaceholder:x===u}))},[e.image,e.images,o]);return s.useEffect(()=>{if(!(e!=null&&e.id)||Z(e.id)||typeof window>"u")return;const u=p.current;if(!u)return;if(!("IntersectionObserver"in window)){X(e.id),Y({businessId:e.id});return}let N=!1;const h=new IntersectionObserver(w=>{const i=w[0];if(!i||N)return;i.isIntersecting&&i.intersectionRatio>=.5?c.current==null&&(c.current=window.setTimeout(()=>{if(c.current=null,N||Z(e.id))return;const L=u.getBoundingClientRect(),E=Math.min(L.bottom,window.innerHeight)-Math.max(L.top,0);(L.height>0?E/L.height:0)<.5||(X(e.id),Y({businessId:e.id}),h.disconnect())},1e3)):c.current!=null&&(clearTimeout(c.current),c.current=null)},{threshold:[0,.5,1]});return h.observe(u),()=>{N=!0,c.current!=null&&(clearTimeout(c.current),c.current=null),h.disconnect()}},[e==null?void 0:e.id]),r.jsxs("div",{className:"card",ref:p,children:[r.jsxs("div",{className:"biz-header",children:[r.jsx("img",{src:y,alt:`${o} logo`,className:"biz-avatar",onError:u=>{u.currentTarget.onerror=null,u.currentTarget.src=v}}),r.jsx("div",{children:r.jsxs("div",{className:"biz-name",children:[o,f?r.jsx("img",{src:S,alt:"Verified",className:"verified-badge",title:"Verified business","aria-label":"Verified business"}):null]})})]}),r.jsx(he,{slides:M}),r.jsxs("div",{className:"biz-address",children:[r.jsx("i",{className:"fa-solid fa-location-dot",style:{alignSelf:"flex-start",marginTop:3}}),r.jsxs("div",{children:[r.jsx("div",{style:{fontWeight:600},children:e.address||"123 Main Street"}),r.jsxs("div",{style:{fontSize:"0.8em",opacity:.8},children:[e.suburb||"Central",", ",e.city||"Johannesburg"]}),r.jsx("div",{style:{fontSize:"0.8em",opacity:.8},children:e.province||"Gauteng"})]})]}),r.jsx("div",{className:"biz-rating",style:{marginTop:8},children:g?r.jsxs(r.Fragment,{children:[pe(n)," ",r.jsxs("span",{children:["(",n.toFixed(1),")"]})]}):r.jsx("span",{className:"no-rating",children:"No ratings yet"})}),r.jsx("div",{className:"badge",style:{marginTop:6},children:d}),r.jsx("a",{href:`/local_hub_app/local_hub_info.html?business_id=${encodeURIComponent(e.id||"")}`,className:"view-details-btn",onClick:u=>{var h,w;(w=(h=window.matchMedia)==null?void 0:h.call(window,"(max-width: 640px)"))!=null&&w.matches&&(u.preventDefault(),window.location.href=`/local_hub_app/local_hub_info_mobile.html?business_id=${encodeURIComponent(e.id||"")}`)},children:r.jsx("span",{children:"View Details"})})]})}function Q(e){return typeof e=="string"?{value:e,label:e}:e}function F({id:e,label:o,value:n,items:g,allOption:d,onChange:f,containerClassName:S="filter-box",labelClassName:p="filter-label",disabled:c=!1}){const v=s.useRef(null),[y,M]=s.useState(!1),u=s.useMemo(()=>(g||[]).map(Q),[g]),N=s.useMemo(()=>Q(d),[d]),h=s.useMemo(()=>{const i=u.find(x=>x.value===n);return(i==null?void 0:i.label)??N.label},[N.label,u,n]);s.useEffect(()=>{c&&M(!1)},[c]),s.useEffect(()=>{function i(x){v.current&&(v.current.contains(x.target)||M(!1))}return document.addEventListener("click",i),()=>document.removeEventListener("click",i)},[]);function w(i){f(i),M(!1)}return r.jsxs("div",{className:S,style:{zIndex:y?3:1},children:[o?r.jsx("label",{className:p,htmlFor:e,children:o}):null,r.jsxs("div",{className:`custom-dropdown ${y?"active":""}`,ref:v,children:[r.jsxs("button",{id:e,type:"button",className:"custom-dropdown-btn","aria-haspopup":"listbox","aria-expanded":y,disabled:c,onClick:i=>{i.stopPropagation(),!c&&M(x=>!x)},children:[r.jsx("span",{children:h}),r.jsx("i",{className:"fas fa-chevron-down"})]}),r.jsx("div",{className:"custom-dropdown-menu",role:"listbox","aria-label":o,children:r.jsxs("div",{className:"custom-dropdown-items",children:[r.jsx("div",{className:`custom-dropdown-item ${n===N.value?"selected":""}`,role:"option","aria-selected":n===N.value,onClick:()=>w(N.value),children:N.label}),u.map(i=>r.jsx("div",{className:`custom-dropdown-item ${n===i.value?"selected":""}`,role:"option","aria-selected":n===i.value,onClick:()=>w(i.value),children:i.label},i.value))]})})]})]})}const b={limpopo:["Tzaneen","Louis Trichardt","Polokwane","Lephalale","Mokopane","Modimolle","Musina","Phalaborwa","Bela-Bela","Thohoyandou","Thabazimbi","Giyani","Lebowakgomo","Seshego","Burgersfort","Malamulele","Vuwani","Sibasa","Mphephu"],gauteng:["Johannesburg","Vereeniging","Heidelberg","Pretoria","Krugersdorp","Centurion","Thokoza","Randfontein","Carletonville","Alberton","Vanderbijlpark","Soweto","Springs","Thembisa","Boksburg","Randburg","Benoni","Bophelong","Alexandra","Mamelodi","Tsakani","Duduza","Refilwe","Vosloorus","Wattville","Sebokeng","Hammanskraal","Evaton","Khutsong","Katlehong","Kagiso","Zithobeni","Reiger Park","Midrand","Sharpeville","Muldersdrift","Roodepoort","Meyerton"],"western-cape":["Cape Town","Stellenbosch","Paarl","Franschhoek","George","Mossel Bay","Knysna","Hermanus","Worcester","Somerset West","Bellville","Claremont"],"kwazulu-natal":["Durban","Pietermaritzburg","Umhlanga","Pinetown","Richards Bay","Newcastle","Ladysmith","Empangeni","Ballito","Margate"],"eastern-cape":["Gqeberha","Port Elizabeth","East London","Mthatha","Grahamstown","King William's Town","Jeffreys Bay","Uitenhage"],mpumalanga:["Mbombela","Nelspruit","Witbank","eMalahleni","Middelburg","Secunda","White River","Hazyview"],"north-west":["Mahikeng","Rustenburg","Klerksdorp","Potchefstroom","Brits","Zeerust","Lichtenburg"],"free-state":["Bloemfontein","Welkom","Sasolburg","Bethlehem","Kroonstad","Parys","Harrismith"],"northern-cape":["Kimberley","Upington","Springbok","Kuruman","De Aar","Port Nolloth"]},O=12,z=[{value:"all",label:"All Categories"},{value:"service",label:"Service"},{value:"beauty",label:"Beauty & Wellness"},{value:"health",label:"Health Care"},{value:"retail",label:"Retail"}],ee=[{value:"relevance",label:"Relevance"},{value:"rating",label:"Highest Rated"},{value:"popular",label:"Most Popular"},{value:"newest",label:"Newest"},{value:"distance",label:"Distance"}];function R(e){return String(e||"").trim().toLowerCase().replace(/&/g,"and").replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"")}function U(e){return String(e||"").split("-").filter(Boolean).map(o=>o.charAt(0).toUpperCase()+o.slice(1)).join(" ")}function ye(e){const o=[],n=g=>{if(g){if(Array.isArray(g)){g.forEach(n);return}if(typeof g=="string"){const d=R(g);d&&o.push(d)}}};return n(e==null?void 0:e.category),n(e==null?void 0:e.businessCategory),n(e==null?void 0:e.categories),n(e==null?void 0:e.categoryTags),n(e==null?void 0:e.businessCategories),n(e==null?void 0:e.businessType),Array.from(new Set(o))}function xe(e){var g,d,f,S,p,c,v;const o=Number((e==null?void 0:e.latitude)??(e==null?void 0:e.lat)??((g=e==null?void 0:e.location)==null?void 0:g.lat)??((d=e==null?void 0:e.coordinates)==null?void 0:d.lat)??((f=e==null?void 0:e.coordinates)==null?void 0:f.latitude)),n=Number((e==null?void 0:e.longitude)??(e==null?void 0:e.lng)??((S=e==null?void 0:e.location)==null?void 0:S.lng)??((p=e==null?void 0:e.location)==null?void 0:p.lon)??((c=e==null?void 0:e.coordinates)==null?void 0:c.lng)??((v=e==null?void 0:e.coordinates)==null?void 0:v.longitude));return!Number.isFinite(o)||!Number.isFinite(n)?null:{lat:o,lng:n}}function je(e,o){const n=c=>c*Math.PI/180,g=n(o.lat-e.lat),d=n(o.lng-e.lng),f=n(e.lat),S=n(o.lat),p=Math.sin(g/2)**2+Math.cos(f)*Math.cos(S)*Math.sin(d/2)**2;return 2*6371*Math.asin(Math.sqrt(p))}function Ne(){const[e,o]=s.useState([]),[n,g]=s.useState(!0),[d,f]=s.useState(""),[S,p]=s.useState(!1),[c,v]=s.useState(""),[y,M]=s.useState("all"),[u,N]=s.useState("all"),[h,w]=s.useState("all"),[i,x]=s.useState("relevance"),[L,E]=s.useState(O),[I,K]=s.useState(null),[W,ae]=s.useState(!1),[ne,_]=s.useState(!1),D=s.useRef(null);s.useEffect(()=>{const t=new AbortController;return g(!0),f(""),me({limit:200,offset:0,signal:t.signal}).then(a=>{o(Array.isArray(a)?a:[])}).catch(a=>{t.signal.aborted||f(a instanceof Error?a.message:"Failed to load businesses.")}).finally(()=>{t.signal.aborted||g(!1)}),()=>t.abort()},[]),s.useEffect(()=>{function t(a){D.current&&(D.current.contains(a.target)||_(!1))}return document.addEventListener("click",t),()=>document.removeEventListener("click",t)},[]),s.useEffect(()=>{E(O)},[c,y,u,h,i]),s.useEffect(()=>{i!=="distance"||W||(ae(!0),navigator.geolocation&&navigator.geolocation.getCurrentPosition(t=>{K({lat:t.coords.latitude,lng:t.coords.longitude})},()=>{K(null)},{enableHighAccuracy:!1,timeout:6e3,maximumAge:3e5}))},[i,W]);const le=s.useMemo(()=>Object.keys(b).sort().map(t=>({value:t,label:U(t)})),[]),A=u==="all",V=s.useMemo(()=>A?[]:(b[u]||[]).slice().sort(),[A,u]),B=s.useMemo(()=>{let t=e.slice();if(y!=="all"){const l={service:["service"],beauty:["beauty","wellness","salon","spa"],health:["health","medical","clinic","pharmacy"],retail:["retail","store","shop","market"]}[y]||[y];t=t.filter(m=>{const j=ye(m);if(j.length)return j.includes(y);const C=R((m==null?void 0:m.businessType)||(m==null?void 0:m.category));return l.some(k=>C.includes(k)||C===k)})}return u!=="all"&&(t=t.filter(a=>R(a==null?void 0:a.province)===u)),h!=="all"&&(t=t.filter(a=>{const l=R(a==null?void 0:a.city),m=R(a==null?void 0:a.suburb);return l===h||m===h})),t},[e,y,h,u]),$=s.useMemo(()=>{let t=B.slice();const a=c.trim().toLowerCase();if(a&&(t=t.filter(l=>{const m=String((l==null?void 0:l.name)||"").toLowerCase(),j=String((l==null?void 0:l.businessType)||(l==null?void 0:l.category)||"").toLowerCase(),C=String((l==null?void 0:l.city)||"").toLowerCase(),k=String((l==null?void 0:l.suburb)||"").toLowerCase(),P=String((l==null?void 0:l.address)||"").toLowerCase();return m.includes(a)||j.includes(a)||C.includes(a)||k.includes(a)||P.includes(a)})),i==="rating")t.sort((l,m)=>(Number(m==null?void 0:m.rating)||0)-(Number(l==null?void 0:l.rating)||0));else if(i==="popular")t.sort((l,m)=>(Number(m==null?void 0:m.followers)||0)-(Number(l==null?void 0:l.followers)||0));else if(i==="newest")t.sort((l,m)=>{const j=new Date((l==null?void 0:l.createdAt)||0).getTime();return new Date((m==null?void 0:m.createdAt)||0).getTime()-j});else if(i==="distance"&&I){const l=t.map(j=>{const C=xe(j),k=C?je(I,C):Number.POSITIVE_INFINITY;return{...j,_distance:k}});l.some(j=>Number.isFinite(j._distance)&&j._distance<Number.POSITIVE_INFINITY)&&(t=l.sort((j,C)=>j._distance-C._distance).map(j=>{const{_distance:C,...k}=j;return k}))}return t},[B,c,i,I]),se=s.useMemo(()=>$.slice(0,L),[$,L]),oe=L<$.length,G=s.useMemo(()=>{const t=c.trim().toLowerCase();return t?B.filter(a=>{const l=String((a==null?void 0:a.name)||"").toLowerCase(),m=String((a==null?void 0:a.businessType)||(a==null?void 0:a.category)||"").toLowerCase(),j=String((a==null?void 0:a.city)||"").toLowerCase(),C=String((a==null?void 0:a.suburb)||"").toLowerCase();return l.includes(t)||m.includes(t)||j.includes(t)||C.includes(t)}).slice(0,6):[]},[B,c]),q=ne&&c.trim().length>0,ce=!!(c.trim()||y!=="all"||u!=="all"||h!=="all"||i!=="relevance"),J=s.useMemo(()=>{const t=[],a=h!=="all"?V.find(l=>R(l)===h)||U(h):"";if(c.trim()&&t.push({label:`Search: "${c.trim()}"`,onClear:()=>v("")}),y!=="all"){const l={service:"Service",beauty:"Beauty & Wellness",health:"Health Care",retail:"Retail"};t.push({label:l[y]||y,onClear:()=>M("all")})}if(u!=="all"&&t.push({label:U(u),onClear:()=>{N("all"),w("all")}}),h!=="all"&&t.push({label:a||h,onClear:()=>w("all")}),i!=="relevance"){const l={rating:"Highest Rated",popular:"Most Popular",newest:"Newest",distance:"Distance"};t.push({label:l[i]||i,onClear:()=>x("relevance")})}return t},[y,h,V,u,c,i]);function ie(){v(""),M("all"),N("all"),w("all"),x("relevance")}const ue="/local_hub_app/logo/localhub_logo.png",de="/local_hub_app/images/verified-badge.svg";return r.jsx("div",{className:"page-shell",style:{"--bg-image":"url(/local_hub_app/images/background.png)"},children:r.jsxs("div",{className:"page",children:[r.jsx("div",{className:"hero",children:r.jsx("img",{src:ue,alt:"LocalHub",className:"hero-logo"})}),r.jsxs("div",{className:"search-card",children:[r.jsxs("div",{className:"search-wrapper",ref:D,children:[r.jsx("input",{type:"text",value:c,onChange:t=>{v(t.target.value),_(!0)},onFocus:()=>_(!0),placeholder:"Search a business, product, or neighborhood...",disabled:n}),r.jsx("button",{type:"button",className:`search-clear-btn ${c?"visible":""}`,"aria-label":"Clear search",onClick:()=>{v(""),_(!1)},children:"x"}),r.jsx("div",{className:`search-suggestions ${q?"visible":""}`,children:q?G.length?G.map(t=>{const a=(t==null?void 0:t.name)||"Business",l=typeof(t==null?void 0:t.logo)=="string"&&t.logo.trim().length?t.logo.trim():`https://ui-avatars.com/api/?name=${encodeURIComponent(a)}&background=random&color=fff`,m=[t==null?void 0:t.suburb,t==null?void 0:t.city,t==null?void 0:t.province].filter(Boolean),j=m.length?m.join(" â€¢ "):"Local business",C=(t==null?void 0:t.businessType)||(t==null?void 0:t.category)||"Services",k=!!(t!=null&&t.isVerified||t!=null&&t.verified||t!=null&&t.is_verified);return r.jsx("button",{type:"button",className:"search-suggestion",onClick:()=>{v(a),_(!1)},children:r.jsxs("span",{className:"suggestion-row",children:[r.jsx("img",{src:l,alt:`${a} logo`,className:"suggestion-avatar",onError:P=>{P.currentTarget.onerror=null,P.currentTarget.src=H({title:"Logo",subtitle:a})}}),r.jsxs("span",{className:"suggestion-text",children:[r.jsxs("span",{className:"suggestion-title",children:[a,k?r.jsx("img",{src:de,alt:"Verified",className:"suggestion-verified",title:"Verified business","aria-label":"Verified business"}):null]}),r.jsx("span",{className:"suggestion-badge",children:C}),r.jsx("span",{className:"suggestion-meta",children:j})]})]})},`${t.id}-suggestion`)}):r.jsx("div",{className:"search-suggestion empty",children:"No matches found"}):null})]}),r.jsx("button",{type:"button",onClick:()=>_(!1),children:"Search"})]}),r.jsxs("div",{className:"filter-toggle-row",children:[r.jsx("button",{type:"button",className:"filter-toggle-btn",onClick:()=>p(t=>!t),disabled:n,children:S?"Hide Filters":"Show Filters"}),r.jsx("button",{type:"button",className:"clear-filters-btn",onClick:ie,disabled:n,style:{display:ce?"inline-flex":"none"},children:"Clear Filters"})]}),r.jsxs("div",{className:`filter-bar ${S?"":"hidden"}`,children:[r.jsx(F,{id:"categoryDropdown",label:"Category:",value:y,allOption:z[0],items:z.slice(1),onChange:M}),r.jsx(F,{id:"provinceDropdown",label:"Province:",value:u,allOption:{value:"all",label:"All Provinces"},items:le,onChange:t=>{N(t),w("all")}}),r.jsx(F,{id:"locationDropdown",label:"Location:",value:h,allOption:{value:"all",label:A?"Select Province First":"All Locations"},items:V.map(t=>({value:R(t),label:t})),onChange:w,disabled:A}),r.jsx(F,{id:"sortDropdown",label:"Sort by:",value:i,allOption:ee[0],items:ee.slice(1),onChange:x})]}),J.length?r.jsx("div",{className:"active-filters",children:J.map(t=>r.jsxs("span",{className:"filter-chip",children:[t.label,r.jsx("button",{type:"button",onClick:t.onClear,"aria-label":`Clear ${t.label}`,children:"x"})]},t.label))}):null,d?r.jsxs("div",{className:"error-state",children:[r.jsx("h3",{children:"Failed to load businesses"}),r.jsx("p",{children:d})]}):null,r.jsxs("div",{className:"business-grid",children:[n?r.jsx("div",{className:"skeleton-grid",style:{gridColumn:"1 / -1"},children:Array.from({length:6},(t,a)=>r.jsxs("div",{className:"skeleton-card",children:[r.jsx("div",{className:"skeleton-line small"}),r.jsx("div",{className:"skeleton-line tiny"}),r.jsx("div",{className:"skeleton-box"}),r.jsx("div",{className:"skeleton-line"}),r.jsx("div",{className:"skeleton-line small"})]},a))}):null,!n&&!d?se.map(t=>r.jsx(ve,{business:t},t.id)):null,!n&&!d&&$.length===0?r.jsxs("div",{className:"empty-state",children:[r.jsx("h3",{children:"No results found"}),r.jsx("p",{children:"Try adjusting your filters or search term."})]}):null]}),!n&&!d&&oe?r.jsx("div",{className:"load-more-row",children:r.jsx("button",{type:"button",className:"load-more-btn",onClick:()=>E(t=>t+O),children:"Load more"})}):null]})})}ge.createRoot(document.getElementById("root")).render(r.jsx(fe.StrictMode,{children:r.jsx(Ne,{})}));
