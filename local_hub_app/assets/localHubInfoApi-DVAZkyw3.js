import{s as x,g as k}from"./localHub-Ddi82mor.js";function m(e){try{const i=`; ${document.cookie}`.split(`; ${e}=`);return i.length===2?i.pop().split(";").shift():""}catch{return""}}function J(){try{return new URL(window.location.href).searchParams.get("business_id")||""}catch{return""}}async function z({businessId:e,limit:s=30,offset:i=0,signal:a}={}){const o=String(e||"").trim();if(!o)throw new Error("Missing business_id in the URL.");const{url:c,anonKey:n}=k(),t=`${c}/functions/v1/local_hub?business_id=${encodeURIComponent(o)}&followers=1&limit=${encodeURIComponent(s)}&offset=${encodeURIComponent(i)}`,u=m("standard_session_id")||"",l=m("business_session_id")||"",d=u||l,b=await fetch(t,{method:"GET",credentials:"include",headers:{apikey:n,Authorization:`Bearer ${n}`,"Content-Type":"application/json",...d?{"x-access-token":d,"x-session-id":d}:{}},signal:a}),h=await b.json().catch(()=>({}));if(!b.ok){const v=typeof(h==null?void 0:h.error)=="string"?h.error:`Failed to load followers (HTTP ${b.status})`;throw new Error(v)}return h||null}function E(e){try{const s=new Date(e);return Number.isNaN(s.getTime())?"":s.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})}catch{return""}}function H(e){if(e==null)return"";if(Array.isArray(e))return e.map(s=>String(s||"").trim()).filter(Boolean).join(" | ");if(typeof e=="string"){const s=e.trim();if(!s)return"";try{const i=JSON.parse(s);if(typeof i=="string")return i.trim();if(Array.isArray(i))return i.map(a=>String(a||"").trim()).filter(Boolean).join(" | ")}catch{}return s.replace(/^"|"$/g,"")}return String(e).trim()}function F(e){var o,c;const s=String(e||"").trim().split(/\s+/).filter(Boolean);if(!s.length)return"U";const i=((o=s[0])==null?void 0:o[0])||"",a=s.length>1&&((c=s[s.length-1])==null?void 0:c[0])||"";return(i+a).toUpperCase()||"U"}function G(e,s){const i=typeof s=="string"?s.trim():"";if(!i)return"";if(/^https?:\/\//i.test(i))return i;if(e==="whatsapp"){const o=i.replace(/[^\d]/g,"");return o?`https://wa.me/${o}`:""}const a=i.replace(/^@/,"");return a?e==="facebook"?`https://www.facebook.com/${a}`:e==="twitter"?`https://x.com/${a}`:e==="instagram"?`https://www.instagram.com/${a}`:e==="tiktok"?`https://www.tiktok.com/@${a}`:"":""}function q({recipientId:e,recipientName:s}){try{const i=window.location.hostname,o=i==="localhost"||i==="127.0.0.1"||i===""?`http://${i||"localhost"}:5173/`:`${window.location.origin}/chat-hub/`,c=new URL(o);return e&&c.searchParams.set("recipientId",String(e)),s&&c.searchParams.set("recipientName",String(s)),c.toString()}catch{return"http://localhost:5173/"}}async function W({businessId:e,signal:s}={}){const i=String(e||"").trim();if(!i)throw new Error("Missing business_id in the URL.");const{url:a,anonKey:o}=k(),c=`${a}/functions/v1/local_hub?business_id=${encodeURIComponent(i)}`,n=m("standard_session_id")||"",t=m("business_session_id")||"",u=n||t,l=await fetch(c,{method:"GET",credentials:"include",headers:{apikey:o,Authorization:`Bearer ${o}`,"Content-Type":"application/json",...u?{"x-access-token":u,"x-session-id":u}:{}},signal:s}),d=await l.json().catch(()=>({}));if(!l.ok){const b=typeof(d==null?void 0:d.error)=="string"?d.error:`Failed to load business details (HTTP ${l.status})`;throw new Error(b)}return d||null}function D(){const e=m("standard_session_id"),s=m("standard_csrf_token");if(e&&s)return{sessionId:e,csrfToken:s};const i=m("business_session_id"),a=m("business_csrf_token");return i&&a?{sessionId:i,csrfToken:a}:null}async function M({action:e,payload:s={},signal:i}={}){const a=D();if(!a)throw new Error("Please log in to continue.");const{url:o,anonKey:c}=k(),n=await fetch(`${o}/functions/v1/local_hub`,{method:"POST",headers:{"Content-Type":"application/json",apikey:c,Authorization:`Bearer ${c}`,"x-access-token":a.sessionId,"x-csrf-token":a.csrfToken},body:JSON.stringify({action:e,...s||{}}),signal:i}),t=await n.json().catch(()=>({}));if(!n.ok){const u=typeof(t==null?void 0:t.error)=="string"?t.error:`Request failed (HTTP ${n.status})`;throw new Error(u)}return t}async function Q({businessId:e,method:s,url:i,signal:a}={}){const o=String(e||"").trim();if(!o)return{ok:!1};const{url:c,anonKey:n}=k(),t=await fetch(`${c}/functions/v1/local_hub`,{method:"POST",headers:{"Content-Type":"application/json",apikey:n,Authorization:`Bearer ${n}`},body:JSON.stringify({action:"share_business_profile",business_id:o,share_method:s||"",share_url:i||""}),signal:a}),u=await t.json().catch(()=>({}));return t.ok?{ok:!0}:{ok:!1,error:(u==null?void 0:u.error)||"Failed to track share."}}async function X({businessId:e,reason:s,details:i,signal:a}={}){if(!e)throw new Error("Missing business id.");if(!s)throw new Error("Please select a reason.");return await M({action:"report_business",payload:{business_id:e,reason:s,details:i},signal:a})}function Y(e){const s=(e==null?void 0:e.post)||null,i=e!=null&&e.stats&&typeof e.stats=="object"?e.stats:{},a=Array.isArray(e==null?void 0:e.reviews)?e.reviews:[],o=e!=null&&e.viewer&&typeof e.viewer=="object"?e.viewer:null,c=e!=null&&e.product_reactions&&typeof e.product_reactions=="object"?e.product_reactions:{},n=s!=null&&s.content&&typeof s.content=="object"?s.content:{},t=n!=null&&n.business&&typeof n.business=="object"?n.business:{},u=n!=null&&n.moderation&&typeof n.moderation=="object"?n.moderation:{},l=t.businessName||t.name||"Business",d=typeof t.businessLogo=="string"?t.businessLogo.trim():"",b=`https://ui-avatars.com/api/?name=${encodeURIComponent(l)}&background=random&color=fff`,h=t.streetAddress||t.businessAddress||t.address||"",v=t.suburb||"",I=t.city||"",N=t.province||"",$=[h,v,I,N].map(r=>String(r||"").trim()).filter(Boolean).join(", "),T=!!((u==null?void 0:u.status)==="approved"||(s==null?void 0:s.status)==="approved"||t!=null&&t.isVerified||t!=null&&t.verified||t!=null&&t.is_verified||n!=null&&n.isVerified||n!=null&&n.verified||s!=null&&s.isVerified||s!=null&&s.verified||s!=null&&s.is_verified),S=t.businessNumber||t.business_number||t.phone||t.businessPhone||(n==null?void 0:n.businessNumber)||(n==null?void 0:n.business_number)||"",U=typeof S=="string"?S.trim():"",j=H(t.businessHours||t.business_hours||(n==null?void 0:n.businessHours)||(n==null?void 0:n.business_hours)||""),B=typeof(t==null?void 0:t.description)=="string"?t.description.trim():typeof(n==null?void 0:n.description)=="string"?n.description.trim():"",A=(Array.isArray(n==null?void 0:n.products)?n.products:[]).map(r=>{const p=typeof(r==null?void 0:r.name)=="string"&&r.name.trim()?r.name.trim():typeof(r==null?void 0:r.title)=="string"&&r.title.trim()?r.title.trim():"Product",_=Array.isArray(r==null?void 0:r.images)?r.images.filter(g=>typeof g=="string"&&g.trim()).map(g=>g.trim()):[],y=x({title:l,subtitle:p}),w=_.length?_.slice(0,10):[y];return{title:p,images:w,cover:w[0]||y}}),f=t.socials&&typeof t.socials=="object"&&t.socials||t.socialMedia&&typeof t.socialMedia=="object"&&t.socialMedia||t.social&&typeof t.social=="object"&&t.social||{},R={facebook:f.facebook||f.fb||"",twitter:f.twitter||f.x||"",whatsapp:f.whatsapp||f.wa||f.phone||"",tiktok:f.tiktok||f.tt||"",instagram:f.instagram||f.ig||""},P=a.map(r=>{const p=typeof(r==null?void 0:r.author_name)=="string"&&r.author_name.trim()?r.author_name.trim():typeof(r==null?void 0:r.authorName)=="string"&&r.authorName.trim()?r.authorName.trim():"Anonymous User",_=String((r==null?void 0:r.id)||""),y=Number(r==null?void 0:r.rating)||0,w=(r==null?void 0:r.created_at)||(r==null?void 0:r.updated_at)||"",g=w?Date.parse(w):0,C=typeof(r==null?void 0:r.content)=="string"?r.content:"",L=Number(r==null?void 0:r.helpful_count)||0;return{id:_,name:p,initials:F(p),avatarUrl:"",dateLabel:E(w)||"",timestamp:Number.isFinite(g)?g:0,rating:y,text:C,helpful:L}});return{businessId:(s==null?void 0:s.business_id)||(s==null?void 0:s.businessId)||(s==null?void 0:s.id)||"",businessName:l,isVerified:T,logoUrl:d||b,addressLine:$||"Address not provided",businessNumber:U,businessHours:j,aboutText:B||"No description provided yet.",social:R,products:A,productReactions:c,stats:{followers:Number(i.followers)||0,likes:Number(i.likes)||0,reviewCount:Number(i.review_count)||0,averageRating:typeof i.average_rating=="number"?i.average_rating:Number(i.average_rating)||0,profileViews:Number(i.profile_views)||0,profileImpressions:Number(i.profile_impressions)||0,productViews:Number(i.product_views)||0,ratingBreakdown:i.rating_breakdown&&typeof i.rating_breakdown=="object"?i.rating_breakdown:null},reviews:P,viewer:o?{actorType:o.actorType?String(o.actorType):"",actorId:o.actorId?String(o.actorId):"",isFollowing:!!o.isFollowing,isSaved:!!o.isSaved,myReviewId:o.myReviewId?String(o.myReviewId):null,productReactions:o.productReactions&&typeof o.productReactions=="object"?o.productReactions:{}}:null,raw:e}}export{D as a,q as b,Y as c,z as d,W as f,J as g,M as l,G as n,X as r,Q as t};
