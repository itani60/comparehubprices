import{s as L,g as k}from"./localHub-DHLivfa6.js";function l(s){try{const i=`; ${document.cookie}`.split(`; ${s}=`);return i.length===2?i.pop().split(";").shift():""}catch{return""}}function K(){try{return new URL(window.location.href).searchParams.get("business_id")||""}catch{return""}}async function J({businessId:s,limit:e=30,offset:i=0,signal:a}={}){const o=String(s||"").trim();if(!o)throw new Error("Missing business_id in the URL.");const{url:c,anonKey:n}=k(),t=`${c}/functions/v1/local_hub?business_id=${encodeURIComponent(o)}&followers=1&limit=${encodeURIComponent(e)}&offset=${encodeURIComponent(i)}`,u=l("standard_session_id")||"",m=l("business_session_id")||"",d=u||m,b=await fetch(t,{method:"GET",credentials:"include",headers:{apikey:n,Authorization:`Bearer ${n}`,"Content-Type":"application/json",...d?{"x-access-token":d,"x-session-id":d}:{}},signal:a}),h=await b.json().catch(()=>({}));if(!b.ok){const v=typeof(h==null?void 0:h.error)=="string"?h.error:`Failed to load followers (HTTP ${b.status})`;throw new Error(v)}return h||null}function x(s){try{const e=new Date(s);return Number.isNaN(e.getTime())?"":e.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})}catch{return""}}function E(s){if(s==null)return"";if(Array.isArray(s))return s.map(e=>String(e||"").trim()).filter(Boolean).join(" | ");if(typeof s=="string"){const e=s.trim();if(!e)return"";try{const i=JSON.parse(e);if(typeof i=="string")return i.trim();if(Array.isArray(i))return i.map(a=>String(a||"").trim()).filter(Boolean).join(" | ")}catch{}return e.replace(/^"|"$/g,"")}return String(s).trim()}function H(s){var o,c;const e=String(s||"").trim().split(/\s+/).filter(Boolean);if(!e.length)return"U";const i=((o=e[0])==null?void 0:o[0])||"",a=e.length>1&&((c=e[e.length-1])==null?void 0:c[0])||"";return(i+a).toUpperCase()||"U"}function z(s,e){const i=typeof e=="string"?e.trim():"";if(!i)return"";if(/^https?:\/\//i.test(i))return i;if(s==="whatsapp"){const o=i.replace(/[^\d]/g,"");return o?`https://wa.me/${o}`:""}const a=i.replace(/^@/,"");return a?s==="facebook"?`https://www.facebook.com/${a}`:s==="twitter"?`https://x.com/${a}`:s==="instagram"?`https://www.instagram.com/${a}`:s==="tiktok"?`https://www.tiktok.com/@${a}`:"":""}function G({recipientId:s,recipientName:e}){try{const i=window.location.hostname,o=i==="localhost"||i==="127.0.0.1"||i===""?`http://${i||"localhost"}:5173/`:`${window.location.origin}/chat-hub/`,c=new URL(o);return s&&c.searchParams.set("recipientId",String(s)),e&&c.searchParams.set("recipientName",String(e)),c.toString()}catch{return"http://localhost:5173/"}}async function q({businessId:s,signal:e}={}){const i=String(s||"").trim();if(!i)throw new Error("Missing business_id in the URL.");const{url:a,anonKey:o}=k(),c=`${a}/functions/v1/local_hub?business_id=${encodeURIComponent(i)}`,n=l("standard_session_id")||"",t=l("business_session_id")||"",u=n||t,m=await fetch(c,{method:"GET",credentials:"include",headers:{apikey:o,Authorization:`Bearer ${o}`,"Content-Type":"application/json",...u?{"x-access-token":u,"x-session-id":u}:{}},signal:e}),d=await m.json().catch(()=>({}));if(!m.ok){const b=typeof(d==null?void 0:d.error)=="string"?d.error:`Failed to load business details (HTTP ${m.status})`;throw new Error(b)}return d||null}function F(){const s=l("standard_session_id"),e=l("standard_csrf_token");if(s&&e)return{sessionId:s,csrfToken:e};const i=l("business_session_id"),a=l("business_csrf_token");return i&&a?{sessionId:i,csrfToken:a}:null}async function D({action:s,payload:e={},signal:i}={}){const a=F();if(!a)throw new Error("Please log in to continue.");const{url:o,anonKey:c}=k(),n=await fetch(`${o}/functions/v1/local_hub`,{method:"POST",headers:{"Content-Type":"application/json",apikey:c,Authorization:`Bearer ${c}`,"x-access-token":a.sessionId,"x-csrf-token":a.csrfToken},body:JSON.stringify({action:s,...e||{}}),signal:i}),t=await n.json().catch(()=>({}));if(!n.ok){const u=typeof(t==null?void 0:t.error)=="string"?t.error:`Request failed (HTTP ${n.status})`;throw new Error(u)}return t}async function W({businessId:s,method:e,url:i,signal:a}={}){const o=String(s||"").trim();if(!o)return{ok:!1};const{url:c,anonKey:n}=k(),t=await fetch(`${c}/functions/v1/local_hub`,{method:"POST",headers:{"Content-Type":"application/json",apikey:n,Authorization:`Bearer ${n}`},body:JSON.stringify({action:"share_business_profile",business_id:o,share_method:e||"",share_url:i||""}),signal:a}),u=await t.json().catch(()=>({}));return t.ok?{ok:!0}:{ok:!1,error:(u==null?void 0:u.error)||"Failed to track share."}}async function Q({businessId:s,reason:e,details:i,signal:a}={}){if(!s)throw new Error("Missing business id.");if(!e)throw new Error("Please select a reason.");return await D({action:"report_business",payload:{business_id:s,reason:e,details:i},signal:a})}function X(s){const e=(s==null?void 0:s.post)||null,i=s!=null&&s.stats&&typeof s.stats=="object"?s.stats:{},a=Array.isArray(s==null?void 0:s.reviews)?s.reviews:[],o=s!=null&&s.viewer&&typeof s.viewer=="object"?s.viewer:null,c=s!=null&&s.product_reactions&&typeof s.product_reactions=="object"?s.product_reactions:{},n=e!=null&&e.content&&typeof e.content=="object"?e.content:{},t=n!=null&&n.business&&typeof n.business=="object"?n.business:{};n!=null&&n.moderation&&typeof n.moderation=="object"&&n.moderation;const u=t.businessName||t.name||"Business",m=typeof t.businessLogo=="string"?t.businessLogo.trim():"",d=`https://ui-avatars.com/api/?name=${encodeURIComponent(u)}&background=random&color=fff`,b=t.streetAddress||t.businessAddress||t.address||"",h=t.suburb||"",v=t.city||"",I=t.province||"",N=[b,h,v,I].map(r=>String(r||"").trim()).filter(Boolean).join(", "),$=!!(t!=null&&t.isVerified||t!=null&&t.verified||t!=null&&t.is_verified||n!=null&&n.isVerified||n!=null&&n.verified||e!=null&&e.isVerified||e!=null&&e.verified||e!=null&&e.is_verified),S=t.businessNumber||t.business_number||t.phone||t.businessPhone||(n==null?void 0:n.businessNumber)||(n==null?void 0:n.business_number)||"",T=typeof S=="string"?S.trim():"",U=E(t.businessHours||t.business_hours||(n==null?void 0:n.businessHours)||(n==null?void 0:n.business_hours)||""),j=typeof(t==null?void 0:t.description)=="string"?t.description.trim():typeof(n==null?void 0:n.description)=="string"?n.description.trim():"",B=(Array.isArray(n==null?void 0:n.products)?n.products:[]).map(r=>{const p=typeof(r==null?void 0:r.name)=="string"&&r.name.trim()?r.name.trim():typeof(r==null?void 0:r.title)=="string"&&r.title.trim()?r.title.trim():"Product",_=Array.isArray(r==null?void 0:r.images)?r.images.filter(g=>typeof g=="string"&&g.trim()).map(g=>g.trim()):[],y=L({title:u,subtitle:p}),w=_.length?_.slice(0,10):[y];return{title:p,images:w,cover:w[0]||y}}),f=t.socials&&typeof t.socials=="object"&&t.socials||t.socialMedia&&typeof t.socialMedia=="object"&&t.socialMedia||t.social&&typeof t.social=="object"&&t.social||{},A={facebook:f.facebook||f.fb||"",twitter:f.twitter||f.x||"",whatsapp:f.whatsapp||f.wa||f.phone||"",tiktok:f.tiktok||f.tt||"",instagram:f.instagram||f.ig||""},R=a.map(r=>{const p=typeof(r==null?void 0:r.author_name)=="string"&&r.author_name.trim()?r.author_name.trim():typeof(r==null?void 0:r.authorName)=="string"&&r.authorName.trim()?r.authorName.trim():"Anonymous User",_=String((r==null?void 0:r.id)||""),y=Number(r==null?void 0:r.rating)||0,w=(r==null?void 0:r.created_at)||(r==null?void 0:r.updated_at)||"",g=w?Date.parse(w):0,P=typeof(r==null?void 0:r.content)=="string"?r.content:"",C=Number(r==null?void 0:r.helpful_count)||0;return{id:_,name:p,initials:H(p),avatarUrl:"",dateLabel:x(w)||"",timestamp:Number.isFinite(g)?g:0,rating:y,text:P,helpful:C}});return{businessId:(e==null?void 0:e.business_id)||(e==null?void 0:e.businessId)||(e==null?void 0:e.id)||"",businessName:u,isVerified:$,logoUrl:m||d,addressLine:N||"Address not provided",businessNumber:T,businessHours:U,aboutText:j||"No description provided yet.",social:A,products:B,productReactions:c,stats:{followers:Number(i.followers)||0,likes:Number(i.likes)||0,reviewCount:Number(i.review_count)||0,averageRating:typeof i.average_rating=="number"?i.average_rating:Number(i.average_rating)||0,profileViews:Number(i.profile_views)||0,profileImpressions:Number(i.profile_impressions)||0,productViews:Number(i.product_views)||0,ratingBreakdown:i.rating_breakdown&&typeof i.rating_breakdown=="object"?i.rating_breakdown:null},reviews:R,viewer:o?{actorType:o.actorType?String(o.actorType):"",actorId:o.actorId?String(o.actorId):"",isFollowing:!!o.isFollowing,isSaved:!!o.isSaved,myReviewId:o.myReviewId?String(o.myReviewId):null,productReactions:o.productReactions&&typeof o.productReactions=="object"?o.productReactions:{}}:null,raw:s}}export{F as a,G as b,X as c,J as d,q as f,K as g,D as l,z as n,Q as r,W as t};
