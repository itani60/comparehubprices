import{r as l,j as s,a as gs,b as ms,c as ys,R as vs}from"./localHub-Ddi82mor.js";import{g as T,l as g,a as xs,b as Cs,c as js,s as ps,t as fs,d as ws,n as S,L as Rs,e as Is,R as Ls,f as _s,r as Ss,h as Bs,i as Fs,j as Es}from"./localHubInfoApi-DWGnuHbr.js";const Hs=[{value:"Newest",label:"Newest"},{value:"Highest",label:"Highest Rated"},{value:"Lowest",label:"Lowest Rated"}];function $s({reviews:u,ratingSummary:d,onReport:b,onHelpful:y,onReportReview:B}){const[x,v]=l.useState("Newest"),[o,R]=l.useState(!1),[F,$]=l.useState(()=>new Map),N=l.useRef(null);l.useEffect(()=>{function i(c){N.current&&(N.current.contains(c.target)||R(!1))}return document.addEventListener("click",i),()=>document.removeEventListener("click",i)},[]);const j=l.useMemo(()=>Array.isArray(u)?u:[],[u]),C=l.useMemo(()=>{const i=[...j];return x==="Highest"?i.sort((c,h)=>h.rating-c.rating||h.timestamp-c.timestamp):x==="Lowest"?i.sort((c,h)=>c.rating-h.rating||h.timestamp-c.timestamp):i.sort((c,h)=>h.timestamp-c.timestamp),i},[j,x]),I=(d&&typeof d.total=="number"?d.total:j.length)||1,L=d&&typeof d.avg=="number"?d.avg:j.reduce((i,c)=>i+(Number(c.rating)||0),0)/(j.length||1),z=l.useMemo(()=>{if(d&&d.counts)return d.counts;const i={1:0,2:0,3:0,4:0,5:0};return j.forEach(c=>{const h=Math.max(1,Math.min(5,Math.round(Number(c.rating)||0)));i[h]+=1}),i},[d,j]);return s.jsxs("section",{className:"collCard",children:[s.jsxs("div",{className:"collHead collHeadRow",children:[s.jsxs("span",{children:[s.jsx("i",{className:"fas fa-star"})," Reviews"]}),s.jsxs("div",{className:"sort-box",ref:N,children:[s.jsxs("button",{type:"button",className:"custom-dropdown",onClick:i=>{i.stopPropagation(),R(c=>!c)},children:[s.jsx("i",{className:"fas fa-sort-amount-down"})," ",s.jsx("span",{children:x})]}),s.jsx("div",{className:`dropdown-menu ${o?"show":""}`,children:Hs.map(i=>s.jsx("div",{className:`dropdown-item ${i.value===x?"active":""}`,onClick:()=>{v(i.value),R(!1)},children:i.label},i.value))})]})]}),s.jsxs("div",{className:"rating-summary-card",children:[s.jsxs("div",{className:"summary-left",children:[s.jsx("div",{className:"big-num",children:L.toFixed(1)}),s.jsx("div",{className:"stars-sm",children:Array.from({length:5},(i,c)=>s.jsx("svg",{viewBox:"0 0 24 24",style:{fill:c<Math.round(L)?"#fbbf24":"#e2e8f0"},children:s.jsx("path",{d:"M12 17.3l-6.2 3.7 1.7-7L2 8.9l7.2-.6L12 2l2.8 6.3 7.2.6-5.5 5.1 1.7 7z"})},c))}),s.jsxs("div",{className:"total-cnt",children:[I," Reviews"]})]}),s.jsx("div",{className:"summary-bars",children:[5,4,3,2,1].map(i=>s.jsxs("div",{className:"bar-row",children:[s.jsx("span",{children:i}),s.jsx("div",{className:"bar-bg",children:s.jsx("div",{className:"bar-fill",style:{width:`${Math.round(z[i]/I*100)}%`}})})]},i))})]}),s.jsx("div",{className:"rev-container",children:C.length?C.map(i=>s.jsx("div",{className:"review-row",children:(()=>{const c=F.get(i.id)||0,h=Number(i.helpful||0)+c;return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"rev-header",children:[s.jsx("div",{className:"rev-avatar",children:i.avatarUrl?s.jsx("img",{src:i.avatarUrl,alt:"User"}):i.initials}),s.jsxs("div",{className:"rev-meta",children:[s.jsx("div",{className:"rev-name",children:i.name}),s.jsx("div",{className:"rev-date",children:i.dateLabel}),s.jsx("div",{className:"stars-sm",style:{margin:"2px 0"},children:Array.from({length:5},(k,p)=>s.jsx("svg",{viewBox:"0 0 24 24",style:{fill:p<i.rating?"#fbbf24":"#e2e8f0"},children:s.jsx("path",{d:"M12 17.3l-6.2 3.7 1.7-7L2 8.9l7.2-.6L12 2l2.8 6.3 7.2.6-5.5 5.1 1.7 7z"})},p))})]})]}),s.jsx("div",{className:"rev-body",children:i.text}),s.jsxs("div",{className:"rev-actions",children:[s.jsxs("button",{type:"button",className:"btn-link-action",onClick:async()=>{try{await(y==null?void 0:y(i.id)),$(k=>{const p=new Map(k);return p.set(i.id,(p.get(i.id)||0)+1),p})}catch{}},children:[s.jsx("i",{className:"far fa-thumbs-up"})," Helpful"," ",s.jsxs("span",{style:{opacity:.7},children:["(",h,")"]})]}),s.jsxs("button",{type:"button",className:"btn-link-action",onClick:()=>{B?B(i.id):b==null||b()},children:[s.jsx("i",{className:"far fa-flag"})," Report"]})]})]})})()},i.id)):s.jsx("div",{style:{padding:12,color:"var(--muted)",fontWeight:900},children:"No reviews yet."})})]})}function zs(){return s.jsxs("div",{className:"lh-skeleton",children:[s.jsxs("section",{className:"hero",children:[s.jsx("div",{className:"cover",children:s.jsx("div",{className:"logoRing",children:s.jsx("div",{className:"sk sk-circle w-120 h-120"})})}),s.jsxs("div",{className:"heroBody",children:[s.jsx("div",{className:"sk sk-rect w-220 h-16"}),s.jsx("div",{style:{height:8}}),s.jsx("div",{className:"sk sk-rect w-full h-12"}),s.jsxs("div",{className:"stats-row",style:{marginTop:14},children:[s.jsx("div",{className:"sk sk-pill w-120 h-14"}),s.jsx("div",{className:"sk sk-pill w-120 h-14"}),s.jsx("div",{className:"sk sk-pill w-120 h-14"}),s.jsx("div",{className:"sk sk-pill w-120 h-14"})]}),s.jsxs("div",{className:"actions",style:{marginTop:14},children:[s.jsx("div",{className:"sk sk-btn w-full h-44"}),s.jsx("div",{className:"sk sk-btn w-full h-44"}),s.jsx("div",{className:"sk sk-btn w-full h-44"}),s.jsx("div",{className:"sk sk-btn w-full h-44"}),s.jsx("div",{className:"sk sk-btn w-full h-44"}),s.jsx("div",{className:"sk sk-btn w-full h-44"})]})]})]}),s.jsxs("section",{className:"card",children:[s.jsx("div",{className:"sk sk-rect w-180 h-14"}),s.jsx("div",{style:{height:12}}),s.jsx("div",{className:"sk sk-rect w-full h-12"}),s.jsx("div",{style:{height:10}}),s.jsx("div",{className:"sk sk-rect w-full h-12"}),s.jsx("div",{style:{height:10}}),s.jsx("div",{className:"sk sk-rect w-300 h-12"}),s.jsxs("div",{className:"social-flex",style:{marginTop:12},children:[s.jsx("div",{className:"sk sk-rect w-52 h-52"}),s.jsx("div",{className:"sk sk-rect w-52 h-52"}),s.jsx("div",{className:"sk sk-rect w-52 h-52"}),s.jsx("div",{className:"sk sk-rect w-52 h-52"}),s.jsx("div",{className:"sk sk-rect w-52 h-52"})]})]}),s.jsxs("section",{className:"collCard",children:[s.jsx("div",{className:"sk sk-rect w-180 h-14"}),s.jsx("div",{className:"prodGrid",style:{marginTop:12},children:Array.from({length:4},(u,d)=>s.jsxs("div",{className:"prodCard",children:[s.jsx("div",{className:"sk sk-rect w-full h-150"}),s.jsxs("div",{style:{padding:12,display:"grid",gap:10},children:[s.jsx("div",{className:"sk sk-rect w-180 h-12"}),s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:10},children:[s.jsx("div",{className:"sk sk-pill w-140 h-36"}),s.jsx("div",{className:"sk sk-rect w-36 h-36"})]})]})]},d))})]}),s.jsxs("section",{className:"collCard",children:[s.jsx("div",{className:"sk sk-rect w-180 h-14"}),s.jsx("div",{style:{height:12}}),s.jsx("div",{className:"sk sk-rect w-full h-280"})]}),s.jsxs("section",{className:"collCard",children:[s.jsx("div",{className:"sk sk-rect w-180 h-14"}),s.jsx("div",{className:"rev-container",style:{marginTop:12},children:Array.from({length:2},(u,d)=>s.jsxs("div",{className:"review-row",children:[s.jsx("div",{className:"sk sk-circle w-44 h-44"}),s.jsxs("div",{style:{flex:1,display:"grid",gap:10},children:[s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:10},children:[s.jsx("div",{className:"sk sk-rect w-180 h-12"}),s.jsx("div",{className:"sk sk-rect w-120 h-10"})]}),s.jsx("div",{className:"sk sk-pill w-160 h-12"}),s.jsx("div",{className:"sk sk-rect w-full h-40"}),s.jsxs("div",{style:{display:"flex",gap:10,flexWrap:"wrap"},children:[s.jsx("div",{className:"sk sk-pill w-140 h-34"}),s.jsx("div",{className:"sk sk-pill w-140 h-34"})]})]})]},d))})]})]})}function Os(){var D,W,V,G,K,Y,q,J,Q,X,Z,M,ss,es,as,ts,is,ns,rs,ls;const[u,d]=l.useState(!0),[b,y]=l.useState(""),[B,x]=l.useState(null),[v,o]=l.useState(""),[R,F]=l.useState(!1),[$,N]=l.useState(!1),[j,C]=l.useState(!1),[I,L]=l.useState(""),[z,i]=l.useState(!1),[c,h]=l.useState(!1),[k,p]=l.useState([]),[bs,O]=l.useState(0);function U(a,t=0){p(a),O(t),h(!0)}l.useEffect(()=>{let a=null;if(v)return a=setTimeout(()=>o(""),4e3),()=>{a&&clearTimeout(a)}},[v]);async function w({signal:a}={}){const t=T();if(!t){x(null),d(!1);return}d(!0),y("");try{const n=await Fs({businessId:t,signal:a});x(Es(n))}catch(n){if(a!=null&&a.aborted)return;x(null),y(n instanceof Error?n.message:"Failed to load business details.")}finally{if(a!=null&&a.aborted)return;d(!1)}}l.useEffect(()=>{const a=new AbortController;return w({signal:a.signal}),()=>a.abort()},[]),l.useEffect(()=>{const a=T();a&&gs({businessId:a})},[]);const P=T();if(!P)return s.jsx("div",{className:"screen",children:s.jsxs("section",{className:"card",style:{borderColor:"#fecaca"},children:[s.jsx("div",{className:"cardHead",children:s.jsx("h2",{style:{color:"#b91c1c"},children:"Missing business_id"})}),s.jsx("div",{className:"cardBody",children:"Open this page with `?business_id=...`."})]})});const e=B,A=u&&!e&&!b,Ns=(e==null?void 0:e.logoUrl)||"";return s.jsxs("div",{className:"screen",children:[v?s.jsx("div",{style:{marginBottom:10,fontWeight:900},children:v}):null,b?s.jsxs("section",{className:"card",style:{borderColor:"#fecaca"},children:[s.jsx("div",{className:"cardHead",children:s.jsx("h2",{style:{color:"#b91c1c"},children:"Failed to load business details"})}),s.jsx("div",{className:"cardBody",children:b})]}):null,A?s.jsx(zs,{}):null,A?null:s.jsxs(s.Fragment,{children:[s.jsxs("section",{className:"hero",children:[s.jsx("div",{className:"cover",children:s.jsx("div",{className:"logoRing",children:s.jsx("img",{src:Ns,alt:"Logo"})})}),s.jsxs("div",{className:"heroBody",children:[s.jsx("div",{className:"titleRow",children:s.jsxs("div",{className:"nameBlock",children:[s.jsxs("h1",{className:"name",children:[s.jsx("span",{className:"bizNameText",children:(e==null?void 0:e.businessName)||(u?"Loading...":"Business")}),e!=null&&e.isVerified?s.jsxs("svg",{className:"verified-badge",width:"16",height:"16",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",role:"img","aria-label":"Verified business",title:"Verified business",children:[s.jsx("rect",{width:"24",height:"24",fill:"#000000",opacity:"0"}),s.jsxs("g",{transform:"translate(12 12) scale(0.42)",children:[s.jsx("polygon",{points:"5.62,-21 9.05,-15.69 15.37,-15.38 15.69,-9.06 21,-5.63 18.12,0 21,5.62 15.69,9.05 15.38,15.37 9.06,15.69 5.63,21 0,18.12 -5.62,21 -9.05,15.69 -15.37,15.38 -15.69,9.06 -21,5.63 -18.12,0 -21,-5.62 -15.69,-9.05 -15.38,-15.37 -9.06,-15.69 -5.63,-21 0,-18.12",fill:"#42a5f5",fillRule:"nonzero"}),s.jsx("g",{transform:"translate(-0.01 0.51)",children:s.jsx("polygon",{points:"-2.6,6.74 -9.09,0.25 -6.97,-1.87 -2.56,2.53 7,-6.74 9.09,-4.59",fill:"#ffffff",fillRule:"nonzero"})})]})]}):null]}),s.jsxs("div",{className:"addr",children:[s.jsxs("svg",{className:"pin",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("path",{d:"M12 21s7-4.35 7-11a7 7 0 1 0-14 0c0 6.65 7 11 7 11z"}),s.jsx("circle",{cx:"12",cy:"10",r:"2.5"})]}),(e==null?void 0:e.addressLine)||(u?"Loading...":"Address not provided")]})]})}),s.jsxs("div",{className:"stats-row",children:[s.jsxs("div",{className:"stats-item",children:[s.jsx("span",{className:"stats-val",children:((D=e==null?void 0:e.stats)==null?void 0:D.followers)??0})," Followers"]}),s.jsxs("div",{className:"stats-item",children:[s.jsx("span",{className:"stats-val",children:((W=e==null?void 0:e.stats)==null?void 0:W.reviewCount)??0})," Reviews"]}),s.jsxs("div",{className:"stats-item",children:[s.jsx("span",{className:"stats-val",children:((V=e==null?void 0:e.stats)==null?void 0:V.likes)??0})," Likes"]}),s.jsxs("div",{className:"stats-item",children:[s.jsx("span",{className:"stats-val",children:(G=e==null?void 0:e.stats)!=null&&G.reviewCount?e.stats.averageRating.toFixed(1):"0.0"})," ","Rating"]})]}),s.jsxs("div",{className:"actions",children:[s.jsxs("button",{type:"button",className:`btn follow${(K=e==null?void 0:e.viewer)!=null&&K.isFollowing?" following":""}`,disabled:!(e!=null&&e.businessId)||u,onClick:async()=>{var a;if(e!=null&&e.businessId)try{const t=!((a=e==null?void 0:e.viewer)!=null&&a.isFollowing);await g({action:t?"follow_business":"unfollow_business",payload:{business_id:e.businessId}}),o(t?"Following":"Unfollowed"),await w()}catch(t){o(t instanceof Error?t.message:"Failed to update follow.")}},children:[s.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"}),s.jsx("circle",{cx:"9",cy:"7",r:"4"}),s.jsx("path",{d:"M16 11l2 2 4-4"})]}),(Y=e==null?void 0:e.viewer)!=null&&Y.isFollowing?"Following":"Follow"]}),s.jsxs("a",{href:Cs({recipientId:e==null?void 0:e.businessId,recipientName:e==null?void 0:e.businessName}),className:"btn chat",onClick:a=>{xs()||(a.preventDefault(),o("Please log in to continue."))},children:[s.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:s.jsx("path",{d:"M21 15a4 4 0 0 1-4 4H7l-4 3V7a4 4 0 0 1 4-4h10a4 4 0 0 1 4 4z"})}),"Chat"]}),s.jsxs("button",{type:"button",className:"btn rate",onClick:()=>F(!0),children:[s.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:s.jsx("path",{d:"M12 17.3l-6.2 3.7 1.7-7L2 8.9l7.2-.6L12 2l2.8 6.3 7.2.6-5.5 5.1 1.7 7z"})}),"Rate"]}),s.jsxs("button",{type:"button",className:"btn share",onClick:async()=>{const a=js({baseUrl:"/local_hub_app/",businessId:e==null?void 0:e.businessId,isMobile:!0}),t=await ps({title:e!=null&&e.businessName?`${e.businessName} â€¢ LocalHub`:"LocalHub",text:e!=null&&e.businessName?`Check out ${e.businessName} on LocalHub.`:"Check this out on LocalHub.",url:a});(t.method==="copy"||t.method==="share")&&await fs({businessId:e==null?void 0:e.businessId,method:t.method,url:a}),t.method==="copy"?o("Link copied."):t.method==="share"&&o("Shared.")},children:[s.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("circle",{cx:"18",cy:"5",r:"3"}),s.jsx("circle",{cx:"6",cy:"12",r:"3"}),s.jsx("circle",{cx:"18",cy:"19",r:"3"}),s.jsx("path",{d:"M8.6 13.5l6.8 3.9M15.4 6.6L8.6 10.5"})]}),"Share"]}),s.jsxs("button",{type:"button",className:"btn save",disabled:!(e!=null&&e.businessId)||u,onClick:async()=>{var t;if(!(e!=null&&e.businessId))return;if(!xs()){o("Please log in to continue.");return}try{const n=!((t=e==null?void 0:e.viewer)!=null&&t.isSaved);await g({action:n?"save_business":"unsave_business",payload:{business_id:e.businessId}}),o(n?"Saved":"Removed from saved"),await w()}catch(n){o(n instanceof Error?n.message:"Failed to update save.")}},children:[s.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:s.jsx("path",{d:"M6 3h12a2 2 0 0 1 2 2v16l-8-4-8 4V5a2 2 0 0 1 2-2z"})}),(q=e==null?void 0:e.viewer)!=null&&q.isSaved?"Saved":"Save"]}),s.jsxs("button",{type:"button",className:"btn report",onClick:()=>N(!0),children:[s.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("path",{d:"M4 22V4"}),s.jsx("path",{d:"M4 4h13l-1.5 4L17 12H4"})]}),"Report"]})]})]})]}),s.jsxs("section",{className:"card",children:[s.jsx("div",{className:"cardHead",children:s.jsxs("h2",{children:["About ",(e==null?void 0:e.businessName)||"Business"]})}),s.jsx("div",{className:"cardBody",children:u?"Loading...":(()=>{const a=ws((e==null?void 0:e.aboutText)||"");return a.length?s.jsx("div",{className:"aboutRich",children:a.map((t,n)=>t.type==="heading"?s.jsx("div",{className:"aboutHeading",children:t.text},`h-${n}`):t.type==="list"?s.jsx("ul",{className:"aboutList",children:t.items.map((E,_)=>s.jsx("li",{children:E},`li-${n}-${_}`))},`l-${n}`):s.jsx("p",{className:"aboutPara",children:t.text},`p-${n}`))}):"No description provided."})()}),s.jsxs("div",{style:{marginTop:10},children:[s.jsx("div",{style:{fontSize:13,fontWeight:1e3,marginBottom:10},children:"Connect with us"}),s.jsxs("div",{className:"social-flex",style:{padding:0,gap:10},children:[s.jsx("a",{href:S("facebook",(J=e==null?void 0:e.social)==null?void 0:J.facebook),className:"social-item fb",onClick:a=>{var t;(t=e==null?void 0:e.social)!=null&&t.facebook||a.preventDefault()},style:{display:(Q=e==null?void 0:e.social)!=null&&Q.facebook?"":"none"},target:"_blank",rel:"noopener",children:s.jsx("i",{className:"fab fa-facebook-f"})}),s.jsx("a",{href:S("twitter",(X=e==null?void 0:e.social)==null?void 0:X.twitter),className:"social-item tw",onClick:a=>{var t;(t=e==null?void 0:e.social)!=null&&t.twitter||a.preventDefault()},style:{display:(Z=e==null?void 0:e.social)!=null&&Z.twitter?"":"none"},target:"_blank",rel:"noopener",children:s.jsx("i",{className:"fa-brands fa-x-twitter"})}),s.jsx("a",{href:S("whatsapp",(M=e==null?void 0:e.social)==null?void 0:M.whatsapp),className:"social-item wa",onClick:a=>{var t;(t=e==null?void 0:e.social)!=null&&t.whatsapp||a.preventDefault()},style:{display:(ss=e==null?void 0:e.social)!=null&&ss.whatsapp?"":"none"},target:"_blank",rel:"noopener",children:s.jsx("i",{className:"fab fa-whatsapp"})}),s.jsx("a",{href:S("tiktok",(es=e==null?void 0:e.social)==null?void 0:es.tiktok),className:"social-item tt",onClick:a=>{var t;(t=e==null?void 0:e.social)!=null&&t.tiktok||a.preventDefault()},style:{display:(as=e==null?void 0:e.social)!=null&&as.tiktok?"":"none"},target:"_blank",rel:"noopener",children:s.jsx("i",{className:"fab fa-tiktok"})}),s.jsx("a",{href:S("instagram",(ts=e==null?void 0:e.social)==null?void 0:ts.instagram),className:"social-item ig",onClick:a=>{var t;(t=e==null?void 0:e.social)!=null&&t.instagram||a.preventDefault()},style:{display:(is=e==null?void 0:e.social)!=null&&is.instagram?"":"none"},target:"_blank",rel:"noopener",children:s.jsx("i",{className:"fab fa-instagram"})})]})]})]}),s.jsxs("section",{className:"collCard",children:[s.jsx("div",{style:{fontSize:13,fontWeight:1e3,marginBottom:10},children:"Our Gallery"}),s.jsx("div",{className:"prodGrid",children:((e==null?void 0:e.products)||[]).map(a=>s.jsxs("div",{className:"prodCard",role:"group",children:[s.jsx("div",{className:"prodImg",style:{cursor:"zoom-in"},onClick:()=>{ms({businessId:(e==null?void 0:e.businessId)||P,productKey:a.title||"Product"}),U(a.images,0)},role:"button",tabIndex:0,onKeyDown:t=>{(t.key==="Enter"||t.key===" ")&&(ms({businessId:(e==null?void 0:e.businessId)||P,productKey:a.title||"Product"}),U(a.images,0))},children:s.jsx("img",{src:a.cover,alt:a.title})}),s.jsxs("div",{className:"prodInfo",children:[s.jsx("div",{className:"prodName",children:a.title}),s.jsx("div",{className:"product-meta-row",children:s.jsx("div",{className:"product-actions",children:(()=>{var ds,hs,us;const t=a.title||"Product",n=((ds=e==null?void 0:e.productReactions)==null?void 0:ds[t])||{},E=Number(n==null?void 0:n.total)||0,_=n!=null&&n.by_reaction&&typeof n.by_reaction=="object"?n.by_reaction:{},H=((us=(hs=e==null?void 0:e.viewer)==null?void 0:hs.productReactions)==null?void 0:us[t])||"",cs=["ðŸ‘","â¤ï¸","ðŸ”¥"],ks=cs.map(r=>({reaction:r,count:Number((_==null?void 0:_[r])??0)||0})).filter(r=>r.count>0).sort((r,m)=>m.count-r.count).slice(0,3).map(r=>r.reaction),os=E>0;return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"reaction-container",children:[s.jsx("div",{className:"reactions-popover small-popover",children:cs.map(r=>s.jsx("span",{className:`emoji ${H===r?"active":""}`,onClick:async m=>{m.preventDefault(),m.stopPropagation();try{await g({action:"react_product",payload:{business_id:e==null?void 0:e.businessId,product_key:t,reaction:r,force_set:!0}}),await w()}catch(f){o(f instanceof Error?f.message:"Failed to react.")}},title:r,"aria-label":`React ${r}`,children:r},r))}),s.jsxs("div",{className:"btn-with-count",children:[s.jsx("button",{type:"button",className:"small-btn",onClick:async r=>{r.preventDefault(),r.stopPropagation();try{await g({action:"react_product",payload:{business_id:e==null?void 0:e.businessId,product_key:t,reaction:H||"â¤ï¸",force_set:!1}}),await w()}catch(m){o(m instanceof Error?m.message:"Failed to react.")}},"aria-label":"React",children:H?s.jsx("span",{className:"my-reaction-emoji",children:H}):s.jsx("i",{className:"far fa-heart"})}),os?s.jsx("div",{className:"emoji-stack",children:ks.map(r=>s.jsx("span",{children:r},r))}):null,os?s.jsx("span",{className:"reaction-count",children:E}):null]})]}),s.jsx("button",{type:"button",className:"small-btn",title:"Share",onClick:r=>{r.preventDefault(),r.stopPropagation(),(async()=>{const m=js({baseUrl:"/local_hub_app/",businessId:e==null?void 0:e.businessId,isMobile:!0}),f=await ps({title:e!=null&&e.businessName?`${e.businessName} â€¢ LocalHub`:"LocalHub",text:a!=null&&a.title?`Check out "${a.title}" on LocalHub.`:"Check this out on LocalHub.",url:m});(f.method==="copy"||f.method==="share")&&await fs({businessId:e==null?void 0:e.businessId,method:f.method,url:m}),f.method==="copy"?o("Link copied."):f.method==="share"&&o("Shared.")})()},children:s.jsx("i",{className:"fas fa-share-nodes"})})]})})()})})]})]},a.title))})]}),s.jsx(Rs,{address:(e==null?void 0:e.addressLine)||""}),s.jsx($s,{reviews:(e==null?void 0:e.reviews)||[],ratingSummary:{total:((ns=e==null?void 0:e.stats)==null?void 0:ns.reviewCount)??0,avg:((rs=e==null?void 0:e.stats)==null?void 0:rs.averageRating)??0,counts:((ls=e==null?void 0:e.stats)==null?void 0:ls.ratingBreakdown)||null},onReport:()=>N(!0),onHelpful:async a=>{try{await g({action:"set_review_helpful",payload:{review_id:a,helpful:!0}})}catch(t){throw o(t instanceof Error?t.message:"Failed to mark helpful."),t}},onReportReview:a=>{L(String(a||"")),C(!0)}})]}),s.jsx(Is,{open:c,slides:k,index:bs,onPrev:()=>O(a=>(a-1+k.length)%k.length),onNext:()=>O(a=>(a+1)%k.length),onClose:()=>h(!1)}),s.jsx(Ls,{open:j,onClose:()=>C(!1),busy:z,onSubmit:async({reason:a,details:t})=>{if(I){i(!0);try{await g({action:"report_review",payload:{review_id:I,reason:a||"other",details:t||""}}),o("Review reported. Thank you."),C(!1),L("")}catch(n){o(n instanceof Error?n.message:"Failed to submit report.")}finally{i(!1)}}}}),s.jsx(_s,{open:$,onClose:()=>N(!1),businessId:(e==null?void 0:e.businessId)||"",onSubmit:async({businessId:a,reason:t,details:n})=>{await Ss({businessId:a,reason:t,details:n}),o("Report received. Our team will review this business shortly.")}}),s.jsx(Bs,{open:R,onClose:()=>F(!1),businessId:(e==null?void 0:e.businessId)||"",onSubmit:async({businessId:a,rating:t,content:n})=>{await g({action:"upsert_review",payload:{business_id:a,rating:t,content:n}}),o("Success! Your review has been submitted."),await w()}})]})}ys.createRoot(document.getElementById("root")).render(s.jsx(vs.StrictMode,{children:s.jsx(Os,{})}));
