import{s as D,g as v}from"./localHub-DhdBYosn.js";function m(s){try{const r=`; ${document.cookie}`.split(`; ${s}=`);return r.length===2?r.pop().split(";").shift():""}catch{return""}}function G(){try{return new URL(window.location.href).searchParams.get("business_id")||""}catch{return""}}async function q({businessId:s,limit:e=30,offset:r=0,signal:c}={}){const o=String(s||"").trim();if(!o)throw new Error("Missing business_id in the URL.");const{url:a,anonKey:u}=v(),t=`${a}/functions/v1/local_hub?business_id=${encodeURIComponent(o)}&followers=1&limit=${encodeURIComponent(e)}&offset=${encodeURIComponent(r)}`,n=m("standard_session_id")||"",d=m("business_session_id")||"",f=n||d,b=await fetch(t,{method:"GET",credentials:"include",headers:{apikey:u,Authorization:`Bearer ${u}`,"Content-Type":"application/json",...f?{"x-access-token":f,"x-session-id":f}:{}},signal:c}),h=await b.json().catch(()=>({}));if(!b.ok){const y=typeof(h==null?void 0:h.error)=="string"?h.error:`Failed to load followers (HTTP ${b.status})`;throw new Error(y)}return h||null}function F(s){try{const e=new Date(s);return Number.isNaN(e.getTime())?"":e.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})}catch{return""}}function M(s){if(s==null)return"";if(Array.isArray(s))return s.map(e=>String(e||"").trim()).filter(Boolean).join(`
`);if(typeof s=="string"){const e=s.trim();if(!e)return"";try{const r=JSON.parse(e);if(typeof r=="string")return r.trim();if(Array.isArray(r))return r.map(c=>String(c||"").trim()).filter(Boolean).join(`
`)}catch{}return e.replace(/^"|"$/g,"").replace(/\s*\|\s*/g,`
`)}return String(s).trim()}function O(s){var o,a;const e=String(s||"").trim().split(/\s+/).filter(Boolean);if(!e.length)return"U";const r=((o=e[0])==null?void 0:o[0])||"",c=e.length>1&&((a=e[e.length-1])==null?void 0:a[0])||"";return(r+c).toUpperCase()||"U"}function W(s,e){const r=typeof e=="string"?e.trim():"";if(!r)return"";if(/^https?:\/\//i.test(r))return r;if(s==="whatsapp"){const o=r.replace(/[^\d]/g,"");return o?`https://wa.me/${o}`:""}const c=r.replace(/^@/,"");return c?s==="facebook"?`https://www.facebook.com/${c}`:s==="twitter"?`https://x.com/${c}`:s==="instagram"?`https://www.instagram.com/${c}`:s==="tiktok"?`https://www.tiktok.com/@${c}`:"":""}function Q({recipientId:s,recipientName:e}){try{const r=window.location.hostname,o=r==="localhost"||r==="127.0.0.1"||r===""?`http://${r||"localhost"}:5173/`:`${window.location.origin}/chat-hub/`,a=new URL(o);return s&&a.searchParams.set("recipientId",String(s)),e&&a.searchParams.set("recipientName",String(e)),a.toString()}catch{return"http://localhost:5173/"}}async function X({businessId:s,signal:e}={}){const r=String(s||"").trim();if(!r)throw new Error("Missing business_id in the URL.");const{url:c,anonKey:o}=v(),a=`${c}/functions/v1/local_hub?business_id=${encodeURIComponent(r)}`,u=m("standard_session_id")||"",t=m("business_session_id")||"",n=u||t,d=await fetch(a,{method:"GET",credentials:"include",headers:{apikey:o,Authorization:`Bearer ${o}`,"Content-Type":"application/json",...n?{"x-access-token":n,"x-session-id":n}:{}},signal:e}),f=await d.json().catch(()=>({}));if(!d.ok){const b=typeof(f==null?void 0:f.error)=="string"?f.error:`Failed to load business details (HTTP ${d.status})`;throw new Error(b)}return f||null}function V(){const s=m("standard_session_id"),e=m("standard_csrf_token");if(s&&e)return{sessionId:s,csrfToken:e};const r=m("business_session_id"),c=m("business_csrf_token");return r&&c?{sessionId:r,csrfToken:c}:null}async function J({action:s,payload:e={},signal:r}={}){const c=V();if(!c)throw new Error("Please log in to continue.");const{url:o,anonKey:a}=v(),u=await fetch(`${o}/functions/v1/local_hub`,{method:"POST",headers:{"Content-Type":"application/json",apikey:a,Authorization:`Bearer ${a}`,"x-access-token":c.sessionId,"x-csrf-token":c.csrfToken},body:JSON.stringify({action:s,...e||{}}),signal:r}),t=await u.json().catch(()=>({}));if(!u.ok){const n=typeof(t==null?void 0:t.error)=="string"?t.error:`Request failed (HTTP ${u.status})`;throw new Error(n)}return t}async function Y({businessId:s,method:e,url:r,signal:c}={}){const o=String(s||"").trim();if(!o)return{ok:!1};const{url:a,anonKey:u}=v(),t=await fetch(`${a}/functions/v1/local_hub`,{method:"POST",headers:{"Content-Type":"application/json",apikey:u,Authorization:`Bearer ${u}`},body:JSON.stringify({action:"share_business_profile",business_id:o,share_method:e||"",share_url:r||""}),signal:c}),n=await t.json().catch(()=>({}));return t.ok?{ok:!0}:{ok:!1,error:(n==null?void 0:n.error)||"Failed to track share."}}async function Z({businessId:s,reason:e,details:r,signal:c}={}){if(!s)throw new Error("Missing business id.");if(!e)throw new Error("Please select a reason.");return await J({action:"report_business",payload:{business_id:s,reason:e,details:r},signal:c})}function ss(s){const e=(s==null?void 0:s.post)||null,r=s!=null&&s.stats&&typeof s.stats=="object"?s.stats:{},c=Array.isArray(s==null?void 0:s.reviews)?s.reviews:[],o=s!=null&&s.viewer&&typeof s.viewer=="object"?s.viewer:null,a=s!=null&&s.product_reactions&&typeof s.product_reactions=="object"?s.product_reactions:{},u=(s!=null&&s.profile&&typeof s.profile=="object"?s.profile:null)||(s!=null&&s.business_profile&&typeof s.business_profile=="object"?s.business_profile:null)||(s!=null&&s.businessProfile&&typeof s.businessProfile=="object"?s.businessProfile:null);let t={};if(e!=null&&e.content&&typeof e.content=="object")t=e.content;else if(typeof(e==null?void 0:e.content)=="string")try{const i=JSON.parse(e.content);i&&typeof i=="object"&&(t=i)}catch{t={}}const n=(u&&typeof u=="object"?u:null)||(t!=null&&t.business&&typeof t.business=="object"?t.business:{});t!=null&&t.moderation&&typeof t.moderation=="object"&&t.moderation;const d=n.businessName||n.name||"Business",f=typeof n.businessLogo=="string"?n.businessLogo.trim():"",b=`https://ui-avatars.com/api/?name=${encodeURIComponent(d)}&background=random&color=fff`,h=n.streetAddress||n.businessAddress||n.address||"",y=n.suburb||"",j=n.village||"",I=n.town||n.city||"",$=n.province||"",S=[h,y,j,I,$].map(i=>String(i||"").trim()).filter(Boolean),T=S.join(", "),U=S.join(`
`),B=!!(n!=null&&n.isVerified||n!=null&&n.verified||n!=null&&n.is_verified||t!=null&&t.isVerified||t!=null&&t.verified||e!=null&&e.isVerified||e!=null&&e.verified||e!=null&&e.is_verified),N=n.businessNumber||n.business_number||n.phone||n.businessPhone||(t==null?void 0:t.businessNumber)||(t==null?void 0:t.business_number)||"",A=typeof N=="string"?N.trim():"",R=M(n.businessHours||n.business_hours||(t==null?void 0:t.businessHours)||(t==null?void 0:t.business_hours)||""),P=typeof(n==null?void 0:n.description)=="string"?n.description.trim():typeof(t==null?void 0:t.description)=="string"?t.description.trim():"",C=(Array.isArray(t==null?void 0:t.products)?t.products:[]).map(i=>{const p=typeof(i==null?void 0:i.name)=="string"&&i.name.trim()?i.name.trim():typeof(i==null?void 0:i.title)=="string"&&i.title.trim()?i.title.trim():"Product",_=Array.isArray(i==null?void 0:i.images)?i.images.filter(g=>typeof g=="string"&&g.trim()).map(g=>g.trim()):[],k=D({title:d,subtitle:p}),w=_.length?_.slice(0,10):[k];return{title:p,images:w,cover:w[0]||k}}),l=n.socials&&typeof n.socials=="object"&&n.socials||n.socialMedia&&typeof n.socialMedia=="object"&&n.socialMedia||n.social&&typeof n.social=="object"&&n.social||{},L={facebook:l.facebook||l.fb||"",twitter:l.twitter||l.x||"",whatsapp:l.whatsapp||l.wa||l.phone||"",tiktok:l.tiktok||l.tt||"",instagram:l.instagram||l.ig||""},x=c.map(i=>{const p=typeof(i==null?void 0:i.author_name)=="string"&&i.author_name.trim()?i.author_name.trim():typeof(i==null?void 0:i.authorName)=="string"&&i.authorName.trim()?i.authorName.trim():"Anonymous User",_=String((i==null?void 0:i.id)||""),k=Number(i==null?void 0:i.rating)||0,w=(i==null?void 0:i.created_at)||(i==null?void 0:i.updated_at)||"",g=w?Date.parse(w):0,E=typeof(i==null?void 0:i.content)=="string"?i.content:"",H=Number(i==null?void 0:i.helpful_count)||0;return{id:_,name:p,initials:O(p),avatarUrl:"",dateLabel:F(w)||"",timestamp:Number.isFinite(g)?g:0,rating:k,text:E,helpful:H}});return{businessId:(e==null?void 0:e.business_id)||(e==null?void 0:e.businessId)||(e==null?void 0:e.id)||"",businessName:d,isVerified:B,logoUrl:f||b,addressLine:T||"Address not provided",addressDisplay:U||"",businessNumber:A,businessHours:R,aboutText:P||"No description provided yet.",social:L,products:C,productReactions:a,stats:{followers:Number(r.followers)||0,likes:Number(r.likes)||0,reviewCount:Number(r.review_count)||0,averageRating:typeof r.average_rating=="number"?r.average_rating:Number(r.average_rating)||0,profileViews:Number(r.profile_views)||0,profileImpressions:Number(r.profile_impressions)||0,productViews:Number(r.product_views)||0,ratingBreakdown:r.rating_breakdown&&typeof r.rating_breakdown=="object"?r.rating_breakdown:null},reviews:x,viewer:o?{actorType:o.actorType?String(o.actorType):"",actorId:o.actorId?String(o.actorId):"",isFollowing:!!o.isFollowing,isSaved:!!o.isSaved,myReviewId:o.myReviewId?String(o.myReviewId):null,productReactions:o.productReactions&&typeof o.productReactions=="object"?o.productReactions:{}}:null,raw:s}}export{V as a,Q as b,ss as c,q as d,X as f,G as g,J as l,W as n,Z as r,Y as t};
