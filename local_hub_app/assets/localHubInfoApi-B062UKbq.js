import{r as h,j as e,s as I,g as A}from"./localHub-Byr6UtYB.js";function z({open:t,slides:s,index:a,onPrev:o,onNext:r,onClose:l}){const c=h.useMemo(()=>Array.isArray(s)?s:[],[s]),n=c[a]||c[0],m=c.length>1,d=h.useRef("");return h.useEffect(()=>{if(!t)return;d.current=document.body.style.overflow||"",document.body.style.overflow="hidden";function u(f){f.key==="Escape"&&(l==null||l()),m&&(f.key==="ArrowRight"&&(r==null||r()),f.key==="ArrowLeft"&&(o==null||o()))}return document.addEventListener("keydown",u),()=>{document.removeEventListener("keydown",u),document.body.style.overflow=d.current,d.current=""}},[m,l,r,o,t]),t?e.jsxs("div",{className:"modal-overlay active",onClick:l,role:"dialog","aria-modal":"true",children:[e.jsx("button",{type:"button",className:"lightbox-close",id:"closeLightbox",onClick:u=>{u.stopPropagation(),l==null||l()},"aria-label":"Close",children:e.jsx("i",{className:"fas fa-times"})}),m?e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",className:"lightbox-nav prev",onClick:u=>{u.stopPropagation(),o==null||o()},"aria-label":"Previous",children:e.jsx("i",{className:"fas fa-chevron-left"})}),e.jsx("button",{type:"button",className:"lightbox-nav next",onClick:u=>{u.stopPropagation(),r==null||r()},"aria-label":"Next",children:e.jsx("i",{className:"fas fa-chevron-right"})})]}):null,e.jsx("div",{className:"lightbox-content",onClick:u=>u.stopPropagation(),children:e.jsx("img",{src:n,alt:"Preview"})}),m?e.jsxs("div",{className:"lightbox-counter",id:"lightboxCounter",children:[Math.min(a+1,c.length)," / ",c.length||1]}):null]}):null}function O({open:t,onClose:s,businessId:a,onSubmit:o}){const[r,l]=h.useState(0),[c,n]=h.useState(""),[m,d]=h.useState(!1),[u,f]=h.useState(""),x=h.useMemo(()=>r>0&&!!a&&!m,[a,m,r]);return t?e.jsx("div",{className:"modal-overlay active",id:"rateModal",onClick:s,role:"dialog","aria-modal":"true","aria-label":"Rate your experience",children:e.jsxs("div",{className:"modal-content rate-modal",onClick:b=>b.stopPropagation(),children:[e.jsx("button",{type:"button",className:"modal-close",onClick:s,"aria-label":"Close",children:e.jsx("i",{className:"fas fa-times"})}),e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{className:"modal-title",style:{color:"var(--text)"},children:"Rate your experience"}),e.jsx("p",{className:"modal-subtitle",children:"We appreciate your feedback!"})]}),e.jsxs("div",{className:"modal-body",children:[e.jsx("div",{className:"rating-stars",id:"starContainer",children:Array.from({length:5},(b,k)=>{const v=k+1,_=v<=r;return e.jsx("i",{className:`fas fa-star${_?" active":""}`,"data-value":v,role:"button",tabIndex:0,"aria-label":`${v} star`,onClick:()=>l(v),onKeyDown:p=>{(p.key==="Enter"||p.key===" ")&&l(v)}},v)})}),e.jsx("textarea",{className:"report-textarea",value:c,onChange:b=>n(b.target.value),placeholder:"Write your thoughts here...",id:"reviewText",style:{height:120}}),u?e.jsx("div",{className:"rate-modal-error",children:u}):null,e.jsx("button",{type:"button",className:"btn-submit",id:"submitReview",disabled:!x,onClick:async()=>{if(a){d(!0),f("");try{await(o==null?void 0:o({businessId:a,rating:r,content:c})),l(0),n(""),s==null||s()}catch(b){f(b instanceof Error?b.message:"Failed to submit review.")}finally{d(!1)}}},children:m?"Posting...":"Post Review"})]})]})}):null}const E=[{value:"spam",label:"Spam or misleading content"},{value:"inappropriate",label:"Inappropriate content"},{value:"fraud",label:"Fraud or scam activity"},{value:"other",label:"Other issues"}];function K({open:t,onClose:s,businessId:a,onSubmit:o}){const[r,l]=h.useState("spam"),[c,n]=h.useState(""),[m,d]=h.useState(null),[u,f]=h.useState(""),[x,b]=h.useState(!1),[k,v]=h.useState(""),_=h.useMemo(()=>!!r&&!!a&&!x,[a,x,r]);return t?e.jsx("div",{className:"modal-overlay active",id:"reportModal",onClick:s,role:"dialog","aria-modal":"true","aria-label":"Report Business",children:e.jsxs("div",{className:"modal-content report-modal",onClick:p=>p.stopPropagation(),children:[e.jsx("button",{type:"button",className:"modal-close",onClick:s,"aria-label":"Close",children:e.jsx("i",{className:"fas fa-times"})}),e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{className:"modal-title",children:"Report Business"}),e.jsx("p",{className:"modal-subtitle",children:"Help us understand what's happening."})]}),e.jsxs("div",{className:"modal-body",children:[e.jsx("div",{className:"report-options",children:E.map(p=>e.jsxs("label",{className:`report-option ${r===p.value?"selected":""}`,children:[e.jsx("input",{type:"radio",name:"report_reason",value:p.value,checked:r===p.value,onChange:()=>l(p.value)}),e.jsx("span",{className:"report-radio-custom"}),e.jsx("span",{children:p.label})]},p.value))}),e.jsx("textarea",{className:"report-textarea",placeholder:"Provide additional details (optional)...",id:"reportDetails",value:c,onChange:p=>n(p.target.value)}),e.jsxs("div",{className:"upload-container",children:[e.jsxs("div",{className:"upload-box",id:"uploadBox",children:[e.jsx("i",{className:"fas fa-camera"}),e.jsx("p",{children:"Tap to upload evidence"}),e.jsx("input",{type:"file",id:"reportImage",accept:"image/*",onChange:p=>{var g;const N=((g=p.target.files)==null?void 0:g[0])||null;if(d(N),v(""),!N){f("");return}const y=new FileReader;y.onload=C=>{var $;return f(String((($=C.target)==null?void 0:$.result)||""))},y.readAsDataURL(N)}})]}),e.jsxs("div",{className:"upload-preview",id:"imagePreview",style:{display:u?"block":"none"},children:[e.jsx("img",{src:u||"",alt:"preview",id:"previewImg"}),e.jsx("button",{type:"button",className:"remove-img",id:"removeImg","aria-label":"Remove image",onClick:()=>{d(null),f("")},children:e.jsx("i",{className:"fas fa-times"})})]})]}),k?e.jsx("div",{className:"report-modal-error",children:k}):null,e.jsx("button",{type:"button",className:"btn-report-submit",id:"submitReport",disabled:!_,onClick:async()=>{if(!a)return;const N=!!m?" (evidence attached in UI)":"";b(!0),v("");try{await(o==null?void 0:o({businessId:a,reason:r,details:`${c}${N}`.trim()})),n(""),d(null),f(""),s==null||s()}catch(y){v(y instanceof Error?y.message:"Failed to submit report.")}finally{b(!1)}},children:x?"Submitting...":"Submit Report"})]})]})}):null}function W({address:t}){const s=h.useMemo(()=>`https://www.google.com/maps?q=${encodeURIComponent(t||"Johannesburg, Gauteng")}&output=embed`,[t]);return e.jsxs("section",{className:"collCard",children:[e.jsxs("div",{className:"collHead",children:[e.jsx("i",{className:"fas fa-map-marked-alt"})," Our Location"]}),e.jsx("div",{className:"map-box",children:e.jsx("iframe",{src:s,width:"100%",height:"100%",style:{border:0},allowFullScreen:!0,loading:"lazy",referrerPolicy:"no-referrer-when-downgrade",title:"Map"})})]})}const M=[{value:"spam",label:"Spam or misleading"},{value:"offensive",label:"Inappropriate or offensive"},{value:"fake",label:"Fake or biased review"}];function q({open:t,onClose:s,onSubmit:a,busy:o}){const[r,l]=h.useState("spam"),[c,n]=h.useState(""),m=h.useMemo(()=>!!r&&!o,[o,r]);return t?e.jsx("div",{className:"modal-overlay active",onClick:s,role:"dialog","aria-modal":"true","aria-label":"Report Review",children:e.jsxs("div",{className:"modal-content",onClick:d=>d.stopPropagation(),children:[e.jsx("button",{type:"button",className:"modal-close",onClick:s,"aria-label":"Close",children:e.jsx("i",{className:"fas fa-times"})}),e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{className:"modal-title",style:{color:"#ff4757"},children:"Report Review"}),e.jsx("p",{className:"modal-subtitle",children:"Why are you reporting this review?"})]}),e.jsxs("div",{className:"modal-body",children:[e.jsx("div",{style:{display:"grid",gap:10},children:M.map(d=>e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:10,padding:"10px 12px",borderRadius:12,border:"1px solid rgba(229,231,235,.9)",cursor:"pointer"},children:[e.jsx("input",{type:"radio",name:"review_report_reason",value:d.value,checked:r===d.value,onChange:()=>l(d.value)}),e.jsx("span",{style:{fontWeight:900},children:d.label})]},d.value))}),e.jsx("textarea",{value:c,onChange:d=>n(d.target.value),placeholder:"More details...",rows:4,style:{width:"100%",borderRadius:12,border:"1px solid rgba(229,231,235,.9)",padding:10,fontFamily:"inherit",marginTop:12}}),e.jsx("button",{type:"button",className:"btn danger",disabled:!m,onClick:async()=>{await(a==null?void 0:a({reason:r,details:c})),n(""),l("spam")},style:{justifyContent:"center",width:"100%",marginTop:12},children:o?"Submitting...":"Submit Report"})]})]})}):null}function w(t){try{const a=`; ${document.cookie}`.split(`; ${t}=`);return a.length===2?a.pop().split(";").shift():""}catch{return""}}function G(){try{return new URL(window.location.href).searchParams.get("business_id")||""}catch{return""}}function B(t){try{const s=new Date(t);return Number.isNaN(s.getTime())?"":s.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})}catch{return""}}function F(t){var r,l;const s=String(t||"").trim().split(/\s+/).filter(Boolean);if(!s.length)return"U";const a=((r=s[0])==null?void 0:r[0])||"",o=s.length>1&&((l=s[s.length-1])==null?void 0:l[0])||"";return(a+o).toUpperCase()||"U"}function J(t,s){const a=typeof s=="string"?s.trim():"";if(!a)return"";if(/^https?:\/\//i.test(a))return a;if(t==="whatsapp"){const r=a.replace(/[^\d]/g,"");return r?`https://wa.me/${r}`:""}const o=a.replace(/^@/,"");return o?t==="facebook"?`https://www.facebook.com/${o}`:t==="twitter"?`https://x.com/${o}`:t==="instagram"?`https://www.instagram.com/${o}`:t==="tiktok"?`https://www.tiktok.com/@${o}`:"":""}function Q({recipientId:t,recipientName:s}){try{const a=window.location.hostname,r=a==="localhost"||a==="127.0.0.1"||a===""?`http://${a||"localhost"}:5173/`:`${window.location.origin}/chat-hub/`,l=new URL(r);return t&&l.searchParams.set("recipientId",String(t)),s&&l.searchParams.set("recipientName",String(s)),l.toString()}catch{return"http://localhost:5173/"}}async function V({businessId:t,signal:s}={}){const a=String(t||"").trim();if(!a)throw new Error("Missing business_id in the URL.");const{url:o,anonKey:r}=A(),l=`${o}/functions/v1/local_hub?business_id=${encodeURIComponent(a)}`,c=w("standard_session_id")||"",n=w("business_session_id")||"",m=c||n,d=await fetch(l,{method:"GET",credentials:"include",headers:{apikey:r,Authorization:`Bearer ${r}`,"Content-Type":"application/json",...m?{"x-access-token":m,"x-session-id":m}:{}},signal:s}),u=await d.json().catch(()=>({}));if(!d.ok){const f=typeof(u==null?void 0:u.error)=="string"?u.error:`Failed to load business details (HTTP ${d.status})`;throw new Error(f)}return u||null}function D(){const t=w("standard_session_id"),s=w("standard_csrf_token");if(t&&s)return{sessionId:t,csrfToken:s};const a=w("business_session_id"),o=w("business_csrf_token");return a&&o?{sessionId:a,csrfToken:o}:null}async function X({action:t,payload:s={},signal:a}={}){const o=D();if(!o)throw new Error("Please log in to continue.");const{url:r,anonKey:l}=A(),c=await fetch(`${r}/functions/v1/local_hub`,{method:"POST",headers:{"Content-Type":"application/json",apikey:l,Authorization:`Bearer ${l}`,"x-access-token":o.sessionId,"x-csrf-token":o.csrfToken},body:JSON.stringify({action:t,...s||{}}),signal:a}),n=await c.json().catch(()=>({}));if(!c.ok){const m=typeof(n==null?void 0:n.error)=="string"?n.error:`Request failed (HTTP ${c.status})`;throw new Error(m)}return n}async function Y({businessId:t,reportKind:s="business",reason:a,details:o,signal:r}={}){const l=w("standard_session_id")||"",c=w("standard_csrf_token")||"";if(!l||!c)throw new Error("Please log in to submit a report.");const{url:n,anonKey:m}=A(),d=await fetch(`${n}/functions/v1/standard_user_reports_api`,{method:"POST",headers:{"Content-Type":"application/json",apikey:m,Authorization:`Bearer ${m}`,"x-access-token":l,"x-csrf-token":c},body:JSON.stringify({action:"create_report",business_id:t,report_kind:s,reason:a,details:o}),signal:r}),u=await d.json().catch(()=>({}));if(!d.ok){const f=typeof(u==null?void 0:u.error)=="string"?u.error:`Failed to submit report (HTTP ${d.status})`;throw new Error(f)}return u}function Z(t){const s=(t==null?void 0:t.post)||null,a=t!=null&&t.stats&&typeof t.stats=="object"?t.stats:{},o=Array.isArray(t==null?void 0:t.reviews)?t.reviews:[],r=t!=null&&t.viewer&&typeof t.viewer=="object"?t.viewer:null,l=t!=null&&t.product_reactions&&typeof t.product_reactions=="object"?t.product_reactions:{},c=s!=null&&s.content&&typeof s.content=="object"?s.content:{},n=c!=null&&c.business&&typeof c.business=="object"?c.business:{},m=n.businessName||n.name||"Business",d=typeof n.businessLogo=="string"?n.businessLogo.trim():"",u=`https://ui-avatars.com/api/?name=${encodeURIComponent(m)}&background=random&color=fff`,f=n.streetAddress||n.businessAddress||n.address||"",x=n.suburb||"",b=n.city||"",k=n.province||"",_=[f,x,b,k].map(i=>String(i||"").trim()).filter(Boolean).join(", "),p=typeof(n==null?void 0:n.description)=="string"?n.description.trim():typeof(c==null?void 0:c.description)=="string"?c.description.trim():"",y=(Array.isArray(c==null?void 0:c.products)?c.products:[]).map(i=>{const S=typeof(i==null?void 0:i.name)=="string"&&i.name.trim()?i.name.trim():typeof(i==null?void 0:i.title)=="string"&&i.title.trim()?i.title.trim():"Product",T=Array.isArray(i==null?void 0:i.images)?i.images.filter(j=>typeof j=="string"&&j.trim()).map(j=>j.trim()):[],U=I({title:m,subtitle:S}),R=T.length?T.slice(0,10):[U];return{title:S,images:R,cover:R[0]||U}}),g=n.socials&&typeof n.socials=="object"&&n.socials||n.socialMedia&&typeof n.socialMedia=="object"&&n.socialMedia||n.social&&typeof n.social=="object"&&n.social||{},C={facebook:g.facebook||g.fb||"",twitter:g.twitter||g.x||"",whatsapp:g.whatsapp||g.wa||g.phone||"",tiktok:g.tiktok||g.tt||"",instagram:g.instagram||g.ig||""},$=o.map(i=>{const S=typeof(i==null?void 0:i.author_name)=="string"&&i.author_name.trim()?i.author_name.trim():typeof(i==null?void 0:i.authorName)=="string"&&i.authorName.trim()?i.authorName.trim():"Anonymous User",T=String((i==null?void 0:i.id)||""),U=Number(i==null?void 0:i.rating)||0,R=(i==null?void 0:i.created_at)||(i==null?void 0:i.updated_at)||"",j=R?Date.parse(R):0,L=typeof(i==null?void 0:i.content)=="string"?i.content:"",P=Number(i==null?void 0:i.helpful_count)||0;return{id:T,name:S,initials:F(S),avatarUrl:"",dateLabel:B(R)||"",timestamp:Number.isFinite(j)?j:0,rating:U,text:L,helpful:P}});return{businessId:(s==null?void 0:s.business_id)||(s==null?void 0:s.businessId)||(s==null?void 0:s.id)||"",businessName:m,logoUrl:d||u,addressLine:_||"Address not provided",aboutText:p||"No description provided yet.",social:C,products:y,productReactions:l,stats:{followers:Number(a.followers)||0,likes:Number(a.likes)||0,reviewCount:Number(a.review_count)||0,averageRating:typeof a.average_rating=="number"?a.average_rating:Number(a.average_rating)||0,ratingBreakdown:a.rating_breakdown&&typeof a.rating_breakdown=="object"?a.rating_breakdown:null},reviews:$,viewer:r?{isFollowing:!!r.isFollowing,myReviewId:r.myReviewId?String(r.myReviewId):null,productReactions:r.productReactions&&typeof r.productReactions=="object"?r.productReactions:{}}:null,raw:t}}export{W as L,q as R,Q as a,z as b,K as c,Y as d,O as e,V as f,G as g,Z as h,X as l,J as n};
