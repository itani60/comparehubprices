import{r as h,j as a,s as M,g as T}from"./localHub-Ddi82mor.js";function G({open:t,slides:e,index:s,onPrev:r,onNext:n,onClose:l}){const i=h.useMemo(()=>Array.isArray(e)?e:[],[e]),o=i[s]||i[0],u=i.length>1,d=h.useRef("");return h.useEffect(()=>{if(!t)return;d.current=document.body.style.overflow||"",document.body.style.overflow="hidden";function m(p){p.key==="Escape"&&(l==null||l()),u&&(p.key==="ArrowRight"&&(n==null||n()),p.key==="ArrowLeft"&&(r==null||r()))}return document.addEventListener("keydown",m),()=>{document.removeEventListener("keydown",m),document.body.style.overflow=d.current,d.current=""}},[u,l,n,r,t]),t?a.jsxs("div",{className:"modal-overlay active",onClick:l,role:"dialog","aria-modal":"true",children:[a.jsx("button",{type:"button",className:"lightbox-close",id:"closeLightbox",onClick:m=>{m.stopPropagation(),l==null||l()},"aria-label":"Close",children:a.jsx("i",{className:"fas fa-times"})}),u?a.jsxs(a.Fragment,{children:[a.jsx("button",{type:"button",className:"lightbox-nav prev",onClick:m=>{m.stopPropagation(),r==null||r()},"aria-label":"Previous",children:a.jsx("i",{className:"fas fa-chevron-left"})}),a.jsx("button",{type:"button",className:"lightbox-nav next",onClick:m=>{m.stopPropagation(),n==null||n()},"aria-label":"Next",children:a.jsx("i",{className:"fas fa-chevron-right"})})]}):null,a.jsx("div",{className:"lightbox-content",onClick:m=>m.stopPropagation(),children:a.jsx("img",{src:o,alt:"Preview"})}),u?a.jsxs("div",{className:"lightbox-counter",id:"lightboxCounter",children:[Math.min(s+1,i.length)," / ",i.length||1]}):null]}):null}function J({open:t,onClose:e,businessId:s,onSubmit:r}){const[n,l]=h.useState(0),[i,o]=h.useState(""),[u,d]=h.useState(!1),[m,p]=h.useState(""),w=h.useMemo(()=>n>0&&!!s&&!u,[s,u,n]);return t?a.jsx("div",{className:"modal-overlay active",id:"rateModal",onClick:e,role:"dialog","aria-modal":"true","aria-label":"Rate your experience",children:a.jsxs("div",{className:"modal-content rate-modal",onClick:b=>b.stopPropagation(),children:[a.jsx("button",{type:"button",className:"modal-close",onClick:e,"aria-label":"Close",children:a.jsx("i",{className:"fas fa-times"})}),a.jsxs("div",{className:"modal-header",children:[a.jsx("h3",{className:"modal-title",style:{color:"var(--text)"},children:"Rate your experience"}),a.jsx("p",{className:"modal-subtitle",children:"We appreciate your feedback!"})]}),a.jsxs("div",{className:"modal-body",children:[a.jsx("div",{className:"rating-stars",id:"starContainer",children:Array.from({length:5},(b,k)=>{const v=k+1,S=v<=n;return a.jsx("i",{className:`fas fa-star${S?" active":""}`,"data-value":v,role:"button",tabIndex:0,"aria-label":`${v} star`,onClick:()=>l(v),onKeyDown:f=>{(f.key==="Enter"||f.key===" ")&&l(v)}},v)})}),a.jsx("textarea",{className:"report-textarea",value:i,onChange:b=>o(b.target.value),placeholder:"Write your thoughts here...",id:"reviewText",style:{height:120}}),m?a.jsx("div",{className:"rate-modal-error",children:m}):null,a.jsx("button",{type:"button",className:"btn-submit",id:"submitReview",disabled:!w,onClick:async()=>{if(s){d(!0),p("");try{await(r==null?void 0:r({businessId:s,rating:n,content:i})),l(0),o(""),e==null||e()}catch(b){p(b instanceof Error?b.message:"Failed to submit review.")}finally{d(!1)}}},children:u?"Posting...":"Post Review"})]})]})}):null}const I=[{value:"spam",label:"Spam or misleading content"},{value:"inappropriate",label:"Inappropriate content"},{value:"fraud",label:"Fraud or scam activity"},{value:"other",label:"Other issues"}];function z({open:t,onClose:e,businessId:s,onSubmit:r}){const[n,l]=h.useState("spam"),[i,o]=h.useState(""),[u,d]=h.useState(null),[m,p]=h.useState(""),[w,b]=h.useState(!1),[k,v]=h.useState(""),S=h.useMemo(()=>!!n&&!!s&&!w,[s,w,n]);return t?a.jsx("div",{className:"modal-overlay active",id:"reportModal",onClick:e,role:"dialog","aria-modal":"true","aria-label":"Report Business",children:a.jsxs("div",{className:"modal-content report-modal",onClick:f=>f.stopPropagation(),children:[a.jsx("button",{type:"button",className:"modal-close",onClick:e,"aria-label":"Close",children:a.jsx("i",{className:"fas fa-times"})}),a.jsxs("div",{className:"modal-header",children:[a.jsx("h3",{className:"modal-title",children:"Report Business"}),a.jsx("p",{className:"modal-subtitle",children:"Help us understand what's happening."})]}),a.jsxs("div",{className:"modal-body",children:[a.jsx("div",{className:"report-options",children:I.map(f=>a.jsxs("label",{className:`report-option ${n===f.value?"selected":""}`,children:[a.jsx("input",{type:"radio",name:"report_reason",value:f.value,checked:n===f.value,onChange:()=>l(f.value)}),a.jsx("span",{className:"report-radio-custom"}),a.jsx("span",{children:f.label})]},f.value))}),a.jsx("textarea",{className:"report-textarea",placeholder:"Provide additional details (optional)...",id:"reportDetails",value:i,onChange:f=>o(f.target.value)}),a.jsxs("div",{className:"upload-container",children:[a.jsxs("div",{className:"upload-box",id:"uploadBox",children:[a.jsx("i",{className:"fas fa-camera"}),a.jsx("p",{children:"Tap to upload evidence"}),a.jsx("input",{type:"file",id:"reportImage",accept:"image/*",onChange:f=>{var U;const y=((U=f.target.files)==null?void 0:U[0])||null;if(d(y),v(""),!y){p("");return}const x=new FileReader;x.onload=A=>{var g;return p(String(((g=A.target)==null?void 0:g.result)||""))},x.readAsDataURL(y)}})]}),a.jsxs("div",{className:"upload-preview",id:"imagePreview",style:{display:m?"block":"none"},children:[a.jsx("img",{src:m||"",alt:"preview",id:"previewImg"}),a.jsx("button",{type:"button",className:"remove-img",id:"removeImg","aria-label":"Remove image",onClick:()=>{d(null),p("")},children:a.jsx("i",{className:"fas fa-times"})})]})]}),k?a.jsx("div",{className:"report-modal-error",children:k}):null,a.jsx("button",{type:"button",className:"btn-report-submit",id:"submitReport",disabled:!S,onClick:async()=>{if(!s)return;const y=!!u?" (evidence attached in UI)":"";b(!0),v("");try{await(r==null?void 0:r({businessId:s,reason:n,details:`${i}${y}`.trim()})),o(""),d(null),p(""),e==null||e()}catch(x){v(x instanceof Error?x.message:"Failed to submit report.")}finally{b(!1)}},children:w?"Submitting...":"Submit Report"})]})]})}):null}function Q({address:t}){const e=h.useMemo(()=>`https://www.google.com/maps?q=${encodeURIComponent(t||"Johannesburg, Gauteng")}&output=embed`,[t]);return a.jsxs("section",{className:"collCard",children:[a.jsxs("div",{className:"collHead",children:[a.jsx("i",{className:"fas fa-map-marked-alt"})," Our Location"]}),a.jsx("div",{className:"map-box",children:a.jsx("iframe",{src:e,width:"100%",height:"100%",style:{border:0},allowFullScreen:!0,loading:"lazy",referrerPolicy:"no-referrer-when-downgrade",title:"Map"})})]})}const F=[{value:"spam",label:"Spam or misleading"},{value:"offensive",label:"Inappropriate or offensive"},{value:"fake",label:"Fake or biased review"}];function X({open:t,onClose:e,onSubmit:s,busy:r}){const[n,l]=h.useState("spam"),[i,o]=h.useState(""),u=h.useMemo(()=>!!n&&!r,[r,n]);return t?a.jsx("div",{className:"modal-overlay active",onClick:e,role:"dialog","aria-modal":"true","aria-label":"Report Review",children:a.jsxs("div",{className:"modal-content",onClick:d=>d.stopPropagation(),children:[a.jsx("button",{type:"button",className:"modal-close",onClick:e,"aria-label":"Close",children:a.jsx("i",{className:"fas fa-times"})}),a.jsxs("div",{className:"modal-header",children:[a.jsx("h3",{className:"modal-title",style:{color:"#ff4757"},children:"Report Review"}),a.jsx("p",{className:"modal-subtitle",children:"Why are you reporting this review?"})]}),a.jsxs("div",{className:"modal-body",children:[a.jsx("div",{style:{display:"grid",gap:10},children:F.map(d=>a.jsxs("label",{style:{display:"flex",alignItems:"center",gap:10,padding:"10px 12px",borderRadius:12,border:"1px solid rgba(229,231,235,.9)",cursor:"pointer"},children:[a.jsx("input",{type:"radio",name:"review_report_reason",value:d.value,checked:n===d.value,onChange:()=>l(d.value)}),a.jsx("span",{style:{fontWeight:900},children:d.label})]},d.value))}),a.jsx("textarea",{value:i,onChange:d=>o(d.target.value),placeholder:"More details...",rows:4,style:{width:"100%",borderRadius:12,border:"1px solid rgba(229,231,235,.9)",padding:10,fontFamily:"inherit",marginTop:12}}),a.jsx("button",{type:"button",className:"btn danger",disabled:!u,onClick:async()=>{await(s==null?void 0:s({reason:n,details:i})),o(""),l("spam")},style:{justifyContent:"center",width:"100%",marginTop:12},children:r?"Submitting...":"Submit Report"})]})]})}):null}function D(){try{return typeof navigator<"u"&&typeof navigator.share=="function"}catch{return!1}}async function O(t){var s;const e=String(t||"");if(!e)return!1;try{if((s=navigator==null?void 0:navigator.clipboard)!=null&&s.writeText)return await navigator.clipboard.writeText(e),!0}catch{}try{const r=document.createElement("textarea");r.value=e,r.setAttribute("readonly","readonly"),r.style.position="fixed",r.style.top="-9999px",r.style.left="-9999px",document.body.appendChild(r),r.select();const n=document.execCommand("copy");return document.body.removeChild(r),n}catch{return!1}}async function Y({title:t,text:e,url:s}){const r={title:t?String(t):void 0,text:e?String(e):void 0,url:s?String(s):void 0},n=r.url||"";if(D())try{return await navigator.share(r),{ok:!0,method:"share"}}catch(i){if(i&&typeof i=="object"&&"name"in i&&String(i.name)==="AbortError")return{ok:!0,method:"canceled"}}const l=await O(n||window.location.href);return{ok:l,method:l?"copy":"none"}}function Z({baseUrl:t,businessId:e,isMobile:s}){try{const r=t?String(t):"",n=e?String(e):"",l=s?"local_hub_info_mobile.html":"local_hub_info.html",i=new URL(`${r}${l}`,window.location.href);return n&&i.searchParams.set("business_id",n),i.toString()}catch{return window.location.href}}const ee=t=>{if(typeof t!="string")return[];const e=t.replace(/\r\n/g,`
`).split(`
`),s=[];let r=[];const n=()=>{r.length&&(s.push({type:"list",items:r}),r=[])};return e.forEach(l=>{const i=l.trim();if(!i){n();return}const o=i.match(/^#{1,3}\s+(.*)$/);if(o){n(),s.push({type:"heading",text:o[1].trim()});return}const u=i.match(/^([•\u2022]|â€¢|-|\*)\s+(.*)$/);if(u){r.push(u[2].trim());return}n(),s.push({type:"para",text:i})}),n(),s};function _(t){try{const s=`; ${document.cookie}`.split(`; ${t}=`);return s.length===2?s.pop().split(";").shift():""}catch{return""}}function te(){try{return new URL(window.location.href).searchParams.get("business_id")||""}catch{return""}}function H(t){try{const e=new Date(t);return Number.isNaN(e.getTime())?"":e.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})}catch{return""}}function V(t){var n,l;const e=String(t||"").trim().split(/\s+/).filter(Boolean);if(!e.length)return"U";const s=((n=e[0])==null?void 0:n[0])||"",r=e.length>1&&((l=e[e.length-1])==null?void 0:l[0])||"";return(s+r).toUpperCase()||"U"}function se(t,e){const s=typeof e=="string"?e.trim():"";if(!s)return"";if(/^https?:\/\//i.test(s))return s;if(t==="whatsapp"){const n=s.replace(/[^\d]/g,"");return n?`https://wa.me/${n}`:""}const r=s.replace(/^@/,"");return r?t==="facebook"?`https://www.facebook.com/${r}`:t==="twitter"?`https://x.com/${r}`:t==="instagram"?`https://www.instagram.com/${r}`:t==="tiktok"?`https://www.tiktok.com/@${r}`:"":""}function ae({recipientId:t,recipientName:e}){try{const s=window.location.hostname,n=s==="localhost"||s==="127.0.0.1"||s===""?`http://${s||"localhost"}:5173/`:`${window.location.origin}/chat-hub/`,l=new URL(n);return t&&l.searchParams.set("recipientId",String(t)),e&&l.searchParams.set("recipientName",String(e)),l.toString()}catch{return"http://localhost:5173/"}}async function re({businessId:t,signal:e}={}){const s=String(t||"").trim();if(!s)throw new Error("Missing business_id in the URL.");const{url:r,anonKey:n}=T(),l=`${r}/functions/v1/local_hub?business_id=${encodeURIComponent(s)}`,i=_("standard_session_id")||"",o=_("business_session_id")||"",u=i||o,d=await fetch(l,{method:"GET",credentials:"include",headers:{apikey:n,Authorization:`Bearer ${n}`,"Content-Type":"application/json",...u?{"x-access-token":u,"x-session-id":u}:{}},signal:e}),m=await d.json().catch(()=>({}));if(!d.ok){const p=typeof(m==null?void 0:m.error)=="string"?m.error:`Failed to load business details (HTTP ${d.status})`;throw new Error(p)}return m||null}function W(){const t=_("standard_session_id"),e=_("standard_csrf_token");if(t&&e)return{sessionId:t,csrfToken:e};const s=_("business_session_id"),r=_("business_csrf_token");return s&&r?{sessionId:s,csrfToken:r}:null}async function K({action:t,payload:e={},signal:s}={}){const r=W();if(!r)throw new Error("Please log in to continue.");const{url:n,anonKey:l}=T(),i=await fetch(`${n}/functions/v1/local_hub`,{method:"POST",headers:{"Content-Type":"application/json",apikey:l,Authorization:`Bearer ${l}`,"x-access-token":r.sessionId,"x-csrf-token":r.csrfToken},body:JSON.stringify({action:t,...e||{}}),signal:s}),o=await i.json().catch(()=>({}));if(!i.ok){const u=typeof(o==null?void 0:o.error)=="string"?o.error:`Request failed (HTTP ${i.status})`;throw new Error(u)}return o}async function ie({businessId:t,method:e,url:s,signal:r}={}){const n=String(t||"").trim();if(!n)return{ok:!1};const{url:l,anonKey:i}=T(),o=await fetch(`${l}/functions/v1/local_hub`,{method:"POST",headers:{"Content-Type":"application/json",apikey:i,Authorization:`Bearer ${i}`},body:JSON.stringify({action:"share_business_profile",business_id:n,share_method:e||"",share_url:s||""}),signal:r}),u=await o.json().catch(()=>({}));return o.ok?{ok:!0}:{ok:!1,error:(u==null?void 0:u.error)||"Failed to track share."}}async function ne({businessId:t,reason:e,details:s,signal:r}={}){if(!t)throw new Error("Missing business id.");if(!e)throw new Error("Please select a reason.");return await K({action:"report_business",payload:{business_id:t,reason:e,details:s},signal:r})}function oe(t){const e=(t==null?void 0:t.post)||null,s=t!=null&&t.stats&&typeof t.stats=="object"?t.stats:{},r=Array.isArray(t==null?void 0:t.reviews)?t.reviews:[],n=t!=null&&t.viewer&&typeof t.viewer=="object"?t.viewer:null,l=t!=null&&t.product_reactions&&typeof t.product_reactions=="object"?t.product_reactions:{},i=e!=null&&e.content&&typeof e.content=="object"?e.content:{},o=i!=null&&i.business&&typeof i.business=="object"?i.business:{},u=i!=null&&i.moderation&&typeof i.moderation=="object"?i.moderation:{},d=o.businessName||o.name||"Business",m=typeof o.businessLogo=="string"?o.businessLogo.trim():"",p=`https://ui-avatars.com/api/?name=${encodeURIComponent(d)}&background=random&color=fff`,w=o.streetAddress||o.businessAddress||o.address||"",b=o.suburb||"",k=o.city||"",v=o.province||"",f=[w,b,k,v].map(c=>String(c||"").trim()).filter(Boolean).join(", "),y=!!((u==null?void 0:u.status)==="approved"||(e==null?void 0:e.status)==="approved"||o!=null&&o.isVerified||o!=null&&o.verified||o!=null&&o.is_verified||i!=null&&i.isVerified||i!=null&&i.verified||e!=null&&e.isVerified||e!=null&&e.verified||e!=null&&e.is_verified),x=typeof(o==null?void 0:o.description)=="string"?o.description.trim():typeof(i==null?void 0:i.description)=="string"?i.description.trim():"",A=(Array.isArray(i==null?void 0:i.products)?i.products:[]).map(c=>{const R=typeof(c==null?void 0:c.name)=="string"&&c.name.trim()?c.name.trim():typeof(c==null?void 0:c.title)=="string"&&c.title.trim()?c.title.trim():"Product",$=Array.isArray(c==null?void 0:c.images)?c.images.filter(j=>typeof j=="string"&&j.trim()).map(j=>j.trim()):[],C=M({title:d,subtitle:R}),N=$.length?$.slice(0,10):[C];return{title:R,images:N,cover:N[0]||C}}),g=o.socials&&typeof o.socials=="object"&&o.socials||o.socialMedia&&typeof o.socialMedia=="object"&&o.socialMedia||o.social&&typeof o.social=="object"&&o.social||{},B={facebook:g.facebook||g.fb||"",twitter:g.twitter||g.x||"",whatsapp:g.whatsapp||g.wa||g.phone||"",tiktok:g.tiktok||g.tt||"",instagram:g.instagram||g.ig||""},L=r.map(c=>{const R=typeof(c==null?void 0:c.author_name)=="string"&&c.author_name.trim()?c.author_name.trim():typeof(c==null?void 0:c.authorName)=="string"&&c.authorName.trim()?c.authorName.trim():"Anonymous User",$=String((c==null?void 0:c.id)||""),C=Number(c==null?void 0:c.rating)||0,N=(c==null?void 0:c.created_at)||(c==null?void 0:c.updated_at)||"",j=N?Date.parse(N):0,E=typeof(c==null?void 0:c.content)=="string"?c.content:"",P=Number(c==null?void 0:c.helpful_count)||0;return{id:$,name:R,initials:V(R),avatarUrl:"",dateLabel:H(N)||"",timestamp:Number.isFinite(j)?j:0,rating:C,text:E,helpful:P}});return{businessId:(e==null?void 0:e.business_id)||(e==null?void 0:e.businessId)||(e==null?void 0:e.id)||"",businessName:d,isVerified:y,logoUrl:m||p,addressLine:f||"Address not provided",aboutText:x||"No description provided yet.",social:B,products:A,productReactions:l,stats:{followers:Number(s.followers)||0,likes:Number(s.likes)||0,reviewCount:Number(s.review_count)||0,averageRating:typeof s.average_rating=="number"?s.average_rating:Number(s.average_rating)||0,profileViews:Number(s.profile_views)||0,profileImpressions:Number(s.profile_impressions)||0,productViews:Number(s.product_views)||0,ratingBreakdown:s.rating_breakdown&&typeof s.rating_breakdown=="object"?s.rating_breakdown:null},reviews:L,viewer:n?{isFollowing:!!n.isFollowing,isSaved:!!n.isSaved,myReviewId:n.myReviewId?String(n.myReviewId):null,productReactions:n.productReactions&&typeof n.productReactions=="object"?n.productReactions:{}}:null,raw:t}}export{Q as L,X as R,W as a,ae as b,Z as c,ee as d,G as e,z as f,te as g,J as h,re as i,oe as j,K as l,se as n,ne as r,Y as s,ie as t};
