import{r as l,j as s,c as ps,R as fs}from"./localHub-Byr6UtYB.js";import{g as ms,l as v,a as js,n as S,L as bs,b as Ns,R as gs,c as ys,d as ks,e as vs,f as Cs,h as Rs}from"./localHubInfoApi-B062UKbq.js";const _s=[{value:"Newest",label:"Newest"},{value:"Highest",label:"Highest Rated"},{value:"Lowest",label:"Lowest Rated"}];function Ls({reviews:x,ratingSummary:o,onReport:N,onHelpful:g,onReportReview:B}){const[u,y]=l.useState("Newest"),[m,C]=l.useState(!1),[I,E]=l.useState(()=>new Map),f=l.useRef(null);l.useEffect(()=>{function n(i){f.current&&(f.current.contains(i.target)||C(!1))}return document.addEventListener("click",n),()=>document.removeEventListener("click",n)},[]);const h=l.useMemo(()=>Array.isArray(x)?x:[],[x]),k=l.useMemo(()=>{const n=[...h];return u==="Highest"?n.sort((i,d)=>d.rating-i.rating||d.timestamp-i.timestamp):u==="Lowest"?n.sort((i,d)=>i.rating-d.rating||d.timestamp-i.timestamp):n.sort((i,d)=>d.timestamp-i.timestamp),n},[h,u]),R=(o&&typeof o.total=="number"?o.total:h.length)||1,_=o&&typeof o.avg=="number"?o.avg:h.reduce((n,i)=>n+(Number(i.rating)||0),0)/(h.length||1),U=l.useMemo(()=>{if(o&&o.counts)return o.counts;const n={1:0,2:0,3:0,4:0,5:0};return h.forEach(i=>{const d=Math.max(1,Math.min(5,Math.round(Number(i.rating)||0)));n[d]+=1}),n},[o,h]);return s.jsxs("section",{className:"collCard",children:[s.jsxs("div",{className:"collHead collHeadRow",children:[s.jsxs("span",{children:[s.jsx("i",{className:"fas fa-star"})," Reviews"]}),s.jsxs("div",{className:"sort-box",ref:f,children:[s.jsxs("button",{type:"button",className:"custom-dropdown",onClick:n=>{n.stopPropagation(),C(i=>!i)},children:[s.jsx("i",{className:"fas fa-sort-amount-down"})," ",s.jsx("span",{children:u})]}),s.jsx("div",{className:`dropdown-menu ${m?"show":""}`,children:_s.map(n=>s.jsx("div",{className:`dropdown-item ${n.value===u?"active":""}`,onClick:()=>{y(n.value),C(!1)},children:n.label},n.value))})]})]}),s.jsxs("div",{className:"rating-summary-card",children:[s.jsxs("div",{className:"summary-left",children:[s.jsx("div",{className:"big-num",children:_.toFixed(1)}),s.jsx("div",{className:"stars-sm",children:Array.from({length:5},(n,i)=>s.jsx("svg",{viewBox:"0 0 24 24",style:{fill:i<Math.round(_)?"#fbbf24":"#e2e8f0"},children:s.jsx("path",{d:"M12 17.3l-6.2 3.7 1.7-7L2 8.9l7.2-.6L12 2l2.8 6.3 7.2.6-5.5 5.1 1.7 7z"})},i))}),s.jsxs("div",{className:"total-cnt",children:[R," Reviews"]})]}),s.jsx("div",{className:"summary-bars",children:[5,4,3,2,1].map(n=>s.jsxs("div",{className:"bar-row",children:[s.jsx("span",{children:n}),s.jsx("div",{className:"bar-bg",children:s.jsx("div",{className:"bar-fill",style:{width:`${Math.round(U[n]/R*100)}%`}})})]},n))})]}),s.jsx("div",{className:"rev-container",children:k.length?k.map(n=>s.jsx("div",{className:"review-row",children:(()=>{const i=I.get(n.id)||0,d=Number(n.helpful||0)+i;return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"rev-header",children:[s.jsx("div",{className:"rev-avatar",children:n.avatarUrl?s.jsx("img",{src:n.avatarUrl,alt:"User"}):n.initials}),s.jsxs("div",{className:"rev-meta",children:[s.jsx("div",{className:"rev-name",children:n.name}),s.jsx("div",{className:"rev-date",children:n.dateLabel}),s.jsx("div",{className:"stars-sm",style:{margin:"2px 0"},children:Array.from({length:5},(j,p)=>s.jsx("svg",{viewBox:"0 0 24 24",style:{fill:p<n.rating?"#fbbf24":"#e2e8f0"},children:s.jsx("path",{d:"M12 17.3l-6.2 3.7 1.7-7L2 8.9l7.2-.6L12 2l2.8 6.3 7.2.6-5.5 5.1 1.7 7z"})},p))})]})]}),s.jsx("div",{className:"rev-body",children:n.text}),s.jsxs("div",{className:"rev-actions",children:[s.jsxs("button",{type:"button",className:"btn-link-action",onClick:async()=>{try{await(g==null?void 0:g(n.id)),E(j=>{const p=new Map(j);return p.set(n.id,(p.get(n.id)||0)+1),p})}catch{}},children:[s.jsx("i",{className:"far fa-thumbs-up"})," Helpful"," ",s.jsxs("span",{style:{opacity:.7},children:["(",d,")"]})]}),s.jsxs("button",{type:"button",className:"btn-link-action",onClick:()=>{B?B(n.id):N==null||N()},children:[s.jsx("i",{className:"far fa-flag"})," Report"]})]})]})})()},n.id)):s.jsx("div",{style:{padding:12,color:"var(--muted)",fontWeight:900},children:"No reviews yet."})})]})}function Ss(){var W,z,A,w,T,P,$,K,V,G,Y,q,J,Q,X,Z,M,ss,es,as,ts;const[x,o]=l.useState(!0),[N,g]=l.useState(""),[B,u]=l.useState(null),[y,m]=l.useState(""),[C,I]=l.useState(!1),[E,f]=l.useState(!1),[h,k]=l.useState(!1),[R,_]=l.useState(""),[U,n]=l.useState(!1),[i,d]=l.useState(!1),[j,p]=l.useState([]),[us,D]=l.useState(0);function H(a,t=0){p(a),D(t),d(!0)}l.useEffect(()=>{let a=null;if(y)return a=setTimeout(()=>m(""),4e3),()=>{a&&clearTimeout(a)}},[y]);async function L({signal:a}={}){const t=ms();if(!t){u(null),o(!1);return}o(!0),g("");try{const c=await Cs({businessId:t,signal:a});u(Rs(c))}catch(c){if(a!=null&&a.aborted)return;u(null),g(c instanceof Error?c.message:"Failed to load business details.")}finally{if(a!=null&&a.aborted)return;o(!1)}}if(l.useEffect(()=>{const a=new AbortController;return L({signal:a.signal}),()=>a.abort()},[]),!ms())return s.jsx("div",{className:"screen",children:s.jsxs("section",{className:"card",style:{borderColor:"#fecaca"},children:[s.jsx("div",{className:"cardHead",children:s.jsx("h2",{style:{color:"#b91c1c"},children:"Missing business_id"})}),s.jsx("div",{className:"cardBody",children:"Open this page with `?business_id=...`."})]})});const e=B,hs=(e==null?void 0:e.logoUrl)||"";return s.jsxs("div",{className:"screen",children:[y?s.jsx("div",{style:{marginBottom:10,fontWeight:900},children:y}):null,N?s.jsxs("section",{className:"card",style:{borderColor:"#fecaca"},children:[s.jsx("div",{className:"cardHead",children:s.jsx("h2",{style:{color:"#b91c1c"},children:"Failed to load business details"})}),s.jsx("div",{className:"cardBody",children:N})]}):null,s.jsxs("section",{className:"hero",children:[s.jsx("div",{className:"cover",children:s.jsx("div",{className:"logoRing",children:s.jsx("img",{src:hs,alt:"Logo"})})}),s.jsxs("div",{className:"heroBody",children:[s.jsx("div",{className:"titleRow",children:s.jsxs("div",{className:"nameBlock",children:[s.jsx("h1",{className:"name",children:(e==null?void 0:e.businessName)||(x?"Loading...":"Business")}),s.jsxs("div",{className:"addr",children:[s.jsxs("svg",{className:"pin",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("path",{d:"M12 21s7-4.35 7-11a7 7 0 1 0-14 0c0 6.65 7 11 7 11z"}),s.jsx("circle",{cx:"12",cy:"10",r:"2.5"})]}),(e==null?void 0:e.addressLine)||(x?"Loading...":"Address not provided")]})]})}),s.jsxs("div",{className:"stats-row",children:[s.jsxs("div",{className:"stats-item",children:[s.jsx("span",{className:"stats-val",children:((W=e==null?void 0:e.stats)==null?void 0:W.followers)??0})," Followers"]}),s.jsxs("div",{className:"stats-item",children:[s.jsx("span",{className:"stats-val",children:((z=e==null?void 0:e.stats)==null?void 0:z.reviewCount)??0})," Reviews"]}),s.jsxs("div",{className:"stats-item",children:[s.jsx("span",{className:"stats-val",children:((A=e==null?void 0:e.stats)==null?void 0:A.likes)??0})," Likes"]}),s.jsxs("div",{className:"stats-item",children:[s.jsx("span",{className:"stats-val",children:(w=e==null?void 0:e.stats)!=null&&w.reviewCount?e.stats.averageRating.toFixed(1):"0.0"})," ","Rating"]})]}),s.jsxs("div",{className:"actions",children:[s.jsxs("button",{type:"button",className:"btn primary",disabled:!(e!=null&&e.businessId)||x,onClick:async()=>{var a;if(e!=null&&e.businessId)try{const t=!((a=e==null?void 0:e.viewer)!=null&&a.isFollowing);await v({action:t?"follow_business":"unfollow_business",payload:{business_id:e.businessId}}),m(t?"Following":"Unfollowed"),await L()}catch(t){m(t instanceof Error?t.message:"Failed to update follow.")}},children:[s.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:s.jsx("path",{d:"M20 6L9 17l-5-5"})}),(T=e==null?void 0:e.viewer)!=null&&T.isFollowing?"Following":"Follow"]}),s.jsxs("a",{href:js({recipientId:e==null?void 0:e.businessId,recipientName:e==null?void 0:e.businessName}),className:"btn ghost",children:[s.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:s.jsx("path",{d:"M21 15a4 4 0 0 1-4 4H7l-4 3V7a4 4 0 0 1 4-4h10a4 4 0 0 1 4 4z"})}),"Chat"]})]}),s.jsxs("div",{className:"actions2",children:[s.jsxs("button",{type:"button",className:"btn small",onClick:()=>I(!0),children:[s.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:s.jsx("path",{d:"M12 17.3l-6.2 3.7 1.7-7L2 8.9l7.2-.6L12 2l2.8 6.3 7.2.6-5.5 5.1 1.7 7z"})}),"Rate"]}),s.jsxs("button",{type:"button",className:"btn small",onClick:()=>alert("Share"),children:[s.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("circle",{cx:"18",cy:"5",r:"3"}),s.jsx("circle",{cx:"6",cy:"12",r:"3"}),s.jsx("circle",{cx:"18",cy:"19",r:"3"}),s.jsx("path",{d:"M8.6 13.5l6.8 3.9M15.4 6.6L8.6 10.5"})]}),"Share"]}),s.jsxs("button",{type:"button",className:"btn small danger",onClick:()=>f(!0),children:[s.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("path",{d:"M4 22V4"}),s.jsx("path",{d:"M4 4h13l-1.5 4L17 12H4"})]}),"Report"]})]})]})]}),s.jsxs("section",{className:"card",children:[s.jsxs("div",{className:"cardHead",children:[s.jsxs("h2",{children:["About ",(e==null?void 0:e.businessName)||"Business"]}),s.jsx("span",{className:"badge",children:"Verified"})]}),s.jsx("div",{className:"cardBody",children:x?"Loading...":(e==null?void 0:e.aboutText)||"No description provided."}),s.jsxs("div",{style:{marginTop:10},children:[s.jsx("div",{style:{fontSize:13,fontWeight:1e3,marginBottom:10},children:"Connect with us"}),s.jsxs("div",{className:"social-flex",style:{padding:0,gap:10},children:[s.jsx("a",{href:S("facebook",(P=e==null?void 0:e.social)==null?void 0:P.facebook),className:"social-item fb",onClick:a=>{var t;(t=e==null?void 0:e.social)!=null&&t.facebook||a.preventDefault()},style:{display:($=e==null?void 0:e.social)!=null&&$.facebook?"":"none"},target:"_blank",rel:"noopener",children:s.jsx("i",{className:"fab fa-facebook-f"})}),s.jsx("a",{href:S("twitter",((K=e==null?void 0:e.social)==null?void 0:K.instagram)||((V=e==null?void 0:e.social)==null?void 0:V.twitter)),className:"social-item tw",onClick:a=>{var t,c;(t=e==null?void 0:e.social)!=null&&t.instagram||(c=e==null?void 0:e.social)!=null&&c.twitter||a.preventDefault()},style:{display:(G=e==null?void 0:e.social)!=null&&G.instagram||(Y=e==null?void 0:e.social)!=null&&Y.twitter?"":"none"},target:"_blank",rel:"noopener",children:s.jsx("i",{className:(q=e==null?void 0:e.social)!=null&&q.instagram?"fab fa-instagram":"fa-brands fa-x-twitter"})}),s.jsx("a",{href:S("whatsapp",(J=e==null?void 0:e.social)==null?void 0:J.whatsapp),className:"social-item wa",onClick:a=>{var t;(t=e==null?void 0:e.social)!=null&&t.whatsapp||a.preventDefault()},style:{display:(Q=e==null?void 0:e.social)!=null&&Q.whatsapp?"":"none"},target:"_blank",rel:"noopener",children:s.jsx("i",{className:"fab fa-whatsapp"})}),s.jsx("a",{href:S("tiktok",(X=e==null?void 0:e.social)==null?void 0:X.tiktok),className:"social-item tt",onClick:a=>{var t;(t=e==null?void 0:e.social)!=null&&t.tiktok||a.preventDefault()},style:{display:(Z=e==null?void 0:e.social)!=null&&Z.tiktok?"":"none"},target:"_blank",rel:"noopener",children:s.jsx("i",{className:"fab fa-tiktok"})}),s.jsx("a",{href:S("instagram",(M=e==null?void 0:e.social)==null?void 0:M.instagram),className:"social-item ig",onClick:a=>{var t;(t=e==null?void 0:e.social)!=null&&t.instagram||a.preventDefault()},style:{display:(ss=e==null?void 0:e.social)!=null&&ss.instagram?"":"none"},target:"_blank",rel:"noopener",children:s.jsx("i",{className:"fab fa-instagram"})})]})]})]}),s.jsxs("section",{className:"collCard",children:[s.jsx("div",{style:{fontSize:13,fontWeight:1e3,marginBottom:10},children:"Featured Collections"}),s.jsx("div",{className:"prodGrid",children:((e==null?void 0:e.products)||[]).map(a=>s.jsxs("div",{className:"prodCard",role:"group",children:[s.jsx("div",{className:"prodImg",style:{cursor:"zoom-in"},onClick:()=>H(a.images,0),role:"button",tabIndex:0,onKeyDown:t=>{(t.key==="Enter"||t.key===" ")&&H(a.images,0)},children:s.jsx("img",{src:a.cover,alt:a.title})}),s.jsxs("div",{className:"prodInfo",children:[s.jsx("div",{className:"prodName",children:a.title}),s.jsx("div",{className:"product-meta-row",children:s.jsx("div",{className:"product-actions",children:(()=>{var is,ls,os;const t=a.title||"Product",c=((is=e==null?void 0:e.productReactions)==null?void 0:is[t])||{},ns=Number(c==null?void 0:c.total)||0,O=c!=null&&c.by_reaction&&typeof c.by_reaction=="object"?c.by_reaction:{},F=((os=(ls=e==null?void 0:e.viewer)==null?void 0:ls.productReactions)==null?void 0:os[t])||"",rs=["ðŸ‘","â¤ï¸","ðŸ”¥"],xs=rs.map(r=>({reaction:r,count:Number((O==null?void 0:O[r])??0)||0})).filter(r=>r.count>0).sort((r,b)=>b.count-r.count).slice(0,3).map(r=>r.reaction),cs=ns>0;return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"reaction-container",children:[s.jsx("div",{className:"reactions-popover small-popover",children:rs.map(r=>s.jsx("span",{className:`emoji ${F===r?"active":""}`,onClick:async b=>{b.preventDefault(),b.stopPropagation();try{await v({action:"react_product",payload:{business_id:e==null?void 0:e.businessId,product_key:t,reaction:r,force_set:!0}}),await L()}catch(ds){m(ds instanceof Error?ds.message:"Failed to react.")}},title:r,"aria-label":`React ${r}`,children:r},r))}),s.jsxs("div",{className:"btn-with-count",children:[s.jsx("button",{type:"button",className:"small-btn",onClick:async r=>{r.preventDefault(),r.stopPropagation();try{await v({action:"react_product",payload:{business_id:e==null?void 0:e.businessId,product_key:t,reaction:F||"â¤ï¸",force_set:!1}}),await L()}catch(b){m(b instanceof Error?b.message:"Failed to react.")}},"aria-label":"React",children:F?s.jsx("span",{className:"my-reaction-emoji",children:F}):s.jsx("i",{className:"far fa-heart"})}),cs?s.jsx("div",{className:"emoji-stack",children:xs.map(r=>s.jsx("span",{children:r},r))}):null,cs?s.jsx("span",{className:"reaction-count",children:ns}):null]})]}),s.jsx("button",{type:"button",className:"small-btn",title:"Share",onClick:r=>{r.preventDefault(),r.stopPropagation(),m("Share not implemented yet.")},children:s.jsx("i",{className:"fas fa-share-nodes"})})]})})()})})]})]},a.title))})]}),s.jsx(bs,{address:(e==null?void 0:e.addressLine)||""}),s.jsx(Ls,{reviews:(e==null?void 0:e.reviews)||[],ratingSummary:{total:((es=e==null?void 0:e.stats)==null?void 0:es.reviewCount)??0,avg:((as=e==null?void 0:e.stats)==null?void 0:as.averageRating)??0,counts:((ts=e==null?void 0:e.stats)==null?void 0:ts.ratingBreakdown)||null},onReport:()=>f(!0),onHelpful:async a=>{try{await v({action:"set_review_helpful",payload:{review_id:a,helpful:!0}})}catch(t){throw m(t instanceof Error?t.message:"Failed to mark helpful."),t}},onReportReview:a=>{_(String(a||"")),k(!0)}}),s.jsx(Ns,{open:i,slides:j,index:us,onPrev:()=>D(a=>(a-1+j.length)%j.length),onNext:()=>D(a=>(a+1)%j.length),onClose:()=>d(!1)}),s.jsx(gs,{open:h,onClose:()=>k(!1),busy:U,onSubmit:async({reason:a,details:t})=>{if(R){n(!0);try{await v({action:"report_review",payload:{review_id:R,reason:a||"other",details:t||""}}),m("Review reported. Thank you."),k(!1),_("")}catch(c){m(c instanceof Error?c.message:"Failed to submit report.")}finally{n(!1)}}}}),s.jsx(ys,{open:E,onClose:()=>f(!1),businessId:(e==null?void 0:e.businessId)||"",onSubmit:async({businessId:a,reason:t,details:c})=>{await ks({businessId:a,reportKind:"business",reason:t,details:c}),m("Report received. Our team will review this business shortly.")}}),s.jsx(vs,{open:C,onClose:()=>I(!1),businessId:(e==null?void 0:e.businessId)||"",onSubmit:async({businessId:a,rating:t,content:c})=>{await v({action:"upsert_review",payload:{business_id:a,rating:t,content:c}}),m("Success! Your review has been submitted."),await L()}})]})}ps.createRoot(document.getElementById("root")).render(s.jsx(fs.StrictMode,{children:s.jsx(Ss,{})}));
