import{r as i,f as xa,a as At,R as e,l as Ma,g as Da,b as Ba,m as ja,c as La,d as Pa,s as Oa,e as Rt,j as xt,n as $a,h as Ua,i as Fa,k as Va,u as _a,o as Mt,p as za}from"./realtimeClient-DHQhtgbp.js";const Ka={recent:"recent latest history frequently used",smileys:"smile smiles smiling emotion emotions face faces happy joy laugh crying sad angry love wink kiss",people:"people person body hand hands gesture gestures thumbs clap clapping pray thanks family woman man boy girl baby",nature:"animals animal pet dog cat bird fish bug flower flowers tree trees plant plants nature",food:"food drink drinks fruit fruits meal meals breakfast lunch dinner snack snacks pizza burger coffee tea",travel:"travel place places car bus train plane ship map maps city home weather road roads",objects:"objects object phone computer laptop device devices tool tools money key lock locks light lights",symbols:"symbols symbol heart hearts sign signs warning alert check cross star stars religion zodiac arrows"},Ya={"1f602":"laugh laughing joy tears crying funny lol","1f923":"rolling floor laugh lol","2764-fe0f":"heart love","1f44d":"thumbs up like yes approve","1f525":"fire hot lit","1f60a":"smile happy blush","1f64f":"pray thanks please","1f97a":"sad pleading tear","1f600":"grinning face smile happy","1f603":"smiley face happy","1f604":"smile grin happy","1f60d":"heart eyes love","1f618":"kiss face love","1f622":"crying face sad","1f62d":"loud cry sad tears","1f621":"angry pouting face mad","1f620":"angry mad face","1f631":"scream shocked face","1f44e":"thumbs down dislike no","1f44f":"clap clapping hands","1f44b":"wave waving hand hello","1f680":"rocket ship launch","2708-fe0f":"airplane plane flight","1f697":"car vehicle","1f436":"dog puppy pet","1f431":"cat kitten pet","1f354":"burger hamburger food","1f355":"pizza food",2615:"coffee drink","1f4a9":"poop pile","1f389":"party celebration","1f525":"fire flames hot","2b50":"star",2728:"sparkles sparkle",2705:"check done yes","274c":"cross mark no wrong","1f4af":"hundred perfect","1f499":"blue heart","1f49a":"green heart","1f49b":"yellow heart","1f49c":"purple heart"};function Ha(a){return String(a||"").trim().toLowerCase()}function qa(a){return Array.from(a).map(s=>s.codePointAt(0).toString(16)).join("-")}function Dt(a){return a.replace(/^u\+/,"").replace(/\s+/g,"").replace(/-/g,"")}function Wa(a,s){const l=Ha(s);if(!l)return a;const m=Dt(l);return a.map(f=>{const w=`${f.name} ${Ka[f.id]||""}`.toLowerCase().includes(l)?f.emojis:f.emojis.filter(v=>{if(v.includes(l))return!0;const u=qa(v);return(Ya[u]||"").includes(l)?!0:m?Dt(u).includes(m):!1});return{...f,emojis:w}}).filter(f=>f.emojis.length>0)}const Ie={name:"",firstName:"",lastName:"",status:"",about:"",email:"",phone:"",suburb:"",city:"",province:"",accountSince:""},Za=[],Ja={},Qe="chp_chat_session",Bt=[{value:"spam",label:"Spam"},{value:"harassment",label:"Harassment"},{value:"scam",label:"Scam"},{value:"other",label:"Other"}];function we(){if(typeof window>"u")return null;try{const a=window.localStorage.getItem(Qe);if(!a)return null;const s=JSON.parse(a),l=typeof(s==null?void 0:s.sessionId)=="string"?s.sessionId.trim():"",m=typeof(s==null?void 0:s.sessionCsrf)=="string"?s.sessionCsrf.trim():"";return!l||!m?null:{sessionId:l,sessionCsrf:m}}catch{return null}}function Qa(a,s){if(!(typeof window>"u"))try{window.localStorage.setItem(Qe,JSON.stringify({sessionId:a,sessionCsrf:s}))}catch{}}function jt(){if(!(typeof window>"u"))try{window.localStorage.removeItem(Qe)}catch{}}const Lt="chp_recent_emojis",Se=[{id:"recent",name:"Recent",icon:'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>',emojis:["😂","❤️","👍","🔥","😊","🙏","🥺","🤣"]},{id:"smileys",name:"Smileys & Emotion",icon:'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M8 14s1.5 2 4 2 4-2 4-2"></path><line x1="9" y1="9" x2="9.01" y2="9"></line><line x1="15" y1="9" x2="15.01" y2="9"></line></svg>',emojis:["😀","😃","😄","😁","😆","😅","😂","🤣","😊","😇","🙂","🙃","😉","😌","😍","🥰","😘","😗","😙","😚","😋","😛","😝","😜","🤪","🤨","🧐","🤓","😎","🤩","🥳","😏","😒","😞","😔","😟","😕","🙁","☹️","😣","😖","😫","😩","🥺","😢","😭","😤","😠","😡","🤬","🤯","😳","🥵","🥶","😱","😨","😰","😥","😓","🤗","🤔","🤭","🤫","🤥","😶","😐","😑","😬","🙄","😯","😦","😧","😮","😲","🥱","😴","🤤","😪","😵","🤐","🥴","🤢","🤮","🤧","😷","🤒","🤕","🤑","🤠","😈","👿","👹","👺","🤡","💩","👻","💀","☠️","👽","👾","🤖","🎃"]},{id:"people",name:"People & Body",icon:'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 11V6a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v5"></path><path d="M14 10V4a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v10"></path><path d="M10 10.5V6a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v8"></path><path d="M18 8a2 2 0 1 1 4 0v6a8 8 0 0 1-8 8h-2c-2.8 0-4.5-.86-5.99-2.34l-3.6-3.6a2 2 0 0 1 2.83-2.82L7 15"></path></svg>',emojis:["👋","🤚","🖐️","✋","🖖","👌","🤏","✌️","🤞","🤟","🤘","🤙","👈","👉","👆","🖕","👇","☝️","👍","👎","✊","👊","🤛","🤜","👏","🙌","👐","🤲","🤝","🙏","✍️","💅","🤳","💪","🦾","🦵","🦿","🦶","👂","🦻","👃","🧠","🦷","🦴","👀","👁️","👅","👄","👶","🧒","👦","👧","🧑","👱","👨","🧔","👩","🧓","👴","👵","👨‍⚕️","👩‍⚕️","👨‍🎓","👩‍🎓","👨‍🏫","👩‍🏫","👨‍⚖️","👩‍⚖️","👨‍🌾","👩‍🌾","👨‍🍳","👩‍🍳","👨‍🔧","👩‍🔧","👨‍🏭","👩‍🏭","👨‍💼","👩‍💼","👨‍🔬","👩‍🔬","👨‍💻","👩‍💻","👨‍🎤","👩‍🎤","👨‍🎨","👩‍🎨","👨‍✈️","👩‍✈️","👨‍🚀","👩‍🚀","👨‍🚒","👩‍🚒","👮","🕵️","💂","👷","🤴","👸","👳","👲","🧕","🤵","👰"]},{id:"nature",name:"Animals & Nature",icon:'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10Z"></path><path d="M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12"></path></svg>',emojis:["🐶","🐱","🐭","🐹","🐰","🦊","🐻","🐼","🐻‍❄️","🐨","🐯","🦁","🐮","🐷","🐽","🐸","🐵","🙈","🙉","🙊","🐒","🐔","🐧","🐦","🐤","🐣","🐥","🦆","🦢","🦉","🦩","🦚","🦜","🐸","🐊","🐢","🦎","🐍","🐲","🐉","🦕","🦖","🐳","🐋","🐬","🦭","🐟","🐠","🐡","🦈","🐙","🐚","🐌","🦋","🐛","🐜","🐝","🐞","🦗","🕷️","🕸️","🦂","🦟","🦠","💐","🌸","💮","🏵️","🌹","🥀","🌺","🌻","🌼","🌷","🌱","🪴","🌲","🌳","🌴","🌵","🌾","🌿","☘️","🍀","🍁","🍂","🍃"]},{id:"food",name:"Food & Drink",icon:'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 2v20"></path><path d="M15 3v10"></path><path d="M15 17v5"></path><path d="M15 3c-1.1 0-2 .9-2 2h0c0 1.1.9 2 2 2h0c1.1 0 2-.9 2-2h0c0-1.1-.9-2-2-2Z"></path><path d="M15 17c-1.1 0-2 .9-2 2h0c0 1.1.9 2 2 2h0c1.1 0 2-.9 2-2h0c0-1.1-.9-2-2-2Z"></path><path d="M9 3v10"></path><path d="M9 17v5"></path><path d="M9 3c-1.1 0-2 .9-2 2h0c0 1.1.9 2 2 2h0c1.1 0 2-.9 2-2h0c0-1.1-.9-2-2-2Z"></path><path d="M9 17c-1.1 0-2 .9-2 2h0c0 1.1.9 2 2 2h0c1.1 0 2-.9 2-2h0c0-1.1-.9-2-2-2Z"></path></svg>',emojis:["🍏","🍎","🍐","🍊","🍋","🍌","🍉","🍇","🍓","🫐","🍈","🍒","🍑","🥭","🍍","🥥","🥝","🍅","🍆","🥑","🥦","🥬","🥒","🌶️","🌽","🥕","🫒","🧄","🧅","🍄","🥜","🫘","🌰","🍞","🥐","🥖","🫓","🥨","🥯","🥞","🧇","🧀","🍖","🍗","🥩","🥓","🍔","🍟","🍕","🌭","🥪","🌮","🌯","🫔","🥙","🧆","🥚","🍳","🥘","🍲","🥣","🥗","🍿","🧈","🧂","🥫","🍱","🍘","🍙","🍚","🍛","🍜","🍝","🍠","🍢","🍣","🍤","🍥","🥮","🍡","🥟","🥠","🥡","🦀","🦞","🦐","🦑","🦪","🍦","🍧","🍨","🍩","🍪","🎂","🍰","🧁","🥧","🍫","🍬","🍭","🍮","🍯","🍼","🥛","☕","🫖","🍵","🍶","🍾","🍷","🍸","🍹","🍺","🍻","🥂","🥃","🥤","🧋","🧃","🧉","🧊","🥢","🍽️","🍴","🥄"]},{id:"travel",name:"Travel & Places",icon:'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>',emojis:["🚗","🚕","🚙","🚌","🚎","🏎️","🚓","🚑","🚒","🚐","🛻","🚚","🚛","🚜","🛵","🏍️","🛺","🚲","🛴","🛹","🚏","🛤️","🛩️","✈️","🛫","🛬","🛰️","🚀","🛸","🚁","🛶","⛵","🚤","🛳️","⛴️","🚢","⚓","⛽","🚧","🚦","🚥","🗺️","🗿","🗽","🗼","🏰","🏯","🏟️","🎡","🎢","🎠","⛲","⛱️","🏖️","🏝️","🏜️","🌋","⛰️","🏔️","🗻","🏕️","⛺","🏠","🏡","🏢","🏣","🏤","🏥","🏦","🏨","🏩","🏪","🏫","🏬","🏭","🏙️","🌆","🌇","🌃","🌉","🌌","♨️","🌍","🌎","🌏","🌐","🌑","🌒","🌓","🌔","🌕","🌖","🌗","🌘","🌙","🌚","🌝","🪐","🌟","⭐","✨","🌠","☀️","🌤️","⛅","🌥️","☁️","🌦️","🌧️","⛈️","🌩️","🌨️","❄️","☃️","⛄","🌬️","💨","🌪️","🌫️","🌈","☔","💧","💦","🌊"]},{id:"objects",name:"Objects",icon:'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path><polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline><line x1="12" y1="22.08" x2="12" y2="12"></line></svg>',emojis:["⌚","📱","📲","💻","⌨️","🖥️","🖨️","🖱️","🖲️","🕹️","🗜️","💽","💾","💿","📀","📼","📷","📸","📹","🎥","📽️","🎞️","📞","☎️","📟","📠","📺","📻","🎙️","🎚️","🎛️","🧭","⏱️","⏲️","⏰","🕰️","⌛","⏳","🔋","🔌","💡","🔦","🕯️","🪔","🗑️","🛢️","💸","💵","💴","💶","💷","💰","💳","💎","⚖️","🪜","🧰","🪛","🔧","🔨","⚒️","🛠️","⛏️","🪓","🔩","⚙️","🪗","🧱","⛓️","🧲","⚗️","🔭","🔬","🕳️","🩹","🩺","💊","💉","🩸","🧬","🧼","🪠","🧽","🪣","🪑","🧹","🧺","🧻","🧴","🧼","🪥","🪒","🧵","🧶","🪜","🔑","🗝️","🔨","🔫","🛡️","🏹","🗡️","⚔️","💣","🧨","🚬","⚰️","🪦","⚱️","🏺","🔮","📿","🧿","💈"]},{id:"symbols",name:"Symbols",icon:'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 12h2"></path><path d="M12 11v2"></path><circle cx="12" cy="12" r="10"></circle></svg>',emojis:["❤️","🧡","💛","💚","💙","💜","🖤","🤍","🤎","💔","❣️","💕","💞","💓","💗","💖","💘","💝","💟","☮️","✝️","☪️","🕉️","☸️","✡️","🔯","🕎","☯️","☦️","🛐","⛎","♈","♉","♊","♋","♌","♍","♎","♏","♐","♑","♒","♓","🆔","⚛️","🉑","☢️","☣️","📴","📳","🈶","🈚","🈸","🈺","🈷️","✴️","🆚","💮","🉐","㊙️","㊗️","🈴","🈵","🈹","🈲","🅰️","🅱️","🆎","🆑","🅾️","🆘","❌","⭕","🛑","⛔","📛","🚫","💯","💢","♨️","🚷","🚯","🚳","🚱","🔞","📵","🚭","❗","❕","❓","❔","‼️","⁉️","🔅","🔆","⚠️","🚸","🔱","⚜️","🔰","♻️","✅","🈯","💹","❇️","✳️","❎","🌐","💠","Ⓜ️","🌀","💤","🏧","🚾","♿","🅿️","🛗","🈳","🈂️","🛂","🛃","🛄","🛅"]}];function le(a){if(!a)return"";const s=a.split(" ").filter(Boolean),l=s[0]?s[0][0]:"",m=s.length>1?s[s.length-1][0]:"";return(l+m).toUpperCase()}function ne(a){return!a||typeof a!="object"||a.blockedByOther?"User unavailable":a.name||"Unknown"}function Y(a){return!!(a&&(a.blocked||a.blockedByOther))}function Ot(a){if(!a)return"";const s=new Date(a);return Number.isNaN(s.getTime())?"":s.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}function Ga(a){if(!a)return"";const s=new Date(a);return Number.isNaN(s.getTime())?"":s.toLocaleDateString([],{month:"short",day:"numeric"})}function Ze(a){if(!a)return"";const s=new Date(a);return Number.isNaN(s.getTime())?"":s.toLocaleString([],{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}function $t(a){const s=String(a||"").trim();return s?s.split(/[_\s-]+/).filter(Boolean).map(l=>l.charAt(0).toUpperCase()+l.slice(1).toLowerCase()).join(" "):"Status unavailable"}function Ut(a){const s=String(a||"").trim().toLowerCase();return s==="resolved"||s==="closed"||s==="complete"||s==="completed"||s==="done"?"success":s==="rejected"||s==="dismissed"||s==="denied"?"danger":s==="open"||s==="pending"||s==="in_review"||s==="in review"||s==="under_review"||s==="under review"?"warning":""}function Pt(a,s){return a.getFullYear()===s.getFullYear()&&a.getMonth()===s.getMonth()&&a.getDate()===s.getDate()}function Xa(a){const s=new Date(a);if(Number.isNaN(s.getTime()))return"";const l=new Date,m=new Date;return m.setDate(l.getDate()-1),Pt(s,l)?"Today":Pt(s,m)?"Yesterday":s.toLocaleDateString([],{month:"short",day:"numeric"})}function en(a){const s=[];let l="";return a.forEach(m=>{const f=m.timestamp.slice(0,10);f!==l&&(s.push({type:"day",id:`day-${f}`,label:Xa(m.timestamp)}),l=f),s.push({type:"message",id:m.id,message:m})}),s}function tn(a){return a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function an(a,s){if(!s)return a;const l=tn(s);return a.split(new RegExp(`(${l})`,"ig")).map((f,E)=>f.toLowerCase()===s.toLowerCase()?e.createElement("mark",{key:E,className:"msg-highlight"},f):e.createElement("span",{key:E},f))}function nn(a,s,l){const m=(l==null?void 0:l.selectionStart)??a.length,f=(l==null?void 0:l.selectionEnd)??m;return{nextValue:a.slice(0,m)+s+a.slice(f),caret:m+s.length}}function Ge(a,s,l){i.useEffect(()=>{if(!l)return;const m=f=>{!a.current||a.current.contains(f.target)||s()};return document.addEventListener("mousedown",m),document.addEventListener("touchstart",m),()=>{document.removeEventListener("mousedown",m),document.removeEventListener("touchstart",m)}},[a,s,l])}function M({children:a,size:s=20,className:l}){return e.createElement("svg",{className:l,width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.8",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true"},a)}const sn=a=>e.createElement(M,{...a},e.createElement("circle",{cx:"12",cy:"5",r:"1.6",fill:"currentColor",stroke:"none"}),e.createElement("circle",{cx:"12",cy:"12",r:"1.6",fill:"currentColor",stroke:"none"}),e.createElement("circle",{cx:"12",cy:"19",r:"1.6",fill:"currentColor",stroke:"none"})),Xe=a=>e.createElement(M,{...a},e.createElement("circle",{cx:"11",cy:"11",r:"6.5"}),e.createElement("line",{x1:"16.5",y1:"16.5",x2:"21",y2:"21"})),Ft=a=>e.createElement(M,{...a},e.createElement("rect",{x:"5",y:"11",width:"14",height:"9",rx:"2"}),e.createElement("path",{d:"M8 11V8a4 4 0 0 1 8 0v3"})),ln=a=>e.createElement(M,{...a},e.createElement("path",{d:"M6 18l-2.5 3.5V6.5A2.5 2.5 0 0 1 6 4h12a2.5 2.5 0 0 1 2.5 2.5V14A2.5 2.5 0 0 1 18 16.5H7.8L6 18Z"})),rn=a=>e.createElement(M,{...a},e.createElement("path",{d:"M3 12l17-7-7 17-2-6-8-4Z"})),on=a=>e.createElement(M,{...a},e.createElement("circle",{cx:"12",cy:"12",r:"9"}),e.createElement("circle",{cx:"9",cy:"10",r:"1",fill:"currentColor",stroke:"none"}),e.createElement("circle",{cx:"15",cy:"10",r:"1",fill:"currentColor",stroke:"none"}),e.createElement("path",{d:"M8 15c1.2 1.3 2.6 2 4 2s2.8-.7 4-2"})),cn=a=>e.createElement(M,{...a},e.createElement("path",{d:"M7.5 12.5l6.8-6.8a3 3 0 0 1 4.3 4.3l-7.5 7.5a4.5 4.5 0 0 1-6.4-6.4l7.2-7.2"})),mn=a=>e.createElement(M,{...a},e.createElement("polyline",{points:"5 12 9 16 19 6"})),dn=a=>e.createElement(M,{...a},e.createElement("polyline",{points:"2 12 6 16 12 10"}),e.createElement("polyline",{points:"8 12 12 16 22 6"})),un=a=>e.createElement(M,{...a},e.createElement("path",{d:"M4 11.5 12 4l8 7.5"}),e.createElement("path",{d:"M6 10.5V20h12v-9.5"})),fn=a=>e.createElement(M,{...a},e.createElement("rect",{x:"4",y:"4",width:"16",height:"5"}),e.createElement("rect",{x:"5",y:"9",width:"14",height:"11"}),e.createElement("line",{x1:"9",y1:"13",x2:"15",y2:"13"})),Vt=a=>e.createElement(M,{...a},e.createElement("path",{d:"M5 4v16"}),e.createElement("path",{d:"M5 4h12l-2.2 4L17 12H5"})),se=a=>e.createElement(M,{...a},e.createElement("circle",{cx:"12",cy:"12",r:"9"}),e.createElement("line",{x1:"7",y1:"17",x2:"17",y2:"7"})),pn=a=>e.createElement(M,{...a},e.createElement("circle",{cx:"12",cy:"8",r:"3.2"}),e.createElement("path",{d:"M4.5 19.5c1.9-3 4.5-4.5 7.5-4.5s5.6 1.5 7.5 4.5"})),_t=a=>e.createElement(M,{...a},e.createElement("path",{d:"M4 7h16"}),e.createElement("path",{d:"M9 7V5h6v2"}),e.createElement("path",{d:"M7 7l1 12h8l1-12"}),e.createElement("path",{d:"M10 11v6"}),e.createElement("path",{d:"M14 11v6"})),hn=a=>e.createElement(M,{...a},e.createElement("path",{d:"M9 4h-4v16h4"}),e.createElement("path",{d:"M16 12H7"}),e.createElement("path",{d:"M13 9l3 3-3 3"})),Te=a=>e.createElement(M,{...a},e.createElement("line",{x1:"5",y1:"5",x2:"19",y2:"19"}),e.createElement("line",{x1:"19",y1:"5",x2:"5",y2:"19"}));function zt({ariaLabel:a,items:s}){const[l,m]=i.useState(!1),f=i.useRef(null);return Ge(f,()=>m(!1),l),e.createElement("div",{className:"menu-wrap",ref:f},e.createElement("button",{className:"icon-btn","aria-label":a,"aria-haspopup":"menu","aria-expanded":l,onClick:()=>m(E=>!E),type:"button"},e.createElement(sn,null)),l?e.createElement("div",{className:"dropdown",role:"menu"},s.map(E=>e.createElement("button",{key:E.label,className:"dropdown-item",role:"menuitem",type:"button",onClick:()=>{m(!1),E.onSelect()}},E.label))):null)}function vn({status:a}){if(!a)return null;if(a==="sent")return e.createElement(mn,{className:"status-icon"});const s=a==="read"?"status-icon read":"status-icon";return e.createElement(dn,{className:s})}function gn({open:a,title:s,message:l,confirmLabel:m,onConfirm:f,onCancel:E}){return a?e.createElement("div",{className:"panel-backdrop",role:"dialog","aria-modal":"true","aria-label":s},e.createElement("div",{className:"confirm-dialog"},e.createElement("h3",null,s),e.createElement("p",null,l),e.createElement("div",{className:"confirm-actions"},e.createElement("button",{className:"ghost-btn",type:"button",onClick:E},"Cancel"),e.createElement("button",{className:"primary-btn",type:"button",onClick:f},m)))):null}function En({open:a,title:s,message:l,confirmLabel:m="Delete",onConfirm:f,onCancel:E}){return a?e.createElement("div",{className:"panel-backdrop",role:"dialog","aria-modal":"true","aria-label":s},e.createElement("div",{className:"confirm-dialog"},e.createElement("h3",null,s),e.createElement("p",null,l),e.createElement("div",{className:"confirm-actions"},e.createElement("button",{className:"ghost-btn",type:"button",onClick:E},"Cancel"),e.createElement("button",{className:"primary-btn",type:"button",onClick:f},m)))):null}function yn({open:a,sessionId:s,sessionCsrf:l,error:m,busy:f=!1,onSessionIdChange:E,onSessionCsrfChange:h,onConnect:w,onCancel:v}){return a?e.createElement("div",{className:"panel-backdrop",role:"dialog","aria-modal":"true","aria-label":"Connect session"},e.createElement("div",{className:"connect-dialog"},e.createElement("h3",null,"Connect Session"),e.createElement("p",null,"Enter your session credentials to connect."),e.createElement("div",{className:"connect-form"},e.createElement("label",{className:"connect-field"},e.createElement("span",null,"Session ID"),e.createElement("input",{className:"connect-input",type:"text",value:s,onChange:u=>E(u.target.value),placeholder:"Enter session id",autoComplete:"off"})),e.createElement("label",{className:"connect-field"},e.createElement("span",null,"Session CSRF"),e.createElement("input",{className:"connect-input",type:"text",value:l,onChange:u=>h(u.target.value),placeholder:"Enter session csrf",autoComplete:"off"}))),m?e.createElement("p",{className:"connect-error"},m):null,e.createElement("div",{className:"connect-actions"},e.createElement("button",{className:"ghost-btn",type:"button",onClick:v},"Cancel"),e.createElement("button",{className:"primary-btn",type:"button",onClick:w,disabled:f},f?"Connecting...":"Connect")))):null}function bn({open:a,onClose:s,currentUser:l}){if(!a)return null;const m={...Ie,...l&&typeof l=="object"?l:{}},f=m.name||"User";return e.createElement("div",{className:"panel-backdrop",role:"dialog","aria-modal":"true","aria-label":"Profile panel"},e.createElement("div",{className:"profile-panel"},e.createElement("div",{className:"panel-header"},e.createElement("h2",null,"Profile"),e.createElement("button",{className:"icon-btn","aria-label":"Close profile",onClick:s,type:"button"},e.createElement(Te,null))),e.createElement("div",{className:"profile-hero"},e.createElement("div",{className:"avatar large",style:{backgroundColor:"#2f9e8f"}},le(f)),e.createElement("div",null,e.createElement("h3",null,f))),e.createElement("div",{className:"profile-section"},e.createElement("h4",null,"Details"),e.createElement("p",null,"First name: ",m.firstName||"-"),e.createElement("p",null,"Family name: ",m.lastName||"-"),e.createElement("p",null,"Suburb: ",m.suburb||"-"),e.createElement("p",null,"City: ",m.city||"-"),e.createElement("p",null,"Province: ",m.province||"-"),e.createElement("p",null,"Account since: ",m.accountSince||"-"))))}function kn({open:a,onClose:s,chat:l,onDelete:m,onBlock:f,onReport:E}){if(!a||!l)return null;const h=!!l.blockedByOther,w=ne(l),v=l.name?l.name.split(" ").filter(Boolean):[],u=v[0]||"",A=v.slice(1).join(" "),S=h?"-":l.firstName||u||"-",d=h?"-":l.lastName||A||"-",N=h?"-":l.suburb||"-",O=h?"-":l.city||"-",y=h?"-":l.province||"-",k=h?"-":l.accountSince||"-",D=h?"-":l.accountType||"Standard";return e.createElement("div",{className:"panel-backdrop",role:"dialog","aria-modal":"true","aria-label":"Chat profile"},e.createElement("div",{className:"profile-panel"},e.createElement("div",{className:"panel-header"},e.createElement("h2",null,"Chat Profile"),e.createElement("button",{className:"icon-btn","aria-label":"Close profile",onClick:s,type:"button"},e.createElement(Te,null))),e.createElement("div",{className:"profile-hero"},e.createElement("div",{className:"avatar large",style:{backgroundColor:l.color}},Y(l)?e.createElement(se,{className:"avatar-blocked-icon",size:18}):le(w)),e.createElement("div",null,e.createElement("h3",null,w))),e.createElement("div",{className:"profile-section"},e.createElement("h4",null,"Details"),e.createElement("p",null,"First name: ",S),e.createElement("p",null,"Family name: ",d),e.createElement("p",null,"Suburb: ",N),e.createElement("p",null,"City: ",O),e.createElement("p",null,"Province: ",y),e.createElement("p",null,"Account since: ",k),e.createElement("p",null,"Account type: ",D)),e.createElement("div",{className:"profile-section"},e.createElement("h4",null,"Actions"),e.createElement("div",{className:"profile-action-row"},e.createElement("button",{className:"profile-btn danger",type:"button",onClick:m},e.createElement(_t,null),"Delete"),h?null:e.createElement(e.Fragment,null,e.createElement("button",{className:"profile-btn warn",type:"button",onClick:f},e.createElement(se,null),l.blocked?"Unblock":"Block"),e.createElement("button",{className:"profile-btn",type:"button",onClick:E},e.createElement(Vt,null),"Report"))))))}function Je({title:a,subtitle:s}){return e.createElement("div",{className:"empty-state"},e.createElement("h3",null,a),e.createElement("p",null,s))}function Nn(){const a=Array.from({length:7}),s=Array.from({length:5});return e.createElement("div",{className:"chat-loading-overlay desktop",role:"status","aria-live":"polite"},e.createElement("div",{className:"chat-loading-desktop-shell"},e.createElement("aside",{className:"chat-loading-desktop-sidebar"},e.createElement("div",{className:"chat-loading-desktop-header"},e.createElement("div",{className:"chat-loading-sk chat-loading-desktop-logo"}),e.createElement("div",{className:"chat-loading-sk chat-loading-desktop-circle"})),e.createElement("div",{className:"chat-loading-desktop-search"},e.createElement("div",{className:"chat-loading-sk chat-loading-desktop-search-box"})),e.createElement("div",{className:"chat-loading-desktop-list"},a.map((l,m)=>e.createElement("div",{className:"chat-loading-desktop-thread",key:m},e.createElement("div",{className:"chat-loading-sk chat-loading-desktop-avatar"}),e.createElement("div",{className:"chat-loading-desktop-thread-meta"},e.createElement("div",{className:"chat-loading-sk chat-loading-desktop-line lg"}),e.createElement("div",{className:"chat-loading-sk chat-loading-desktop-line sm"})),e.createElement("div",{className:"chat-loading-sk chat-loading-desktop-time"}))))),e.createElement("section",{className:"chat-loading-desktop-chat"},e.createElement("div",{className:"chat-loading-desktop-chat-header"},e.createElement("div",{className:"chat-loading-desktop-chat-user"},e.createElement("div",{className:"chat-loading-sk chat-loading-desktop-avatar"}),e.createElement("div",{className:"chat-loading-desktop-thread-meta"},e.createElement("div",{className:"chat-loading-sk chat-loading-desktop-line lg"}),e.createElement("div",{className:"chat-loading-sk chat-loading-desktop-line sm"}))),e.createElement("div",{className:"chat-loading-desktop-chat-actions"},e.createElement("div",{className:"chat-loading-sk chat-loading-desktop-circle"}),e.createElement("div",{className:"chat-loading-sk chat-loading-desktop-circle"}),e.createElement("div",{className:"chat-loading-sk chat-loading-desktop-circle"}))),e.createElement("div",{className:"chat-loading-desktop-messages"},e.createElement("div",{className:"chat-loading-sk chat-loading-desktop-day"}),s.map((l,m)=>e.createElement("div",{className:`chat-loading-desktop-bubble-row ${m%2?"me":"them"}`,key:m},e.createElement("div",{className:"chat-loading-desktop-bubble"},e.createElement("div",{className:"chat-loading-sk chat-loading-desktop-line lg"}),e.createElement("div",{className:"chat-loading-sk chat-loading-desktop-line sm"}),e.createElement("div",{className:"chat-loading-sk chat-loading-desktop-meta"}))))),e.createElement("div",{className:"chat-loading-desktop-composer"},e.createElement("div",{className:"chat-loading-sk chat-loading-desktop-circle"}),e.createElement("div",{className:"chat-loading-sk chat-loading-desktop-circle"}),e.createElement("div",{className:"chat-loading-sk chat-loading-desktop-input"}),e.createElement("div",{className:"chat-loading-sk chat-loading-desktop-circle"})))))}function et({title:a,subtitle:s,children:l}){return e.createElement("div",{className:"section-panel"},e.createElement("div",{className:"section-header"},e.createElement("div",null,e.createElement("h2",null,a),s?e.createElement("p",{className:"muted"},s):null)),e.createElement("div",{className:"section-card"},l))}function Cn({currentUser:a}){const s={...Ie,...a&&typeof a=="object"?a:{}},l=s.name||"User";return e.createElement(et,{title:"My Profile",subtitle:""},e.createElement("div",{className:"profile-card"},e.createElement("div",{className:"profile-card-hero"},e.createElement("div",{className:"avatar large",style:{backgroundColor:"#0f766e"}},le(l)),e.createElement("div",null,e.createElement("h3",null,l))),e.createElement("div",{className:"profile-section"},e.createElement("h4",null,"Details"),e.createElement("p",null,"First name: ",s.firstName||"-"),e.createElement("p",null,"Family name: ",s.lastName||"-"),e.createElement("p",null,"Suburb: ",s.suburb||"-"),e.createElement("p",null,"City: ",s.city||"-"),e.createElement("p",null,"Province: ",s.province||"-"),e.createElement("p",null,"Account since: ",s.accountSince||"-")),e.createElement("div",{className:"profile-actions"},e.createElement("button",{className:"manage-profile-btn",type:"button","data-link":"manage-profile"},"Manage Profile"))))}function wn({chats:a,onUnblock:s}){return e.createElement(et,{title:"Blocked Accounts",subtitle:"People and businesses you blocked."},a.length===0?e.createElement("div",{className:"section-empty"},"No blocked accounts."):e.createElement("div",{className:"section-list"},a.map(l=>e.createElement("div",{key:l.id,className:"section-item"},e.createElement("div",{className:"section-item-info"},e.createElement("div",{className:"avatar",style:{backgroundColor:l.color}},e.createElement(se,{className:"avatar-blocked-icon",size:16})),e.createElement("div",{className:"section-item-text"},e.createElement("div",{className:"section-item-name"},l.name))),e.createElement("div",{className:"section-item-meta"},e.createElement("span",{className:"section-tag danger"},"Blocked"),e.createElement("span",null,Ga(l.blockedAt||l.lastTime)),e.createElement("button",{className:"section-action",type:"button",onClick:()=>s(l.id)},"Unblock"))))))}function Sn({reports:a,onOpenReport:s}){return e.createElement(et,{title:"Reports",subtitle:"Reports you submitted."},a.length===0?e.createElement("div",{className:"section-empty"},"No reports found."):e.createElement("div",{className:"section-list"},a.map(l=>e.createElement("div",{key:l.id,className:"section-item"},e.createElement("div",{className:"section-item-info"},e.createElement("div",{className:"avatar",style:{backgroundColor:l.color||"#3b5bdb"}},le(l.name)),e.createElement("div",{className:"section-item-text"},e.createElement("div",{className:"section-item-name"},l.name),e.createElement("div",{className:"section-item-sub"},l.context||"No reason provided."))),e.createElement("div",{className:"section-item-meta"},e.createElement("span",{className:`section-tag ${Ut(l.status)}`},$t(l.status)),e.createElement("span",null,Ze(l.createdAt)||"Date unavailable"),e.createElement("button",{className:"section-action",type:"button",onClick:()=>s(l)},"View report"))))))}function In({open:a,report:s,onClose:l}){return!a||!s?null:e.createElement("div",{className:"panel-backdrop",role:"dialog","aria-modal":"true","aria-label":"Report details"},e.createElement("div",{className:"report-details-dialog"},e.createElement("div",{className:"report-details-header"},e.createElement("div",null,e.createElement("div",{className:"report-details-title"},"Report details"),e.createElement("div",{className:"report-sub"},"Submitted information from your report.")),e.createElement("button",{type:"button",className:"report-details-close",onClick:l,"aria-label":"Close report details"},e.createElement(Te,{size:18}))),e.createElement("div",{className:"report-details-grid"},e.createElement("div",{className:"report-details-field"},e.createElement("div",{className:"report-details-label"},"Reported account"),e.createElement("div",{className:"report-details-value"},s.name||"Unknown")),e.createElement("div",{className:"report-details-field"},e.createElement("div",{className:"report-details-label"},"Status"),e.createElement("div",{className:`section-tag ${Ut(s.status)}`},$t(s.status))),e.createElement("div",{className:"report-details-field"},e.createElement("div",{className:"report-details-label"},"Sent"),e.createElement("div",{className:"report-details-value"},Ze(s.createdAt)||"Not available")),e.createElement("div",{className:"report-details-field"},e.createElement("div",{className:"report-details-label"},"Admin reply time"),e.createElement("div",{className:"report-details-value"},Ze(s.adminReplyAt)||"Not available"))),e.createElement("div",{className:"report-details-field"},e.createElement("div",{className:"report-details-label"},"Reason"),e.createElement("div",{className:"report-details-value report-details-reason"},s.context||"No reason provided.")),e.createElement("div",{className:"report-details-field"},e.createElement("div",{className:"report-details-label"},"Admin reply"),e.createElement("div",{className:"report-details-value report-details-reason"},s.adminReply||"No admin reply yet."))))}function Tn({open:a,onClose:s,reasons:l,value:m,onChange:f,details:E,onDetailsChange:h,onSubmit:w,targetName:v}){const[u,A]=i.useState(!1),S=i.useRef(null),d=l.find(N=>N.value===m);return Ge(S,()=>A(!1),u),i.useEffect(()=>{a||A(!1)},[a]),a?e.createElement("div",{className:"panel-backdrop",role:"dialog","aria-modal":"true","aria-label":"Report"},e.createElement("div",{className:"report-dialog"},e.createElement("div",{className:"report-title"},"Quick report"),e.createElement("div",{className:"report-sub"},"Select a reason for reporting ",v||"this chat","."),e.createElement("div",{className:`report-select${u?" active":""}`,ref:S},e.createElement("button",{className:"report-select__trigger",type:"button",onClick:()=>A(N=>!N),"aria-haspopup":"listbox","aria-expanded":u},e.createElement("span",null,d?d.label:"Choose a reason"),e.createElement("span",{className:"report-select__caret"},"â–¾")),e.createElement("div",{className:"report-select__options",role:"listbox"},l.map(N=>e.createElement("button",{key:N.value,type:"button",className:`report-select__option${m===N.value?" selected":""}`,onClick:()=>{f(N.value),A(!1)},role:"option","aria-selected":m===N.value},N.label)))),e.createElement("textarea",{className:"report-textarea",placeholder:"Optional details",value:E,onChange:N=>h(N.target.value)}),e.createElement("div",{className:"report-actions"},e.createElement("button",{className:"ghost-btn",type:"button",onClick:s},"Cancel"),e.createElement("button",{className:"primary-btn",type:"button",onClick:w,disabled:!m},"Report")))):null}function An({chats:a,searchValue:s,onSearchChange:l,activeChatId:m,onOpenChat:f,onMenuAction:E,emptyTitle:h="No chats yet",emptySubtitle:w="Start a new chat to compare prices.",showSearch:v=!0}){return e.createElement("div",{className:"chat-list-screen"},v?e.createElement("div",{className:"search-bar"},e.createElement(Xe,{className:"search-icon"}),e.createElement("input",{type:"search",value:s,onChange:u=>l(u.target.value),placeholder:"Search chats or messages","aria-label":"Search chats"})):null,e.createElement("div",{className:"chat-list",role:"list"},a.length===0?e.createElement(Je,{title:h,subtitle:w}):a.map(u=>{const A=ne(u),S=[{label:u.archived?"Unarchive chat":"Archive chat",onSelect:()=>E(u.id,u.archived?"unarchive":"archive")},{label:"Delete chat",onSelect:()=>E(u.id,"delete")},{label:"Report",onSelect:()=>E(u.id,"report")}];return e.createElement("div",{key:u.id,className:`chat-item ${m===u.id?"active":""}`,role:"listitem"},e.createElement("button",{className:"chat-open",onClick:()=>f(u.id),type:"button","aria-label":`Open chat with ${A}`},e.createElement("div",{className:"chat-avatar"},e.createElement("div",{className:"avatar",style:{backgroundColor:u.color}},Y(u)?e.createElement(se,{className:"avatar-blocked-icon",size:16}):le(u.name)),u.online?e.createElement("span",{className:"status-dot","aria-hidden":"true"}):null),e.createElement("div",{className:"chat-body"},e.createElement("div",{className:"chat-row"},e.createElement("span",{className:"chat-name"},A),e.createElement("span",{className:"chat-time"},Ot(u.lastTime))),e.createElement("div",{className:"chat-row chat-preview"},e.createElement("span",{className:"chat-message"},u.lastMessage?u.lastMessage:"No messages yet"),e.createElement("span",{className:"chat-flags"},u.unread>0?e.createElement("span",{className:"chat-unread"},u.unread):null)))),e.createElement(zt,{ariaLabel:"Chat options",items:S}))})))}function Rn({message:a,query:s,onPreviewImage:l}){const m=a.sender==="me",f=typeof a.attachmentUrl=="string"?a.attachmentUrl:"",E=typeof a.attachmentType=="string"?a.attachmentType.toLowerCase():"",h=typeof a.attachmentName=="string"&&a.attachmentName?a.attachmentName:"Attachment",w=!!a.attachmentIsImage||E.startsWith("image/"),v=!!a.attachmentIsVideo||E.startsWith("video/"),u=typeof a.text=="string"&&a.text.trim().length>0,A={width:"100%",maxWidth:"260px",borderRadius:"10px",display:"block",marginBottom:u?"8px":"0"};return e.createElement("div",{className:`message-row ${m?"me":"them"}`},e.createElement("div",{className:`message-bubble ${m?"outgoing":"incoming"}`},f?e.createElement("div",{className:"message-attachment"},w?e.createElement("button",{className:"message-image-trigger",type:"button",onClick:()=>{l&&l(a)},"aria-label":`Preview ${h}`},e.createElement("img",{src:f,alt:h,loading:"lazy",style:A})):v?e.createElement("video",{controls:!0,preload:"metadata",style:A},e.createElement("source",{src:f,type:E||void 0})):e.createElement("a",{href:f,target:"_blank",rel:"noreferrer"},"Open attachment")):null,u?e.createElement("div",{className:"message-text"},an(a.text,s)):null,e.createElement("div",{className:"message-meta"},e.createElement("span",null,Ot(a.timestamp)),m?e.createElement(vn,{status:a.status}):null)))}function xn({preview:a,onClose:s,onSave:l,onReport:m}){return a?e.createElement("div",{className:"attachment-preview-panel",role:"region","aria-label":"Photo preview"},e.createElement("div",{className:"attachment-preview-head"},e.createElement("div",{className:"attachment-preview-title"},"Photo preview"),e.createElement("button",{className:"icon-btn",type:"button",onClick:s,"aria-label":"Close preview"},e.createElement(Te,null))),e.createElement("div",{className:"attachment-preview-stage"},e.createElement("img",{src:a.url,alt:a.name||"Image preview",loading:"eager"})),e.createElement("div",{className:"attachment-preview-meta"},a.name||"Image"),e.createElement("div",{className:"attachment-preview-actions"},e.createElement("button",{className:"primary-btn",type:"button",onClick:l},"Save"),e.createElement("button",{className:"ghost-btn",type:"button",onClick:m},"Report Photo"))):null}function Mn(){return e.createElement("div",{className:"message-row them"},e.createElement("div",{className:"typing-bubble"},e.createElement("span",{className:"typing-label"},"typing"),e.createElement("div",{className:"typing-dots","aria-hidden":"true"},e.createElement("span",null),e.createElement("span",null),e.createElement("span",null))))}function Dn(){const a=[!1,!0,!1,!0,!1];return e.createElement("div",{className:"conversation-loading",role:"status","aria-live":"polite","aria-label":"Loading messages"},a.map((s,l)=>e.createElement("div",{key:l,className:`conversation-loading-row ${s?"me":"them"}`},e.createElement("div",{className:"conversation-loading-bubble"},e.createElement("div",{className:"chat-loading-sk conversation-loading-line lg"}),e.createElement("div",{className:"chat-loading-sk conversation-loading-line md"}),e.createElement("div",{className:"chat-loading-sk conversation-loading-line sm"})))))}function Bn({value:a,onChange:s,onSend:l,onEmoji:m,onAttach:f,inputRef:E,disabled:h=!1}){const w=v=>{v.key==="Enter"&&!v.shiftKey&&(v.preventDefault(),!h&&a.trim()&&l())};return e.createElement("div",{className:"composer"},e.createElement("div",{className:"composer-actions"},e.createElement("button",{className:"icon-btn",type:"button",onClick:m,"aria-label":"Emoji",disabled:h},e.createElement(on,null)),e.createElement("button",{className:"icon-btn",type:"button",onClick:f,"aria-label":"Attach",disabled:h},e.createElement(cn,null))),e.createElement("textarea",{ref:E,rows:1,value:a,onChange:v=>s(v.target.value),onKeyDown:w,placeholder:h?"Unblock to send messages":"Type a message","aria-label":"Message input",disabled:h}),e.createElement("button",{className:"send-btn",type:"button",onClick:l,disabled:h||!a.trim(),"aria-label":"Send message"},e.createElement(rn,null)))}function jn({open:a,recents:s,onSelect:l,onClose:m}){const[f,E]=i.useState(""),[h,w]=i.useState("recent"),v=i.useRef(null),u=i.useRef(null),A=i.useRef({});Ge(u,m,a);const S=i.useMemo(()=>{const y=Se.map(k=>k.id==="recent"?{...k,emojis:s}:k);return Wa(y,f)},[s,f]);i.useEffect(()=>{var k;if(!a)return;const y=((k=S[0])==null?void 0:k.id)||"recent";w(y),v.current&&(v.current.scrollTop=0)},[a,f,S]);const d=()=>{const y=v.current;if(!y)return;let k=h;S.forEach(D=>{const Q=A.current[D.id];Q&&y.scrollTop>=Q.offsetTop-40&&(k=D.id)}),k!==h&&w(k)},N=y=>{const k=A.current[y];k&&(k.scrollIntoView({behavior:"smooth",block:"start"}),w(y))},O=y=>{l(y)};return a?e.createElement("div",{className:"emoji-popover","aria-live":"polite"},e.createElement("div",{className:"emoji-picker fade-in",ref:u},e.createElement("div",{className:"picker-header"},e.createElement("div",{className:"search-container"},e.createElement(Xe,{className:"search-icon"}),e.createElement("input",{type:"search",className:"search-input",placeholder:"Search emojis...",value:f,onChange:y=>E(y.target.value),"aria-label":"Search emojis"})),e.createElement("div",{className:"category-tabs",role:"tablist"},S.map(y=>e.createElement("button",{key:y.id,type:"button",className:`category-tab ${h===y.id?"active":""}`,onClick:()=>N(y.id),"aria-label":y.name,"aria-pressed":h===y.id,dangerouslySetInnerHTML:{__html:y.icon}})))),e.createElement("div",{className:"emoji-list",onScroll:d,ref:v},S.length===0?e.createElement("div",{className:"emoji-empty"},"No emojis found."):S.map(y=>e.createElement("div",{key:y.id,className:"category-section",ref:k=>{A.current[y.id]=k}},e.createElement("div",{className:"category-title"},y.name),e.createElement("div",{className:"emoji-grid"},y.emojis.map((k,D)=>e.createElement("button",{key:`${y.id}-${D}`,type:"button",className:"emoji-item",onClick:()=>O(k),"aria-label":"Emoji"},k)))))))):null}function Ln({chat:a,groupedMessages:s,searchValue:l,showSearch:m,onToggleSearch:f,onSearchChange:E,onSend:h,composerValue:w,onComposerChange:v,onEmoji:u,onAttach:A,emojiOpen:S,emojiRecents:d,onEmojiSelect:N,onEmojiClose:O,composerRef:y,typing:k,conversationLoading:D,messageListRef:Q,matchCount:H,onMenuAction:U,attachmentPreview:q,onOpenAttachmentPreview:Ae,onCloseAttachmentPreview:G,onSaveAttachmentPreview:re,onReportAttachmentPreview:Re}){if(!a)return e.createElement("div",{className:"conversation empty-view"},e.createElement(Je,{title:"Select a chat",subtitle:"Choose a conversation to see messages and compare prices."}));if(q)return e.createElement("div",{className:"conversation attachment-only-view"},e.createElement(xn,{preview:q,onClose:G,onSave:re,onReport:Re}));const ue=ne(a),W=[{label:"View profile",onSelect:()=>U("profile")},{label:"Close chat",onSelect:()=>U("close")},{label:"Delete chat",onSelect:()=>U("delete")},{label:"Block",onSelect:()=>U("block")},{label:"Report",onSelect:()=>U("report")}];return e.createElement("div",{className:"conversation"},e.createElement("div",{className:"conversation-header"},e.createElement("div",{className:"conversation-title"},e.createElement("div",{className:"avatar",style:{backgroundColor:a.color}},Y(a)?e.createElement(se,{className:"avatar-blocked-icon",size:16}):le(a.name)),e.createElement("div",{className:"conversation-title-text"},e.createElement("div",{className:"conversation-name"},ue),e.createElement("div",{className:"conversation-status"},k?e.createElement("span",null,"Typing..."):e.createElement(e.Fragment,null,a.online?e.createElement("span",{className:"presence-dot"}):null,e.createElement("span",null,a.online?"online":a.presence))))),e.createElement("div",{className:"conversation-actions"},e.createElement(zt,{ariaLabel:"Conversation menu",items:W}))),m?e.createElement("div",{className:"conversation-search"},e.createElement(Xe,{className:"search-icon"}),e.createElement("input",{type:"search",value:l,onChange:V=>E(V.target.value),placeholder:"Search in conversation","aria-label":"Search within conversation"}),l?e.createElement("span",{className:"search-count"},H," match",H===1?"":"es"):null):null,e.createElement("div",{className:"conversation-scroll",ref:Q},e.createElement("div",{className:"security-banner"},e.createElement(Ft,null),e.createElement("div",null,"Messages are end-to-end encrypted. No one outside of this chat can read or listen to them.")),D?e.createElement(Dn,null):s.length===0?e.createElement(Je,{title:l?"No matches":"No messages yet",subtitle:l?"Try a different phrase.":"Send a message to start the chat."}):s.map(V=>V.type==="day"?e.createElement("div",{key:V.id,className:"day-separator"},V.label):e.createElement(Rn,{key:V.id,message:V.message,query:l.trim(),onPreviewImage:Ae})),k&&!l&&!D?e.createElement(Mn,null):null,!D&&Y(a)?e.createElement("div",{className:"blocked-notice",role:"note"},a.blockedByOther?"You cannot message this account.":"You blocked this account. Unblock to send messages."):null),e.createElement(Bn,{value:w,onChange:v,onSend:h,onEmoji:u,onAttach:A,inputRef:y,disabled:Y(a)}),e.createElement(jn,{open:S,recents:d,onSelect:N,onClose:O}))}function Pn({currentUser:a=Ie,initialChats:s=Za,initialMessages:l=Ja}){const m={...Ie,...a&&typeof a=="object"?a:{}},f=Array.isArray(s)?s:[],E=l&&typeof l=="object"?l:{},[h,w]=i.useState("chats"),[v,u]=i.useState(f),[A,S]=i.useState(E),[d,N]=i.useState(null),[O,y]=i.useState(""),[k,D]=i.useState(""),[Q,H]=i.useState(!1),[U,q]=i.useState(""),[Ae,G]=i.useState(!1),[re,Re]=i.useState(()=>{var t,n,r;if(typeof window>"u")return((t=Se[0])==null?void 0:t.emojis)||[];try{const o=window.localStorage.getItem(Lt);return o?JSON.parse(o):((n=Se[0])==null?void 0:n.emojis)||[]}catch{return((r=Se[0])==null?void 0:r.emojis)||[]}}),[ue,W]=i.useState(!1),[V,Kt]=i.useState(!1),[$n,tt]=i.useState(null),[at,xe]=i.useState(!1),[Yt,nt]=i.useState(!1),[F,st]=i.useState(null),[lt,fe]=i.useState([]),[Me,De]=i.useState([]),[Be,rt]=i.useState(!1),[_,je]=i.useState(null),[Ht,Le]=i.useState(!1),[pe,he]=i.useState(""),[ot,ve]=i.useState(""),[X,Pe]=i.useState(null),[P,Oe]=i.useState(null),[qt,$e]=i.useState(!1),[ct,ge]=i.useState(()=>{var t;return((t=we())==null?void 0:t.sessionId)||""}),[it,Ee]=i.useState(()=>{var t;return((t=we())==null?void 0:t.sessionCsrf)||""}),[Wt,oe]=i.useState(""),[Ue,mt]=i.useState(!1),[Zt,ye]=i.useState(null),[be,dt]=i.useState({sessionId:"",sessionCsrf:"",userId:"",realtimeToken:""}),[ee,ut]=i.useState({open:!1,title:"",message:"",confirmLabel:"Delete",onConfirm:null}),[te,ft]=i.useState({open:!1,title:"",message:"",confirmLabel:"Confirm",onConfirm:null}),pt=i.useRef(null),ce=i.useRef(null),Fe=i.useRef(null),ie=i.useRef(null),Z=i.useRef(null),z=i.useRef(null),B=i.useRef({lastSentAt:0,lastValue:!1,idleTimer:null}),R=be.sessionId,x=be.sessionCsrf,L=be.userId,Ve=be.realtimeToken,I=!!(R&&x&&L),C=v.find(t=>t.id===d)||null,ke=i.useMemo(()=>v.filter(t=>!t.archived),[v]),me=i.useMemo(()=>v.filter(t=>t.archived),[v]),Jt=i.useMemo(()=>{const t=new Map;return lt.forEach(n=>{n!=null&&n.id&&t.set(n.id,{id:n.id,name:n.name||"Unknown",blockedAt:n.blockedAt||"",color:n.color||"#3b82f6"})}),Array.from(t.values())},[lt]),Qt=i.useMemo(()=>{const t=O.trim().toLowerCase();return t?me.filter(n=>n.name.toLowerCase().includes(t)||(n.lastMessage||"").toLowerCase().includes(t)):me},[me,O]),Gt=i.useMemo(()=>{const t=O.trim().toLowerCase();return t?ke.filter(n=>n.name.toLowerCase().includes(t)||(n.lastMessage||"").toLowerCase().includes(t)):ke},[ke,O]),Ne=C?A[d]||[]:[],_e=i.useMemo(()=>{const t=k.trim().toLowerCase();return t?Ne.filter(n=>n.text.toLowerCase().includes(t)):Ne},[Ne,k]),Xt=i.useMemo(()=>en(_e),[_e]),ea=!!(d&&Zt===d),ht=()=>{z.current&&(window.clearTimeout(z.current),z.current=null),B.current.idleTimer&&(window.clearTimeout(B.current.idleTimer),B.current.idleTimer=null)},Ce=async(t,{force:n=!1}={})=>{const r=Z.current;if(!r||!L)return;const o=!!t,c=Date.now(),p=B.current;if(!(!n&&p.lastValue===o&&c-p.lastSentAt<600)){p.lastValue=o,p.lastSentAt=c;try{await r.send({type:"broadcast",event:"typing",payload:{isTyping:o,userId:String(L)}})}catch{}}};i.useEffect(()=>{let t=!1;return(async()=>{if(!d||!L||!Ve||!I){W(!1);return}try{const r=await Da();if(!r||t)return;r.realtime.setAuth(Ve);const o=Z.current;if(o)try{await o.unsubscribe()}catch{}Z.current=null,ht(),B.current.lastValue=!1;const c=r.channel(`conversation:${d}`,{config:{presence:{key:`chat:${String(L)}`}}});c.on("broadcast",{event:"typing"},({payload:p})=>{const b=String((p==null?void 0:p.userId)||"");if(!b||b===String(L))return;const T=!!(p!=null&&p.isTyping);W(T),z.current&&(window.clearTimeout(z.current),z.current=null),T&&(z.current=window.setTimeout(()=>{W(!1),z.current=null},3e3))}),c.subscribe(async p=>{if(!(t||p!=="SUBSCRIBED"))try{await c.track({userId:String(L),at:new Date().toISOString()})}catch{}}),Z.current=c}catch{t||W(!1)}})(),()=>{t=!0;const r=Z.current;if(Z.current=null,r)try{r.unsubscribe()}catch{}ht(),B.current.lastValue=!1,W(!1)}},[d,I,L,Ve]),i.useEffect(()=>{if(!d||!L||!Z.current)return;const t=U.trim().length>0,n=Date.now(),r=B.current;t!==r.lastValue&&n-r.lastSentAt>600&&Ce(t,{force:!0}),r.idleTimer&&(window.clearTimeout(r.idleTimer),r.idleTimer=null),t&&(r.idleTimer=window.setTimeout(()=>{B.current.idleTimer=null,Ce(!1,{force:!0})},2e3))},[U,d,L]),i.useEffect(()=>{if(!d||k.trim())return;const t=pt.current;t&&requestAnimationFrame(()=>{t.scrollTo({top:t.scrollHeight,behavior:"smooth"})})},[d,Ne.length,ue,k]),i.useEffect(()=>{d||G(!1)},[d]),i.useEffect(()=>{Oe(null)},[d]),i.useEffect(()=>{(!d||!I)&&ye(null)},[d,I]),i.useEffect(()=>()=>{ie.current&&clearTimeout(ie.current)},[]),i.useEffect(()=>{if(!(typeof window>"u"))try{window.localStorage.setItem(Lt,JSON.stringify(re))}catch{}},[re]);const g=t=>{tt(t),ie.current&&clearTimeout(ie.current),ie.current=setTimeout(()=>tt(null),2400)},ta=t=>{if(!t||typeof t!="object")return;const n=typeof t.attachmentUrl=="string"?t.attachmentUrl.trim():"",r=typeof t.attachmentType=="string"?t.attachmentType.toLowerCase():"",o=!!t.attachmentIsImage||r.startsWith("image/");if(!n||!o)return;const c=typeof t.attachmentName=="string"&&t.attachmentName?t.attachmentName:"photo";Oe({url:n,name:c,messageId:typeof t.id=="string"?t.id:""})},aa=()=>{Oe(null)},na=async()=>{if(!(P!=null&&P.url))return;const t=P.name||"photo";try{const n=await fetch(P.url);if(!n.ok)throw new Error("download_failed");const r=await n.blob(),o=window.URL.createObjectURL(r),c=document.createElement("a");c.href=o,c.download=t,document.body.appendChild(c),c.click(),c.remove(),window.URL.revokeObjectURL(o),g("Image saved.")}catch{const n=document.createElement("a");n.href=P.url,n.target="_blank",n.rel="noreferrer",n.click(),g("Could not save directly. Opened image in a new tab.")}},sa=()=>{if(!C){g("No chat selected.");return}Pe(C),he(""),ve(P!=null&&P.name?`Photo attachment: ${P.name}`:"Photo attachment"),Le(!0)};i.useEffect(()=>{if(!d||!I)return;let t=!1;ye(d);const n=async({silent:o=!1}={})=>{try{const{messages:c,chatPatch:p}=await Ba({sessionId:R,sessionCsrf:x,conversationId:d,currentUserId:L});if(t)return;S(b=>({...b,[d]:c})),u(b=>b.map(T=>T.id===d?{...T,...p||{},unread:0}:T));try{await ja({sessionId:R,sessionCsrf:x,conversationId:d})}catch{}}catch(c){!t&&!o&&g((c==null?void 0:c.message)||"Failed to load chat messages.")}finally{t||ye(c=>c===d?null:c)}};n();const r=window.setInterval(()=>{n({silent:!0})},5e3);return()=>{t=!0,window.clearInterval(r)}},[d,I,R,x,L]);const la=()=>{if(!d){g("Select a chat to add emojis.");return}G(t=>!t)},ra=()=>G(!1),oa=t=>{t&&(Re(n=>[t,...n.filter(o=>o!==t)].slice(0,24)),q(n=>{const{nextValue:r,caret:o}=nn(n,t,ce.current);return requestAnimationFrame(()=>{ce.current&&(ce.current.focus(),ce.current.setSelectionRange(o,o))}),r}))},ca=t=>{if(!t){g("No chat selected.");return}st(t),nt(!0)},ze=()=>{nt(!1),st(null)},ia=(t,n)=>{const r=v.find(T=>T.id===t),o=(r==null?void 0:r.otherPartyId)||t;if(!o)return;const c=n||new Date().toISOString(),p=(r==null?void 0:r.name)||"Unknown",b=(r==null?void 0:r.color)||"#3b82f6";fe(T=>{const j=T.filter(de=>de.id!==o);return[{id:o,name:p,blockedAt:c,color:b},...j]})},vt=({accountId:t,conversationId:n=""})=>{const r=typeof t=="string"?t.trim():"",o=typeof n=="string"?n.trim():"";u(c=>c.map(p=>{const b=!!o&&p.id===o,T=!!r&&p.otherPartyId===r;if(!b&&!T)return p;const j=!!p.blockedByOther;return{...p,blocked:!1,blockedByMe:!1,hasBlockingRelationship:j,blockedAt:void 0}})),r&&fe(c=>c.filter(p=>p.id!==r))},gt=async t=>{if(!t)return!1;if(I)try{await $a({sessionId:R,sessionCsrf:x,conversationId:t})}catch(r){return g((r==null?void 0:r.message)||"Failed to block account."),!1}const n=new Date().toISOString();return u(r=>r.map(o=>o.id===t?{...o,blocked:!0,blockedByMe:!0,hasBlockingRelationship:!0,blockedAt:n}:o)),ia(t,n),d===t&&N(null),g("Chat blocked."),!0},ma=async t=>{if(!t)return!1;const n=v.find(o=>o.id===t),r=(n==null?void 0:n.otherPartyId)||"";if(I)try{await xt({sessionId:R,sessionCsrf:x,conversationId:t||void 0,recipientId:r||void 0})}catch(o){return g((o==null?void 0:o.message)||"Failed to unblock account."),!1}return vt({accountId:r,conversationId:t}),g("Account unblocked."),!0},da=async t=>{const n=typeof t=="string"?t.trim():"";if(!n)return!1;const r=v.find(c=>c.otherPartyId===n),o=(r==null?void 0:r.id)||"";if(I)try{await xt({sessionId:R,sessionCsrf:x,conversationId:o||void 0,recipientId:n})}catch(c){return g((c==null?void 0:c.message)||"Failed to unblock account."),!1}return vt({accountId:n,conversationId:o}),g("Account unblocked."),!0},ua=async(t,n={})=>{if(!t)return!1;const r=n.clearActive!==!1,o=n.toast!==!1;if(I)try{await Va({sessionId:R,sessionCsrf:x,conversationId:t})}catch(c){return g((c==null?void 0:c.message)||"Failed to archive chat."),!1}return u(c=>c.map(p=>p.id===t?{...p,archived:!0,archivedAt:new Date().toISOString()}:p)),r&&d===t&&N(null),o&&g("Chat archived."),!0},Et=async(t,n={})=>{if(!t)return!1;const r=n.clearActive===!0,o=n.toast!==!1;if(I)try{await _a({sessionId:R,sessionCsrf:x,conversationId:t})}catch(c){return g((c==null?void 0:c.message)||"Failed to restore chat."),!1}return u(c=>c.map(p=>p.id===t?{...p,archived:!1,archivedAt:void 0}:p)),r&&d===t&&N(null),o&&g("Chat restored from archive."),!0},fa=t=>{t&&(je(t),rt(!0))},yt=()=>{rt(!1),je(null)},Ke=t=>{t&&(Pe(t),he(""),ve(""),Le(!0))},bt=()=>{Le(!1),Pe(null),he(""),ve("")},pa=async()=>{var o;if(!X||!pe)return;if(!I){g("Connect first to submit reports.");return}const t=((o=Bt.find(c=>c.value===pe))==null?void 0:o.label)||pe,n=ot.trim(),r=n?`${t} - ${n}`:t;try{await Ua({sessionId:R,sessionCsrf:x,conversationId:X.id,recipientId:X.otherPartyId,reason:r});try{const c=await At({sessionId:R,sessionCsrf:x});De(c)}catch{}bt(),g("Report sent.")}catch(c){g((c==null?void 0:c.message)||"Failed to submit report.")}},ha=({title:t,message:n,confirmLabel:r,onConfirm:o})=>{ft({open:!0,title:t,message:n,confirmLabel:r,onConfirm:o})},Ye=()=>{ft(t=>({...t,open:!1}))},va=()=>{if(oe(""),R&&x)ge(R),Ee(x);else{const t=we();t&&(ge(t.sessionId),Ee(t.sessionCsrf))}$e(!0)},ga=()=>{oe(""),$e(!1)},kt=async(t,n,r={})=>{const o=!!(r!=null&&r.silent);if(Ue)return!1;const c=t.trim(),p=n.trim();if(!c||!p)return o||oe("Session ID and Session CSRF are required."),!1;mt(!0),o||oe("");try{const b=await La({sessionId:c,sessionCsrf:p}),{chats:T,blockedAccounts:j,reports:de}=await Pa({sessionId:c,sessionCsrf:p});return dt({sessionId:c,sessionCsrf:p,userId:b.userId,realtimeToken:b.token||""}),Qa(c,p),u(T),fe(j),S({}),De(de),N(null),xe(!1),y(""),D(""),H(!1),w("chats"),$e(!1),!o&&T.length===0?g("Connected. No chats found."):o||g(`Connected. Loaded ${T.length} chat${T.length===1?"":"s"}.`),!0}catch(b){return o?jt():oe((b==null?void 0:b.message)||"Failed to connect session."),!1}finally{mt(!1)}};i.useEffect(()=>{const t=we();!t||I||(ge(n=>n||t.sessionId),Ee(n=>n||t.sessionCsrf),kt(t.sessionId,t.sessionCsrf,{silent:!0}))},[]);const Ea=async()=>{await kt(ct,it)},ae=({title:t,message:n,confirmLabel:r="Delete",onConfirm:o})=>{ut({open:!0,title:t,message:n,confirmLabel:r,onConfirm:o})},K=()=>{ut(t=>({...t,open:!1}))},ya=async(t,n={})=>{n.unarchive&&!await Et(t,{clearActive:!1,toast:!0})||(N(t),I&&ye(t),xe(!1),n.keepSection||w("chats"),u(r=>r.map(o=>o.id===t?{...o,unread:0}:o)),H(!1),D(""))},Nt=(t,n,r)=>{S(o=>{const c=o[t]||[];return{...o,[t]:c.map(p=>p.id===n?{...p,status:r}:p)}})},ba=async()=>{const t=U.trim();if(!t||!d)return;if(Y(C)){g(C!=null&&C.blockedByOther?"You cannot message this account.":"Unblock this account to send messages.");return}if(I){try{const r=await Oa({sessionId:R,sessionCsrf:x,conversationId:d,content:t}),o=Rt(r==null?void 0:r.data,L);S(c=>({...c,[d]:[...c[d]||[],o]})),q(""),u(c=>{const p=c.map(j=>j.id===d?{...j,lastMessage:o.text||t,lastTime:o.timestamp||new Date().toISOString(),unread:0}:j),b=p.find(j=>j.id===d),T=p.filter(j=>j.id!==d);return b?[b,...T]:p}),B.current.idleTimer&&(window.clearTimeout(B.current.idleTimer),B.current.idleTimer=null),B.current.lastValue=!1,Ce(!1,{force:!0})}catch(r){g((r==null?void 0:r.message)||"Failed to send message.")}return}const n={id:`m-${Date.now()}`,chatId:d,sender:"me",text:t,timestamp:new Date().toISOString(),status:"sent"};S(r=>({...r,[d]:[...r[d]||[],n]})),q(""),u(r=>{const o=r.map(b=>b.id===d?{...b,lastMessage:t,lastTime:n.timestamp,unread:0}:b),c=o.find(b=>b.id===d),p=o.filter(b=>b.id!==d);return c?[c,...p]:o}),setTimeout(()=>Nt(d,n.id,"delivered"),900),setTimeout(()=>Nt(d,n.id,"read"),2e3),B.current.idleTimer&&(window.clearTimeout(B.current.idleTimer),B.current.idleTimer=null),B.current.lastValue=!1,Ce(!1,{force:!0})},ka=()=>{if(!d){g("Select a chat first.");return}if(!I){g("Connect your session first.");return}if(Y(C)){g(C!=null&&C.blockedByOther?"You cannot message this account.":"Unblock this account to send messages.");return}Fe.current&&Fe.current.click()},Na=async t=>{var o;const n=t.target,r=(o=n==null?void 0:n.files)==null?void 0:o[0];if(n&&(n.value=""),!!r){if(!d){g("Select a chat first.");return}if(!I){g("Connect your session first.");return}if(Y(C)){g(C!=null&&C.blockedByOther?"You cannot message this account.":"Unblock this account to send messages.");return}try{const c=await Fa({sessionId:R,sessionCsrf:x,conversationId:d,file:r}),p=Rt(c==null?void 0:c.data,L);S(b=>({...b,[d]:[...b[d]||[],p]})),u(b=>{const T=b.map(J=>J.id===d?{...J,lastMessage:p.text||r.name,lastTime:p.timestamp||new Date().toISOString(),unread:0}:J),j=T.find(J=>J.id===d),de=T.filter(J=>J.id!==d);return j?[j,...de]:T}),g("Attachment sent.")}catch(c){g((c==null?void 0:c.message)||"Failed to send attachment.")}}},He=t=>{if(!Array.isArray(t)||t.length===0)return;const n=new Set(t.filter(Boolean));n.size&&(u(r=>r.filter(o=>!n.has(o.id))),S(r=>{const o={...r};return n.forEach(c=>{delete o[c]}),o}),d&&n.has(d)&&N(null))},qe=async(t,n={})=>{const r=typeof t=="string"?t.trim():"";if(!r)return!1;const o=n.toast!==!1;if(I)try{await Mt({sessionId:R,sessionCsrf:x,conversationId:r})}catch(c){return g((c==null?void 0:c.message)||"Failed to delete chat."),!1}return He([r]),o&&g("Chat deleted."),!0},Ct=async()=>{const t=v.map(o=>o.id).filter(Boolean);if(t.length===0)return g("No chats to delete."),!1;if(!I)return He(t),g("All chats deleted."),!0;const n=[];for(const o of t)try{await Mt({sessionId:R,sessionCsrf:x,conversationId:o}),n.push(o)}catch{}n.length>0&&He(n);const r=t.length-n.length;return n.length===0?(g("Failed to delete chats."),!1):r===0?(g("All chats deleted."),!0):(g(`Deleted ${n.length} chat${n.length===1?"":"s"}. ${r} failed.`),!1)},Ca=t=>{S(n=>({...n,[t]:[]})),u(n=>n.map(r=>r.id===t?{...r,lastMessage:"No messages yet",lastTime:"",unread:0}:r))},wa=()=>{if(d){Ca(d),g("Cleared current chat.");return}const t={};v.forEach(n=>{t[n.id]=[]}),S(t),u(n=>n.map(r=>({...r,lastMessage:"No messages yet",lastTime:"",unread:0}))),g("Cleared all chats.")},Sa=t=>{if(t==="profile"){ca(C);return}if(t==="close"){N(null),xe(!0),H(!1),D(""),g("Chat closed.");return}if(t==="block"){if(!C)return;gt(C.id);return}if(t==="delete"){ae(C?{title:`Delete chat with ${ne(C)}?`,message:"This removes the chat from your list.",onConfirm:()=>{K(),qe(C.id)}}:{title:"Delete all chats?",message:"This removes every chat from your list.",onConfirm:()=>{K(),Ct()}});return}if(t==="clear"){const n=C?`Clear chat with ${C.name}?`:"Clear all chats?";ha({title:n,message:C?"This clears the messages in this chat.":"This clears the messages in every chat.",confirmLabel:"Clear",onConfirm:()=>{Ye(),wa()}});return}t==="report"&&Ke(C)},Ia=()=>{H(t=>{const n=!t;return n||D(""),n})},Ta=async(t,n)=>{if(n==="archive"){await ua(t,{clearActive:!0,toast:!0});return}if(n==="unarchive"){await Et(t,{clearActive:$,toast:!0});return}if(n==="delete"){const r=v.find(o=>o.id===t);ae({title:r?`Delete chat with ${ne(r)}?`:"Delete chat?",message:"This removes the chat from your list.",onConfirm:()=>{K(),qe(t)}});return}if(n==="report"){const r=v.find(o=>o.id===t);Ke(r)}},Aa=t=>{da(t)},$=h==="archive",wt=h==="block",St=h==="profile",It=h==="reports",We=!!P,Tt=We||St||wt||It,Ra=Ue;return i.useEffect(()=>{h!=="chats"&&h!=="archive"&&G(!1)},[h]),i.useEffect(()=>{if(!$||at)return;if(me.length===0){N(null);return}const t=v.find(n=>n.id===d);t&&!t.archived&&N(null)},[$,me,v,d,at]),i.useEffect(()=>{if($)return;const t=v.find(n=>n.id===d);t&&t.archived&&N(null)},[$,v,d,ke]),i.useEffect(()=>{if(!I||h!=="block")return;let t=!1;return(async()=>{try{const n=await xa({sessionId:R,sessionCsrf:x});t||fe(n)}catch{}})(),()=>{t=!0}},[I,h,R,x]),i.useEffect(()=>{if(!I||h!=="reports")return;let t=!1;return(async()=>{try{const n=await At({sessionId:R,sessionCsrf:x});t||De(n)}catch{}})(),()=>{t=!0}},[I,h,R,x]),i.useEffect(()=>{if(!Be||!(_!=null&&_.id))return;const t=Me.find(n=>n.id===_.id);if(!t){yt();return}je(t)},[Be,_==null?void 0:_.id,Me]),e.createElement("div",{className:"desktop-stage"},e.createElement("div",{className:"desktop-window"},e.createElement("div",{className:`desktop-content chp-desktop${We?" preview-only":Tt?" section-only":""}`},We?null:e.createElement("aside",{className:"icon-rail"},e.createElement("nav",{className:"rail-nav","aria-label":"Primary"},[{key:"home",label:"Home",icon:un},{key:"chats",label:"Chats",icon:ln},{key:"archive",label:"Archive",icon:fn},{key:"block",label:"Block",icon:se},{key:"reports",label:"Reports",icon:Vt},{key:"profile",label:"Profile",icon:pn},{key:"connect",label:"Connect",icon:Ft}].map(t=>{const n=t.icon;return e.createElement("button",{key:t.key,className:`rail-btn ${h===t.key?"active":""}`,type:"button",onClick:()=>{if(t.key==="connect"){va();return}if(w(t.key),t.key==="home"){window.location.href="homepage.html";return}},"aria-label":t.label},e.createElement("span",{className:"rail-icon"},e.createElement(n,null)),e.createElement("span",null,t.label))})),e.createElement("div",{className:"rail-footer"},e.createElement("button",{className:`rail-btn danger ${h==="logout"?"active":""}`,type:"button",onClick:()=>{w("logout"),ae({title:"Log out?",message:"Are you sure you want to log out?",confirmLabel:"Log out",onConfirm:()=>{K(),jt(),dt({sessionId:"",sessionCsrf:"",userId:"",realtimeToken:""}),g("Logged out.")}})},"aria-label":"Logout"},e.createElement("span",{className:"rail-icon"},e.createElement(hn,null)),e.createElement("span",null,"Logout")))),Tt?null:e.createElement("aside",{className:"sidebar"},$?e.createElement(e.Fragment,null,e.createElement("div",{className:"archive-heading"},e.createElement("h2",null,"Achieved Chats")),e.createElement("div",{className:"archive-description muted"},"Archived conversations stored here.")):e.createElement("div",{className:"sidebar-header"},e.createElement("div",{className:"sidebar-title"},e.createElement("div",{className:"sidebar-brand"},e.createElement("img",{src:Ma,alt:"CompareHubPrices"}))),e.createElement("div",{className:"sidebar-actions-row"},e.createElement("button",{className:"icon-btn",type:"button","aria-label":"Delete all chats",onClick:()=>{ae({title:"Delete all chats?",message:"This removes every chat from your list.",onConfirm:()=>{K(),Ct()}})}},e.createElement(_t,null)))),e.createElement(An,{chats:$?Qt:Gt,searchValue:O,onSearchChange:y,activeChatId:d,onOpenChat:t=>ya(t,{keepSection:$}),onMenuAction:Ta,emptyTitle:$?"No archived chats":void 0,emptySubtitle:$?"Archived conversations will appear here.":void 0,showSearch:!$})),e.createElement("section",{className:"chat-panel"},St?e.createElement(Cn,{currentUser:m}):wt?e.createElement(wn,{chats:Jt,onUnblock:Aa}):It?e.createElement(Sn,{reports:Me,onOpenReport:fa}):e.createElement(Ln,{chat:C,groupedMessages:Xt,searchValue:k,showSearch:Q,onToggleSearch:Ia,onSearchChange:D,onSend:ba,composerValue:U,onComposerChange:q,onEmoji:la,onAttach:ka,emojiOpen:Ae,emojiRecents:re,onEmojiSelect:oa,onEmojiClose:ra,composerRef:ce,typing:ue,conversationLoading:ea,messageListRef:pt,matchCount:_e.length,onMenuAction:Sa,attachmentPreview:P,onOpenAttachmentPreview:ta,onCloseAttachmentPreview:aa,onSaveAttachmentPreview:na,onReportAttachmentPreview:sa})))),Ra?e.createElement(Nn,null):null,e.createElement(bn,{open:V,onClose:()=>Kt(!1),currentUser:m}),e.createElement(kn,{open:Yt,onClose:ze,chat:F,onDelete:()=>{F&&ae({title:`Delete chat with ${ne(F)}?`,message:"This removes the chat from your list.",onConfirm:async()=>{K(),await qe(F.id)&&ze()}})},onBlock:()=>{(async()=>{if(!F)return;(F.blocked?await ma(F.id):await gt(F.id))&&ze()})()},onReport:()=>{F&&Ke(F)}}),e.createElement(In,{open:Be,report:_,onClose:yt}),e.createElement(Tn,{open:Ht,onClose:bt,reasons:Bt,value:pe,onChange:he,details:ot,onDetailsChange:ve,onSubmit:pa,targetName:X==null?void 0:X.name}),e.createElement(yn,{open:qt,sessionId:ct,sessionCsrf:it,error:Wt,busy:Ue,onSessionIdChange:ge,onSessionCsrfChange:Ee,onConnect:Ea,onCancel:ga}),e.createElement(En,{open:ee.open,title:ee.title,message:ee.message,confirmLabel:ee.confirmLabel,onConfirm:()=>{ee.onConfirm?ee.onConfirm():K()},onCancel:K}),e.createElement(gn,{open:te.open,title:te.title,message:te.message,confirmLabel:te.confirmLabel,onConfirm:()=>{te.onConfirm?te.onConfirm():Ye()},onCancel:Ye}),e.createElement("input",{ref:Fe,type:"file",accept:".pdf,image/png,image/jpeg,image/webp,video/mp4,video/webm,video/quicktime,.mov,.m4v",onChange:Na,style:{display:"none"}}))}const On=za(document.getElementById("root"));On.render(e.createElement(e.StrictMode,null,e.createElement(Pn,null)));
