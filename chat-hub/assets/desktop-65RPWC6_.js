import{r as i,h as Ln,i as jn,f as On,a as Rt,R as e,l as Un,g as $n,b as Fn,m as Vn,s as _n,c as Pt,j as Lt,n as zn,d as Hn,e as Wn,k as Yn,u as Zn,o as jt,p as qn}from"./realtimeClient-CLlQXVsk.js";const le={name:"",firstName:"",lastName:"",status:"",about:"",email:"",phone:"",suburb:"",city:"",province:"",accountSince:""},Kn=[],Jn={},Ot=[{value:"spam",label:"Spam"},{value:"harassment",label:"Harassment"},{value:"scam",label:"Scam"},{value:"other",label:"Other"}];function Qn(){if(typeof document>"u")return null;const n=Ut("standard_session_id"),s=Ut("standard_csrf_token");return console.log("[ChatDebug] readPersistedChatSession:",{hasSessionId:!!n,sessionIdPreview:n?n.slice(0,8)+"...":"(empty)",hasCsrf:!!s,csrfPreview:s?s.slice(0,8)+"...":"(empty)",allCookies:document.cookie?document.cookie.split(";").map(l=>l.trim().split("=")[0]):[]}),!n||!s?null:{sessionId:n,sessionCsrf:s}}function Gn(n,s){var u,E;if(console.log("[ChatDebug] persistChatSession called:",{hasSessionId:!!n,hasCsrf:!!s,protocol:typeof window<"u"?(u=window.location)==null?void 0:u.protocol:"unknown"}),typeof document>"u"||!n||!s)return;const l=typeof window<"u"&&((E=window.location)==null?void 0:E.protocol)==="https:"?"; Secure":"",m=60*60*24*30;document.cookie=`standard_session_id=${encodeURIComponent(n)}; path=/; max-age=${m}; SameSite=Lax${l}`,document.cookie=`standard_csrf_token=${encodeURIComponent(s)}; path=/; max-age=${m}; SameSite=Lax${l}`,console.log("[ChatDebug] persistChatSession done. Cookie names now:",document.cookie.split(";").map(p=>p.trim().split("=")[0]))}function Xn(){typeof document>"u"||($t("standard_session_id"),$t("standard_csrf_token"))}function Ut(n){if(!n||typeof document>"u")return"";try{const s=String(document.cookie||"");if(!s)return"";const l=s.split(";");let m="";for(const u of l){const E=u.indexOf("=");if(E<=0||u.slice(0,E).trim()!==n)continue;const D=u.slice(E+1).trim();if(D)try{m=decodeURIComponent(D).trim()}catch{m=D.trim()}}return m}catch{return""}}function $t(n){var l;const s=typeof window<"u"&&((l=window.location)==null?void 0:l.protocol)==="https:"?"; Secure":"";document.cookie=`${n}=; path=/; max-age=0; SameSite=Lax${s}`}function ea(){if(typeof window>"u")return{conversationId:"",recipientId:"",recipientName:""};try{const n=new URLSearchParams(window.location.search||"");return{conversationId:(n.get("conversationId")||"").trim(),recipientId:(n.get("recipientId")||"").trim(),recipientName:(n.get("recipientName")||"").trim()}}catch{return{conversationId:"",recipientId:"",recipientName:""}}}function ta(n){return n!=null&&n.id?{id:"",name:String(n.name||"").trim()||"Business",firstName:"",lastName:"",suburb:"",city:"",province:"",streetAddress:"",accountSince:"",accountType:"Business",lastMessage:"No messages yet",lastTime:"",unread:0,online:!1,presence:"Start conversation",color:"#3b82f6",archived:!1,blocked:!1,blockedByMe:!1,blockedByOther:!1,hasBlockingRelationship:!1,otherPartyId:n.id,launchPending:!0}:null}const Vt=[{id:"recent",name:"Recent",icon:'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>',emojis:["ğŸ˜‚","â¤ï¸","ğŸ‘","ğŸ”¥","ğŸ˜Š","ğŸ™","ğŸ¥º","ğŸ¤£"]},{id:"smileys",name:"Smileys & Emotion",icon:'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M8 14s1.5 2 4 2 4-2 4-2"></path><line x1="9" y1="9" x2="9.01" y2="9"></line><line x1="15" y1="9" x2="15.01" y2="9"></line></svg>',emojis:["ğŸ˜€","ğŸ˜ƒ","ğŸ˜„","ğŸ˜","ğŸ˜†","ğŸ˜…","ğŸ˜‚","ğŸ¤£","ğŸ˜Š","ğŸ˜‡","ğŸ™‚","ğŸ™ƒ","ğŸ˜‰","ğŸ˜Œ","ğŸ˜","ğŸ¥°","ğŸ˜˜","ğŸ˜—","ğŸ˜™","ğŸ˜š","ğŸ˜‹","ğŸ˜›","ğŸ˜","ğŸ˜œ","ğŸ¤ª","ğŸ¤¨","ğŸ§","ğŸ¤“","ğŸ˜","ğŸ¤©","ğŸ¥³","ğŸ˜","ğŸ˜’","ğŸ˜","ğŸ˜”","ğŸ˜Ÿ","ğŸ˜•","ğŸ™","â˜¹ï¸","ğŸ˜£","ğŸ˜–","ğŸ˜«","ğŸ˜©","ğŸ¥º","ğŸ˜¢","ğŸ˜­","ğŸ˜¤","ğŸ˜ ","ğŸ˜¡","ğŸ¤¬","ğŸ¤¯","ğŸ˜³","ğŸ¥µ","ğŸ¥¶","ğŸ˜±","ğŸ˜¨","ğŸ˜°","ğŸ˜¥","ğŸ˜“","ğŸ¤—","ğŸ¤”","ğŸ¤­","ğŸ¤«","ğŸ¤¥","ğŸ˜¶","ğŸ˜","ğŸ˜‘","ğŸ˜¬","ğŸ™„","ğŸ˜¯","ğŸ˜¦","ğŸ˜§","ğŸ˜®","ğŸ˜²","ğŸ¥±","ğŸ˜´","ğŸ¤¤","ğŸ˜ª","ğŸ˜µ","ğŸ¤","ğŸ¥´","ğŸ¤¢","ğŸ¤®","ğŸ¤§","ğŸ˜·","ğŸ¤’","ğŸ¤•","ğŸ¤‘","ğŸ¤ ","ğŸ˜ˆ","ğŸ‘¿","ğŸ‘¹","ğŸ‘º","ğŸ¤¡","ğŸ’©","ğŸ‘»","ğŸ’€","â˜ ï¸","ğŸ‘½","ğŸ‘¾","ğŸ¤–","ğŸƒ"]},{id:"people",name:"People & Body",icon:'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 11V6a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v5"></path><path d="M14 10V4a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v10"></path><path d="M10 10.5V6a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v8"></path><path d="M18 8a2 2 0 1 1 4 0v6a8 8 0 0 1-8 8h-2c-2.8 0-4.5-.86-5.99-2.34l-3.6-3.6a2 2 0 0 1 2.83-2.82L7 15"></path></svg>',emojis:["ğŸ‘‹","ğŸ¤š","ğŸ–ï¸","âœ‹","ğŸ––","ğŸ‘Œ","ğŸ¤","âœŒï¸","ğŸ¤","ğŸ¤Ÿ","ğŸ¤˜","ğŸ¤™","ğŸ‘ˆ","ğŸ‘‰","ğŸ‘†","ğŸ–•","ğŸ‘‡","â˜ï¸","ğŸ‘","ğŸ‘","âœŠ","ğŸ‘Š","ğŸ¤›","ğŸ¤œ","ğŸ‘","ğŸ™Œ","ğŸ‘","ğŸ¤²","ğŸ¤","ğŸ™","âœï¸","ğŸ’…","ğŸ¤³","ğŸ’ª","ğŸ¦¾","ğŸ¦µ","ğŸ¦¿","ğŸ¦¶","ğŸ‘‚","ğŸ¦»","ğŸ‘ƒ","ğŸ§ ","ğŸ¦·","ğŸ¦´","ğŸ‘€","ğŸ‘ï¸","ğŸ‘…","ğŸ‘„","ğŸ‘¶","ğŸ§’","ğŸ‘¦","ğŸ‘§","ğŸ§‘","ğŸ‘±","ğŸ‘¨","ğŸ§”","ğŸ‘©","ğŸ§“","ğŸ‘´","ğŸ‘µ","ğŸ‘¨â€âš•ï¸","ğŸ‘©â€âš•ï¸","ğŸ‘¨â€ğŸ“","ğŸ‘©â€ğŸ“","ğŸ‘¨â€ğŸ«","ğŸ‘©â€ğŸ«","ğŸ‘¨â€âš–ï¸","ğŸ‘©â€âš–ï¸","ğŸ‘¨â€ğŸŒ¾","ğŸ‘©â€ğŸŒ¾","ğŸ‘¨â€ğŸ³","ğŸ‘©â€ğŸ³","ğŸ‘¨â€ğŸ”§","ğŸ‘©â€ğŸ”§","ğŸ‘¨â€ğŸ­","ğŸ‘©â€ğŸ­","ğŸ‘¨â€ğŸ’¼","ğŸ‘©â€ğŸ’¼","ğŸ‘¨â€ğŸ”¬","ğŸ‘©â€ğŸ”¬","ğŸ‘¨â€ğŸ’»","ğŸ‘©â€ğŸ’»","ğŸ‘¨â€ğŸ¤","ğŸ‘©â€ğŸ¤","ğŸ‘¨â€ğŸ¨","ğŸ‘©â€ğŸ¨","ğŸ‘¨â€âœˆï¸","ğŸ‘©â€âœˆï¸","ğŸ‘¨â€ğŸš€","ğŸ‘©â€ğŸš€","ğŸ‘¨â€ğŸš’","ğŸ‘©â€ğŸš’","ğŸ‘®","ğŸ•µï¸","ğŸ’‚","ğŸ‘·","ğŸ¤´","ğŸ‘¸","ğŸ‘³","ğŸ‘²","ğŸ§•","ğŸ¤µ","ğŸ‘°"]},{id:"nature",name:"Animals & Nature",icon:'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10Z"></path><path d="M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12"></path></svg>',emojis:["ğŸ¶","ğŸ±","ğŸ­","ğŸ¹","ğŸ°","ğŸ¦Š","ğŸ»","ğŸ¼","ğŸ»â€â„ï¸","ğŸ¨","ğŸ¯","ğŸ¦","ğŸ®","ğŸ·","ğŸ½","ğŸ¸","ğŸµ","ğŸ™ˆ","ğŸ™‰","ğŸ™Š","ğŸ’","ğŸ”","ğŸ§","ğŸ¦","ğŸ¤","ğŸ£","ğŸ¥","ğŸ¦†","ğŸ¦¢","ğŸ¦‰","ğŸ¦©","ğŸ¦š","ğŸ¦œ","ğŸ¸","ğŸŠ","ğŸ¢","ğŸ¦","ğŸ","ğŸ²","ğŸ‰","ğŸ¦•","ğŸ¦–","ğŸ³","ğŸ‹","ğŸ¬","ğŸ¦­","ğŸŸ","ğŸ ","ğŸ¡","ğŸ¦ˆ","ğŸ™","ğŸš","ğŸŒ","ğŸ¦‹","ğŸ›","ğŸœ","ğŸ","ğŸ","ğŸ¦—","ğŸ•·ï¸","ğŸ•¸ï¸","ğŸ¦‚","ğŸ¦Ÿ","ğŸ¦ ","ğŸ’","ğŸŒ¸","ğŸ’®","ğŸµï¸","ğŸŒ¹","ğŸ¥€","ğŸŒº","ğŸŒ»","ğŸŒ¼","ğŸŒ·","ğŸŒ±","ğŸª´","ğŸŒ²","ğŸŒ³","ğŸŒ´","ğŸŒµ","ğŸŒ¾","ğŸŒ¿","â˜˜ï¸","ğŸ€","ğŸ","ğŸ‚","ğŸƒ"]},{id:"food",name:"Food & Drink",icon:'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 2v20"></path><path d="M15 3v10"></path><path d="M15 17v5"></path><path d="M15 3c-1.1 0-2 .9-2 2h0c0 1.1.9 2 2 2h0c1.1 0 2-.9 2-2h0c0-1.1-.9-2-2-2Z"></path><path d="M15 17c-1.1 0-2 .9-2 2h0c0 1.1.9 2 2 2h0c1.1 0 2-.9 2-2h0c0-1.1-.9-2-2-2Z"></path><path d="M9 3v10"></path><path d="M9 17v5"></path><path d="M9 3c-1.1 0-2 .9-2 2h0c0 1.1.9 2 2 2h0c1.1 0 2-.9 2-2h0c0-1.1-.9-2-2-2Z"></path><path d="M9 17c-1.1 0-2 .9-2 2h0c0 1.1.9 2 2 2h0c1.1 0 2-.9 2-2h0c0-1.1-.9-2-2-2Z"></path></svg>',emojis:["ğŸ","ğŸ","ğŸ","ğŸŠ","ğŸ‹","ğŸŒ","ğŸ‰","ğŸ‡","ğŸ“","ğŸ«","ğŸˆ","ğŸ’","ğŸ‘","ğŸ¥­","ğŸ","ğŸ¥¥","ğŸ¥","ğŸ…","ğŸ†","ğŸ¥‘","ğŸ¥¦","ğŸ¥¬","ğŸ¥’","ğŸŒ¶ï¸","ğŸŒ½","ğŸ¥•","ğŸ«’","ğŸ§„","ğŸ§…","ğŸ„","ğŸ¥œ","ğŸ«˜","ğŸŒ°","ğŸ","ğŸ¥","ğŸ¥–","ğŸ«“","ğŸ¥¨","ğŸ¥¯","ğŸ¥","ğŸ§‡","ğŸ§€","ğŸ–","ğŸ—","ğŸ¥©","ğŸ¥“","ğŸ”","ğŸŸ","ğŸ•","ğŸŒ­","ğŸ¥ª","ğŸŒ®","ğŸŒ¯","ğŸ«”","ğŸ¥™","ğŸ§†","ğŸ¥š","ğŸ³","ğŸ¥˜","ğŸ²","ğŸ¥£","ğŸ¥—","ğŸ¿","ğŸ§ˆ","ğŸ§‚","ğŸ¥«","ğŸ±","ğŸ˜","ğŸ™","ğŸš","ğŸ›","ğŸœ","ğŸ","ğŸ ","ğŸ¢","ğŸ£","ğŸ¤","ğŸ¥","ğŸ¥®","ğŸ¡","ğŸ¥Ÿ","ğŸ¥ ","ğŸ¥¡","ğŸ¦€","ğŸ¦","ğŸ¦","ğŸ¦‘","ğŸ¦ª","ğŸ¦","ğŸ§","ğŸ¨","ğŸ©","ğŸª","ğŸ‚","ğŸ°","ğŸ§","ğŸ¥§","ğŸ«","ğŸ¬","ğŸ­","ğŸ®","ğŸ¯","ğŸ¼","ğŸ¥›","â˜•","ğŸ«–","ğŸµ","ğŸ¶","ğŸ¾","ğŸ·","ğŸ¸","ğŸ¹","ğŸº","ğŸ»","ğŸ¥‚","ğŸ¥ƒ","ğŸ¥¤","ğŸ§‹","ğŸ§ƒ","ğŸ§‰","ğŸ§Š","ğŸ¥¢","ğŸ½ï¸","ğŸ´","ğŸ¥„"]},{id:"travel",name:"Travel & Places",icon:'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>',emojis:["ğŸš—","ğŸš•","ğŸš™","ğŸšŒ","ğŸš","ğŸï¸","ğŸš“","ğŸš‘","ğŸš’","ğŸš","ğŸ›»","ğŸšš","ğŸš›","ğŸšœ","ğŸ›µ","ğŸï¸","ğŸ›º","ğŸš²","ğŸ›´","ğŸ›¹","ğŸš","ğŸ›¤ï¸","ğŸ›©ï¸","âœˆï¸","ğŸ›«","ğŸ›¬","ğŸ›°ï¸","ğŸš€","ğŸ›¸","ğŸš","ğŸ›¶","â›µ","ğŸš¤","ğŸ›³ï¸","â›´ï¸","ğŸš¢","âš“","â›½","ğŸš§","ğŸš¦","ğŸš¥","ğŸ—ºï¸","ğŸ—¿","ğŸ—½","ğŸ—¼","ğŸ°","ğŸ¯","ğŸŸï¸","ğŸ¡","ğŸ¢","ğŸ ","â›²","â›±ï¸","ğŸ–ï¸","ğŸï¸","ğŸœï¸","ğŸŒ‹","â›°ï¸","ğŸ”ï¸","ğŸ—»","ğŸ•ï¸","â›º","ğŸ ","ğŸ¡","ğŸ¢","ğŸ£","ğŸ¤","ğŸ¥","ğŸ¦","ğŸ¨","ğŸ©","ğŸª","ğŸ«","ğŸ¬","ğŸ­","ğŸ™ï¸","ğŸŒ†","ğŸŒ‡","ğŸŒƒ","ğŸŒ‰","ğŸŒŒ","â™¨ï¸","ğŸŒ","ğŸŒ","ğŸŒ","ğŸŒ","ğŸŒ‘","ğŸŒ’","ğŸŒ“","ğŸŒ”","ğŸŒ•","ğŸŒ–","ğŸŒ—","ğŸŒ˜","ğŸŒ™","ğŸŒš","ğŸŒ","ğŸª","ğŸŒŸ","â­","âœ¨","ğŸŒ ","â˜€ï¸","ğŸŒ¤ï¸","â›…","ğŸŒ¥ï¸","â˜ï¸","ğŸŒ¦ï¸","ğŸŒ§ï¸","â›ˆï¸","ğŸŒ©ï¸","ğŸŒ¨ï¸","â„ï¸","â˜ƒï¸","â›„","ğŸŒ¬ï¸","ğŸ’¨","ğŸŒªï¸","ğŸŒ«ï¸","ğŸŒˆ","â˜”","ğŸ’§","ğŸ’¦","ğŸŒŠ"]},{id:"objects",name:"Objects",icon:'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path><polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline><line x1="12" y1="22.08" x2="12" y2="12"></line></svg>',emojis:["âŒš","ğŸ“±","ğŸ“²","ğŸ’»","âŒ¨ï¸","ğŸ–¥ï¸","ğŸ–¨ï¸","ğŸ–±ï¸","ğŸ–²ï¸","ğŸ•¹ï¸","ğŸ—œï¸","ğŸ’½","ğŸ’¾","ğŸ’¿","ğŸ“€","ğŸ“¼","ğŸ“·","ğŸ“¸","ğŸ“¹","ğŸ¥","ğŸ“½ï¸","ğŸï¸","ğŸ“","â˜ï¸","ğŸ“Ÿ","ğŸ“ ","ğŸ“º","ğŸ“»","ğŸ™ï¸","ğŸšï¸","ğŸ›ï¸","ğŸ§­","â±ï¸","â²ï¸","â°","ğŸ•°ï¸","âŒ›","â³","ğŸ”‹","ğŸ”Œ","ğŸ’¡","ğŸ”¦","ğŸ•¯ï¸","ğŸª”","ğŸ—‘ï¸","ğŸ›¢ï¸","ğŸ’¸","ğŸ’µ","ğŸ’´","ğŸ’¶","ğŸ’·","ğŸ’°","ğŸ’³","ğŸ’","âš–ï¸","ğŸªœ","ğŸ§°","ğŸª›","ğŸ”§","ğŸ”¨","âš’ï¸","ğŸ› ï¸","â›ï¸","ğŸª“","ğŸ”©","âš™ï¸","ğŸª—","ğŸ§±","â›“ï¸","ğŸ§²","âš—ï¸","ğŸ”­","ğŸ”¬","ğŸ•³ï¸","ğŸ©¹","ğŸ©º","ğŸ’Š","ğŸ’‰","ğŸ©¸","ğŸ§¬","ğŸ§¼","ğŸª ","ğŸ§½","ğŸª£","ğŸª‘","ğŸ§¹","ğŸ§º","ğŸ§»","ğŸ§´","ğŸ§¼","ğŸª¥","ğŸª’","ğŸ§µ","ğŸ§¶","ğŸªœ","ğŸ”‘","ğŸ—ï¸","ğŸ”¨","ğŸ”«","ğŸ›¡ï¸","ğŸ¹","ğŸ—¡ï¸","âš”ï¸","ğŸ’£","ğŸ§¨","ğŸš¬","âš°ï¸","ğŸª¦","âš±ï¸","ğŸº","ğŸ”®","ğŸ“¿","ğŸ§¿","ğŸ’ˆ"]},{id:"symbols",name:"Symbols",icon:'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 12h2"></path><path d="M12 11v2"></path><circle cx="12" cy="12" r="10"></circle></svg>',emojis:["â¤ï¸","ğŸ§¡","ğŸ’›","ğŸ’š","ğŸ’™","ğŸ’œ","ğŸ–¤","ğŸ¤","ğŸ¤","ğŸ’”","â£ï¸","ğŸ’•","ğŸ’","ğŸ’“","ğŸ’—","ğŸ’–","ğŸ’˜","ğŸ’","ğŸ’Ÿ","â˜®ï¸","âœï¸","â˜ªï¸","ğŸ•‰ï¸","â˜¸ï¸","âœ¡ï¸","ğŸ”¯","ğŸ•","â˜¯ï¸","â˜¦ï¸","ğŸ›","â›","â™ˆ","â™‰","â™Š","â™‹","â™Œ","â™","â™","â™","â™","â™‘","â™’","â™“","ğŸ†”","âš›ï¸","ğŸ‰‘","â˜¢ï¸","â˜£ï¸","ğŸ“´","ğŸ“³","ğŸˆ¶","ğŸˆš","ğŸˆ¸","ğŸˆº","ğŸˆ·ï¸","âœ´ï¸","ğŸ†š","ğŸ’®","ğŸ‰","ãŠ™ï¸","ãŠ—ï¸","ğŸˆ´","ğŸˆµ","ğŸˆ¹","ğŸˆ²","ğŸ…°ï¸","ğŸ…±ï¸","ğŸ†","ğŸ†‘","ğŸ…¾ï¸","ğŸ†˜","âŒ","â­•","ğŸ›‘","â›”","ğŸ“›","ğŸš«","ğŸ’¯","ğŸ’¢","â™¨ï¸","ğŸš·","ğŸš¯","ğŸš³","ğŸš±","ğŸ”","ğŸ“µ","ğŸš­","â—","â•","â“","â”","â€¼ï¸","â‰ï¸","ğŸ”…","ğŸ”†","âš ï¸","ğŸš¸","ğŸ”±","âšœï¸","ğŸ”°","â™»ï¸","âœ…","ğŸˆ¯","ğŸ’¹","â‡ï¸","âœ³ï¸","â","ğŸŒ","ğŸ’ ","â“‚ï¸","ğŸŒ€","ğŸ’¤","ğŸ§","ğŸš¾","â™¿","ğŸ…¿ï¸","ğŸ›—","ğŸˆ³","ğŸˆ‚ï¸","ğŸ›‚","ğŸ›ƒ","ğŸ›„","ğŸ›…"]}];function ve(n){if(!n)return"";const s=n.split(" ").filter(Boolean),l=s[0]?s[0][0]:"",m=s.length>1?s[s.length-1][0]:"";return(l+m).toUpperCase()}function he(n){return!n||typeof n!="object"||n.blockedByOther?"User unavailable":n.name||"Unknown"}function ne(n){return!!(n&&(n.blocked||n.blockedByOther))}function _t(n){if(!n)return"";const s=new Date(n);return Number.isNaN(s.getTime())?"":s.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}function na(n){if(!n)return"";const s=new Date(n);return Number.isNaN(s.getTime())?"":s.toLocaleDateString([],{month:"short",day:"numeric"})}function tt(n){if(!n)return"";const s=new Date(n);return Number.isNaN(s.getTime())?"":s.toLocaleString([],{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}function zt(n){const s=String(n||"").trim();return s?s.split(/[_\s-]+/).filter(Boolean).map(l=>l.charAt(0).toUpperCase()+l.slice(1).toLowerCase()).join(" "):"Status unavailable"}function Ht(n){const s=String(n||"").trim().toLowerCase();return s==="resolved"||s==="closed"||s==="complete"||s==="completed"||s==="done"?"success":s==="rejected"||s==="dismissed"||s==="denied"?"danger":s==="open"||s==="pending"||s==="in_review"||s==="in review"||s==="under_review"||s==="under review"?"warning":""}function Ft(n,s){return n.getFullYear()===s.getFullYear()&&n.getMonth()===s.getMonth()&&n.getDate()===s.getDate()}function aa(n){const s=new Date(n);if(Number.isNaN(s.getTime()))return"";const l=new Date,m=new Date;return m.setDate(l.getDate()-1),Ft(s,l)?"Today":Ft(s,m)?"Yesterday":s.toLocaleDateString([],{month:"short",day:"numeric"})}function sa(n){const s=[];let l="";return n.forEach(m=>{const u=m.timestamp.slice(0,10);u!==l&&(s.push({type:"day",id:`day-${u}`,label:aa(m.timestamp)}),l=u),s.push({type:"message",id:m.id,message:m})}),s}function la(n){return n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function ra(n,s){if(!s)return n;const l=la(s);return n.split(new RegExp(`(${l})`,"ig")).map((u,E)=>u.toLowerCase()===s.toLowerCase()?e.createElement("mark",{key:E,className:"msg-highlight"},u):e.createElement("span",{key:E},u))}function oa(n,s,l){const m=(l==null?void 0:l.selectionStart)??n.length,u=(l==null?void 0:l.selectionEnd)??m;return{nextValue:n.slice(0,m)+s+n.slice(u),caret:m+s.length}}function at(n,s,l){i.useEffect(()=>{if(!l)return;const m=u=>{!n.current||n.current.contains(u.target)||s()};return document.addEventListener("mousedown",m),document.addEventListener("touchstart",m),()=>{document.removeEventListener("mousedown",m),document.removeEventListener("touchstart",m)}},[n,s,l])}function O({children:n,size:s=20,className:l}){return e.createElement("svg",{className:l,width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.8",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true"},n)}const ca=n=>e.createElement(O,{...n},e.createElement("circle",{cx:"12",cy:"5",r:"1.6",fill:"currentColor",stroke:"none"}),e.createElement("circle",{cx:"12",cy:"12",r:"1.6",fill:"currentColor",stroke:"none"}),e.createElement("circle",{cx:"12",cy:"19",r:"1.6",fill:"currentColor",stroke:"none"})),Wt=n=>e.createElement(O,{...n},e.createElement("circle",{cx:"11",cy:"11",r:"6.5"}),e.createElement("line",{x1:"16.5",y1:"16.5",x2:"21",y2:"21"})),ia=n=>e.createElement(O,{...n},e.createElement("rect",{x:"5",y:"11",width:"14",height:"9",rx:"2"}),e.createElement("path",{d:"M8 11V8a4 4 0 0 1 8 0v3"})),ma=n=>e.createElement(O,{...n},e.createElement("path",{d:"M6 18l-2.5 3.5V6.5A2.5 2.5 0 0 1 6 4h12a2.5 2.5 0 0 1 2.5 2.5V14A2.5 2.5 0 0 1 18 16.5H7.8L6 18Z"})),da=n=>e.createElement(O,{...n},e.createElement("path",{d:"M3 12l17-7-7 17-2-6-8-4Z"})),ua=n=>e.createElement(O,{...n},e.createElement("circle",{cx:"12",cy:"12",r:"9"}),e.createElement("circle",{cx:"9",cy:"10",r:"1",fill:"currentColor",stroke:"none"}),e.createElement("circle",{cx:"15",cy:"10",r:"1",fill:"currentColor",stroke:"none"}),e.createElement("path",{d:"M8 15c1.2 1.3 2.6 2 4 2s2.8-.7 4-2"})),fa=n=>e.createElement(O,{...n},e.createElement("path",{d:"M7.5 12.5l6.8-6.8a3 3 0 0 1 4.3 4.3l-7.5 7.5a4.5 4.5 0 0 1-6.4-6.4l7.2-7.2"})),ha=n=>e.createElement(O,{...n},e.createElement("polyline",{points:"5 12 9 16 19 6"})),pa=n=>e.createElement(O,{...n},e.createElement("polyline",{points:"2 12 6 16 12 10"}),e.createElement("polyline",{points:"8 12 12 16 22 6"})),va=n=>e.createElement(O,{...n},e.createElement("path",{d:"M4 11.5 12 4l8 7.5"}),e.createElement("path",{d:"M6 10.5V20h12v-9.5"})),ga=n=>e.createElement(O,{...n},e.createElement("rect",{x:"4",y:"4",width:"16",height:"5"}),e.createElement("rect",{x:"5",y:"9",width:"14",height:"11"}),e.createElement("line",{x1:"9",y1:"13",x2:"15",y2:"13"})),Yt=n=>e.createElement(O,{...n},e.createElement("path",{d:"M5 4v16"}),e.createElement("path",{d:"M5 4h12l-2.2 4L17 12H5"})),pe=n=>e.createElement(O,{...n},e.createElement("circle",{cx:"12",cy:"12",r:"9"}),e.createElement("line",{x1:"7",y1:"17",x2:"17",y2:"7"})),Ea=n=>e.createElement(O,{...n},e.createElement("circle",{cx:"12",cy:"8",r:"3.2"}),e.createElement("path",{d:"M4.5 19.5c1.9-3 4.5-4.5 7.5-4.5s5.6 1.5 7.5 4.5"})),Zt=n=>e.createElement(O,{...n},e.createElement("path",{d:"M4 7h16"}),e.createElement("path",{d:"M9 7V5h6v2"}),e.createElement("path",{d:"M7 7l1 12h8l1-12"}),e.createElement("path",{d:"M10 11v6"}),e.createElement("path",{d:"M14 11v6"})),ba=n=>e.createElement(O,{...n},e.createElement("path",{d:"M9 4h-4v16h4"}),e.createElement("path",{d:"M16 12H7"}),e.createElement("path",{d:"M13 9l3 3-3 3"})),Re=n=>e.createElement(O,{...n},e.createElement("line",{x1:"5",y1:"5",x2:"19",y2:"19"}),e.createElement("line",{x1:"19",y1:"5",x2:"5",y2:"19"}));function qt({ariaLabel:n,items:s}){const[l,m]=i.useState(!1),u=i.useRef(null);return at(u,()=>m(!1),l),e.createElement("div",{className:"menu-wrap",ref:u},e.createElement("button",{className:"icon-btn","aria-label":n,"aria-haspopup":"menu","aria-expanded":l,onClick:()=>m(E=>!E),type:"button"},e.createElement(ca,null)),l?e.createElement("div",{className:"dropdown",role:"menu"},s.map(E=>e.createElement("button",{key:E.label,className:"dropdown-item",role:"menuitem",type:"button",onClick:()=>{m(!1),E.onSelect()}},E.label))):null)}function ya({status:n}){if(!n)return null;if(n==="sent")return e.createElement(ha,{className:"status-icon"});const s=n==="read"?"status-icon read":"status-icon";return e.createElement(pa,{className:s})}function ka({open:n,title:s,message:l,confirmLabel:m,onConfirm:u,onCancel:E}){return n?e.createElement("div",{className:"panel-backdrop",role:"dialog","aria-modal":"true","aria-label":s},e.createElement("div",{className:"confirm-dialog"},e.createElement("h3",null,s),e.createElement("p",null,l),e.createElement("div",{className:"confirm-actions"},e.createElement("button",{className:"ghost-btn",type:"button",onClick:E},"Cancel"),e.createElement("button",{className:"primary-btn",type:"button",onClick:u},m)))):null}function Na({open:n,title:s,message:l,confirmLabel:m="Delete",onConfirm:u,onCancel:E}){return n?e.createElement("div",{className:"panel-backdrop",role:"dialog","aria-modal":"true","aria-label":s},e.createElement("div",{className:"confirm-dialog"},e.createElement("h3",null,s),e.createElement("p",null,l),e.createElement("div",{className:"confirm-actions"},e.createElement("button",{className:"ghost-btn",type:"button",onClick:E},"Cancel"),e.createElement("button",{className:"primary-btn",type:"button",onClick:u},m)))):null}function Ca({open:n,onClose:s,currentUser:l}){if(!n)return null;const m={...le,...l&&typeof l=="object"?l:{}},u=m.name||"User";return e.createElement("div",{className:"panel-backdrop",role:"dialog","aria-modal":"true","aria-label":"Profile panel"},e.createElement("div",{className:"profile-panel"},e.createElement("div",{className:"panel-header"},e.createElement("h2",null,"Profile"),e.createElement("button",{className:"icon-btn","aria-label":"Close profile",onClick:s,type:"button"},e.createElement(Re,null))),e.createElement("div",{className:"profile-hero"},e.createElement("div",{className:"avatar large",style:{backgroundColor:"#2f9e8f"}},ve(u)),e.createElement("div",null,e.createElement("h3",null,u))),e.createElement("div",{className:"profile-section"},e.createElement("h4",null,"Details"),e.createElement("p",null,"First name: ",m.firstName||"-"),e.createElement("p",null,"Family name: ",m.lastName||"-"),e.createElement("p",null,"Suburb: ",m.suburb||"-"),e.createElement("p",null,"City: ",m.city||"-"),e.createElement("p",null,"Province: ",m.province||"-"),e.createElement("p",null,"Account since: ",m.accountSince||"-"))))}function wa({open:n,onClose:s,chat:l,onDelete:m,onBlock:u,onReport:E}){if(!n||!l)return null;const p=!!l.blockedByOther,D=he(l),x=l.name?l.name.split(" ").filter(Boolean):[],f=x[0]||"",M=x.slice(1).join(" "),N=p?"-":l.firstName||f||"-",v=p?"-":l.lastName||M||"-",y=p?"-":l.suburb||"-",R=p?"-":l.city||"-",d=p?"-":l.province||"-",j=p?"-":l.accountSince||"-",k=p?"-":l.accountType||"Standard";return e.createElement("div",{className:"panel-backdrop",role:"dialog","aria-modal":"true","aria-label":"Chat profile"},e.createElement("div",{className:"profile-panel"},e.createElement("div",{className:"panel-header"},e.createElement("h2",null,"Chat Profile"),e.createElement("button",{className:"icon-btn","aria-label":"Close profile",onClick:s,type:"button"},e.createElement(Re,null))),e.createElement("div",{className:"profile-hero"},e.createElement("div",{className:"avatar large",style:{backgroundColor:l.color}},ne(l)?e.createElement(pe,{className:"avatar-blocked-icon",size:18}):ve(D)),e.createElement("div",null,e.createElement("h3",null,D))),e.createElement("div",{className:"profile-section"},e.createElement("h4",null,"Details"),e.createElement("p",null,"First name: ",N),e.createElement("p",null,"Family name: ",v),e.createElement("p",null,"Suburb: ",y),e.createElement("p",null,"City: ",R),e.createElement("p",null,"Province: ",d),e.createElement("p",null,"Account since: ",j),e.createElement("p",null,"Account type: ",k)),e.createElement("div",{className:"profile-section"},e.createElement("h4",null,"Actions"),e.createElement("div",{className:"profile-action-row"},e.createElement("button",{className:"profile-btn danger",type:"button",onClick:m},e.createElement(Zt,null),"Delete"),p?null:e.createElement(e.Fragment,null,e.createElement("button",{className:"profile-btn warn",type:"button",onClick:u},e.createElement(pe,null),l.blocked?"Unblock":"Block"),e.createElement("button",{className:"profile-btn",type:"button",onClick:E},e.createElement(Yt,null),"Report"))))))}function nt({title:n,subtitle:s}){return e.createElement("div",{className:"empty-state"},e.createElement("h3",null,n),e.createElement("p",null,s))}function Sa(){const n=Array.from({length:7}),s=Array.from({length:5});return e.createElement("div",{className:"chat-loading-overlay desktop",role:"status","aria-live":"polite"},e.createElement("div",{className:"chat-loading-desktop-shell"},e.createElement("aside",{className:"chat-loading-desktop-sidebar"},e.createElement("div",{className:"chat-loading-desktop-header"},e.createElement("div",{className:"chat-loading-sk chat-loading-desktop-logo"}),e.createElement("div",{className:"chat-loading-sk chat-loading-desktop-circle"})),e.createElement("div",{className:"chat-loading-desktop-search"},e.createElement("div",{className:"chat-loading-sk chat-loading-desktop-search-box"})),e.createElement("div",{className:"chat-loading-desktop-list"},n.map((l,m)=>e.createElement("div",{className:"chat-loading-desktop-thread",key:m},e.createElement("div",{className:"chat-loading-sk chat-loading-desktop-avatar"}),e.createElement("div",{className:"chat-loading-desktop-thread-meta"},e.createElement("div",{className:"chat-loading-sk chat-loading-desktop-line lg"}),e.createElement("div",{className:"chat-loading-sk chat-loading-desktop-line sm"})),e.createElement("div",{className:"chat-loading-sk chat-loading-desktop-time"}))))),e.createElement("section",{className:"chat-loading-desktop-chat"},e.createElement("div",{className:"chat-loading-desktop-chat-header"},e.createElement("div",{className:"chat-loading-desktop-chat-user"},e.createElement("div",{className:"chat-loading-sk chat-loading-desktop-avatar"}),e.createElement("div",{className:"chat-loading-desktop-thread-meta"},e.createElement("div",{className:"chat-loading-sk chat-loading-desktop-line lg"}),e.createElement("div",{className:"chat-loading-sk chat-loading-desktop-line sm"}))),e.createElement("div",{className:"chat-loading-desktop-chat-actions"},e.createElement("div",{className:"chat-loading-sk chat-loading-desktop-circle"}),e.createElement("div",{className:"chat-loading-sk chat-loading-desktop-circle"}),e.createElement("div",{className:"chat-loading-sk chat-loading-desktop-circle"}))),e.createElement("div",{className:"chat-loading-desktop-messages"},e.createElement("div",{className:"chat-loading-sk chat-loading-desktop-day"}),s.map((l,m)=>e.createElement("div",{className:`chat-loading-desktop-bubble-row ${m%2?"me":"them"}`,key:m},e.createElement("div",{className:"chat-loading-desktop-bubble"},e.createElement("div",{className:"chat-loading-sk chat-loading-desktop-line lg"}),e.createElement("div",{className:"chat-loading-sk chat-loading-desktop-line sm"}),e.createElement("div",{className:"chat-loading-sk chat-loading-desktop-meta"}))))),e.createElement("div",{className:"chat-loading-desktop-composer"},e.createElement("div",{className:"chat-loading-sk chat-loading-desktop-circle"}),e.createElement("div",{className:"chat-loading-sk chat-loading-desktop-circle"}),e.createElement("div",{className:"chat-loading-sk chat-loading-desktop-input"}),e.createElement("div",{className:"chat-loading-sk chat-loading-desktop-circle"})))))}function st({title:n,subtitle:s,children:l}){return e.createElement("div",{className:"section-panel"},e.createElement("div",{className:"section-header"},e.createElement("div",null,e.createElement("h2",null,n),s?e.createElement("p",{className:"muted"},s):null)),e.createElement("div",{className:"section-card"},l))}function Ia({currentUser:n}){const s={...le,...n&&typeof n=="object"?n:{}},l=s.name||"User";return e.createElement(st,{title:"My Profile",subtitle:""},e.createElement("div",{className:"profile-card"},e.createElement("div",{className:"profile-card-hero"},e.createElement("div",{className:"avatar large",style:{backgroundColor:"#0f766e"}},ve(l)),e.createElement("div",null,e.createElement("h3",null,l))),e.createElement("div",{className:"profile-section"},e.createElement("h4",null,"Details"),e.createElement("p",null,"First name: ",s.firstName||"-"),e.createElement("p",null,"Family name: ",s.lastName||"-"),e.createElement("p",null,"Suburb: ",s.suburb||"-"),e.createElement("p",null,"City: ",s.city||"-"),e.createElement("p",null,"Province: ",s.province||"-"),e.createElement("p",null,"Account since: ",s.accountSince||"-")),e.createElement("div",{className:"profile-actions"},e.createElement("button",{className:"manage-profile-btn",type:"button","data-link":"manage-profile"},"Manage Profile"))))}function Ta({chats:n,onUnblock:s}){return e.createElement(st,{title:"Blocked Accounts",subtitle:"People and businesses you blocked."},n.length===0?e.createElement("div",{className:"section-empty"},"No blocked accounts."):e.createElement("div",{className:"section-list"},n.map(l=>e.createElement("div",{key:l.id,className:"section-item"},e.createElement("div",{className:"section-item-info"},e.createElement("div",{className:"avatar",style:{backgroundColor:l.color}},e.createElement(pe,{className:"avatar-blocked-icon",size:16})),e.createElement("div",{className:"section-item-text"},e.createElement("div",{className:"section-item-name"},l.name))),e.createElement("div",{className:"section-item-meta"},e.createElement("span",{className:"section-tag danger"},"Blocked"),e.createElement("span",null,na(l.blockedAt||l.lastTime)),e.createElement("button",{className:"section-action",type:"button",onClick:()=>s(l.id)},"Unblock"))))))}function xa({reports:n,onOpenReport:s}){return e.createElement(st,{title:"Reports",subtitle:"Reports you submitted."},n.length===0?e.createElement("div",{className:"section-empty"},"No reports found."):e.createElement("div",{className:"section-list"},n.map(l=>e.createElement("div",{key:l.id,className:"section-item"},e.createElement("div",{className:"section-item-info"},e.createElement("div",{className:"avatar",style:{backgroundColor:l.color||"#3b5bdb"}},ve(l.name)),e.createElement("div",{className:"section-item-text"},e.createElement("div",{className:"section-item-name"},l.name),e.createElement("div",{className:"section-item-sub"},l.context||"No reason provided."))),e.createElement("div",{className:"section-item-meta"},e.createElement("span",{className:`section-tag ${Ht(l.status)}`},zt(l.status)),e.createElement("span",null,tt(l.createdAt)||"Date unavailable"),e.createElement("button",{className:"section-action",type:"button",onClick:()=>s(l)},"View report"))))))}function Aa({open:n,report:s,onClose:l}){return!n||!s?null:e.createElement("div",{className:"panel-backdrop",role:"dialog","aria-modal":"true","aria-label":"Report details"},e.createElement("div",{className:"report-details-dialog"},e.createElement("div",{className:"report-details-header"},e.createElement("div",null,e.createElement("div",{className:"report-details-title"},"Report details"),e.createElement("div",{className:"report-sub"},"Submitted information from your report.")),e.createElement("button",{type:"button",className:"report-details-close",onClick:l,"aria-label":"Close report details"},e.createElement(Re,{size:18}))),e.createElement("div",{className:"report-details-grid"},e.createElement("div",{className:"report-details-field"},e.createElement("div",{className:"report-details-label"},"Reported account"),e.createElement("div",{className:"report-details-value"},s.name||"Unknown")),e.createElement("div",{className:"report-details-field"},e.createElement("div",{className:"report-details-label"},"Status"),e.createElement("div",{className:`section-tag ${Ht(s.status)}`},zt(s.status))),e.createElement("div",{className:"report-details-field"},e.createElement("div",{className:"report-details-label"},"Sent"),e.createElement("div",{className:"report-details-value"},tt(s.createdAt)||"Not available")),e.createElement("div",{className:"report-details-field"},e.createElement("div",{className:"report-details-label"},"Admin reply time"),e.createElement("div",{className:"report-details-value"},tt(s.adminReplyAt)||"Not available"))),e.createElement("div",{className:"report-details-field"},e.createElement("div",{className:"report-details-label"},"Reason"),e.createElement("div",{className:"report-details-value report-details-reason"},s.context||"No reason provided.")),e.createElement("div",{className:"report-details-field"},e.createElement("div",{className:"report-details-label"},"Admin reply"),e.createElement("div",{className:"report-details-value report-details-reason"},s.adminReply||"No admin reply yet."))))}function Ba({open:n,onClose:s,reasons:l,value:m,onChange:u,details:E,onDetailsChange:p,onSubmit:D,targetName:x}){const[f,M]=i.useState(!1),N=i.useRef(null),v=l.find(y=>y.value===m);return at(N,()=>M(!1),f),i.useEffect(()=>{n||M(!1)},[n]),n?e.createElement("div",{className:"panel-backdrop",role:"dialog","aria-modal":"true","aria-label":"Report"},e.createElement("div",{className:"report-dialog"},e.createElement("div",{className:"report-title"},"Quick report"),e.createElement("div",{className:"report-sub"},"Select a reason for reporting ",x||"this chat","."),e.createElement("div",{className:`report-select${f?" active":""}`,ref:N},e.createElement("button",{className:"report-select__trigger",type:"button",onClick:()=>M(y=>!y),"aria-haspopup":"listbox","aria-expanded":f},e.createElement("span",null,v?v.label:"Choose a reason"),e.createElement("span",{className:"report-select__caret"},"â–¾")),e.createElement("div",{className:"report-select__options",role:"listbox"},l.map(y=>e.createElement("button",{key:y.value,type:"button",className:`report-select__option${m===y.value?" selected":""}`,onClick:()=>{u(y.value),M(!1)},role:"option","aria-selected":m===y.value},y.label)))),e.createElement("textarea",{className:"report-textarea",placeholder:"Optional details",value:E,onChange:y=>p(y.target.value)}),e.createElement("div",{className:"report-actions"},e.createElement("button",{className:"ghost-btn",type:"button",onClick:s},"Cancel"),e.createElement("button",{className:"primary-btn",type:"button",onClick:D,disabled:!m},"Report")))):null}function Da({chats:n,searchValue:s,onSearchChange:l,activeChatId:m,onOpenChat:u,onMenuAction:E,emptyTitle:p="No chats yet",emptySubtitle:D="Start a new chat to compare prices.",showSearch:x=!0}){return e.createElement("div",{className:"chat-list-screen"},x?e.createElement("div",{className:"search-bar"},e.createElement(Wt,{className:"search-icon"}),e.createElement("input",{type:"search",value:s,onChange:f=>l(f.target.value),placeholder:"Search chats or messages","aria-label":"Search chats"})):null,e.createElement("div",{className:"chat-list",role:"list"},n.length===0?e.createElement(nt,{title:p,subtitle:D}):n.map(f=>{const M=he(f),N=[{label:f.archived?"Unarchive chat":"Archive chat",onSelect:()=>E(f.id,f.archived?"unarchive":"archive")},{label:"Delete chat",onSelect:()=>E(f.id,"delete")},{label:"Report",onSelect:()=>E(f.id,"report")}];return e.createElement("div",{key:f.id,className:`chat-item ${m===f.id?"active":""}`,role:"listitem"},e.createElement("button",{className:"chat-open",onClick:()=>u(f.id),type:"button","aria-label":`Open chat with ${M}`},e.createElement("div",{className:"chat-avatar"},e.createElement("div",{className:"avatar",style:{backgroundColor:f.color}},ne(f)?e.createElement(pe,{className:"avatar-blocked-icon",size:16}):ve(f.name)),f.online?e.createElement("span",{className:"status-dot","aria-hidden":"true"}):null),e.createElement("div",{className:"chat-body"},e.createElement("div",{className:"chat-row"},e.createElement("span",{className:"chat-name"},M),e.createElement("span",{className:"chat-time"},_t(f.lastTime))),e.createElement("div",{className:"chat-row chat-preview"},e.createElement("span",{className:"chat-message"},f.lastMessage?f.lastMessage:"No messages yet"),e.createElement("span",{className:"chat-flags"},f.unread>0?e.createElement("span",{className:"chat-unread"},f.unread):null)))),e.createElement(qt,{ariaLabel:"Chat options",items:N}))})))}function Ma({message:n,query:s,onPreviewImage:l}){const m=n.sender==="me",u=typeof n.attachmentUrl=="string"?n.attachmentUrl:"",E=typeof n.attachmentType=="string"?n.attachmentType.toLowerCase():"",p=typeof n.attachmentName=="string"&&n.attachmentName?n.attachmentName:"Attachment",D=!!n.attachmentIsImage||E.startsWith("image/"),x=!!n.attachmentIsVideo||E.startsWith("video/"),f=typeof n.text=="string"&&n.text.trim().length>0,M={width:"100%",maxWidth:"260px",borderRadius:"10px",display:"block",marginBottom:f?"8px":"0"};return e.createElement("div",{className:`message-row ${m?"me":"them"}`},e.createElement("div",{className:`message-bubble ${m?"outgoing":"incoming"}`},u?e.createElement("div",{className:"message-attachment"},D?e.createElement("button",{className:"message-image-trigger",type:"button",onClick:()=>{l&&l(n)},"aria-label":`Preview ${p}`},e.createElement("img",{src:u,alt:p,loading:"lazy",style:M})):x?e.createElement("video",{controls:!0,preload:"metadata",style:M},e.createElement("source",{src:u,type:E||void 0})):e.createElement("a",{href:u,target:"_blank",rel:"noreferrer"},"Open attachment")):null,f?e.createElement("div",{className:"message-text"},ra(n.text,s)):null,e.createElement("div",{className:"message-meta"},e.createElement("span",null,_t(n.timestamp)),m?e.createElement(ya,{status:n.status}):null)))}function Ra({preview:n,onClose:s,onSave:l,onReport:m}){return n?e.createElement("div",{className:"attachment-preview-panel",role:"region","aria-label":"Photo preview"},e.createElement("div",{className:"attachment-preview-head"},e.createElement("div",{className:"attachment-preview-title"},"Photo preview"),e.createElement("button",{className:"icon-btn",type:"button",onClick:s,"aria-label":"Close preview"},e.createElement(Re,null))),e.createElement("div",{className:"attachment-preview-stage"},e.createElement("img",{src:n.url,alt:n.name||"Image preview",loading:"eager"})),e.createElement("div",{className:"attachment-preview-meta"},n.name||"Image"),e.createElement("div",{className:"attachment-preview-actions"},e.createElement("button",{className:"primary-btn",type:"button",onClick:l},"Save"),e.createElement("button",{className:"ghost-btn",type:"button",onClick:m},"Report Photo"))):null}function Pa(){return e.createElement("div",{className:"message-row them"},e.createElement("div",{className:"typing-bubble"},e.createElement("span",{className:"typing-label"},"typing"),e.createElement("div",{className:"typing-dots","aria-hidden":"true"},e.createElement("span",null),e.createElement("span",null),e.createElement("span",null))))}function La(){const n=[!1,!0,!1,!0,!1];return e.createElement("div",{className:"conversation-loading",role:"status","aria-live":"polite","aria-label":"Loading messages"},n.map((s,l)=>e.createElement("div",{key:l,className:`conversation-loading-row ${s?"me":"them"}`},e.createElement("div",{className:"conversation-loading-bubble"},e.createElement("div",{className:"chat-loading-sk conversation-loading-line lg"}),e.createElement("div",{className:"chat-loading-sk conversation-loading-line md"}),e.createElement("div",{className:"chat-loading-sk conversation-loading-line sm"})))))}function ja({value:n,onChange:s,onSend:l,onEmoji:m,onAttach:u,inputRef:E,disabled:p=!1}){const D=x=>{x.key==="Enter"&&!x.shiftKey&&(x.preventDefault(),!p&&n.trim()&&l())};return e.createElement("div",{className:"composer"},e.createElement("div",{className:"composer-actions"},e.createElement("button",{className:"icon-btn",type:"button",onClick:m,"aria-label":"Emoji",disabled:p},e.createElement(ua,null)),e.createElement("button",{className:"icon-btn",type:"button",onClick:u,"aria-label":"Attach",disabled:p},e.createElement(fa,null))),e.createElement("textarea",{ref:E,rows:1,value:n,onChange:x=>s(x.target.value),onKeyDown:D,placeholder:p?"Unblock to send messages":"Type a message","aria-label":"Message input",disabled:p}),e.createElement("button",{className:"send-btn",type:"button",onClick:l,disabled:p||!n.trim(),"aria-label":"Send message"},e.createElement(da,null)))}function Oa({open:n,recents:s,onSelect:l,onClose:m}){const[u,E]=i.useState("recent"),p=i.useRef(null),D=i.useRef(null),x=i.useRef({});at(D,m,n);const f=i.useMemo(()=>Vt.map(v=>v.id==="recent"?{...v,emojis:s}:v),[s]);i.useEffect(()=>{var y;if(!n)return;const v=((y=f[0])==null?void 0:y.id)||"recent";E(v),p.current&&(p.current.scrollTop=0)},[n,f]);const M=()=>{const v=p.current;if(!v)return;let y=u;f.forEach(R=>{const d=x.current[R.id];d&&v.scrollTop>=d.offsetTop-40&&(y=R.id)}),y!==u&&E(y)},N=v=>{const y=x.current[v];y&&(y.scrollIntoView({behavior:"smooth",block:"start"}),E(v))};return n?e.createElement("div",{className:"emoji-popover","aria-live":"polite"},e.createElement("div",{className:"emoji-picker fade-in",ref:D},e.createElement("div",{className:"picker-header"},e.createElement("div",{className:"category-tabs",role:"tablist"},f.map(v=>e.createElement("button",{key:v.id,type:"button",className:`category-tab ${u===v.id?"active":""}`,onClick:()=>N(v.id),"aria-label":v.name,"aria-pressed":u===v.id,ref:y=>{if(y&&v.icon){const d=new DOMParser().parseFromString(v.icon,"text/html").body.firstChild;d&&y.firstChild!==d&&(y.innerHTML="",y.appendChild(document.importNode(d,!0)))}}})))),e.createElement("div",{className:"emoji-list",onScroll:M,ref:p},f.length===0?e.createElement("div",{className:"emoji-empty"},"No emojis found."):f.map(v=>e.createElement("div",{key:v.id,className:"category-section",ref:y=>{x.current[v.id]=y}},e.createElement("div",{className:"category-title"},v.name),e.createElement("div",{className:"emoji-grid"},v.emojis.map((y,R)=>e.createElement("button",{key:`${v.id}-${R}`,type:"button",className:"emoji-item",onClick:()=>l(y),"aria-label":"Emoji"},y)))))))):null}function Ua({chat:n,groupedMessages:s,searchValue:l,showSearch:m,onToggleSearch:u,onSearchChange:E,onSend:p,composerValue:D,onComposerChange:x,onEmoji:f,onAttach:M,emojiOpen:N,emojiRecents:v,onEmojiSelect:y,onEmojiClose:R,composerRef:d,typing:j,conversationLoading:k,messageListRef:J,matchCount:Q,onMenuAction:q,attachmentPreview:G,onOpenAttachmentPreview:ae,onCloseAttachmentPreview:Pe,onSaveAttachmentPreview:re,onReportAttachmentPreview:oe}){if(!n)return e.createElement("div",{className:"conversation empty-view"},e.createElement(nt,{title:"Select a chat",subtitle:"Choose a conversation to see messages and compare prices."}));if(G)return e.createElement("div",{className:"conversation attachment-only-view"},e.createElement(Ra,{preview:G,onClose:Pe,onSave:re,onReport:oe}));const ce=he(n),Ne=!!n.launchPending,ge=Ne?[{label:"Close chat",onSelect:()=>q("close")}]:[{label:"View profile",onSelect:()=>q("profile")},{label:"Close chat",onSelect:()=>q("close")},{label:"Delete chat",onSelect:()=>q("delete")},{label:"Block",onSelect:()=>q("block")},{label:"Report",onSelect:()=>q("report")}];return e.createElement("div",{className:"conversation"},e.createElement("div",{className:"conversation-header"},e.createElement("div",{className:"conversation-title"},e.createElement("div",{className:"avatar",style:{backgroundColor:n.color}},ne(n)?e.createElement(pe,{className:"avatar-blocked-icon",size:16}):ve(n.name)),e.createElement("div",{className:"conversation-title-text"},e.createElement("div",{className:"conversation-name"},ce),e.createElement("div",{className:"conversation-status"},Ne?e.createElement("span",null,"Start conversation"):j?e.createElement("span",null,"Typing..."):e.createElement(e.Fragment,null,n.online?e.createElement("span",{className:"presence-dot"}):null,e.createElement("span",null,n.online?"online":n.presence))))),e.createElement("div",{className:"conversation-actions"},e.createElement(qt,{ariaLabel:"Conversation menu",items:ge}))),m?e.createElement("div",{className:"conversation-search"},e.createElement(Wt,{className:"search-icon"}),e.createElement("input",{type:"search",value:l,onChange:K=>E(K.target.value),placeholder:"Search in conversation","aria-label":"Search within conversation"}),l?e.createElement("span",{className:"search-count"},Q," match",Q===1?"":"es"):null):null,e.createElement("div",{className:"conversation-scroll",ref:J},e.createElement("div",{className:"security-banner"},e.createElement(ia,null),e.createElement("div",null,"Messages are end-to-end encrypted. No one outside of this chat can read or listen to them.")),k?e.createElement(La,null):s.length===0?e.createElement(nt,{title:l?"No matches":"No messages yet",subtitle:l?"Try a different phrase.":"Send a message to start the chat."}):s.map(K=>K.type==="day"?e.createElement("div",{key:K.id,className:"day-separator"},K.label):e.createElement(Ma,{key:K.id,message:K.message,query:l.trim(),onPreviewImage:ae})),j&&!l&&!k?e.createElement(Pa,null):null,!k&&ne(n)?e.createElement("div",{className:"blocked-notice",role:"note"},n.blockedByOther?"You cannot message this account.":"You blocked this account. Unblock to send messages."):null),e.createElement(ja,{value:D,onChange:x,onSend:p,onEmoji:f,onAttach:M,inputRef:d,disabled:ne(n)}),e.createElement(Oa,{open:N,recents:v,onSelect:y,onClose:R}))}function $a({currentUser:n=le,initialChats:s=Kn,initialMessages:l=Jn}){const m={...le,...n&&typeof n=="object"?n:{}},u=Array.isArray(s)?s:[],E=l&&typeof l=="object"?l:{},p=i.useMemo(()=>ea(),[]),D=!!(p.conversationId||p.recipientId),x=i.useRef(!D),[f,M]=i.useState("chats"),[N,v]=i.useState(u),[y,R]=i.useState(E),[d,j]=i.useState(null),[k,J]=i.useState(p.recipientId?{id:p.recipientId,name:p.recipientName||"Business"}:null),[Q,q]=i.useState(""),[G,ae]=i.useState(""),[Pe,re]=i.useState(!1),[oe,ce]=i.useState(""),[Ne,ge]=i.useState(!1),[K,Kt]=i.useState(()=>{var t;return((t=Vt[0])==null?void 0:t.emojis)||[]}),[lt,Ee]=i.useState(!1),[Jt,Qt]=i.useState(!1),[Va,rt]=i.useState(null),[ot,Le]=i.useState(!1),[Gt,ct]=i.useState(!1),[H,it]=i.useState(null),[mt,Ce]=i.useState([]),[je,Oe]=i.useState([]),[Ue,dt]=i.useState(!1),[X,$e]=i.useState(null),[Xt,Fe]=i.useState(!1),[we,Se]=i.useState(""),[ut,Ie]=i.useState(""),[ie,Ve]=i.useState(null),[V,_e]=i.useState(null),[ze,ft]=i.useState(!1),[en,Te]=i.useState(null),[xe,He]=i.useState({sessionId:"",sessionCsrf:"",userId:"",realtimeToken:""}),[ht,pt]=i.useState(m),[me,vt]=i.useState({open:!1,title:"",message:"",confirmLabel:"Delete",onConfirm:null}),[de,gt]=i.useState({open:!1,title:"",message:"",confirmLabel:"Confirm",onConfirm:null}),Et=i.useRef(null),be=i.useRef(null),We=i.useRef(null),ye=i.useRef(null),se=i.useRef(null),ee=i.useRef(null),U=i.useRef({lastSentAt:0,lastValue:!1,idleTimer:null}),Ye=i.useRef(!1),bt=i.useRef(null),P=xe.sessionId,L=xe.sessionCsrf,$=xe.userId,Ze=xe.realtimeToken,A=!!(P&&L&&$),C=N.find(t=>t.id===d)||null,tn=i.useMemo(()=>ta(k),[k]),F=C||tn,Ae=i.useMemo(()=>N.filter(t=>!t.archived),[N]),ke=i.useMemo(()=>N.filter(t=>t.archived),[N]),nn=i.useMemo(()=>{const t=new Map;return mt.forEach(a=>{a!=null&&a.id&&t.set(a.id,{id:a.id,name:a.name||"Unknown",blockedAt:a.blockedAt||"",color:a.color||"#3b82f6"})}),Array.from(t.values())},[mt]),an=i.useMemo(()=>{const t=Q.trim().toLowerCase();return t?ke.filter(a=>a.name.toLowerCase().includes(t)||(a.lastMessage||"").toLowerCase().includes(t)):ke},[ke,Q]),sn=i.useMemo(()=>{const t=Q.trim().toLowerCase();return t?Ae.filter(a=>a.name.toLowerCase().includes(t)||(a.lastMessage||"").toLowerCase().includes(t)):Ae},[Ae,Q]),Be=d?y[d]||[]:[],qe=i.useMemo(()=>{const t=G.trim().toLowerCase();return t?Be.filter(a=>a.text.toLowerCase().includes(t)):Be},[Be,G]),ln=i.useMemo(()=>sa(qe),[qe]),rn=!!(d&&en===d),yt=()=>{ee.current&&(window.clearTimeout(ee.current),ee.current=null),U.current.idleTimer&&(window.clearTimeout(U.current.idleTimer),U.current.idleTimer=null)},De=async(t,{force:a=!1}={})=>{const r=se.current;if(!r||!$)return;const o=!!t,c=Date.now(),g=U.current;if(!(!a&&g.lastValue===o&&c-g.lastSentAt<600)){g.lastValue=o,g.lastSentAt=c;try{await r.send({type:"broadcast",event:"typing",payload:{isTyping:o,userId:String($)}})}catch{}}};i.useEffect(()=>{let t=!1;return(async()=>{if(!d||!$||!Ze||!A){Ee(!1);return}try{const r=await $n();if(!r||t)return;r.realtime.setAuth(Ze);const o=se.current;if(o)try{await o.unsubscribe()}catch{}se.current=null,yt(),U.current.lastValue=!1;const c=r.channel(`conversation:${d}`,{config:{presence:{key:`chat:${String($)}`}}});c.on("broadcast",{event:"typing"},({payload:g})=>{const I=String((g==null?void 0:g.userId)||"");if(!I||I===String($))return;const b=!!(g!=null&&g.isTyping);Ee(b),ee.current&&(window.clearTimeout(ee.current),ee.current=null),b&&(ee.current=window.setTimeout(()=>{Ee(!1),ee.current=null},3e3))}),c.subscribe(async g=>{if(!(t||g!=="SUBSCRIBED"))try{await c.track({userId:String($),at:new Date().toISOString()})}catch{}}),se.current=c}catch{t||Ee(!1)}})(),()=>{t=!0;const r=se.current;if(se.current=null,r)try{r.unsubscribe()}catch{}yt(),U.current.lastValue=!1,Ee(!1)}},[d,A,$,Ze]),i.useEffect(()=>{if(!d||!$||!se.current)return;const t=oe.trim().length>0,a=Date.now(),r=U.current;t!==r.lastValue&&a-r.lastSentAt>600&&De(t,{force:!0}),r.idleTimer&&(window.clearTimeout(r.idleTimer),r.idleTimer=null),t&&(r.idleTimer=window.setTimeout(()=>{U.current.idleTimer=null,De(!1,{force:!0})},2e3))},[oe,d,$]),i.useEffect(()=>{if(!d||G.trim())return;const t=Et.current;t&&requestAnimationFrame(()=>{t.scrollTo({top:t.scrollHeight,behavior:"smooth"})})},[d,Be.length,lt,G]),i.useEffect(()=>{d||ge(!1)},[d]),i.useEffect(()=>{_e(null)},[d]),i.useEffect(()=>{(!d||!A)&&Te(null)},[d,A]),i.useEffect(()=>()=>{ye.current&&clearTimeout(ye.current)},[]);const h=t=>{rt(t),ye.current&&clearTimeout(ye.current),ye.current=setTimeout(()=>rt(null),2400)},kt=(t,a={})=>{if(Number(t==null?void 0:t.status)!==401)return!1;const r=!!(a!=null&&a.silent);return He({sessionId:"",sessionCsrf:"",userId:"",realtimeToken:""}),j(null),J(null),r||h("Session missing or expired. Please log in again."),!0},on=t=>{if(!t||typeof t!="object")return;const a=typeof t.attachmentUrl=="string"?t.attachmentUrl.trim():"",r=typeof t.attachmentType=="string"?t.attachmentType.toLowerCase():"",o=!!t.attachmentIsImage||r.startsWith("image/");if(!a||!o)return;const c=typeof t.attachmentName=="string"&&t.attachmentName?t.attachmentName:"photo";_e({url:a,name:c,messageId:typeof t.id=="string"?t.id:""})},cn=()=>{_e(null)},mn=async()=>{if(!(V!=null&&V.url))return;const t=V.name||"photo";try{const a=await fetch(V.url);if(!a.ok)throw new Error("download_failed");const r=await a.blob(),o=window.URL.createObjectURL(r),c=document.createElement("a");c.href=o,c.download=t,document.body.appendChild(c),c.click(),c.remove(),window.URL.revokeObjectURL(o),h("Image saved.")}catch{const a=document.createElement("a");a.href=V.url,a.target="_blank",a.rel="noreferrer",a.click(),h("Could not save directly. Opened image in a new tab.")}},dn=()=>{if(!C){h("No chat selected.");return}Ve(C),Se(""),Ie(V!=null&&V.name?`Photo attachment: ${V.name}`:"Photo attachment"),Fe(!0)};i.useEffect(()=>{if(!d||!A)return;let t=!1;Te(d);const a=async({silent:o=!1}={})=>{try{const{messages:c,chatPatch:g}=await Fn({sessionId:P,sessionCsrf:L,conversationId:d,currentUserId:$});if(t)return;R(I=>{const b=I[d]||[],w=new Set(c.map(S=>S.id)),T=b.filter(S=>S.id&&S.id.startsWith("m-")&&!w.has(S.id));return{...I,[d]:[...c,...T]}}),v(I=>I.map(b=>b.id===d?{...b,...g||{},unread:0}:b));try{await Vn({sessionId:P,sessionCsrf:L,conversationId:d})}catch{}}catch(c){if(!t&&kt(c))return;!t&&!o&&h((c==null?void 0:c.message)||"Failed to load chat messages.")}finally{t||Te(c=>c===d?null:c)}};a();const r=window.setInterval(()=>{a({silent:!0})},5e3);return()=>{t=!0,window.clearInterval(r)}},[d,A,P,L,$]);const un=t=>{if(!t){h("No chat selected.");return}it(t),ct(!0)},Ke=()=>{ct(!1),it(null)},fn=(t,a)=>{const r=N.find(b=>b.id===t),o=(r==null?void 0:r.otherPartyId)||t;if(!o)return;const c=a||new Date().toISOString(),g=(r==null?void 0:r.name)||"Unknown",I=(r==null?void 0:r.color)||"#3b82f6";Ce(b=>{const w=b.filter(T=>T.id!==o);return[{id:o,name:g,blockedAt:c,color:I},...w]})},Nt=({accountId:t,conversationId:a=""})=>{const r=typeof t=="string"?t.trim():"",o=typeof a=="string"?a.trim():"";v(c=>c.map(g=>{const I=!!o&&g.id===o,b=!!r&&g.otherPartyId===r;if(!I&&!b)return g;const w=!!g.blockedByOther;return{...g,blocked:!1,blockedByMe:!1,hasBlockingRelationship:w,blockedAt:void 0}})),r&&Ce(c=>c.filter(g=>g.id!==r))},Ct=async t=>{if(!t)return!1;if(A)try{await zn({sessionId:P,sessionCsrf:L,conversationId:t})}catch(r){return h((r==null?void 0:r.message)||"Failed to block account."),!1}const a=new Date().toISOString();return v(r=>r.map(o=>o.id===t?{...o,blocked:!0,blockedByMe:!0,hasBlockingRelationship:!0,blockedAt:a}:o)),fn(t,a),d===t&&j(null),h("Chat blocked."),!0},hn=async t=>{if(!t)return!1;const a=N.find(o=>o.id===t),r=(a==null?void 0:a.otherPartyId)||"";if(A)try{await Lt({sessionId:P,sessionCsrf:L,conversationId:t||void 0,recipientId:r||void 0})}catch(o){return h((o==null?void 0:o.message)||"Failed to unblock account."),!1}return Nt({accountId:r,conversationId:t}),h("Account unblocked."),!0},pn=async t=>{const a=typeof t=="string"?t.trim():"";if(!a)return!1;const r=N.find(c=>c.otherPartyId===a),o=(r==null?void 0:r.id)||"";if(A)try{await Lt({sessionId:P,sessionCsrf:L,conversationId:o||void 0,recipientId:a})}catch(c){return h((c==null?void 0:c.message)||"Failed to unblock account."),!1}return Nt({accountId:a,conversationId:o}),h("Account unblocked."),!0},vn=async(t,a={})=>{if(!t)return!1;const r=a.clearActive!==!1,o=a.toast!==!1;if(A)try{await Yn({sessionId:P,sessionCsrf:L,conversationId:t})}catch(c){return h((c==null?void 0:c.message)||"Failed to archive chat."),!1}return v(c=>c.map(g=>g.id===t?{...g,archived:!0,archivedAt:new Date().toISOString()}:g)),r&&d===t&&j(null),o&&h("Chat archived."),!0},wt=async(t,a={})=>{if(!t)return!1;const r=a.clearActive===!0,o=a.toast!==!1;if(A)try{await Zn({sessionId:P,sessionCsrf:L,conversationId:t})}catch(c){return h((c==null?void 0:c.message)||"Failed to restore chat."),!1}return v(c=>c.map(g=>g.id===t?{...g,archived:!1,archivedAt:void 0}:g)),r&&d===t&&j(null),o&&h("Chat restored from archive."),!0},gn=t=>{t&&($e(t),dt(!0))},St=()=>{dt(!1),$e(null)},Je=t=>{t&&(Ve(t),Se(""),Ie(""),Fe(!0))},It=()=>{Fe(!1),Ve(null),Se(""),Ie("")},En=async()=>{var o;if(!ie||!we)return;if(!A){h("Session missing or expired. Please log in again.");return}const t=((o=Ot.find(c=>c.value===we))==null?void 0:o.label)||we,a=ut.trim(),r=a?`${t} - ${a}`:t;try{await Hn({sessionId:P,sessionCsrf:L,conversationId:ie.id,recipientId:ie.otherPartyId,reason:r});try{const c=await Rt({sessionId:P,sessionCsrf:L});Oe(c)}catch{}It(),h("Report sent.")}catch(c){h((c==null?void 0:c.message)||"Failed to submit report.")}},bn=({title:t,message:a,confirmLabel:r,onConfirm:o})=>{gt({open:!0,title:t,message:a,confirmLabel:r,onConfirm:o})},Qe=()=>{gt(t=>({...t,open:!1}))},yn=i.useCallback(async(t,a,r={})=>{const o=!!(r!=null&&r.silent);if(ze)return!1;const c=t.trim(),g=a.trim();if(!c||!g)return o||h("Session credentials missing. Please log in again."),!1;ft(!0);try{const I=await Ln({sessionId:c,sessionCsrf:g}),{chats:b,blockedAccounts:w,reports:T,currentUser:S}=await jn({sessionId:c,sessionCsrf:g});He({sessionId:c,sessionCsrf:g,userId:I.userId,realtimeToken:I.token||""}),pt(S?{...le,...S}:{...le,...m}),Gn(c,g),v(b),Ce(w),R({}),Oe(T);let B=null,fe=null;if(!x.current){if(p.conversationId){const W=b.find(Y=>Y.id===p.conversationId);W&&(B=W.id)}if(!B&&p.recipientId){const W=b.find(Y=>Y.otherPartyId===p.recipientId);W?B=W.id:fe={id:p.recipientId,name:p.recipientName||"Business"}}x.current=!0}return J(fe),j(B),Le(!1),q(""),ae(""),re(!1),M("chats"),!o&&b.length===0?h("Connected. No chats found."):o||h(`Connected. Loaded ${b.length} chat${b.length===1?"":"s"}.`),!0}catch(I){const b=kt(I,{silent:o});return!o&&!b&&h((I==null?void 0:I.message)||"Failed to restore your session."),!1}finally{ft(!1)}},[ze,m,p]);bt.current=yn,i.useEffect(()=>{let t=!1;return console.log("[ChatDebug] Session restore effect running..."),(async()=>{const r=Qn();if(console.log("[ChatDebug] Session restore - persisted result:",r?"FOUND":"NOT FOUND"),!r){console.warn("[ChatDebug] No session cookies found. Possible causes:",`
  1. User never logged in`,`
  2. Cookies were cleared`,`
  3. Cookies set on different domain/path`,`
  4. Cookies are HttpOnly (can't read via JS)`),t||h("Session missing or expired. Please log in again.");return}console.log("[ChatDebug] Attempting connectWithSession...");const o=bt.current;if(!o)return;const c=await o(r.sessionId,r.sessionCsrf,{silent:!0});console.log("[ChatDebug] connectWithSession result:",c?"SUCCESS":"FAILED"),c||t||h("Session missing or expired. Please log in again.")})(),()=>{t=!0}},[]);const ue=({title:t,message:a,confirmLabel:r="Delete",onConfirm:o})=>{vt({open:!0,title:t,message:a,confirmLabel:r,onConfirm:o})},te=()=>{vt(t=>({...t,open:!1}))},kn=async(t,a={})=>{a.unarchive&&!await wt(t,{clearActive:!1,toast:!0})||(j(t),J(null),A&&Te(t),Le(!1),a.keepSection||M("chats"),v(r=>r.map(o=>o.id===t?{...o,unread:0}:o)),re(!1),ae(""))},Tt=(t,a,r)=>{R(o=>{const c=o[t]||[];return{...o,[t]:c.map(g=>g.id===a?{...g,status:r}:g)}})},Nn=async()=>{const t=oe.trim(),a=d||"",r=a?"":(k==null?void 0:k.id)||"",o=(C==null?void 0:C.name)||(k==null?void 0:k.name)||p.recipientName||"Business",c=(C==null?void 0:C.color)||"#3b82f6";if(!t||!!!(a||r))return;if(ne(F)){h(F!=null&&F.blockedByOther?"You cannot message this account.":"Unblock this account to send messages.");return}if(!a&&Ye.current){h("Please wait, sending previous message...");return}if(A){a||(Ye.current=!0);try{const b=await _n({sessionId:P,sessionCsrf:L,conversationId:a||void 0,recipientId:r||void 0,content:t}),w=Pt(b==null?void 0:b.data,$),T=(typeof w.chatId=="string"?w.chatId.trim():"")||a;if(!T)throw new Error("Failed to resolve conversation ID.");R(S=>({...S,[T]:[...S[T]||[],w]})),ce(""),v(S=>{const B=w.timestamp||new Date().toISOString();if(!S.find(_=>_.id===T))return[{id:T,name:o,firstName:"",lastName:"",suburb:"",city:"",province:"",streetAddress:"",accountSince:"",accountType:"Business",lastMessage:w.text||t,lastTime:B,unread:0,online:!1,presence:"offline",color:c,archived:!1,blocked:!1,blockedByMe:!1,blockedByOther:!1,hasBlockingRelationship:!1,otherPartyId:r||(k==null?void 0:k.id)||""},...S];const W=S.map(_=>_.id===T?{..._,lastMessage:w.text||t,lastTime:w.timestamp||B,unread:0}:_),Y=W.find(_=>_.id===T),Me=W.filter(_=>_.id!==T);return Y?[Y,...Me]:W}),j(T),J(null),U.current.idleTimer&&(window.clearTimeout(U.current.idleTimer),U.current.idleTimer=null),U.current.lastValue=!1,De(!1,{force:!0})}catch(b){h((b==null?void 0:b.message)||"Failed to send message.")}finally{Ye.current=!1}return}if(!a){h("Session missing or expired. Please log in again.");return}const I={id:`m-${Date.now()}`,chatId:a,sender:"me",text:t,timestamp:new Date().toISOString(),status:"sent"};R(b=>({...b,[a]:[...b[a]||[],I]})),ce(""),v(b=>{const w=b.map(B=>B.id===a?{...B,lastMessage:t,lastTime:I.timestamp,unread:0}:B),T=w.find(B=>B.id===a),S=w.filter(B=>B.id!==a);return T?[T,...S]:w}),setTimeout(()=>Tt(a,I.id,"delivered"),900),setTimeout(()=>Tt(a,I.id,"read"),2e3),U.current.idleTimer&&(window.clearTimeout(U.current.idleTimer),U.current.idleTimer=null),U.current.lastValue=!1,De(!1,{force:!0})},Cn=()=>{if(!d&&!(k!=null&&k.id)){h("Select a chat to add emojis.");return}ge(t=>!t)},wn=()=>{ge(!1)},Sn=t=>{t&&(Kt(a=>[t,...a.filter(r=>r!==t)].slice(0,24)),ce(a=>{const{nextValue:r,caret:o}=oa(a,t,be.current);return requestAnimationFrame(()=>{be.current&&(be.current.focus(),be.current.setSelectionRange(o,o))}),r}))},In=()=>{if(!d&&!(k!=null&&k.id)){h("Select a chat first.");return}if(!A){h("Session missing or expired. Please log in again.");return}if(ne(F)){h(F!=null&&F.blockedByOther?"You cannot message this account.":"Unblock this account to send messages.");return}We.current&&We.current.click()},Tn=async t=>{var b;const a=t.target,r=(b=a==null?void 0:a.files)==null?void 0:b[0];if(a&&(a.value=""),!r)return;if(!d&&!(k!=null&&k.id)){h("Select a chat first.");return}if(!A){h("Session missing or expired. Please log in again.");return}if(ne(F)){h(F!=null&&F.blockedByOther?"You cannot message this account.":"Unblock this account to send messages.");return}const o=d||"",c=o?"":(k==null?void 0:k.id)||"",g=(C==null?void 0:C.name)||(k==null?void 0:k.name)||p.recipientName||"Business",I=(C==null?void 0:C.color)||"#3b82f6";try{const w=await Wn({sessionId:P,sessionCsrf:L,conversationId:o||void 0,recipientId:c||void 0,file:r}),T=Pt(w==null?void 0:w.data,$),S=(typeof T.chatId=="string"?T.chatId.trim():"")||o;if(!S)throw new Error("Failed to resolve conversation ID.");R(B=>({...B,[S]:[...B[S]||[],T]})),v(B=>{const fe=T.timestamp||new Date().toISOString();if(!B.find(Z=>Z.id===S))return[{id:S,name:g,firstName:"",lastName:"",suburb:"",city:"",province:"",streetAddress:"",accountSince:"",accountType:"Business",lastMessage:T.text||r.name,lastTime:fe,unread:0,online:!1,presence:"offline",color:I,archived:!1,blocked:!1,blockedByMe:!1,blockedByOther:!1,hasBlockingRelationship:!1,otherPartyId:c||(k==null?void 0:k.id)||""},...B];const Y=B.map(Z=>Z.id===S?{...Z,lastMessage:T.text||r.name,lastTime:T.timestamp||fe,unread:0}:Z),Me=Y.find(Z=>Z.id===S),_=Y.filter(Z=>Z.id!==S);return Me?[Me,..._]:Y}),j(S),J(null),h("Attachment sent.")}catch(w){h((w==null?void 0:w.message)||"Failed to send attachment.")}},Ge=t=>{if(!Array.isArray(t)||t.length===0)return;const a=new Set(t.filter(Boolean));a.size&&(v(r=>r.filter(o=>!a.has(o.id))),R(r=>{const o={...r};return a.forEach(c=>{delete o[c]}),o}),d&&a.has(d)&&j(null))},Xe=async(t,a={})=>{const r=typeof t=="string"?t.trim():"";if(!r)return!1;const o=a.toast!==!1;if(A)try{await jt({sessionId:P,sessionCsrf:L,conversationId:r})}catch(c){return h((c==null?void 0:c.message)||"Failed to delete chat."),!1}return Ge([r]),o&&h("Chat deleted."),!0},xt=async()=>{const t=N.map(o=>o.id).filter(Boolean);if(t.length===0)return h("No chats to delete."),!1;if(!A)return Ge(t),h("All chats deleted."),!0;const a=[];for(const o of t)try{await jt({sessionId:P,sessionCsrf:L,conversationId:o}),a.push(o)}catch{}a.length>0&&Ge(a);const r=t.length-a.length;return a.length===0?(h("Failed to delete chats."),!1):r===0?(h("All chats deleted."),!0):(h(`Deleted ${a.length} chat${a.length===1?"":"s"}. ${r} failed.`),!1)},xn=t=>{R(a=>({...a,[t]:[]})),v(a=>a.map(r=>r.id===t?{...r,lastMessage:"No messages yet",lastTime:"",unread:0}:r))},An=()=>{if(d){xn(d),h("Cleared current chat.");return}const t={};N.forEach(a=>{t[a.id]=[]}),R(t),v(a=>a.map(r=>({...r,lastMessage:"No messages yet",lastTime:"",unread:0}))),h("Cleared all chats.")},Bn=t=>{if(t==="profile"){C&&un(C);return}if(t==="close"){j(null),J(null),Le(!0),re(!1),ae(""),h("Chat closed.");return}if(t==="block"){if(!C)return;Ct(C.id);return}if(t==="delete"){ue(C?{title:`Delete chat with ${he(C)}?`,message:"This removes the chat from your list.",onConfirm:()=>{te(),Xe(C.id)}}:{title:"Delete all chats?",message:"This removes every chat from your list.",onConfirm:()=>{te(),xt()}});return}if(t==="clear"){const a=C?`Clear chat with ${C.name}?`:"Clear all chats?";bn({title:a,message:C?"This clears the messages in this chat.":"This clears the messages in every chat.",confirmLabel:"Clear",onConfirm:()=>{Qe(),An()}});return}t==="report"&&C&&Je(C)},Dn=()=>{re(t=>{const a=!t;return a||ae(""),a})},Mn=async(t,a)=>{if(a==="archive"){await vn(t,{clearActive:!0,toast:!0});return}if(a==="unarchive"){await wt(t,{clearActive:z,toast:!0});return}if(a==="delete"){const r=N.find(o=>o.id===t);ue({title:r?`Delete chat with ${he(r)}?`:"Delete chat?",message:"This removes the chat from your list.",onConfirm:()=>{te(),Xe(t)}});return}if(a==="report"){const r=N.find(o=>o.id===t);Je(r)}},Rn=t=>{pn(t)},z=f==="archive",At=f==="block",Bt=f==="profile",Dt=f==="reports",et=!!V,Mt=et||Bt||At||Dt,Pn=ze;return i.useEffect(()=>{if(!z||ot)return;if(ke.length===0){j(null);return}const t=N.find(a=>a.id===d);t&&!t.archived&&j(null)},[z,ke,N,d,ot]),i.useEffect(()=>{if(z)return;const t=N.find(a=>a.id===d);t&&t.archived&&j(null)},[z,N,d,Ae]),i.useEffect(()=>{if(!A||f!=="block")return;let t=!1;return(async()=>{try{const a=await On({sessionId:P,sessionCsrf:L});t||Ce(a)}catch{}})(),()=>{t=!0}},[A,f,P,L]),i.useEffect(()=>{if(!A||f!=="reports")return;let t=!1;return(async()=>{try{const a=await Rt({sessionId:P,sessionCsrf:L});t||Oe(a)}catch{}})(),()=>{t=!0}},[A,f,P,L]),i.useEffect(()=>{if(!Ue||!(X!=null&&X.id))return;const t=je.find(a=>a.id===X.id);if(!t){St();return}$e(t)},[Ue,X==null?void 0:X.id,je]),e.createElement("div",{className:"desktop-stage"},e.createElement("div",{className:"desktop-window"},e.createElement("div",{className:`desktop-content chp-desktop${et?" preview-only":Mt?" section-only":""}`},et?null:e.createElement("aside",{className:"icon-rail"},e.createElement("nav",{className:"rail-nav","aria-label":"Primary"},[{key:"home",label:"Home",icon:va},{key:"chats",label:"Chats",icon:ma},{key:"archive",label:"Archive",icon:ga},{key:"block",label:"Block",icon:pe},{key:"reports",label:"Reports",icon:Yt},{key:"profile",label:"Profile",icon:Ea}].map(t=>{const a=t.icon;return e.createElement("button",{key:t.key,className:`rail-btn ${f===t.key?"active":""}`,type:"button",onClick:()=>{if(M(t.key),t.key==="home"){window.location.href="homepage.html";return}},"aria-label":t.label},e.createElement("span",{className:"rail-icon"},e.createElement(a,null)),e.createElement("span",null,t.label))})),e.createElement("div",{className:"rail-footer"},e.createElement("button",{className:`rail-btn danger ${f==="logout"?"active":""}`,type:"button",onClick:()=>{M("logout"),ue({title:"Log out?",message:"Are you sure you want to log out?",confirmLabel:"Log out",onConfirm:()=>{te(),Xn(),He({sessionId:"",sessionCsrf:"",userId:"",realtimeToken:""}),pt({...le,...m}),h("Logged out.")}})},"aria-label":"Logout"},e.createElement("span",{className:"rail-icon"},e.createElement(ba,null)),e.createElement("span",null,"Logout")))),Mt?null:e.createElement("aside",{className:"sidebar"},z?e.createElement(e.Fragment,null,e.createElement("div",{className:"archive-heading"},e.createElement("h2",null,"Achieved Chats")),e.createElement("div",{className:"archive-description muted"},"Archived conversations stored here.")):e.createElement("div",{className:"sidebar-header"},e.createElement("div",{className:"sidebar-title"},e.createElement("div",{className:"sidebar-brand"},e.createElement("img",{src:Un,alt:"CompareHubPrices"}))),e.createElement("div",{className:"sidebar-actions-row"},e.createElement("button",{className:"icon-btn",type:"button","aria-label":"Delete all chats",onClick:()=>{ue({title:"Delete all chats?",message:"This removes every chat from your list.",onConfirm:()=>{te(),xt()}})}},e.createElement(Zt,null)))),e.createElement(Da,{chats:z?an:sn,searchValue:Q,onSearchChange:q,activeChatId:d,onOpenChat:t=>kn(t,{keepSection:z}),onMenuAction:Mn,emptyTitle:z?"No archived chats":void 0,emptySubtitle:z?"Archived conversations will appear here.":void 0,showSearch:!z})),e.createElement("section",{className:"chat-panel"},Bt?e.createElement(Ia,{currentUser:ht}):At?e.createElement(Ta,{chats:nn,onUnblock:Rn}):Dt?e.createElement(xa,{reports:je,onOpenReport:gn}):e.createElement(Ua,{chat:F,groupedMessages:ln,searchValue:G,showSearch:Pe,onToggleSearch:Dn,onSearchChange:ae,onSend:Nn,composerValue:oe,onComposerChange:ce,onEmoji:Cn,onAttach:In,emojiOpen:Ne,emojiRecents:K,onEmojiSelect:Sn,onEmojiClose:wn,composerRef:be,typing:lt,conversationLoading:rn,messageListRef:Et,matchCount:qe.length,onMenuAction:Bn,attachmentPreview:V,onOpenAttachmentPreview:on,onCloseAttachmentPreview:cn,onSaveAttachmentPreview:mn,onReportAttachmentPreview:dn})))),Pn?e.createElement(Sa,null):null,e.createElement(Ca,{open:Jt,onClose:()=>Qt(!1),currentUser:ht}),e.createElement(wa,{open:Gt,onClose:Ke,chat:H,onDelete:()=>{H&&ue({title:`Delete chat with ${he(H)}?`,message:"This removes the chat from your list.",onConfirm:async()=>{te(),await Xe(H.id)&&Ke()}})},onBlock:()=>{(async()=>{if(!H)return;(H.blocked?await hn(H.id):await Ct(H.id))&&Ke()})()},onReport:()=>{H&&Je(H)}}),e.createElement(Aa,{open:Ue,report:X,onClose:St}),e.createElement(Ba,{open:Xt,onClose:It,reasons:Ot,value:we,onChange:Se,details:ut,onDetailsChange:Ie,onSubmit:En,targetName:ie==null?void 0:ie.name}),e.createElement(Na,{open:me.open,title:me.title,message:me.message,confirmLabel:me.confirmLabel,onConfirm:()=>{me.onConfirm?me.onConfirm():te()},onCancel:te}),e.createElement(ka,{open:de.open,title:de.title,message:de.message,confirmLabel:de.confirmLabel,onConfirm:()=>{de.onConfirm?de.onConfirm():Qe()},onCancel:Qe}),e.createElement("input",{ref:We,type:"file",accept:".pdf,image/png,image/jpeg,image/webp,video/mp4,video/webm,video/quicktime,.mov,.m4v",onChange:Tn,style:{display:"none"}}))}const Fa=qn(document.getElementById("root"));Fa.render(e.createElement(e.StrictMode,null,e.createElement($a,null)));
