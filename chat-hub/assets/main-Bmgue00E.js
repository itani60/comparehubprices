import{r as d,f as bn,a as ht,R as e,l as yn,g as Nn,b as Cn,m as kn,s as wn,c as vt,d as Sn,e as In,u as Tn,h as Et,i as An,j as Bn,k as Rn,n as xn,o as Mn,p as gt,q as Dn}from"./emojiSearch-B4bGAw9x.js";const Ve={name:"",firstName:"",lastName:"",status:"",about:"",email:"",phone:"",suburb:"",city:"",province:"",accountSince:""},Ln=[],jn={},bt=[{value:"spam",label:"Spam"},{value:"harassment",label:"Harassment"},{value:"scam",label:"Scam"},{value:"other",label:"Other"}],yt="chp_recent_emojis",ye=[{id:"recent",name:"Recent",icon:'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>',emojis:["ğŸ˜‚","â¤ï¸","ğŸ‘","ğŸ”¥","ğŸ˜Š","ğŸ™","ğŸ¥º","ğŸ¤£"]},{id:"smileys",name:"Smileys & Emotion",icon:'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M8 14s1.5 2 4 2 4-2 4-2"></path><line x1="9" y1="9" x2="9.01" y2="9"></line><line x1="15" y1="9" x2="15.01" y2="9"></line></svg>',emojis:["ğŸ˜€","ğŸ˜ƒ","ğŸ˜„","ğŸ˜","ğŸ˜†","ğŸ˜…","ğŸ˜‚","ğŸ¤£","ğŸ˜Š","ğŸ˜‡","ğŸ™‚","ğŸ˜‰","ğŸ˜","ğŸ¥°","ğŸ˜˜","ğŸ˜š","ğŸ˜‹","ğŸ˜›","ğŸ˜","ğŸ˜œ","ğŸ¤ª","ğŸ˜","ğŸ˜’","ğŸ˜”","ğŸ™","ğŸ˜¢","ğŸ˜­","ğŸ˜ ","ğŸ˜¡","ğŸ˜³","ğŸ˜±","ğŸ˜¨","ğŸ˜°","ğŸ¤—","ğŸ¤”","ğŸ™„","ğŸ¤­","ğŸ¤¯","ğŸ¥´","ğŸ¤ "]},{id:"people",name:"People & Body",icon:'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 11V6a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v5"></path><path d="M14 10V4a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v10"></path><path d="M10 10.5V6a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v8"></path><path d="M18 8a2 2 0 1 1 4 0v6a8 8 0 0 1-8 8h-2c-2.8 0-4.5-.86-5.99-2.34l-3.6-3.6a2 2 0 0 1 2.83-2.82L7 15"></path></svg>',emojis:["ğŸ‘‹","ğŸ¤š","âœ‹","ğŸ‘Œ","âœŒï¸","ğŸ¤Ÿ","ğŸ¤˜","ğŸ¤™","ğŸ‘ˆ","ğŸ‘‰","ğŸ‘†","ğŸ‘‡","ğŸ‘","ğŸ‘","ğŸ‘Š","ğŸ‘","ğŸ™Œ","ğŸ™","âœï¸","ğŸ’ª","ğŸ§ ","ğŸ‘€","ğŸ‘¶","ğŸ‘¦","ğŸ‘§","ğŸ‘¨","ğŸ‘©","ğŸ‘´","ğŸ‘µ","ğŸ‘®"]},{id:"nature",name:"Animals & Nature",icon:'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10Z"></path><path d="M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12"></path></svg>',emojis:["ğŸ¶","ğŸ±","ğŸ­","ğŸ°","ğŸ¦Š","ğŸ»","ğŸ¼","ğŸ¯","ğŸ¦","ğŸ®","ğŸ·","ğŸ¸","ğŸµ","ğŸ§","ğŸ¦†","ğŸŠ","ğŸ¢","ğŸ³","ğŸŸ","ğŸ™","ğŸ’","ğŸŒ¸","ğŸŒ¹","ğŸŒº","ğŸŒ»","ğŸŒ·","ğŸŒ±","ğŸŒ²","ğŸŒ´","ğŸ"]},{id:"food",name:"Food & Drink",icon:'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 2v20"></path><path d="M15 3v10"></path><path d="M15 17v5"></path><path d="M15 3c-1.1 0-2 .9-2 2h0c0 1.1.9 2 2 2h0c1.1 0 2-.9 2-2h0c0-1.1-.9-2-2-2Z"></path><path d="M15 17c-1.1 0-2 .9-2 2h0c0 1.1.9 2 2 2h0c1.1 0 2-.9 2-2h0c0-1.1-.9-2-2-2Z"></path><path d="M9 3v10"></path><path d="M9 17v5"></path><path d="M9 3c-1.1 0-2 .9-2 2h0c0 1.1.9 2 2 2h0c1.1 0 2-.9 2-2h0c0-1.1-.9-2-2-2Z"></path><path d="M9 17c-1.1 0-2 .9-2 2h0c0 1.1.9 2 2 2h0c1.1 0 2-.9 2-2h0c0-1.1-.9-2-2-2Z"></path></svg>',emojis:["ğŸ","ğŸ","ğŸŠ","ğŸ‹","ğŸŒ","ğŸ‰","ğŸ‡","ğŸ“","ğŸ…","ğŸ†","ğŸ¥‘","ğŸ¥¦","ğŸ¥•","ğŸ„","ğŸ","ğŸ¥–","ğŸ§€","ğŸ”","ğŸŸ","ğŸ•","ğŸŒ­","ğŸŒ®","ğŸŒ¯","ğŸ³","ğŸš","ğŸ","ğŸ£","ğŸ¦","ğŸ©","â˜•"]},{id:"travel",name:"Travel & Places",icon:'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>',emojis:["ğŸš—","ğŸš•","ğŸš™","ğŸšŒ","ğŸš“","ğŸš‘","ğŸš’","ğŸšš","ğŸš²","âœˆï¸","ğŸš€","â›µ","ğŸš¢","â›½","ğŸš§","ğŸ—ºï¸","ğŸ—½","ğŸ°","ğŸ¡","ğŸ–ï¸","ğŸ ","ğŸ¢","ğŸ¥","ğŸª","ğŸ­","ğŸŒ†","ğŸŒƒ","ğŸŒ","ğŸŒŒ","ğŸŒˆ"]},{id:"symbols",name:"Symbols",icon:'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 12h2"></path><path d="M12 11v2"></path><circle cx="12" cy="12" r="10"></circle></svg>',emojis:["â¤ï¸","ğŸ§¡","ğŸ’›","ğŸ’š","ğŸ’™","ğŸ’œ","ğŸ¤","ğŸ’”","â£ï¸","ğŸ’•","ğŸ’—","ğŸ’–","âœï¸","â˜ªï¸","ğŸ”¯","â™ˆ","â™‰","â™“","âŒ","â­•","â›”","ğŸ’¯","â—","â“","â€¼ï¸","âš ï¸","âœ…","â™»ï¸","ğŸ’¤","â™¿"]}];function ae(t){if(!t)return"";const s=t.split(" ").filter(Boolean),r=s[0]?s[0][0]:"",m=s.length>1?s[s.length-1][0]:"";return(r+m).toUpperCase()}function Z(t){return!t||typeof t!="object"||t.blockedByOther?"User unavailable":t.name||"Unknown"}function H(t){return!!(t&&(t.blocked||t.blockedByOther))}function Ct(t){if(!t)return"";const s=new Date(t);return Number.isNaN(s.getTime())?"":s.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}function kt(t){if(!t)return"";const s=new Date(t);return Number.isNaN(s.getTime())?"":s.toLocaleDateString([],{month:"short",day:"numeric"})}function _e(t){if(!t)return"";const s=new Date(t);return Number.isNaN(s.getTime())?"":s.toLocaleString([],{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}function wt(t){const s=String(t||"").trim();return s?s.split(/[_\s-]+/).filter(Boolean).map(r=>r.charAt(0).toUpperCase()+r.slice(1).toLowerCase()).join(" "):"Status unavailable"}function St(t){const s=String(t||"").trim().toLowerCase();return s==="resolved"||s==="closed"||s==="complete"||s==="completed"||s==="done"?"success":s==="rejected"||s==="dismissed"||s==="denied"?"danger":s==="open"||s==="pending"||s==="in_review"||s==="in review"||s==="under_review"||s==="under review"?"warning":""}function Nt(t,s){return t.getFullYear()===s.getFullYear()&&t.getMonth()===s.getMonth()&&t.getDate()===s.getDate()}function Pn(t){const s=new Date(t);if(Number.isNaN(s.getTime()))return"";const r=new Date,m=new Date;return m.setDate(r.getDate()-1),Nt(s,r)?"Today":Nt(s,m)?"Yesterday":s.toLocaleDateString([],{month:"short",day:"numeric"})}function On(t){const s=[];let r="";return t.forEach(m=>{const p=m.timestamp.slice(0,10);p!==r&&(s.push({type:"day",id:`day-${p}`,label:Pn(m.timestamp)}),r=p),s.push({type:"message",id:m.id,message:m})}),s}function $n(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Un(t,s){if(!s)return t;const r=$n(s);return t.split(new RegExp(`(${r})`,"ig")).map((p,h)=>p.toLowerCase()===s.toLowerCase()?e.createElement("mark",{key:h,className:"msg-highlight"},p):e.createElement("span",{key:h},p))}function Fn(t,s,r){const m=(r==null?void 0:r.selectionStart)??t.length,p=(r==null?void 0:r.selectionEnd)??m;return{nextValue:t.slice(0,m)+s+t.slice(p),caret:m+s.length}}function He(t,s,r){d.useEffect(()=>{if(!r)return;const m=p=>{!t.current||t.current.contains(p.target)||s()};return document.addEventListener("mousedown",m),document.addEventListener("touchstart",m),()=>{document.removeEventListener("mousedown",m),document.removeEventListener("touchstart",m)}},[t,s,r])}function M({children:t,size:s=20,className:r}){return e.createElement("svg",{className:r,width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.8",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true"},t)}const Vn=t=>e.createElement(M,{...t},e.createElement("circle",{cx:"12",cy:"5",r:"1.6",fill:"currentColor",stroke:"none"}),e.createElement("circle",{cx:"12",cy:"12",r:"1.6",fill:"currentColor",stroke:"none"}),e.createElement("circle",{cx:"12",cy:"19",r:"1.6",fill:"currentColor",stroke:"none"})),Ke=t=>e.createElement(M,{...t},e.createElement("circle",{cx:"11",cy:"11",r:"6.5"}),e.createElement("line",{x1:"16.5",y1:"16.5",x2:"21",y2:"21"})),It=t=>e.createElement(M,{...t},e.createElement("polyline",{points:"15 6 9 12 15 18"})),_n=t=>e.createElement(M,{...t},e.createElement("path",{d:"M3 12l17-7-7 17-2-6-8-4Z"})),zn=t=>e.createElement(M,{...t},e.createElement("circle",{cx:"12",cy:"12",r:"9"}),e.createElement("circle",{cx:"9",cy:"10",r:"1",fill:"currentColor",stroke:"none"}),e.createElement("circle",{cx:"15",cy:"10",r:"1",fill:"currentColor",stroke:"none"}),e.createElement("path",{d:"M8 15c1.2 1.3 2.6 2 4 2s2.8-.7 4-2"})),Hn=t=>e.createElement(M,{...t},e.createElement("path",{d:"M7.5 12.5l6.8-6.8a3 3 0 0 1 4.3 4.3l-7.5 7.5a4.5 4.5 0 0 1-6.4-6.4l7.2-7.2"})),Kn=t=>e.createElement(M,{...t},e.createElement("polyline",{points:"5 12 9 16 19 6"})),Yn=t=>e.createElement(M,{...t},e.createElement("polyline",{points:"2 12 6 16 12 10"}),e.createElement("polyline",{points:"8 12 12 16 22 6"})),Zn=t=>e.createElement(M,{...t},e.createElement("path",{d:"M4 11.5 12 4l8 7.5"}),e.createElement("path",{d:"M6 10.5V20h12v-9.5"})),qn=t=>e.createElement(M,{...t},e.createElement("path",{d:"M6 18l-2.5 3.5V6.5A2.5 2.5 0 0 1 6 4h12a2.5 2.5 0 0 1 2.5 2.5V14A2.5 2.5 0 0 1 18 16.5H7.8L6 18Z"})),Wn=t=>e.createElement(M,{...t},e.createElement("rect",{x:"4",y:"4",width:"16",height:"5"}),e.createElement("rect",{x:"5",y:"9",width:"14",height:"11"}),e.createElement("line",{x1:"9",y1:"13",x2:"15",y2:"13"})),Jn=t=>e.createElement(M,{...t},e.createElement("path",{d:"M5 4v16"}),e.createElement("path",{d:"M5 4h12l-2.2 4L17 12H5"})),G=t=>e.createElement(M,{...t},e.createElement("circle",{cx:"12",cy:"12",r:"9"}),e.createElement("line",{x1:"7",y1:"17",x2:"17",y2:"7"})),Qn=t=>e.createElement(M,{...t},e.createElement("circle",{cx:"12",cy:"8",r:"3.2"}),e.createElement("path",{d:"M4.5 19.5c1.9-3 4.5-4.5 7.5-4.5s5.6 1.5 7.5 4.5"})),Gn=t=>e.createElement(M,{...t},e.createElement("path",{d:"M4 7h16"}),e.createElement("path",{d:"M9 7V5h6v2"}),e.createElement("path",{d:"M7 7l1 12h8l1-12"}),e.createElement("path",{d:"M10 11v6"}),e.createElement("path",{d:"M14 11v6"})),Tt=t=>e.createElement(M,{...t},e.createElement("line",{x1:"5",y1:"5",x2:"19",y2:"19"}),e.createElement("line",{x1:"19",y1:"5",x2:"5",y2:"19"}));function Ye({ariaLabel:t,items:s}){const[r,m]=d.useState(!1),p=d.useRef(null);return He(p,()=>m(!1),r),e.createElement("div",{className:"menu-wrap",ref:p},e.createElement("button",{className:"icon-btn","aria-label":t,"aria-haspopup":"menu","aria-expanded":r,onClick:()=>m(h=>!h),type:"button"},e.createElement(Vn,null)),r?e.createElement("div",{className:"dropdown",role:"menu"},s.map(h=>e.createElement("button",{key:h.label,className:"dropdown-item",role:"menuitem",type:"button",onClick:()=>{m(!1),h.onSelect()}},h.label))):null)}function Xn({status:t}){if(!t)return null;if(t==="sent")return e.createElement(Kn,{className:"status-icon"});const s=t==="read"?"status-icon read":"status-icon";return e.createElement(Yn,{className:s})}function ea({open:t,title:s,message:r,confirmLabel:m,onConfirm:p,onCancel:h}){return t?e.createElement("div",{className:"panel-backdrop",role:"dialog","aria-modal":"true","aria-label":s},e.createElement("div",{className:"confirm-dialog"},e.createElement("h3",null,s),e.createElement("p",null,r),e.createElement("div",{className:"confirm-actions"},e.createElement("button",{className:"ghost-btn",type:"button",onClick:h},"Cancel"),e.createElement("button",{className:"primary-btn",type:"button",onClick:p},m)))):null}function ta({open:t,sessionId:s,sessionCsrf:r,error:m,busy:p=!1,onSessionIdChange:h,onSessionCsrfChange:u,onConnect:b,onCancel:E}){return t?e.createElement("div",{className:"panel-backdrop",role:"dialog","aria-modal":"true","aria-label":"Connect session"},e.createElement("div",{className:"connect-dialog"},e.createElement("h3",null,"Connect Session"),e.createElement("p",null,"Enter your session credentials to connect."),e.createElement("div",{className:"connect-form"},e.createElement("label",{className:"connect-field"},e.createElement("span",null,"Session ID"),e.createElement("input",{className:"connect-input",type:"text",value:s,onChange:N=>h(N.target.value),placeholder:"Enter session id",autoComplete:"off"})),e.createElement("label",{className:"connect-field"},e.createElement("span",null,"Session CSRF"),e.createElement("input",{className:"connect-input",type:"text",value:r,onChange:N=>u(N.target.value),placeholder:"Enter session csrf",autoComplete:"off"}))),m?e.createElement("p",{className:"connect-error"},m):null,e.createElement("div",{className:"connect-actions"},e.createElement("button",{className:"ghost-btn",type:"button",onClick:E},"Cancel"),e.createElement("button",{className:"primary-btn",type:"button",onClick:b,disabled:p},p?"Connecting...":"Connect")))):null}function na({open:t,onClose:s,reasons:r,value:m,onChange:p,details:h,onDetailsChange:u,onSubmit:b,targetName:E}){const[N,i]=d.useState(!1),k=d.useRef(null),j=r.find(B=>B.value===m);return He(k,()=>i(!1),N),d.useEffect(()=>{t||i(!1)},[t]),t?e.createElement("div",{className:"panel-backdrop",role:"dialog","aria-modal":"true","aria-label":"Report"},e.createElement("div",{className:"report-dialog"},e.createElement("div",{className:"report-title"},"Quick report"),e.createElement("div",{className:"report-sub"},"Select a reason for reporting ",E||"this chat","."),e.createElement("div",{className:`report-select${N?" active":""}`,ref:k},e.createElement("button",{className:"report-select__trigger",type:"button",onClick:()=>i(B=>!B),"aria-haspopup":"listbox","aria-expanded":N},e.createElement("span",null,j?j.label:"Choose a reason"),e.createElement("span",{className:"report-select__caret"},"â–¾")),e.createElement("div",{className:"report-select__options",role:"listbox"},r.map(B=>e.createElement("button",{key:B.value,type:"button",className:`report-select__option${m===B.value?" selected":""}`,onClick:()=>{p(B.value),i(!1)},role:"option","aria-selected":m===B.value},B.label)))),e.createElement("textarea",{className:"report-textarea",placeholder:"Optional details",value:h,onChange:B=>u(B.target.value)}),e.createElement("div",{className:"report-actions"},e.createElement("button",{className:"ghost-btn",type:"button",onClick:s},"Cancel"),e.createElement("button",{className:"primary-btn",type:"button",onClick:b,disabled:!m},"Report")))):null}function aa({chat:t,onClose:s,onDelete:r,onBlock:m,onReport:p}){if(!t)return null;const h=!!t.blockedByOther,u=Z(t),b=t.name?t.name.split(" ").filter(Boolean):[],E=b[0]||"",N=b.slice(1).join(" "),i=h?"-":t.firstName||E||"-",k=h?"-":t.lastName||N||"-",j=h?"-":t.suburb||"-",B=h?"-":t.city||"-",$=h?"-":t.province||"-",g=h?"-":t.accountSince||"-",C=h?"-":t.accountType||"-";return e.createElement("div",{className:"profile-section-view","aria-label":"Contact profile"},e.createElement("div",{className:"profile-section-header"},e.createElement("button",{className:"icon-btn","aria-label":"Back",onClick:s,type:"button"},e.createElement(It,null)),e.createElement("h2",null,"Chat Profile")),e.createElement("div",{className:"profile-panel profile-panel-inline"},e.createElement("div",{className:"profile-hero"},e.createElement("div",{className:"avatar large",style:{backgroundColor:t.color}},H(t)?e.createElement(G,{className:"avatar-blocked-icon",size:18}):ae(u)),e.createElement("div",null,e.createElement("h3",null,u))),e.createElement("div",{className:"profile-section"},e.createElement("h4",null,"Details"),e.createElement("p",null,"First name: ",i),e.createElement("p",null,"Family name: ",k),e.createElement("p",null,"Suburb: ",j),e.createElement("p",null,"City: ",B),e.createElement("p",null,"Province: ",$),e.createElement("p",null,"Account since: ",g),e.createElement("p",null,"Account type: ",C)),e.createElement("div",{className:"profile-section"},e.createElement("h4",null,"Actions"),e.createElement("div",{className:"profile-action-row"},e.createElement("button",{className:"profile-btn danger",type:"button",onClick:r},e.createElement(Gn,null),"Delete"),h?null:e.createElement(e.Fragment,null,e.createElement("button",{className:"profile-btn warn",type:"button",onClick:m},e.createElement(G,null),t.blocked?"Unblock":"Block"),e.createElement("button",{className:"profile-btn",type:"button",onClick:p},e.createElement(Jn,null),"Report"))))))}function Ne({title:t,subtitle:s,children:r}){return e.createElement("div",{className:"section-panel"},e.createElement("div",{className:"section-header"},e.createElement("div",null,e.createElement("h2",null,t),s?e.createElement("p",{className:"muted"},s):null)),e.createElement("div",{className:"section-card"},r))}function sa({currentUser:t}){const s={...Ve,...t&&typeof t=="object"?t:{}},r=s.name||"User";return e.createElement(Ne,{title:"My Profile",subtitle:""},e.createElement("div",{className:"profile-panel profile-panel-inline"},e.createElement("div",{className:"profile-hero"},e.createElement("div",{className:"avatar large",style:{backgroundColor:"#3b82f6"}},ae(r)),e.createElement("div",null,e.createElement("h3",null,r),e.createElement("p",{className:"muted"},s.status||"-"))),e.createElement("div",{className:"profile-section"},e.createElement("h4",null,"About"),e.createElement("p",null,s.about||"-")),e.createElement("div",{className:"profile-section"},e.createElement("h4",null,"Details"),e.createElement("p",null,"First name: ",s.firstName||"-"),e.createElement("p",null,"Family name: ",s.lastName||"-"),e.createElement("p",null,"Suburb: ",s.suburb||"-"),e.createElement("p",null,"City: ",s.city||"-"),e.createElement("p",null,"Province: ",s.province||"-"),e.createElement("p",null,"Account since: ",s.accountSince||"-")),e.createElement("div",{className:"profile-actions"},e.createElement("button",{className:"manage-profile-btn",type:"button","data-link":"manage-profile"},"Manage Profile"))))}function la({chats:t,onOpenChat:s,onUnarchive:r}){return e.createElement(Ne,{title:"Achieved Chats",subtitle:"Archived conversations stored here."},t.length===0?e.createElement("div",{className:"section-empty"},"No archived chats yet."):e.createElement("div",{className:"section-list"},t.map(m=>{const p=Z(m);return e.createElement("div",{key:m.id,className:"section-item"},e.createElement("div",{className:"section-item-info"},e.createElement("div",{className:"avatar",style:{backgroundColor:m.color}},H(m)?e.createElement(G,{className:"avatar-blocked-icon",size:16}):ae(m.name)),e.createElement("div",{className:"section-item-text"},e.createElement("div",{className:"section-item-name"},p),e.createElement("div",{className:"section-item-sub"},m.lastMessage?m.lastMessage:"No messages yet"))),e.createElement("div",{className:"section-item-meta"},e.createElement("span",{className:"section-tag"},"Archived"),e.createElement("span",null,kt(m.archivedAt||m.lastTime)),e.createElement("div",{className:"section-item-actions"},e.createElement("button",{className:"section-action",type:"button",onClick:()=>s(m.id,{unarchive:!0})},"Open"),e.createElement("button",{className:"section-action ghost",type:"button",onClick:()=>r(m.id)},"Unarchive"))))})))}function ra({chats:t,onUnblock:s}){return e.createElement(Ne,{title:"Blocked Accounts",subtitle:"People and businesses you blocked."},t.length===0?e.createElement("div",{className:"section-empty"},"No blocked accounts."):e.createElement("div",{className:"section-list"},t.map(r=>e.createElement("div",{key:r.id,className:"section-item"},e.createElement("div",{className:"section-item-info"},e.createElement("div",{className:"avatar",style:{backgroundColor:r.color}},e.createElement(G,{className:"avatar-blocked-icon",size:16})),e.createElement("div",{className:"section-item-text"},e.createElement("div",{className:"section-item-name"},r.name))),e.createElement("div",{className:"section-item-meta"},e.createElement("span",{className:"section-tag danger"},"Blocked"),e.createElement("span",null,kt(r.blockedAt||r.lastTime)),e.createElement("button",{className:"section-action",type:"button",onClick:()=>s(r.id)},"Unblock"))))))}function oa({reports:t,onOpenReport:s}){return e.createElement(Ne,{title:"Reports",subtitle:"Reports you submitted."},t.length===0?e.createElement("div",{className:"section-empty"},"No reports found."):e.createElement("div",{className:"section-list"},t.map(r=>e.createElement("div",{key:r.id,className:"section-item"},e.createElement("div",{className:"section-item-info"},e.createElement("div",{className:"avatar",style:{backgroundColor:r.color||"#3b82f6"}},ae(r.name)),e.createElement("div",{className:"section-item-text"},e.createElement("div",{className:"section-item-name"},r.name),e.createElement("div",{className:"section-item-sub"},r.context||"No reason provided."))),e.createElement("div",{className:"section-item-meta"},e.createElement("span",{className:`section-tag ${St(r.status)}`},wt(r.status)),e.createElement("span",null,_e(r.createdAt)||"Date unavailable"),e.createElement("button",{className:"section-action ghost",type:"button",onClick:()=>s(r)},"View report"))))))}function ca({open:t,report:s,onClose:r}){return!t||!s?null:e.createElement("div",{className:"panel-backdrop",role:"dialog","aria-modal":"true","aria-label":"Report details"},e.createElement("div",{className:"report-details-dialog"},e.createElement("div",{className:"report-details-header"},e.createElement("div",null,e.createElement("div",{className:"report-details-title"},"Report details"),e.createElement("div",{className:"report-sub"},"Submitted information from your report.")),e.createElement("button",{type:"button",className:"report-details-close",onClick:r,"aria-label":"Close report details"},e.createElement(Tt,{size:18}))),e.createElement("div",{className:"report-details-grid"},e.createElement("div",{className:"report-details-field"},e.createElement("div",{className:"report-details-label"},"Reported account"),e.createElement("div",{className:"report-details-value"},s.name||"Unknown")),e.createElement("div",{className:"report-details-field"},e.createElement("div",{className:"report-details-label"},"Status"),e.createElement("div",{className:`section-tag ${St(s.status)}`},wt(s.status))),e.createElement("div",{className:"report-details-field"},e.createElement("div",{className:"report-details-label"},"Sent"),e.createElement("div",{className:"report-details-value"},_e(s.createdAt)||"Not available")),e.createElement("div",{className:"report-details-field"},e.createElement("div",{className:"report-details-label"},"Admin reply time"),e.createElement("div",{className:"report-details-value"},_e(s.adminReplyAt)||"Not available"))),e.createElement("div",{className:"report-details-field"},e.createElement("div",{className:"report-details-label"},"Reason"),e.createElement("div",{className:"report-details-value report-details-reason"},s.context||"No reason provided.")),e.createElement("div",{className:"report-details-field"},e.createElement("div",{className:"report-details-label"},"Admin reply"),e.createElement("div",{className:"report-details-value report-details-reason"},s.adminReply||"No admin reply yet."))))}function ze({title:t,subtitle:s}){return e.createElement("div",{className:"empty-state"},e.createElement("h3",null,t),e.createElement("p",null,s))}function ia(){const t=Array.from({length:6}),s=Array.from({length:5});return e.createElement("div",{className:"chat-loading-overlay mobile",role:"status","aria-live":"polite"},e.createElement("div",{className:"chat-loading-mobile"},e.createElement("div",{className:"chat-loading-mobile-header"},e.createElement("div",{className:"chat-loading-sk chat-loading-mobile-logo"}),e.createElement("div",{className:"chat-loading-sk chat-loading-mobile-icon"})),e.createElement("div",{className:"chat-loading-mobile-search-wrap"},e.createElement("div",{className:"chat-loading-sk chat-loading-mobile-search"})),e.createElement("div",{className:"chat-loading-mobile-list"},t.map((r,m)=>e.createElement("div",{className:"chat-loading-mobile-thread",key:m},e.createElement("div",{className:"chat-loading-sk chat-loading-mobile-avatar"}),e.createElement("div",{className:"chat-loading-mobile-thread-meta"},e.createElement("div",{className:"chat-loading-sk chat-loading-mobile-line lg"}),e.createElement("div",{className:"chat-loading-sk chat-loading-mobile-line sm"})),e.createElement("div",{className:"chat-loading-sk chat-loading-mobile-time"})))),e.createElement("div",{className:"chat-loading-mobile-nav"},s.map((r,m)=>e.createElement("div",{className:"chat-loading-mobile-nav-item",key:m},e.createElement("div",{className:"chat-loading-sk chat-loading-mobile-nav-icon"}),e.createElement("div",{className:"chat-loading-sk chat-loading-mobile-nav-label"}))))))}function ma({chats:t,searchValue:s,onSearchChange:r,activeChatId:m,onOpenChat:p,onChatAction:h}){return e.createElement("div",{className:"chat-list-screen"},e.createElement("div",{className:"search-bar"},e.createElement(Ke,{className:"search-icon"}),e.createElement("input",{type:"search",value:s,onChange:u=>r(u.target.value),placeholder:"Search chats or messages","aria-label":"Search chats"})),e.createElement("div",{className:"chat-list",role:"list"},t.length===0?e.createElement(ze,{title:"No chats yet",subtitle:"Start a new chat to compare prices."}):t.map(u=>{const b=Z(u);return e.createElement("div",{key:u.id,className:`chat-item ${m===u.id?"active":""}`,onClick:()=>p(u.id),onKeyDown:E=>{(E.key==="Enter"||E.key===" ")&&(E.preventDefault(),p(u.id))},role:"button",tabIndex:0,"aria-label":`Open chat with ${b}`},e.createElement("div",{className:"chat-avatar"},e.createElement("div",{className:"avatar",style:{backgroundColor:u.color}},H(u)?e.createElement(G,{className:"avatar-blocked-icon",size:16}):ae(u.name)),u.online?e.createElement("span",{className:"status-dot","aria-hidden":"true"}):null),e.createElement("div",{className:"chat-body"},e.createElement("div",{className:"chat-row"},e.createElement("span",{className:"chat-name"},b),e.createElement("span",{className:"chat-time"},Ct(u.lastTime))),e.createElement("div",{className:"chat-row chat-preview"},e.createElement("span",{className:"chat-message"},u.lastMessage?u.lastMessage:"No messages yet"),u.unread>0?e.createElement("span",{className:"chat-unread"},u.unread):null)),e.createElement("div",{className:"chat-actions",onClick:E=>E.stopPropagation(),onKeyDown:E=>E.stopPropagation()},e.createElement(Ye,{ariaLabel:`More options for ${b}`,items:[{label:"Delete chat",onSelect:()=>h(u.id,"delete")},{label:"Report",onSelect:()=>h(u.id,"report")},{label:"Archive",onSelect:()=>h(u.id,"archive")}]})))})))}function da({message:t,query:s,onPreviewImage:r}){const m=t.sender==="me",p=typeof t.attachmentUrl=="string"?t.attachmentUrl:"",h=typeof t.attachmentType=="string"?t.attachmentType.toLowerCase():"",u=typeof t.attachmentName=="string"&&t.attachmentName?t.attachmentName:"Attachment",b=!!t.attachmentIsImage||h.startsWith("image/"),E=!!t.attachmentIsVideo||h.startsWith("video/"),N=typeof t.text=="string"&&t.text.trim().length>0,i={width:"100%",maxWidth:"220px",borderRadius:"10px",display:"block",marginBottom:N?"8px":"0"};return e.createElement("div",{className:`message-row ${m?"me":"them"}`},e.createElement("div",{className:`message-bubble ${m?"outgoing":"incoming"}`},p?e.createElement("div",{className:"message-attachment"},b?e.createElement("button",{className:"message-image-trigger",type:"button",onClick:()=>{r&&r(t)},"aria-label":`Preview ${u}`},e.createElement("img",{src:p,alt:u,loading:"lazy",style:i})):E?e.createElement("video",{controls:!0,preload:"metadata",style:i},e.createElement("source",{src:p,type:h||void 0})):e.createElement("a",{href:p,target:"_blank",rel:"noreferrer"},"Open attachment")):null,N?e.createElement("div",{className:"message-text"},Un(t.text,s)):null,e.createElement("div",{className:"message-meta"},e.createElement("span",null,Ct(t.timestamp)),m?e.createElement(Xn,{status:t.status}):null)))}function ua({preview:t,onClose:s,onSave:r,onReport:m}){return t?e.createElement("div",{className:"attachment-preview-panel",role:"region","aria-label":"Photo preview"},e.createElement("div",{className:"attachment-preview-head"},e.createElement("div",{className:"attachment-preview-title"},"Photo preview"),e.createElement("button",{className:"icon-btn",type:"button",onClick:s,"aria-label":"Close preview"},e.createElement(Tt,null))),e.createElement("div",{className:"attachment-preview-stage"},e.createElement("img",{src:t.url,alt:t.name||"Image preview",loading:"eager"})),e.createElement("div",{className:"attachment-preview-meta"},t.name||"Image"),e.createElement("div",{className:"attachment-preview-actions"},e.createElement("button",{className:"primary-btn",type:"button",onClick:r},"Save"),e.createElement("button",{className:"ghost-btn",type:"button",onClick:m},"Report Photo"))):null}function fa(){return e.createElement("div",{className:"message-row them"},e.createElement("div",{className:"typing-bubble"},e.createElement("span",{className:"typing-label"},"typing"),e.createElement("div",{className:"typing-dots","aria-hidden":"true"},e.createElement("span",null),e.createElement("span",null),e.createElement("span",null))))}function pa(){const t=[!1,!0,!1,!0,!1];return e.createElement("div",{className:"conversation-loading",role:"status","aria-live":"polite","aria-label":"Loading messages"},t.map((s,r)=>e.createElement("div",{key:r,className:`conversation-loading-row ${s?"me":"them"}`},e.createElement("div",{className:"conversation-loading-bubble"},e.createElement("div",{className:"chat-loading-sk conversation-loading-line lg"}),e.createElement("div",{className:"chat-loading-sk conversation-loading-line md"}),e.createElement("div",{className:"chat-loading-sk conversation-loading-line sm"})))))}function ha({value:t,onChange:s,onSend:r,onEmoji:m,onAttach:p,inputRef:h,disabled:u=!1}){d.useEffect(()=>{const E=h==null?void 0:h.current;E&&(E.style.height="auto",E.style.height=`${Math.min(E.scrollHeight,120)}px`)},[t,h]);const b=E=>{E.key==="Enter"&&!E.shiftKey&&(E.preventDefault(),!u&&t.trim()&&r())};return e.createElement("div",{className:"composer"},e.createElement("div",{className:"composer-actions"},e.createElement("button",{className:"icon-btn",type:"button",onClick:m,"aria-label":"Emoji",disabled:u},e.createElement(zn,null)),e.createElement("button",{className:"icon-btn",type:"button",onClick:p,"aria-label":"Attach",disabled:u},e.createElement(Hn,null))),e.createElement("textarea",{ref:h,rows:1,value:t,onChange:E=>s(E.target.value),onKeyDown:b,placeholder:u?"Unblock to send messages":"Type a message","aria-label":"Message input",disabled:u}),e.createElement("button",{className:"send-btn",type:"button",onClick:r,disabled:u||!t.trim(),"aria-label":"Send message"},e.createElement(_n,null)))}function va({open:t,recents:s,onSelect:r,onClose:m}){const[p,h]=d.useState(""),[u,b]=d.useState("recent"),E=d.useRef(null),N=d.useRef(null),i=d.useRef({});He(N,m,t);const k=d.useMemo(()=>{const g=ye.map(C=>C.id==="recent"?{...C,emojis:s}:C);return Bn(g,p)},[s,p]);d.useEffect(()=>{var C;if(!t)return;const g=((C=k[0])==null?void 0:C.id)||"recent";b(g),E.current&&(E.current.scrollTop=0)},[t,p,k]);const j=()=>{const g=E.current;if(!g)return;let C=u;k.forEach(P=>{const U=i.current[P.id];U&&g.scrollTop>=U.offsetTop-40&&(C=P.id)}),C!==u&&b(C)},B=g=>{const C=i.current[g];C&&(C.scrollIntoView({behavior:"smooth",block:"start"}),b(g))},$=g=>{switch(g){case"recent":return"ğŸ•˜";case"smileys":return"ğŸ˜„";case"people":return"ğŸ‘‹";case"nature":return"ğŸŒ¿";case"food":return"ğŸ”";case"travel":return"ğŸ—ºï¸";case"symbols":return"â¤ï¸";default:return"ğŸ™‚"}};return t?e.createElement("div",{className:"emoji-popover","aria-live":"polite"},e.createElement("div",{className:"emoji-picker fade-in",ref:N},e.createElement("div",{className:"picker-header"},e.createElement("div",{className:"search-container"},e.createElement(Ke,{className:"search-icon"}),e.createElement("input",{type:"search",className:"search-input",placeholder:"Search emojis...",value:p,onChange:g=>h(g.target.value),"aria-label":"Search emojis"})),e.createElement("div",{className:"category-tabs",role:"tablist"},k.map(g=>e.createElement("button",{key:g.id,type:"button",className:`category-tab ${u===g.id?"active":""}`,onClick:()=>B(g.id),"aria-label":g.name,"aria-pressed":u===g.id},e.createElement("span",{"aria-hidden":"true"},$(g.id)))))),e.createElement("div",{className:"emoji-list",onScroll:j,ref:E},k.length===0?e.createElement("div",{className:"emoji-empty"},"No emojis found."):k.map(g=>e.createElement("div",{key:g.id,className:"category-section",ref:C=>{i.current[g.id]=C}},e.createElement("div",{className:"category-title"},g.name),e.createElement("div",{className:"emoji-grid"},g.emojis.map((C,P)=>e.createElement("button",{key:`${g.id}-${P}`,type:"button",className:"emoji-item",onClick:()=>r(C),"aria-label":"Emoji"},C)))))))):null}function Ea({chat:t,groupedMessages:s,searchValue:r,showSearch:m,onToggleSearch:p,onSearchChange:h,onBack:u,onSend:b,composerValue:E,onComposerChange:N,onEmoji:i,onAttach:k,emojiOpen:j,emojiRecents:B,onEmojiSelect:$,onEmojiClose:g,composerRef:C,typing:P,conversationLoading:U,messageListRef:X,matchCount:ce,onMenuAction:V,attachmentPreview:ee,onOpenAttachmentPreview:Ce,onCloseAttachmentPreview:ie,onSaveAttachmentPreview:q,onReportAttachmentPreview:ke}){if(!t)return e.createElement("div",{className:"conversation empty-view"},e.createElement(ze,{title:"Select a chat",subtitle:"Choose a conversation to see messages and compare prices."}));if(ee)return e.createElement("div",{className:"conversation attachment-only-view"},e.createElement(ua,{preview:ee,onClose:ie,onSave:q,onReport:ke}));const me=Z(t),O=[{label:"View profile",onSelect:()=>V("profile")},{label:"Close chat",onSelect:()=>V("close")},{label:"Delete chat",onSelect:()=>V("delete")},{label:"Block",onSelect:()=>V("block")},{label:"Report",onSelect:()=>V("report")}];return e.createElement("div",{className:"conversation"},e.createElement("div",{className:"conversation-header"},e.createElement("button",{className:"icon-btn",type:"button",onClick:u,"aria-label":"Back to chats"},e.createElement(It,null)),e.createElement("div",{className:"conversation-title"},e.createElement("div",{className:"avatar",style:{backgroundColor:t.color}},H(t)?e.createElement(G,{className:"avatar-blocked-icon",size:16}):ae(t.name)),e.createElement("div",{className:"conversation-title-text"},e.createElement("div",{className:"conversation-name"},me),e.createElement("div",{className:"conversation-status"},P?e.createElement("span",null,"Typing..."):e.createElement(e.Fragment,null,t.online?e.createElement("span",{className:"presence-dot"}):null,e.createElement("span",null,t.online?"online":t.presence))))),e.createElement("div",{className:"conversation-actions"},e.createElement(Ye,{ariaLabel:"Conversation menu",items:O}))),m?e.createElement("div",{className:"conversation-search"},e.createElement(Ke,{className:"search-icon"}),e.createElement("input",{type:"search",value:r,onChange:_=>h(_.target.value),placeholder:"Search in conversation","aria-label":"Search within conversation"}),r?e.createElement("span",{className:"search-count"},ce," match",ce===1?"":"es"):null):null,e.createElement("div",{className:"conversation-scroll",ref:X},U?e.createElement(pa,null):s.length===0?e.createElement(ze,{title:r?"No matches":"No messages yet",subtitle:r?"Try a different phrase.":"Send a message to start the chat."}):s.map(_=>_.type==="day"?e.createElement("div",{key:_.id,className:"day-separator"},_.label):e.createElement(da,{key:_.id,message:_.message,query:r.trim(),onPreviewImage:Ce})),P&&!r&&!U?e.createElement(fa,null):null,!U&&H(t)?e.createElement("div",{className:"blocked-notice",role:"note"},t.blockedByOther?"You cannot message this account.":"You blocked this account. Unblock to send messages."):null),e.createElement(ha,{value:E,onChange:N,onSend:b,onEmoji:i,onAttach:k,inputRef:C,disabled:H(t)}),e.createElement(va,{open:j,recents:B,onSelect:$,onClose:g}))}function ga({activeKey:t,onSelect:s}){const r=[{key:"home",label:"Home",icon:Zn},{key:"archive",label:"Archive",icon:Wn},{key:"chats",label:"Chats",icon:qn},{key:"block",label:"Block",icon:G},{key:"profile",label:"My Profile",icon:Qn}];return e.createElement("nav",{className:"bottom-nav","aria-label":"Primary"},r.map(m=>{const p=m.icon;return e.createElement("button",{key:m.key,className:`nav-btn ${t===m.key?"active":""}`,type:"button",onClick:()=>s(m.key),"aria-label":m.label},e.createElement("span",{className:"icon-box"},e.createElement(p,null)),e.createElement("span",null,m.label))}))}function ba({currentUser:t=Ve,initialChats:s=Ln,initialMessages:r=jn}){const m={...Ve,...t&&typeof t=="object"?t:{}},p=Array.isArray(s)?s:[],h=r&&typeof r=="object"?r:{},[u,b]=d.useState(p),[E,N]=d.useState(h),[i,k]=d.useState(null),[j,B]=d.useState(""),[$,g]=d.useState(""),[C,P]=d.useState(!1),[U,X]=d.useState(""),[ce,V]=d.useState(!1),[ee,Ce]=d.useState(()=>{var n,a,l;if(typeof window>"u")return((n=ye[0])==null?void 0:n.emojis)||[];try{const o=window.localStorage.getItem(yt);return o?JSON.parse(o):((a=ye[0])==null?void 0:a.emojis)||[]}catch{return((l=ye[0])==null?void 0:l.emojis)||[]}}),[ie,q]=d.useState(!1),[ke,me]=d.useState(!1),[O,_]=d.useState(null),[Ze,de]=d.useState([]),[we,Se]=d.useState([]),[Ie,qe]=d.useState(!1),[K,Te]=d.useState(null),[At,Ae]=d.useState(!1),[ue,fe]=d.useState(""),[We,pe]=d.useState(""),[te,Be]=d.useState(null),[F,Re]=d.useState(null),[Na,Je]=d.useState(null),[Bt,xe]=d.useState(!1),[Qe,Ge]=d.useState(()=>""),[Xe,et]=d.useState(()=>""),[Rt,se]=d.useState(""),[Me,tt]=d.useState(!1),[xt,he]=d.useState(null),[ve,nt]=d.useState({sessionId:"",sessionCsrf:"",userId:"",realtimeToken:""}),[ne,at]=d.useState({open:!1,title:"",message:"",confirmLabel:"Confirm",onConfirm:null}),[L,Ee]=d.useState("chats"),st=d.useRef(null),le=d.useRef(null),De=d.useRef(null),re=d.useRef(null),W=d.useRef(null),Y=d.useRef(null),R=d.useRef({lastSentAt:0,lastValue:!1,idleTimer:null}),T=ve.sessionId,A=ve.sessionCsrf,D=ve.userId,Le=ve.realtimeToken,I=!!(T&&A&&D),w=u.find(n=>n.id===i)||null,Mt=d.useMemo(()=>u.filter(n=>n.archived),[u]),Dt=d.useMemo(()=>{const n=new Map;return Ze.forEach(a=>{a!=null&&a.id&&n.set(a.id,{id:a.id,name:a.name||"Unknown",blockedAt:a.blockedAt||"",color:a.color||"#3b82f6"})}),Array.from(n.values())},[Ze]),je=d.useMemo(()=>u.filter(n=>!n.archived),[u]),Lt=d.useMemo(()=>{const n=j.trim().toLowerCase();return n?je.filter(a=>a.name.toLowerCase().includes(n)||(a.lastMessage||"").toLowerCase().includes(n)):je},[je,j]),ge=w?E[i]||[]:[],Pe=d.useMemo(()=>{const n=$.trim().toLowerCase();return n?ge.filter(a=>a.text.toLowerCase().includes(n)):ge},[ge,$]),jt=d.useMemo(()=>On(Pe),[Pe]),Pt=!!(i&&xt===i),lt=()=>{Y.current&&(window.clearTimeout(Y.current),Y.current=null),R.current.idleTimer&&(window.clearTimeout(R.current.idleTimer),R.current.idleTimer=null)},be=async(n,{force:a=!1}={})=>{const l=W.current;if(!l||!D)return;const o=!!n,c=Date.now(),f=R.current;if(!(!a&&f.lastValue===o&&c-f.lastSentAt<600)){f.lastValue=o,f.lastSentAt=c;try{await l.send({type:"broadcast",event:"typing",payload:{isTyping:o,userId:String(D)}})}catch{}}};d.useEffect(()=>{let n=!1;return(async()=>{if(!i||!D||!Le||!I){q(!1);return}try{const l=await Nn();if(!l||n)return;l.realtime.setAuth(Le);const o=W.current;if(o)try{await o.unsubscribe()}catch{}W.current=null,lt(),R.current.lastValue=!1;const c=l.channel(`conversation:${i}`,{config:{presence:{key:`chat:${String(D)}`}}});c.on("broadcast",{event:"typing"},({payload:f})=>{const y=String((f==null?void 0:f.userId)||"");if(!y||y===String(D))return;const S=!!(f!=null&&f.isTyping);q(S),Y.current&&(window.clearTimeout(Y.current),Y.current=null),S&&(Y.current=window.setTimeout(()=>{q(!1),Y.current=null},3e3))}),c.subscribe(async f=>{if(!(n||f!=="SUBSCRIBED"))try{await c.track({userId:String(D),at:new Date().toISOString()})}catch{}}),W.current=c}catch{n||q(!1)}})(),()=>{n=!0;const l=W.current;if(W.current=null,l)try{l.unsubscribe()}catch{}lt(),R.current.lastValue=!1,q(!1)}},[i,I,D,Le]),d.useEffect(()=>{if(!i||!D||!W.current)return;const n=U.trim().length>0,a=Date.now(),l=R.current;n!==l.lastValue&&a-l.lastSentAt>600&&be(n,{force:!0}),l.idleTimer&&(window.clearTimeout(l.idleTimer),l.idleTimer=null),n&&(l.idleTimer=window.setTimeout(()=>{R.current.idleTimer=null,be(!1,{force:!0})},2e3))},[U,i,D]),d.useEffect(()=>{if(!i||$.trim())return;const n=st.current;n&&requestAnimationFrame(()=>{n.scrollTo({top:n.scrollHeight,behavior:"smooth"})})},[i,ge.length,ie,$]),d.useEffect(()=>{i||V(!1)},[i]),d.useEffect(()=>{Re(null)},[i]),d.useEffect(()=>()=>{re.current&&clearTimeout(re.current)},[]),d.useEffect(()=>{if(!(typeof window>"u"))try{window.localStorage.setItem(yt,JSON.stringify(ee))}catch{}},[ee]),d.useEffect(()=>{(!i||!I)&&he(null)},[i,I]);const v=n=>{Je(n),re.current&&clearTimeout(re.current),re.current=setTimeout(()=>Je(null),2400)},Ot=n=>{if(!n||typeof n!="object")return;const a=typeof n.attachmentUrl=="string"?n.attachmentUrl.trim():"",l=typeof n.attachmentType=="string"?n.attachmentType.toLowerCase():"",o=!!n.attachmentIsImage||l.startsWith("image/");if(!a||!o)return;const c=typeof n.attachmentName=="string"&&n.attachmentName?n.attachmentName:"photo";Re({url:a,name:c,messageId:typeof n.id=="string"?n.id:""})},$t=()=>{Re(null)},Ut=async()=>{if(!(F!=null&&F.url))return;const n=F.name||"photo";try{const a=await fetch(F.url);if(!a.ok)throw new Error("download_failed");const l=await a.blob(),o=window.URL.createObjectURL(l),c=document.createElement("a");c.href=o,c.download=n,document.body.appendChild(c),c.click(),c.remove(),window.URL.revokeObjectURL(o),v("Image saved.")}catch{const a=document.createElement("a");a.href=F.url,a.target="_blank",a.rel="noreferrer",a.click(),v("Could not save directly. Opened image in a new tab.")}},Ft=()=>{if(!w){v("No chat selected.");return}Be(w),fe(""),pe(F!=null&&F.name?`Photo attachment: ${F.name}`:"Photo attachment"),Ae(!0)},Vt=()=>{if(!i){v("Select a chat to add emojis.");return}V(n=>!n)},_t=()=>V(!1),zt=n=>{n&&(Ce(a=>[n,...a.filter(l=>l!==n)].slice(0,24)),X(a=>{const{nextValue:l,caret:o}=Fn(a,n,le.current);return requestAnimationFrame(()=>{le.current&&(le.current.focus(),le.current.setSelectionRange(o,o))}),l}))};d.useEffect(()=>{if(!i||!I)return;let n=!1;he(i);const a=async({silent:o=!1}={})=>{try{const{messages:c,chatPatch:f}=await Cn({sessionId:T,sessionCsrf:A,conversationId:i,currentUserId:D});if(n)return;N(y=>({...y,[i]:c})),b(y=>y.map(S=>S.id===i?{...S,...f||{},unread:0}:S));try{await kn({sessionId:T,sessionCsrf:A,conversationId:i})}catch{}}catch(c){!n&&!o&&v((c==null?void 0:c.message)||"Failed to load chat messages.")}finally{n||he(c=>c===i?null:c)}};a();const l=window.setInterval(()=>{a({silent:!0})},5e3);return()=>{n=!0,window.clearInterval(l)}},[i,I,T,A,D]);const Ht=n=>{n&&(Te(n),qe(!0))},rt=()=>{qe(!1),Te(null)},Oe=n=>{n&&(Be(n),fe(""),pe(""),Ae(!0))},ot=()=>{Ae(!1),Be(null),fe(""),pe("")},Kt=async()=>{var o;if(!te||!ue)return;if(!I){v("Connect first to submit reports.");return}const n=((o=bt.find(c=>c.value===ue))==null?void 0:o.label)||ue,a=We.trim(),l=a?`${n} - ${a}`:n;try{await Sn({sessionId:T,sessionCsrf:A,conversationId:te.id,recipientId:te.otherPartyId,reason:l});try{const c=await ht({sessionId:T,sessionCsrf:A});Se(c)}catch{}ot(),v("Report sent.")}catch(c){v((c==null?void 0:c.message)||"Failed to submit report.")}},J=({title:n,message:a,confirmLabel:l,onConfirm:o})=>{at({open:!0,title:n,message:a,confirmLabel:l,onConfirm:o})},z=()=>{at(n=>({...n,open:!1}))},Yt=()=>{se(""),T&&A&&(Ge(T),et(A)),xe(!0)},Zt=()=>{se(""),xe(!1)},qt=async(n,a,l={})=>{const o=!!(l!=null&&l.silent);if(Me)return!1;const c=n.trim(),f=a.trim();if(!c||!f)return o||se("Session ID and Session CSRF are required."),!1;tt(!0),o||se("");try{const y=await Rn({sessionId:c,sessionCsrf:f}),{chats:S,blockedAccounts:x,reports:oe}=await xn({sessionId:c,sessionCsrf:f});return nt({sessionId:c,sessionCsrf:f,userId:y.userId,realtimeToken:y.token||""}),b(S),de(x),N({}),Se(oe),k(null),B(""),g(""),P(!1),Ee("chats"),xe(!1),!o&&S.length===0?v("Connected. No chats found."):o||v(`Connected. Loaded ${S.length} chat${S.length===1?"":"s"}.`),!0}catch(y){return o||se((y==null?void 0:y.message)||"Failed to connect session."),!1}finally{tt(!1)}};d.useEffect(()=>{},[]);const Wt=async()=>{await qt(Qe,Xe)},ct=async(n,a={})=>{a.unarchive&&!await ut(n,{clearActive:!1,toast:!0})||(k(n),V(!1),I&&he(n),b(l=>l.map(o=>o.id===n?{...o,unread:0}:o)),P(!1),g(""))},it=(n,a,l)=>{N(o=>{const c=o[n]||[];return{...o,[n]:c.map(f=>f.id===a?{...f,status:l}:f)}})},Jt=async()=>{const n=U.trim();if(!n||!i)return;if(H(w)){v(w!=null&&w.blockedByOther?"You cannot message this account.":"Unblock this account to send messages.");return}if(I){try{const l=await wn({sessionId:T,sessionCsrf:A,conversationId:i,content:n}),o=vt(l==null?void 0:l.data,D);N(c=>({...c,[i]:[...c[i]||[],o]})),X(""),b(c=>{const f=c.map(x=>x.id===i?{...x,lastMessage:o.text||n,lastTime:o.timestamp||new Date().toISOString(),unread:0}:x),y=f.find(x=>x.id===i),S=f.filter(x=>x.id!==i);return y?[y,...S]:f}),R.current.idleTimer&&(window.clearTimeout(R.current.idleTimer),R.current.idleTimer=null),R.current.lastValue=!1,be(!1,{force:!0})}catch(l){v((l==null?void 0:l.message)||"Failed to send message.")}return}const a={id:`m-${Date.now()}`,chatId:i,sender:"me",text:n,timestamp:new Date().toISOString(),status:"sent"};N(l=>({...l,[i]:[...l[i]||[],a]})),X(""),b(l=>{const o=l.map(y=>y.id===i?{...y,lastMessage:n,lastTime:a.timestamp,unread:0}:y),c=o.find(y=>y.id===i),f=o.filter(y=>y.id!==i);return c?[c,...f]:o}),setTimeout(()=>it(i,a.id,"delivered"),900),setTimeout(()=>it(i,a.id,"read"),2e3),R.current.idleTimer&&(window.clearTimeout(R.current.idleTimer),R.current.idleTimer=null),R.current.lastValue=!1,be(!1,{force:!0})},Qt=()=>{if(!i){v("Select a chat first.");return}if(!I){v("Connect your session first.");return}if(H(w)){v(w!=null&&w.blockedByOther?"You cannot message this account.":"Unblock this account to send messages.");return}De.current&&De.current.click()},Gt=async n=>{var o;const a=n.target,l=(o=a==null?void 0:a.files)==null?void 0:o[0];if(a&&(a.value=""),!!l){if(!i){v("Select a chat first.");return}if(!I){v("Connect your session first.");return}if(H(w)){v(w!=null&&w.blockedByOther?"You cannot message this account.":"Unblock this account to send messages.");return}try{const c=await In({sessionId:T,sessionCsrf:A,conversationId:i,file:l}),f=vt(c==null?void 0:c.data,D);N(y=>({...y,[i]:[...y[i]||[],f]})),b(y=>{const S=y.map(Q=>Q.id===i?{...Q,lastMessage:f.text||l.name,lastTime:f.timestamp||new Date().toISOString(),unread:0}:Q),x=S.find(Q=>Q.id===i),oe=S.filter(Q=>Q.id!==i);return x?[x,...oe]:S}),v("Attachment sent.")}catch(c){v((c==null?void 0:c.message)||"Failed to send attachment.")}}},Xt=n=>{N(a=>({...a,[n]:[]})),b(a=>a.map(l=>l.id===n?{...l,lastMessage:"No messages yet",lastTime:"",unread:0}:l))},en=()=>{if(i){Xt(i),v("Cleared current chat.");return}const n={};u.forEach(a=>{n[a.id]=[]}),N(n),b(a=>a.map(l=>({...l,lastMessage:"No messages yet",lastTime:"",unread:0}))),v("Cleared all chats.")},$e=n=>{if(!Array.isArray(n)||n.length===0)return;const a=new Set(n.filter(Boolean));a.size&&(b(l=>l.filter(o=>!a.has(o.id))),N(l=>{const o={...l};return a.forEach(c=>{delete o[c]}),o}),i&&a.has(i)&&k(null))},Ue=async(n,a={})=>{const l=typeof n=="string"?n.trim():"";if(!l)return!1;const o=a.toast!==!1;if(I)try{await gt({sessionId:T,sessionCsrf:A,conversationId:l})}catch(c){return v((c==null?void 0:c.message)||"Failed to delete chat."),!1}return $e([l]),o&&v("Chat deleted."),!0},tn=async()=>{const n=u.map(o=>o.id).filter(Boolean);if(n.length===0)return v("No chats to delete."),!1;if(!I)return $e(n),v("All chats deleted."),!0;const a=[];for(const o of n)try{await gt({sessionId:T,sessionCsrf:A,conversationId:o}),a.push(o)}catch{}a.length>0&&$e(a);const l=n.length-a.length;return a.length===0?(v("Failed to delete chats."),!1):l===0?(v("All chats deleted."),!0):(v(`Deleted ${a.length} chat${a.length===1?"":"s"}. ${l} failed.`),!1)},nn=async()=>{if(i){await Ue(i);return}await tn()},an=(n,a)=>{const l=u.find(S=>S.id===n),o=(l==null?void 0:l.otherPartyId)||n;if(!o)return;const c=a||new Date().toISOString(),f=(l==null?void 0:l.name)||"Unknown",y=(l==null?void 0:l.color)||"#3b82f6";de(S=>{const x=S.filter(oe=>oe.id!==o);return[{id:o,name:f,blockedAt:c,color:y},...x]})},mt=({accountId:n,conversationId:a=""})=>{const l=typeof n=="string"?n.trim():"",o=typeof a=="string"?a.trim():"";b(c=>c.map(f=>{const y=!!o&&f.id===o,S=!!l&&f.otherPartyId===l;if(!y&&!S)return f;const x=!!f.blockedByOther;return{...f,blocked:!1,blockedByMe:!1,hasBlockingRelationship:x,blockedAt:void 0}})),l&&de(c=>c.filter(f=>f.id!==l))},dt=async n=>{if(!n)return!1;if(I)try{await Mn({sessionId:T,sessionCsrf:A,conversationId:n})}catch(l){return v((l==null?void 0:l.message)||"Failed to block account."),!1}const a=new Date().toISOString();return b(l=>l.map(o=>o.id===n?{...o,blocked:!0,blockedByMe:!0,hasBlockingRelationship:!0,blockedAt:a}:o)),an(n,a),i===n&&k(null),v("Chat blocked."),!0},sn=async n=>{if(!n)return!1;const a=u.find(o=>o.id===n),l=(a==null?void 0:a.otherPartyId)||"";if(I)try{await Et({sessionId:T,sessionCsrf:A,conversationId:n||void 0,recipientId:l||void 0})}catch(o){return v((o==null?void 0:o.message)||"Failed to unblock account."),!1}return mt({accountId:l,conversationId:n}),v("Account unblocked."),!0},ln=async n=>{const a=typeof n=="string"?n.trim():"";if(!a)return!1;const l=u.find(c=>c.otherPartyId===a),o=(l==null?void 0:l.id)||"";if(I)try{await Et({sessionId:T,sessionCsrf:A,conversationId:o||void 0,recipientId:a})}catch(c){return v((c==null?void 0:c.message)||"Failed to unblock account."),!1}return mt({accountId:a,conversationId:o}),v("Account unblocked."),!0},rn=async(n,a={})=>{if(!n)return!1;const l=a.clearActive!==!1,o=a.toast!==!1;if(I)try{await An({sessionId:T,sessionCsrf:A,conversationId:n})}catch(c){return v((c==null?void 0:c.message)||"Failed to archive chat."),!1}return b(c=>c.map(f=>f.id===n?{...f,archived:!0,archivedAt:new Date().toISOString()}:f)),l&&i===n&&k(null),o&&v("Chat archived."),!0},ut=async(n,a={})=>{if(!n)return!1;const l=a.clearActive===!0,o=a.toast!==!1;if(I)try{await Tn({sessionId:T,sessionCsrf:A,conversationId:n})}catch(c){return v((c==null?void 0:c.message)||"Failed to restore chat."),!1}return b(c=>c.map(f=>f.id===n?{...f,archived:!1,archivedAt:void 0}:f)),l&&i===n&&k(null),o&&v("Chat restored from archive."),!0},ft=n=>{if(n==="profile"){if(!i){v("No chat selected.");return}const a=u.find(l=>l.id===i)||null;_(a),me(!0);return}if(n==="close"){k(null),P(!1),g(""),v("Chat closed.");return}if(n==="block"){if(!i)return;const a=u.find(o=>o.id===i),l=(a==null?void 0:a.id)||i;J({title:a?`Block ${a.name}?`:"Block chat?",message:"They won't be able to message you.",confirmLabel:"Block",onConfirm:async()=>{z(),await dt(l)}});return}if(n==="delete"){const a=w?`Delete chat with ${Z(w)}?`:"Delete all chats?";J({title:a,message:w?"This removes the chat from your list.":"This removes every chat from your list.",confirmLabel:"Delete",onConfirm:()=>{z(),nn()}});return}if(n==="clear"){const a=w?`Clear chat with ${w.name}?`:"Clear all chats?";J({title:a,message:w?"This clears the messages in this chat.":"This clears the messages in every chat.",confirmLabel:"Clear",onConfirm:()=>{z(),en()}});return}n==="report"&&Oe(w)},on=n=>{ft(n)},cn=(n,a)=>{const l=u.find(o=>o.id===n);if(l){if(a==="delete"){J({title:`Delete chat with ${Z(l)}?`,message:"This removes the chat from your list.",confirmLabel:"Delete",onConfirm:()=>{z(),Ue(n)}});return}if(a==="report"){Oe(l);return}if(a==="archive"){rn(n,{clearActive:!0,toast:!0});return}}},mn=()=>{P(n=>{const a=!n;return a||g(""),a})},Fe=()=>{me(!1),_(null)},dn=()=>{O&&J({title:`Delete chat with ${Z(O)}?`,message:"This removes the chat from your list.",confirmLabel:"Delete",onConfirm:()=>{z(),(async()=>await Ue(O.id)&&Fe())()}})},un=()=>{if(!O)return;const n=O.id,a=!!O.blocked,l=Z(O);J({title:a?`Unblock ${l}?`:`Block ${l}?`,message:a?"They will be able to message you again.":"They won't be able to message you.",confirmLabel:a?"Unblock":"Block",onConfirm:async()=>{z(),(a?await sn(n):await dt(n))&&Fe()}})},fn=()=>{O&&Oe(O)},pn=n=>{if(n==="home"){Ee(n),window.location.href="homepage.html";return}(n==="chats"||n==="archive"||n==="block"||n==="profile"||n==="reports")&&k(null),Ee(n);const a=n.charAt(0).toUpperCase()+n.slice(1);v(`${a} selected.`)},hn=n=>{ut(n,{clearActive:!1,toast:!0})},vn=n=>{ln(n)},En=[{label:"Connect",onSelect:Yt},{label:"Delete chats",onSelect:()=>ft("delete")},{label:"Reports",onSelect:()=>Ee("reports")},{label:"Logout",onSelect:()=>J({title:"Log out?",message:"This will sign you out of CompareHubPrices Chat.",confirmLabel:"Log out",onConfirm:()=>{z(),nt({sessionId:"",sessionCsrf:"",userId:"",realtimeToken:""}),v("Logged out.")}})}],pt=i||L==="archive"||L==="block"||L==="profile"||L==="reports",gn=Me;return d.useEffect(()=>{if(!I||L!=="block")return;let n=!1;return(async()=>{try{const a=await bn({sessionId:T,sessionCsrf:A});n||de(a)}catch{}})(),()=>{n=!0}},[I,L,T,A]),d.useEffect(()=>{if(!I||L!=="reports")return;let n=!1;return(async()=>{try{const a=await ht({sessionId:T,sessionCsrf:A});n||Se(a)}catch{}})(),()=>{n=!0}},[I,L,T,A]),d.useEffect(()=>{if(!Ie||!(K!=null&&K.id))return;const n=we.find(a=>a.id===K.id);if(!n){rt();return}Te(n)},[Ie,K==null?void 0:K.id,we]),e.createElement("div",{className:`chp-app${i?" chat-only":""}${pt&&!i?" no-header":""}`},pt?null:e.createElement("header",{className:"app-bar"},e.createElement("div",{className:"app-title"},e.createElement("img",{src:yn,alt:"CompareHubPrices",className:"app-logo"})),e.createElement("div",{className:"app-actions"},e.createElement(Ye,{ariaLabel:"App menu",items:En}))),e.createElement("main",{className:"chp-main","data-view":i?"chat":"list"},e.createElement("section",{className:"chp-pane chp-list-pane"},L==="archive"?e.createElement(la,{chats:Mt,onOpenChat:ct,onUnarchive:hn}):L==="block"?e.createElement(ra,{chats:Dt,onUnblock:vn}):L==="profile"?e.createElement(sa,{currentUser:m}):L==="reports"?e.createElement(oa,{reports:we,onOpenReport:Ht}):e.createElement(ma,{chats:Lt,searchValue:j,onSearchChange:B,activeChatId:i,onOpenChat:ct,onChatAction:cn})),e.createElement("section",{className:"chp-pane chp-convo-pane"},ke?e.createElement(aa,{chat:O,onClose:Fe,onDelete:dn,onBlock:un,onReport:fn}):e.createElement(Ea,{chat:w,groupedMessages:jt,searchValue:$,showSearch:C,onToggleSearch:mn,onSearchChange:g,onBack:()=>k(null),onSend:Jt,composerValue:U,onComposerChange:X,onEmoji:Vt,onAttach:Qt,emojiOpen:ce,emojiRecents:ee,onEmojiSelect:zt,onEmojiClose:_t,composerRef:le,typing:ie,conversationLoading:Pt,messageListRef:st,matchCount:Pe.length,onMenuAction:on,attachmentPreview:F,onOpenAttachmentPreview:Ot,onCloseAttachmentPreview:$t,onSaveAttachmentPreview:Ut,onReportAttachmentPreview:Ft}))),i?null:e.createElement(ga,{activeKey:L,onSelect:pn}),gn?e.createElement(ia,null):null,e.createElement(ca,{open:Ie,report:K,onClose:rt}),e.createElement(na,{open:At,onClose:ot,reasons:bt,value:ue,onChange:fe,details:We,onDetailsChange:pe,onSubmit:Kt,targetName:te==null?void 0:te.name}),e.createElement(ta,{open:Bt,sessionId:Qe,sessionCsrf:Xe,error:Rt,busy:Me,onSessionIdChange:Ge,onSessionCsrfChange:et,onConnect:Wt,onCancel:Zt}),e.createElement(ea,{open:ne.open,title:ne.title,message:ne.message,confirmLabel:ne.confirmLabel,onConfirm:()=>{ne.onConfirm?ne.onConfirm():z()},onCancel:z}),e.createElement("input",{ref:De,type:"file",accept:".pdf,image/png,image/jpeg,image/webp,video/mp4,video/webm,video/quicktime,.mov,.m4v",onChange:Gt,style:{display:"none"}}))}const ya=Dn(document.getElementById("root"));ya.render(e.createElement(e.StrictMode,null,e.createElement(ba,null)));
