import{r as c,f as Ra,a as Rt,R as e,l as Da,g as Pa,b as La,m as ja,s as Oa,c as Dt,j as Pt,o as $a,d as Ua,e as Fa,h as Va,i as _a,k as Ha,u as za,p as Lt,n as Ya,q as Za}from"./emojiSearch-D0DrxmU_.js";const le={name:"",firstName:"",lastName:"",status:"",about:"",email:"",phone:"",suburb:"",city:"",province:"",accountSince:""},qa=[],Ka={},jt=[{value:"spam",label:"Spam"},{value:"harassment",label:"Harassment"},{value:"scam",label:"Scam"},{value:"other",label:"Other"}];function Wa(){if(typeof document>"u")return null;const a=Ot("standard_session_id"),s=Ot("standard_csrf_token");return!a||!s?null:{sessionId:a,sessionCsrf:s}}function Ja(){typeof document>"u"||($t("standard_session_id"),$t("standard_csrf_token"))}function Ot(a){var s,l;if(!a||typeof document>"u")return"";try{const p=`; ${document.cookie}`.split(`; ${a}=`);if(p.length!==2)return"";const g=((l=(s=p.pop())==null?void 0:s.split(";").shift())==null?void 0:l.trim())||"";if(!g)return"";try{return decodeURIComponent(g).trim()}catch{return g}}catch{return""}}function $t(a){var l;const s=typeof window<"u"&&((l=window.location)==null?void 0:l.protocol)==="https:"?"; Secure":"";document.cookie=`${a}=; path=/; max-age=0; SameSite=Lax${s}`}function Qa(){if(typeof window>"u")return{conversationId:"",recipientId:"",recipientName:""};try{const a=new URLSearchParams(window.location.search||"");return{conversationId:(a.get("conversationId")||"").trim(),recipientId:(a.get("recipientId")||"").trim(),recipientName:(a.get("recipientName")||"").trim()}}catch{return{conversationId:"",recipientId:"",recipientName:""}}}function Ga(a){return a!=null&&a.id?{id:"",name:String(a.name||"").trim()||"Business",firstName:"",lastName:"",suburb:"",city:"",province:"",streetAddress:"",accountSince:"",accountType:"Business",lastMessage:"No messages yet",lastTime:"",unread:0,online:!1,presence:"Start conversation",color:"#3b82f6",archived:!1,blocked:!1,blockedByMe:!1,blockedByOther:!1,hasBlockingRelationship:!1,otherPartyId:a.id,launchPending:!0}:null}const Ut="chp_recent_emojis",De=[{id:"recent",name:"Recent",icon:'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>',emojis:["ğŸ˜‚","â¤ï¸","ğŸ‘","ğŸ”¥","ğŸ˜Š","ğŸ™","ğŸ¥º","ğŸ¤£"]},{id:"smileys",name:"Smileys & Emotion",icon:'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M8 14s1.5 2 4 2 4-2 4-2"></path><line x1="9" y1="9" x2="9.01" y2="9"></line><line x1="15" y1="9" x2="15.01" y2="9"></line></svg>',emojis:["ğŸ˜€","ğŸ˜ƒ","ğŸ˜„","ğŸ˜","ğŸ˜†","ğŸ˜…","ğŸ˜‚","ğŸ¤£","ğŸ˜Š","ğŸ˜‡","ğŸ™‚","ğŸ™ƒ","ğŸ˜‰","ğŸ˜Œ","ğŸ˜","ğŸ¥°","ğŸ˜˜","ğŸ˜—","ğŸ˜™","ğŸ˜š","ğŸ˜‹","ğŸ˜›","ğŸ˜","ğŸ˜œ","ğŸ¤ª","ğŸ¤¨","ğŸ§","ğŸ¤“","ğŸ˜","ğŸ¤©","ğŸ¥³","ğŸ˜","ğŸ˜’","ğŸ˜","ğŸ˜”","ğŸ˜Ÿ","ğŸ˜•","ğŸ™","â˜¹ï¸","ğŸ˜£","ğŸ˜–","ğŸ˜«","ğŸ˜©","ğŸ¥º","ğŸ˜¢","ğŸ˜­","ğŸ˜¤","ğŸ˜ ","ğŸ˜¡","ğŸ¤¬","ğŸ¤¯","ğŸ˜³","ğŸ¥µ","ğŸ¥¶","ğŸ˜±","ğŸ˜¨","ğŸ˜°","ğŸ˜¥","ğŸ˜“","ğŸ¤—","ğŸ¤”","ğŸ¤­","ğŸ¤«","ğŸ¤¥","ğŸ˜¶","ğŸ˜","ğŸ˜‘","ğŸ˜¬","ğŸ™„","ğŸ˜¯","ğŸ˜¦","ğŸ˜§","ğŸ˜®","ğŸ˜²","ğŸ¥±","ğŸ˜´","ğŸ¤¤","ğŸ˜ª","ğŸ˜µ","ğŸ¤","ğŸ¥´","ğŸ¤¢","ğŸ¤®","ğŸ¤§","ğŸ˜·","ğŸ¤’","ğŸ¤•","ğŸ¤‘","ğŸ¤ ","ğŸ˜ˆ","ğŸ‘¿","ğŸ‘¹","ğŸ‘º","ğŸ¤¡","ğŸ’©","ğŸ‘»","ğŸ’€","â˜ ï¸","ğŸ‘½","ğŸ‘¾","ğŸ¤–","ğŸƒ"]},{id:"people",name:"People & Body",icon:'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 11V6a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v5"></path><path d="M14 10V4a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v10"></path><path d="M10 10.5V6a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v8"></path><path d="M18 8a2 2 0 1 1 4 0v6a8 8 0 0 1-8 8h-2c-2.8 0-4.5-.86-5.99-2.34l-3.6-3.6a2 2 0 0 1 2.83-2.82L7 15"></path></svg>',emojis:["ğŸ‘‹","ğŸ¤š","ğŸ–ï¸","âœ‹","ğŸ––","ğŸ‘Œ","ğŸ¤","âœŒï¸","ğŸ¤","ğŸ¤Ÿ","ğŸ¤˜","ğŸ¤™","ğŸ‘ˆ","ğŸ‘‰","ğŸ‘†","ğŸ–•","ğŸ‘‡","â˜ï¸","ğŸ‘","ğŸ‘","âœŠ","ğŸ‘Š","ğŸ¤›","ğŸ¤œ","ğŸ‘","ğŸ™Œ","ğŸ‘","ğŸ¤²","ğŸ¤","ğŸ™","âœï¸","ğŸ’…","ğŸ¤³","ğŸ’ª","ğŸ¦¾","ğŸ¦µ","ğŸ¦¿","ğŸ¦¶","ğŸ‘‚","ğŸ¦»","ğŸ‘ƒ","ğŸ§ ","ğŸ¦·","ğŸ¦´","ğŸ‘€","ğŸ‘ï¸","ğŸ‘…","ğŸ‘„","ğŸ‘¶","ğŸ§’","ğŸ‘¦","ğŸ‘§","ğŸ§‘","ğŸ‘±","ğŸ‘¨","ğŸ§”","ğŸ‘©","ğŸ§“","ğŸ‘´","ğŸ‘µ","ğŸ‘¨â€âš•ï¸","ğŸ‘©â€âš•ï¸","ğŸ‘¨â€ğŸ“","ğŸ‘©â€ğŸ“","ğŸ‘¨â€ğŸ«","ğŸ‘©â€ğŸ«","ğŸ‘¨â€âš–ï¸","ğŸ‘©â€âš–ï¸","ğŸ‘¨â€ğŸŒ¾","ğŸ‘©â€ğŸŒ¾","ğŸ‘¨â€ğŸ³","ğŸ‘©â€ğŸ³","ğŸ‘¨â€ğŸ”§","ğŸ‘©â€ğŸ”§","ğŸ‘¨â€ğŸ­","ğŸ‘©â€ğŸ­","ğŸ‘¨â€ğŸ’¼","ğŸ‘©â€ğŸ’¼","ğŸ‘¨â€ğŸ”¬","ğŸ‘©â€ğŸ”¬","ğŸ‘¨â€ğŸ’»","ğŸ‘©â€ğŸ’»","ğŸ‘¨â€ğŸ¤","ğŸ‘©â€ğŸ¤","ğŸ‘¨â€ğŸ¨","ğŸ‘©â€ğŸ¨","ğŸ‘¨â€âœˆï¸","ğŸ‘©â€âœˆï¸","ğŸ‘¨â€ğŸš€","ğŸ‘©â€ğŸš€","ğŸ‘¨â€ğŸš’","ğŸ‘©â€ğŸš’","ğŸ‘®","ğŸ•µï¸","ğŸ’‚","ğŸ‘·","ğŸ¤´","ğŸ‘¸","ğŸ‘³","ğŸ‘²","ğŸ§•","ğŸ¤µ","ğŸ‘°"]},{id:"nature",name:"Animals & Nature",icon:'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10Z"></path><path d="M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12"></path></svg>',emojis:["ğŸ¶","ğŸ±","ğŸ­","ğŸ¹","ğŸ°","ğŸ¦Š","ğŸ»","ğŸ¼","ğŸ»â€â„ï¸","ğŸ¨","ğŸ¯","ğŸ¦","ğŸ®","ğŸ·","ğŸ½","ğŸ¸","ğŸµ","ğŸ™ˆ","ğŸ™‰","ğŸ™Š","ğŸ’","ğŸ”","ğŸ§","ğŸ¦","ğŸ¤","ğŸ£","ğŸ¥","ğŸ¦†","ğŸ¦¢","ğŸ¦‰","ğŸ¦©","ğŸ¦š","ğŸ¦œ","ğŸ¸","ğŸŠ","ğŸ¢","ğŸ¦","ğŸ","ğŸ²","ğŸ‰","ğŸ¦•","ğŸ¦–","ğŸ³","ğŸ‹","ğŸ¬","ğŸ¦­","ğŸŸ","ğŸ ","ğŸ¡","ğŸ¦ˆ","ğŸ™","ğŸš","ğŸŒ","ğŸ¦‹","ğŸ›","ğŸœ","ğŸ","ğŸ","ğŸ¦—","ğŸ•·ï¸","ğŸ•¸ï¸","ğŸ¦‚","ğŸ¦Ÿ","ğŸ¦ ","ğŸ’","ğŸŒ¸","ğŸ’®","ğŸµï¸","ğŸŒ¹","ğŸ¥€","ğŸŒº","ğŸŒ»","ğŸŒ¼","ğŸŒ·","ğŸŒ±","ğŸª´","ğŸŒ²","ğŸŒ³","ğŸŒ´","ğŸŒµ","ğŸŒ¾","ğŸŒ¿","â˜˜ï¸","ğŸ€","ğŸ","ğŸ‚","ğŸƒ"]},{id:"food",name:"Food & Drink",icon:'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 2v20"></path><path d="M15 3v10"></path><path d="M15 17v5"></path><path d="M15 3c-1.1 0-2 .9-2 2h0c0 1.1.9 2 2 2h0c1.1 0 2-.9 2-2h0c0-1.1-.9-2-2-2Z"></path><path d="M15 17c-1.1 0-2 .9-2 2h0c0 1.1.9 2 2 2h0c1.1 0 2-.9 2-2h0c0-1.1-.9-2-2-2Z"></path><path d="M9 3v10"></path><path d="M9 17v5"></path><path d="M9 3c-1.1 0-2 .9-2 2h0c0 1.1.9 2 2 2h0c1.1 0 2-.9 2-2h0c0-1.1-.9-2-2-2Z"></path><path d="M9 17c-1.1 0-2 .9-2 2h0c0 1.1.9 2 2 2h0c1.1 0 2-.9 2-2h0c0-1.1-.9-2-2-2Z"></path></svg>',emojis:["ğŸ","ğŸ","ğŸ","ğŸŠ","ğŸ‹","ğŸŒ","ğŸ‰","ğŸ‡","ğŸ“","ğŸ«","ğŸˆ","ğŸ’","ğŸ‘","ğŸ¥­","ğŸ","ğŸ¥¥","ğŸ¥","ğŸ…","ğŸ†","ğŸ¥‘","ğŸ¥¦","ğŸ¥¬","ğŸ¥’","ğŸŒ¶ï¸","ğŸŒ½","ğŸ¥•","ğŸ«’","ğŸ§„","ğŸ§…","ğŸ„","ğŸ¥œ","ğŸ«˜","ğŸŒ°","ğŸ","ğŸ¥","ğŸ¥–","ğŸ«“","ğŸ¥¨","ğŸ¥¯","ğŸ¥","ğŸ§‡","ğŸ§€","ğŸ–","ğŸ—","ğŸ¥©","ğŸ¥“","ğŸ”","ğŸŸ","ğŸ•","ğŸŒ­","ğŸ¥ª","ğŸŒ®","ğŸŒ¯","ğŸ«”","ğŸ¥™","ğŸ§†","ğŸ¥š","ğŸ³","ğŸ¥˜","ğŸ²","ğŸ¥£","ğŸ¥—","ğŸ¿","ğŸ§ˆ","ğŸ§‚","ğŸ¥«","ğŸ±","ğŸ˜","ğŸ™","ğŸš","ğŸ›","ğŸœ","ğŸ","ğŸ ","ğŸ¢","ğŸ£","ğŸ¤","ğŸ¥","ğŸ¥®","ğŸ¡","ğŸ¥Ÿ","ğŸ¥ ","ğŸ¥¡","ğŸ¦€","ğŸ¦","ğŸ¦","ğŸ¦‘","ğŸ¦ª","ğŸ¦","ğŸ§","ğŸ¨","ğŸ©","ğŸª","ğŸ‚","ğŸ°","ğŸ§","ğŸ¥§","ğŸ«","ğŸ¬","ğŸ­","ğŸ®","ğŸ¯","ğŸ¼","ğŸ¥›","â˜•","ğŸ«–","ğŸµ","ğŸ¶","ğŸ¾","ğŸ·","ğŸ¸","ğŸ¹","ğŸº","ğŸ»","ğŸ¥‚","ğŸ¥ƒ","ğŸ¥¤","ğŸ§‹","ğŸ§ƒ","ğŸ§‰","ğŸ§Š","ğŸ¥¢","ğŸ½ï¸","ğŸ´","ğŸ¥„"]},{id:"travel",name:"Travel & Places",icon:'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>',emojis:["ğŸš—","ğŸš•","ğŸš™","ğŸšŒ","ğŸš","ğŸï¸","ğŸš“","ğŸš‘","ğŸš’","ğŸš","ğŸ›»","ğŸšš","ğŸš›","ğŸšœ","ğŸ›µ","ğŸï¸","ğŸ›º","ğŸš²","ğŸ›´","ğŸ›¹","ğŸš","ğŸ›¤ï¸","ğŸ›©ï¸","âœˆï¸","ğŸ›«","ğŸ›¬","ğŸ›°ï¸","ğŸš€","ğŸ›¸","ğŸš","ğŸ›¶","â›µ","ğŸš¤","ğŸ›³ï¸","â›´ï¸","ğŸš¢","âš“","â›½","ğŸš§","ğŸš¦","ğŸš¥","ğŸ—ºï¸","ğŸ—¿","ğŸ—½","ğŸ—¼","ğŸ°","ğŸ¯","ğŸŸï¸","ğŸ¡","ğŸ¢","ğŸ ","â›²","â›±ï¸","ğŸ–ï¸","ğŸï¸","ğŸœï¸","ğŸŒ‹","â›°ï¸","ğŸ”ï¸","ğŸ—»","ğŸ•ï¸","â›º","ğŸ ","ğŸ¡","ğŸ¢","ğŸ£","ğŸ¤","ğŸ¥","ğŸ¦","ğŸ¨","ğŸ©","ğŸª","ğŸ«","ğŸ¬","ğŸ­","ğŸ™ï¸","ğŸŒ†","ğŸŒ‡","ğŸŒƒ","ğŸŒ‰","ğŸŒŒ","â™¨ï¸","ğŸŒ","ğŸŒ","ğŸŒ","ğŸŒ","ğŸŒ‘","ğŸŒ’","ğŸŒ“","ğŸŒ”","ğŸŒ•","ğŸŒ–","ğŸŒ—","ğŸŒ˜","ğŸŒ™","ğŸŒš","ğŸŒ","ğŸª","ğŸŒŸ","â­","âœ¨","ğŸŒ ","â˜€ï¸","ğŸŒ¤ï¸","â›…","ğŸŒ¥ï¸","â˜ï¸","ğŸŒ¦ï¸","ğŸŒ§ï¸","â›ˆï¸","ğŸŒ©ï¸","ğŸŒ¨ï¸","â„ï¸","â˜ƒï¸","â›„","ğŸŒ¬ï¸","ğŸ’¨","ğŸŒªï¸","ğŸŒ«ï¸","ğŸŒˆ","â˜”","ğŸ’§","ğŸ’¦","ğŸŒŠ"]},{id:"objects",name:"Objects",icon:'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path><polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline><line x1="12" y1="22.08" x2="12" y2="12"></line></svg>',emojis:["âŒš","ğŸ“±","ğŸ“²","ğŸ’»","âŒ¨ï¸","ğŸ–¥ï¸","ğŸ–¨ï¸","ğŸ–±ï¸","ğŸ–²ï¸","ğŸ•¹ï¸","ğŸ—œï¸","ğŸ’½","ğŸ’¾","ğŸ’¿","ğŸ“€","ğŸ“¼","ğŸ“·","ğŸ“¸","ğŸ“¹","ğŸ¥","ğŸ“½ï¸","ğŸï¸","ğŸ“","â˜ï¸","ğŸ“Ÿ","ğŸ“ ","ğŸ“º","ğŸ“»","ğŸ™ï¸","ğŸšï¸","ğŸ›ï¸","ğŸ§­","â±ï¸","â²ï¸","â°","ğŸ•°ï¸","âŒ›","â³","ğŸ”‹","ğŸ”Œ","ğŸ’¡","ğŸ”¦","ğŸ•¯ï¸","ğŸª”","ğŸ—‘ï¸","ğŸ›¢ï¸","ğŸ’¸","ğŸ’µ","ğŸ’´","ğŸ’¶","ğŸ’·","ğŸ’°","ğŸ’³","ğŸ’","âš–ï¸","ğŸªœ","ğŸ§°","ğŸª›","ğŸ”§","ğŸ”¨","âš’ï¸","ğŸ› ï¸","â›ï¸","ğŸª“","ğŸ”©","âš™ï¸","ğŸª—","ğŸ§±","â›“ï¸","ğŸ§²","âš—ï¸","ğŸ”­","ğŸ”¬","ğŸ•³ï¸","ğŸ©¹","ğŸ©º","ğŸ’Š","ğŸ’‰","ğŸ©¸","ğŸ§¬","ğŸ§¼","ğŸª ","ğŸ§½","ğŸª£","ğŸª‘","ğŸ§¹","ğŸ§º","ğŸ§»","ğŸ§´","ğŸ§¼","ğŸª¥","ğŸª’","ğŸ§µ","ğŸ§¶","ğŸªœ","ğŸ”‘","ğŸ—ï¸","ğŸ”¨","ğŸ”«","ğŸ›¡ï¸","ğŸ¹","ğŸ—¡ï¸","âš”ï¸","ğŸ’£","ğŸ§¨","ğŸš¬","âš°ï¸","ğŸª¦","âš±ï¸","ğŸº","ğŸ”®","ğŸ“¿","ğŸ§¿","ğŸ’ˆ"]},{id:"symbols",name:"Symbols",icon:'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 12h2"></path><path d="M12 11v2"></path><circle cx="12" cy="12" r="10"></circle></svg>',emojis:["â¤ï¸","ğŸ§¡","ğŸ’›","ğŸ’š","ğŸ’™","ğŸ’œ","ğŸ–¤","ğŸ¤","ğŸ¤","ğŸ’”","â£ï¸","ğŸ’•","ğŸ’","ğŸ’“","ğŸ’—","ğŸ’–","ğŸ’˜","ğŸ’","ğŸ’Ÿ","â˜®ï¸","âœï¸","â˜ªï¸","ğŸ•‰ï¸","â˜¸ï¸","âœ¡ï¸","ğŸ”¯","ğŸ•","â˜¯ï¸","â˜¦ï¸","ğŸ›","â›","â™ˆ","â™‰","â™Š","â™‹","â™Œ","â™","â™","â™","â™","â™‘","â™’","â™“","ğŸ†”","âš›ï¸","ğŸ‰‘","â˜¢ï¸","â˜£ï¸","ğŸ“´","ğŸ“³","ğŸˆ¶","ğŸˆš","ğŸˆ¸","ğŸˆº","ğŸˆ·ï¸","âœ´ï¸","ğŸ†š","ğŸ’®","ğŸ‰","ãŠ™ï¸","ãŠ—ï¸","ğŸˆ´","ğŸˆµ","ğŸˆ¹","ğŸˆ²","ğŸ…°ï¸","ğŸ…±ï¸","ğŸ†","ğŸ†‘","ğŸ…¾ï¸","ğŸ†˜","âŒ","â­•","ğŸ›‘","â›”","ğŸ“›","ğŸš«","ğŸ’¯","ğŸ’¢","â™¨ï¸","ğŸš·","ğŸš¯","ğŸš³","ğŸš±","ğŸ”","ğŸ“µ","ğŸš­","â—","â•","â“","â”","â€¼ï¸","â‰ï¸","ğŸ”…","ğŸ”†","âš ï¸","ğŸš¸","ğŸ”±","âšœï¸","ğŸ”°","â™»ï¸","âœ…","ğŸˆ¯","ğŸ’¹","â‡ï¸","âœ³ï¸","â","ğŸŒ","ğŸ’ ","â“‚ï¸","ğŸŒ€","ğŸ’¤","ğŸ§","ğŸš¾","â™¿","ğŸ…¿ï¸","ğŸ›—","ğŸˆ³","ğŸˆ‚ï¸","ğŸ›‚","ğŸ›ƒ","ğŸ›„","ğŸ›…"]}];function Ee(a){if(!a)return"";const s=a.split(" ").filter(Boolean),l=s[0]?s[0][0]:"",d=s.length>1?s[s.length-1][0]:"";return(l+d).toUpperCase()}function pe(a){return!a||typeof a!="object"||a.blockedByOther?"User unavailable":a.name||"Unknown"}function ae(a){return!!(a&&(a.blocked||a.blockedByOther))}function Vt(a){if(!a)return"";const s=new Date(a);return Number.isNaN(s.getTime())?"":s.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}function Xa(a){if(!a)return"";const s=new Date(a);return Number.isNaN(s.getTime())?"":s.toLocaleDateString([],{month:"short",day:"numeric"})}function Xe(a){if(!a)return"";const s=new Date(a);return Number.isNaN(s.getTime())?"":s.toLocaleString([],{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}function _t(a){const s=String(a||"").trim();return s?s.split(/[_\s-]+/).filter(Boolean).map(l=>l.charAt(0).toUpperCase()+l.slice(1).toLowerCase()).join(" "):"Status unavailable"}function Ht(a){const s=String(a||"").trim().toLowerCase();return s==="resolved"||s==="closed"||s==="complete"||s==="completed"||s==="done"?"success":s==="rejected"||s==="dismissed"||s==="denied"?"danger":s==="open"||s==="pending"||s==="in_review"||s==="in review"||s==="under_review"||s==="under review"?"warning":""}function Ft(a,s){return a.getFullYear()===s.getFullYear()&&a.getMonth()===s.getMonth()&&a.getDate()===s.getDate()}function en(a){const s=new Date(a);if(Number.isNaN(s.getTime()))return"";const l=new Date,d=new Date;return d.setDate(l.getDate()-1),Ft(s,l)?"Today":Ft(s,d)?"Yesterday":s.toLocaleDateString([],{month:"short",day:"numeric"})}function tn(a){const s=[];let l="";return a.forEach(d=>{const p=d.timestamp.slice(0,10);p!==l&&(s.push({type:"day",id:`day-${p}`,label:en(d.timestamp)}),l=p),s.push({type:"message",id:d.id,message:d})}),s}function an(a){return a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function nn(a,s){if(!s)return a;const l=an(s);return a.split(new RegExp(`(${l})`,"ig")).map((p,g)=>p.toLowerCase()===s.toLowerCase()?e.createElement("mark",{key:g,className:"msg-highlight"},p):e.createElement("span",{key:g},p))}function sn(a,s,l){const d=(l==null?void 0:l.selectionStart)??a.length,p=(l==null?void 0:l.selectionEnd)??d;return{nextValue:a.slice(0,d)+s+a.slice(p),caret:d+s.length}}function tt(a,s,l){c.useEffect(()=>{if(!l)return;const d=p=>{!a.current||a.current.contains(p.target)||s()};return document.addEventListener("mousedown",d),document.addEventListener("touchstart",d),()=>{document.removeEventListener("mousedown",d),document.removeEventListener("touchstart",d)}},[a,s,l])}function j({children:a,size:s=20,className:l}){return e.createElement("svg",{className:l,width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.8",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true"},a)}const ln=a=>e.createElement(j,{...a},e.createElement("circle",{cx:"12",cy:"5",r:"1.6",fill:"currentColor",stroke:"none"}),e.createElement("circle",{cx:"12",cy:"12",r:"1.6",fill:"currentColor",stroke:"none"}),e.createElement("circle",{cx:"12",cy:"19",r:"1.6",fill:"currentColor",stroke:"none"})),at=a=>e.createElement(j,{...a},e.createElement("circle",{cx:"11",cy:"11",r:"6.5"}),e.createElement("line",{x1:"16.5",y1:"16.5",x2:"21",y2:"21"})),rn=a=>e.createElement(j,{...a},e.createElement("rect",{x:"5",y:"11",width:"14",height:"9",rx:"2"}),e.createElement("path",{d:"M8 11V8a4 4 0 0 1 8 0v3"})),on=a=>e.createElement(j,{...a},e.createElement("path",{d:"M6 18l-2.5 3.5V6.5A2.5 2.5 0 0 1 6 4h12a2.5 2.5 0 0 1 2.5 2.5V14A2.5 2.5 0 0 1 18 16.5H7.8L6 18Z"})),cn=a=>e.createElement(j,{...a},e.createElement("path",{d:"M3 12l17-7-7 17-2-6-8-4Z"})),mn=a=>e.createElement(j,{...a},e.createElement("circle",{cx:"12",cy:"12",r:"9"}),e.createElement("circle",{cx:"9",cy:"10",r:"1",fill:"currentColor",stroke:"none"}),e.createElement("circle",{cx:"15",cy:"10",r:"1",fill:"currentColor",stroke:"none"}),e.createElement("path",{d:"M8 15c1.2 1.3 2.6 2 4 2s2.8-.7 4-2"})),dn=a=>e.createElement(j,{...a},e.createElement("path",{d:"M7.5 12.5l6.8-6.8a3 3 0 0 1 4.3 4.3l-7.5 7.5a4.5 4.5 0 0 1-6.4-6.4l7.2-7.2"})),un=a=>e.createElement(j,{...a},e.createElement("polyline",{points:"5 12 9 16 19 6"})),fn=a=>e.createElement(j,{...a},e.createElement("polyline",{points:"2 12 6 16 12 10"}),e.createElement("polyline",{points:"8 12 12 16 22 6"})),hn=a=>e.createElement(j,{...a},e.createElement("path",{d:"M4 11.5 12 4l8 7.5"}),e.createElement("path",{d:"M6 10.5V20h12v-9.5"})),pn=a=>e.createElement(j,{...a},e.createElement("rect",{x:"4",y:"4",width:"16",height:"5"}),e.createElement("rect",{x:"5",y:"9",width:"14",height:"11"}),e.createElement("line",{x1:"9",y1:"13",x2:"15",y2:"13"})),zt=a=>e.createElement(j,{...a},e.createElement("path",{d:"M5 4v16"}),e.createElement("path",{d:"M5 4h12l-2.2 4L17 12H5"})),ve=a=>e.createElement(j,{...a},e.createElement("circle",{cx:"12",cy:"12",r:"9"}),e.createElement("line",{x1:"7",y1:"17",x2:"17",y2:"7"})),vn=a=>e.createElement(j,{...a},e.createElement("circle",{cx:"12",cy:"8",r:"3.2"}),e.createElement("path",{d:"M4.5 19.5c1.9-3 4.5-4.5 7.5-4.5s5.6 1.5 7.5 4.5"})),Yt=a=>e.createElement(j,{...a},e.createElement("path",{d:"M4 7h16"}),e.createElement("path",{d:"M9 7V5h6v2"}),e.createElement("path",{d:"M7 7l1 12h8l1-12"}),e.createElement("path",{d:"M10 11v6"}),e.createElement("path",{d:"M14 11v6"})),En=a=>e.createElement(j,{...a},e.createElement("path",{d:"M9 4h-4v16h4"}),e.createElement("path",{d:"M16 12H7"}),e.createElement("path",{d:"M13 9l3 3-3 3"})),Pe=a=>e.createElement(j,{...a},e.createElement("line",{x1:"5",y1:"5",x2:"19",y2:"19"}),e.createElement("line",{x1:"19",y1:"5",x2:"5",y2:"19"}));function Zt({ariaLabel:a,items:s}){const[l,d]=c.useState(!1),p=c.useRef(null);return tt(p,()=>d(!1),l),e.createElement("div",{className:"menu-wrap",ref:p},e.createElement("button",{className:"icon-btn","aria-label":a,"aria-haspopup":"menu","aria-expanded":l,onClick:()=>d(g=>!g),type:"button"},e.createElement(ln,null)),l?e.createElement("div",{className:"dropdown",role:"menu"},s.map(g=>e.createElement("button",{key:g.label,className:"dropdown-item",role:"menuitem",type:"button",onClick:()=>{d(!1),g.onSelect()}},g.label))):null)}function gn({status:a}){if(!a)return null;if(a==="sent")return e.createElement(un,{className:"status-icon"});const s=a==="read"?"status-icon read":"status-icon";return e.createElement(fn,{className:s})}function yn({open:a,title:s,message:l,confirmLabel:d,onConfirm:p,onCancel:g}){return a?e.createElement("div",{className:"panel-backdrop",role:"dialog","aria-modal":"true","aria-label":s},e.createElement("div",{className:"confirm-dialog"},e.createElement("h3",null,s),e.createElement("p",null,l),e.createElement("div",{className:"confirm-actions"},e.createElement("button",{className:"ghost-btn",type:"button",onClick:g},"Cancel"),e.createElement("button",{className:"primary-btn",type:"button",onClick:p},d)))):null}function bn({open:a,title:s,message:l,confirmLabel:d="Delete",onConfirm:p,onCancel:g}){return a?e.createElement("div",{className:"panel-backdrop",role:"dialog","aria-modal":"true","aria-label":s},e.createElement("div",{className:"confirm-dialog"},e.createElement("h3",null,s),e.createElement("p",null,l),e.createElement("div",{className:"confirm-actions"},e.createElement("button",{className:"ghost-btn",type:"button",onClick:g},"Cancel"),e.createElement("button",{className:"primary-btn",type:"button",onClick:p},d)))):null}function Nn({open:a,onClose:s,currentUser:l}){if(!a)return null;const d={...le,...l&&typeof l=="object"?l:{}},p=d.name||"User";return e.createElement("div",{className:"panel-backdrop",role:"dialog","aria-modal":"true","aria-label":"Profile panel"},e.createElement("div",{className:"profile-panel"},e.createElement("div",{className:"panel-header"},e.createElement("h2",null,"Profile"),e.createElement("button",{className:"icon-btn","aria-label":"Close profile",onClick:s,type:"button"},e.createElement(Pe,null))),e.createElement("div",{className:"profile-hero"},e.createElement("div",{className:"avatar large",style:{backgroundColor:"#2f9e8f"}},Ee(p)),e.createElement("div",null,e.createElement("h3",null,p))),e.createElement("div",{className:"profile-section"},e.createElement("h4",null,"Details"),e.createElement("p",null,"First name: ",d.firstName||"-"),e.createElement("p",null,"Family name: ",d.lastName||"-"),e.createElement("p",null,"Suburb: ",d.suburb||"-"),e.createElement("p",null,"City: ",d.city||"-"),e.createElement("p",null,"Province: ",d.province||"-"),e.createElement("p",null,"Account since: ",d.accountSince||"-"))))}function kn({open:a,onClose:s,chat:l,onDelete:d,onBlock:p,onReport:g}){if(!a||!l)return null;const v=!!l.blockedByOther,L=pe(l),C=l.name?l.name.split(" ").filter(Boolean):[],u=C[0]||"",T=C.slice(1).join(" "),N=v?"-":l.firstName||u||"-",A=v?"-":l.lastName||T||"-",R=v?"-":l.suburb||"-",$=v?"-":l.city||"-",m=v?"-":l.province||"-",y=v?"-":l.accountSince||"-",E=v?"-":l.accountType||"Standard";return e.createElement("div",{className:"panel-backdrop",role:"dialog","aria-modal":"true","aria-label":"Chat profile"},e.createElement("div",{className:"profile-panel"},e.createElement("div",{className:"panel-header"},e.createElement("h2",null,"Chat Profile"),e.createElement("button",{className:"icon-btn","aria-label":"Close profile",onClick:s,type:"button"},e.createElement(Pe,null))),e.createElement("div",{className:"profile-hero"},e.createElement("div",{className:"avatar large",style:{backgroundColor:l.color}},ae(l)?e.createElement(ve,{className:"avatar-blocked-icon",size:18}):Ee(L)),e.createElement("div",null,e.createElement("h3",null,L))),e.createElement("div",{className:"profile-section"},e.createElement("h4",null,"Details"),e.createElement("p",null,"First name: ",N),e.createElement("p",null,"Family name: ",A),e.createElement("p",null,"Suburb: ",R),e.createElement("p",null,"City: ",$),e.createElement("p",null,"Province: ",m),e.createElement("p",null,"Account since: ",y),e.createElement("p",null,"Account type: ",E)),e.createElement("div",{className:"profile-section"},e.createElement("h4",null,"Actions"),e.createElement("div",{className:"profile-action-row"},e.createElement("button",{className:"profile-btn danger",type:"button",onClick:d},e.createElement(Yt,null),"Delete"),v?null:e.createElement(e.Fragment,null,e.createElement("button",{className:"profile-btn warn",type:"button",onClick:p},e.createElement(ve,null),l.blocked?"Unblock":"Block"),e.createElement("button",{className:"profile-btn",type:"button",onClick:g},e.createElement(zt,null),"Report"))))))}function et({title:a,subtitle:s}){return e.createElement("div",{className:"empty-state"},e.createElement("h3",null,a),e.createElement("p",null,s))}function Cn(){const a=Array.from({length:7}),s=Array.from({length:5});return e.createElement("div",{className:"chat-loading-overlay desktop",role:"status","aria-live":"polite"},e.createElement("div",{className:"chat-loading-desktop-shell"},e.createElement("aside",{className:"chat-loading-desktop-sidebar"},e.createElement("div",{className:"chat-loading-desktop-header"},e.createElement("div",{className:"chat-loading-sk chat-loading-desktop-logo"}),e.createElement("div",{className:"chat-loading-sk chat-loading-desktop-circle"})),e.createElement("div",{className:"chat-loading-desktop-search"},e.createElement("div",{className:"chat-loading-sk chat-loading-desktop-search-box"})),e.createElement("div",{className:"chat-loading-desktop-list"},a.map((l,d)=>e.createElement("div",{className:"chat-loading-desktop-thread",key:d},e.createElement("div",{className:"chat-loading-sk chat-loading-desktop-avatar"}),e.createElement("div",{className:"chat-loading-desktop-thread-meta"},e.createElement("div",{className:"chat-loading-sk chat-loading-desktop-line lg"}),e.createElement("div",{className:"chat-loading-sk chat-loading-desktop-line sm"})),e.createElement("div",{className:"chat-loading-sk chat-loading-desktop-time"}))))),e.createElement("section",{className:"chat-loading-desktop-chat"},e.createElement("div",{className:"chat-loading-desktop-chat-header"},e.createElement("div",{className:"chat-loading-desktop-chat-user"},e.createElement("div",{className:"chat-loading-sk chat-loading-desktop-avatar"}),e.createElement("div",{className:"chat-loading-desktop-thread-meta"},e.createElement("div",{className:"chat-loading-sk chat-loading-desktop-line lg"}),e.createElement("div",{className:"chat-loading-sk chat-loading-desktop-line sm"}))),e.createElement("div",{className:"chat-loading-desktop-chat-actions"},e.createElement("div",{className:"chat-loading-sk chat-loading-desktop-circle"}),e.createElement("div",{className:"chat-loading-sk chat-loading-desktop-circle"}),e.createElement("div",{className:"chat-loading-sk chat-loading-desktop-circle"}))),e.createElement("div",{className:"chat-loading-desktop-messages"},e.createElement("div",{className:"chat-loading-sk chat-loading-desktop-day"}),s.map((l,d)=>e.createElement("div",{className:`chat-loading-desktop-bubble-row ${d%2?"me":"them"}`,key:d},e.createElement("div",{className:"chat-loading-desktop-bubble"},e.createElement("div",{className:"chat-loading-sk chat-loading-desktop-line lg"}),e.createElement("div",{className:"chat-loading-sk chat-loading-desktop-line sm"}),e.createElement("div",{className:"chat-loading-sk chat-loading-desktop-meta"}))))),e.createElement("div",{className:"chat-loading-desktop-composer"},e.createElement("div",{className:"chat-loading-sk chat-loading-desktop-circle"}),e.createElement("div",{className:"chat-loading-sk chat-loading-desktop-circle"}),e.createElement("div",{className:"chat-loading-sk chat-loading-desktop-input"}),e.createElement("div",{className:"chat-loading-sk chat-loading-desktop-circle"})))))}function nt({title:a,subtitle:s,children:l}){return e.createElement("div",{className:"section-panel"},e.createElement("div",{className:"section-header"},e.createElement("div",null,e.createElement("h2",null,a),s?e.createElement("p",{className:"muted"},s):null)),e.createElement("div",{className:"section-card"},l))}function wn({currentUser:a}){const s={...le,...a&&typeof a=="object"?a:{}},l=s.name||"User";return e.createElement(nt,{title:"My Profile",subtitle:""},e.createElement("div",{className:"profile-card"},e.createElement("div",{className:"profile-card-hero"},e.createElement("div",{className:"avatar large",style:{backgroundColor:"#0f766e"}},Ee(l)),e.createElement("div",null,e.createElement("h3",null,l))),e.createElement("div",{className:"profile-section"},e.createElement("h4",null,"Details"),e.createElement("p",null,"First name: ",s.firstName||"-"),e.createElement("p",null,"Family name: ",s.lastName||"-"),e.createElement("p",null,"Suburb: ",s.suburb||"-"),e.createElement("p",null,"City: ",s.city||"-"),e.createElement("p",null,"Province: ",s.province||"-"),e.createElement("p",null,"Account since: ",s.accountSince||"-")),e.createElement("div",{className:"profile-actions"},e.createElement("button",{className:"manage-profile-btn",type:"button","data-link":"manage-profile"},"Manage Profile"))))}function Sn({chats:a,onUnblock:s}){return e.createElement(nt,{title:"Blocked Accounts",subtitle:"People and businesses you blocked."},a.length===0?e.createElement("div",{className:"section-empty"},"No blocked accounts."):e.createElement("div",{className:"section-list"},a.map(l=>e.createElement("div",{key:l.id,className:"section-item"},e.createElement("div",{className:"section-item-info"},e.createElement("div",{className:"avatar",style:{backgroundColor:l.color}},e.createElement(ve,{className:"avatar-blocked-icon",size:16})),e.createElement("div",{className:"section-item-text"},e.createElement("div",{className:"section-item-name"},l.name))),e.createElement("div",{className:"section-item-meta"},e.createElement("span",{className:"section-tag danger"},"Blocked"),e.createElement("span",null,Xa(l.blockedAt||l.lastTime)),e.createElement("button",{className:"section-action",type:"button",onClick:()=>s(l.id)},"Unblock"))))))}function In({reports:a,onOpenReport:s}){return e.createElement(nt,{title:"Reports",subtitle:"Reports you submitted."},a.length===0?e.createElement("div",{className:"section-empty"},"No reports found."):e.createElement("div",{className:"section-list"},a.map(l=>e.createElement("div",{key:l.id,className:"section-item"},e.createElement("div",{className:"section-item-info"},e.createElement("div",{className:"avatar",style:{backgroundColor:l.color||"#3b5bdb"}},Ee(l.name)),e.createElement("div",{className:"section-item-text"},e.createElement("div",{className:"section-item-name"},l.name),e.createElement("div",{className:"section-item-sub"},l.context||"No reason provided."))),e.createElement("div",{className:"section-item-meta"},e.createElement("span",{className:`section-tag ${Ht(l.status)}`},_t(l.status)),e.createElement("span",null,Xe(l.createdAt)||"Date unavailable"),e.createElement("button",{className:"section-action",type:"button",onClick:()=>s(l)},"View report"))))))}function Tn({open:a,report:s,onClose:l}){return!a||!s?null:e.createElement("div",{className:"panel-backdrop",role:"dialog","aria-modal":"true","aria-label":"Report details"},e.createElement("div",{className:"report-details-dialog"},e.createElement("div",{className:"report-details-header"},e.createElement("div",null,e.createElement("div",{className:"report-details-title"},"Report details"),e.createElement("div",{className:"report-sub"},"Submitted information from your report.")),e.createElement("button",{type:"button",className:"report-details-close",onClick:l,"aria-label":"Close report details"},e.createElement(Pe,{size:18}))),e.createElement("div",{className:"report-details-grid"},e.createElement("div",{className:"report-details-field"},e.createElement("div",{className:"report-details-label"},"Reported account"),e.createElement("div",{className:"report-details-value"},s.name||"Unknown")),e.createElement("div",{className:"report-details-field"},e.createElement("div",{className:"report-details-label"},"Status"),e.createElement("div",{className:`section-tag ${Ht(s.status)}`},_t(s.status))),e.createElement("div",{className:"report-details-field"},e.createElement("div",{className:"report-details-label"},"Sent"),e.createElement("div",{className:"report-details-value"},Xe(s.createdAt)||"Not available")),e.createElement("div",{className:"report-details-field"},e.createElement("div",{className:"report-details-label"},"Admin reply time"),e.createElement("div",{className:"report-details-value"},Xe(s.adminReplyAt)||"Not available"))),e.createElement("div",{className:"report-details-field"},e.createElement("div",{className:"report-details-label"},"Reason"),e.createElement("div",{className:"report-details-value report-details-reason"},s.context||"No reason provided.")),e.createElement("div",{className:"report-details-field"},e.createElement("div",{className:"report-details-label"},"Admin reply"),e.createElement("div",{className:"report-details-value report-details-reason"},s.adminReply||"No admin reply yet."))))}function xn({open:a,onClose:s,reasons:l,value:d,onChange:p,details:g,onDetailsChange:v,onSubmit:L,targetName:C}){const[u,T]=c.useState(!1),N=c.useRef(null),A=l.find(R=>R.value===d);return tt(N,()=>T(!1),u),c.useEffect(()=>{a||T(!1)},[a]),a?e.createElement("div",{className:"panel-backdrop",role:"dialog","aria-modal":"true","aria-label":"Report"},e.createElement("div",{className:"report-dialog"},e.createElement("div",{className:"report-title"},"Quick report"),e.createElement("div",{className:"report-sub"},"Select a reason for reporting ",C||"this chat","."),e.createElement("div",{className:`report-select${u?" active":""}`,ref:N},e.createElement("button",{className:"report-select__trigger",type:"button",onClick:()=>T(R=>!R),"aria-haspopup":"listbox","aria-expanded":u},e.createElement("span",null,A?A.label:"Choose a reason"),e.createElement("span",{className:"report-select__caret"},"Ã¢â€“Â¾")),e.createElement("div",{className:"report-select__options",role:"listbox"},l.map(R=>e.createElement("button",{key:R.value,type:"button",className:`report-select__option${d===R.value?" selected":""}`,onClick:()=>{p(R.value),T(!1)},role:"option","aria-selected":d===R.value},R.label)))),e.createElement("textarea",{className:"report-textarea",placeholder:"Optional details",value:g,onChange:R=>v(R.target.value)}),e.createElement("div",{className:"report-actions"},e.createElement("button",{className:"ghost-btn",type:"button",onClick:s},"Cancel"),e.createElement("button",{className:"primary-btn",type:"button",onClick:L,disabled:!d},"Report")))):null}function An({chats:a,searchValue:s,onSearchChange:l,activeChatId:d,onOpenChat:p,onMenuAction:g,emptyTitle:v="No chats yet",emptySubtitle:L="Start a new chat to compare prices.",showSearch:C=!0}){return e.createElement("div",{className:"chat-list-screen"},C?e.createElement("div",{className:"search-bar"},e.createElement(at,{className:"search-icon"}),e.createElement("input",{type:"search",value:s,onChange:u=>l(u.target.value),placeholder:"Search chats or messages","aria-label":"Search chats"})):null,e.createElement("div",{className:"chat-list",role:"list"},a.length===0?e.createElement(et,{title:v,subtitle:L}):a.map(u=>{const T=pe(u),N=[{label:u.archived?"Unarchive chat":"Archive chat",onSelect:()=>g(u.id,u.archived?"unarchive":"archive")},{label:"Delete chat",onSelect:()=>g(u.id,"delete")},{label:"Report",onSelect:()=>g(u.id,"report")}];return e.createElement("div",{key:u.id,className:`chat-item ${d===u.id?"active":""}`,role:"listitem"},e.createElement("button",{className:"chat-open",onClick:()=>p(u.id),type:"button","aria-label":`Open chat with ${T}`},e.createElement("div",{className:"chat-avatar"},e.createElement("div",{className:"avatar",style:{backgroundColor:u.color}},ae(u)?e.createElement(ve,{className:"avatar-blocked-icon",size:16}):Ee(u.name)),u.online?e.createElement("span",{className:"status-dot","aria-hidden":"true"}):null),e.createElement("div",{className:"chat-body"},e.createElement("div",{className:"chat-row"},e.createElement("span",{className:"chat-name"},T),e.createElement("span",{className:"chat-time"},Vt(u.lastTime))),e.createElement("div",{className:"chat-row chat-preview"},e.createElement("span",{className:"chat-message"},u.lastMessage?u.lastMessage:"No messages yet"),e.createElement("span",{className:"chat-flags"},u.unread>0?e.createElement("span",{className:"chat-unread"},u.unread):null)))),e.createElement(Zt,{ariaLabel:"Chat options",items:N}))})))}function Bn({message:a,query:s,onPreviewImage:l}){const d=a.sender==="me",p=typeof a.attachmentUrl=="string"?a.attachmentUrl:"",g=typeof a.attachmentType=="string"?a.attachmentType.toLowerCase():"",v=typeof a.attachmentName=="string"&&a.attachmentName?a.attachmentName:"Attachment",L=!!a.attachmentIsImage||g.startsWith("image/"),C=!!a.attachmentIsVideo||g.startsWith("video/"),u=typeof a.text=="string"&&a.text.trim().length>0,T={width:"100%",maxWidth:"260px",borderRadius:"10px",display:"block",marginBottom:u?"8px":"0"};return e.createElement("div",{className:`message-row ${d?"me":"them"}`},e.createElement("div",{className:`message-bubble ${d?"outgoing":"incoming"}`},p?e.createElement("div",{className:"message-attachment"},L?e.createElement("button",{className:"message-image-trigger",type:"button",onClick:()=>{l&&l(a)},"aria-label":`Preview ${v}`},e.createElement("img",{src:p,alt:v,loading:"lazy",style:T})):C?e.createElement("video",{controls:!0,preload:"metadata",style:T},e.createElement("source",{src:p,type:g||void 0})):e.createElement("a",{href:p,target:"_blank",rel:"noreferrer"},"Open attachment")):null,u?e.createElement("div",{className:"message-text"},nn(a.text,s)):null,e.createElement("div",{className:"message-meta"},e.createElement("span",null,Vt(a.timestamp)),d?e.createElement(gn,{status:a.status}):null)))}function Mn({preview:a,onClose:s,onSave:l,onReport:d}){return a?e.createElement("div",{className:"attachment-preview-panel",role:"region","aria-label":"Photo preview"},e.createElement("div",{className:"attachment-preview-head"},e.createElement("div",{className:"attachment-preview-title"},"Photo preview"),e.createElement("button",{className:"icon-btn",type:"button",onClick:s,"aria-label":"Close preview"},e.createElement(Pe,null))),e.createElement("div",{className:"attachment-preview-stage"},e.createElement("img",{src:a.url,alt:a.name||"Image preview",loading:"eager"})),e.createElement("div",{className:"attachment-preview-meta"},a.name||"Image"),e.createElement("div",{className:"attachment-preview-actions"},e.createElement("button",{className:"primary-btn",type:"button",onClick:l},"Save"),e.createElement("button",{className:"ghost-btn",type:"button",onClick:d},"Report Photo"))):null}function Rn(){return e.createElement("div",{className:"message-row them"},e.createElement("div",{className:"typing-bubble"},e.createElement("span",{className:"typing-label"},"typing"),e.createElement("div",{className:"typing-dots","aria-hidden":"true"},e.createElement("span",null),e.createElement("span",null),e.createElement("span",null))))}function Dn(){const a=[!1,!0,!1,!0,!1];return e.createElement("div",{className:"conversation-loading",role:"status","aria-live":"polite","aria-label":"Loading messages"},a.map((s,l)=>e.createElement("div",{key:l,className:`conversation-loading-row ${s?"me":"them"}`},e.createElement("div",{className:"conversation-loading-bubble"},e.createElement("div",{className:"chat-loading-sk conversation-loading-line lg"}),e.createElement("div",{className:"chat-loading-sk conversation-loading-line md"}),e.createElement("div",{className:"chat-loading-sk conversation-loading-line sm"})))))}function Pn({value:a,onChange:s,onSend:l,onEmoji:d,onAttach:p,inputRef:g,disabled:v=!1}){const L=C=>{C.key==="Enter"&&!C.shiftKey&&(C.preventDefault(),!v&&a.trim()&&l())};return e.createElement("div",{className:"composer"},e.createElement("div",{className:"composer-actions"},e.createElement("button",{className:"icon-btn",type:"button",onClick:d,"aria-label":"Emoji",disabled:v},e.createElement(mn,null)),e.createElement("button",{className:"icon-btn",type:"button",onClick:p,"aria-label":"Attach",disabled:v},e.createElement(dn,null))),e.createElement("textarea",{ref:g,rows:1,value:a,onChange:C=>s(C.target.value),onKeyDown:L,placeholder:v?"Unblock to send messages":"Type a message","aria-label":"Message input",disabled:v}),e.createElement("button",{className:"send-btn",type:"button",onClick:l,disabled:v||!a.trim(),"aria-label":"Send message"},e.createElement(cn,null)))}function Ln({open:a,recents:s,onSelect:l,onClose:d}){const[p,g]=c.useState(""),[v,L]=c.useState("recent"),C=c.useRef(null),u=c.useRef(null),T=c.useRef({});tt(u,d,a);const N=c.useMemo(()=>{const m=De.map(y=>y.id==="recent"?{...y,emojis:s}:y);return Ya(m,p)},[s,p]);c.useEffect(()=>{var y;if(!a)return;const m=((y=N[0])==null?void 0:y.id)||"recent";L(m),C.current&&(C.current.scrollTop=0)},[a,p,N]);const A=()=>{const m=C.current;if(!m)return;let y=v;N.forEach(E=>{const Y=T.current[E.id];Y&&m.scrollTop>=Y.offsetTop-40&&(y=E.id)}),y!==v&&L(y)},R=m=>{const y=T.current[m];y&&(y.scrollIntoView({behavior:"smooth",block:"start"}),L(m))},$=m=>{l(m)};return a?e.createElement("div",{className:"emoji-popover","aria-live":"polite"},e.createElement("div",{className:"emoji-picker fade-in",ref:u},e.createElement("div",{className:"picker-header"},e.createElement("div",{className:"search-container"},e.createElement(at,{className:"search-icon"}),e.createElement("input",{type:"search",className:"search-input",placeholder:"Search emojis...",value:p,onChange:m=>g(m.target.value),"aria-label":"Search emojis"})),e.createElement("div",{className:"category-tabs",role:"tablist"},N.map(m=>e.createElement("button",{key:m.id,type:"button",className:`category-tab ${v===m.id?"active":""}`,onClick:()=>R(m.id),"aria-label":m.name,"aria-pressed":v===m.id,dangerouslySetInnerHTML:{__html:m.icon}})))),e.createElement("div",{className:"emoji-list",onScroll:A,ref:C},N.length===0?e.createElement("div",{className:"emoji-empty"},"No emojis found."):N.map(m=>e.createElement("div",{key:m.id,className:"category-section",ref:y=>{T.current[m.id]=y}},e.createElement("div",{className:"category-title"},m.name),e.createElement("div",{className:"emoji-grid"},m.emojis.map((y,E)=>e.createElement("button",{key:`${m.id}-${E}`,type:"button",className:"emoji-item",onClick:()=>$(y),"aria-label":"Emoji"},y)))))))):null}function jn({chat:a,groupedMessages:s,searchValue:l,showSearch:d,onToggleSearch:p,onSearchChange:g,onSend:v,composerValue:L,onComposerChange:C,onEmoji:u,onAttach:T,emojiOpen:N,emojiRecents:A,onEmojiSelect:R,onEmojiClose:$,composerRef:m,typing:y,conversationLoading:E,messageListRef:Y,matchCount:Q,onMenuAction:J,attachmentPreview:G,onOpenAttachmentPreview:ne,onCloseAttachmentPreview:Le,onSaveAttachmentPreview:re,onReportAttachmentPreview:oe}){if(!a)return e.createElement("div",{className:"conversation empty-view"},e.createElement(et,{title:"Select a chat",subtitle:"Choose a conversation to see messages and compare prices."}));if(G)return e.createElement("div",{className:"conversation attachment-only-view"},e.createElement(Mn,{preview:G,onClose:Le,onSave:re,onReport:oe}));const ce=pe(a),ke=!!a.launchPending,ie=ke?[{label:"Close chat",onSelect:()=>J("close")}]:[{label:"View profile",onSelect:()=>J("profile")},{label:"Close chat",onSelect:()=>J("close")},{label:"Delete chat",onSelect:()=>J("delete")},{label:"Block",onSelect:()=>J("block")},{label:"Report",onSelect:()=>J("report")}];return e.createElement("div",{className:"conversation"},e.createElement("div",{className:"conversation-header"},e.createElement("div",{className:"conversation-title"},e.createElement("div",{className:"avatar",style:{backgroundColor:a.color}},ae(a)?e.createElement(ve,{className:"avatar-blocked-icon",size:16}):Ee(a.name)),e.createElement("div",{className:"conversation-title-text"},e.createElement("div",{className:"conversation-name"},ce),e.createElement("div",{className:"conversation-status"},ke?e.createElement("span",null,"Start conversation"):y?e.createElement("span",null,"Typing..."):e.createElement(e.Fragment,null,a.online?e.createElement("span",{className:"presence-dot"}):null,e.createElement("span",null,a.online?"online":a.presence))))),e.createElement("div",{className:"conversation-actions"},e.createElement(Zt,{ariaLabel:"Conversation menu",items:ie}))),d?e.createElement("div",{className:"conversation-search"},e.createElement(at,{className:"search-icon"}),e.createElement("input",{type:"search",value:l,onChange:H=>g(H.target.value),placeholder:"Search in conversation","aria-label":"Search within conversation"}),l?e.createElement("span",{className:"search-count"},Q," match",Q===1?"":"es"):null):null,e.createElement("div",{className:"conversation-scroll",ref:Y},e.createElement("div",{className:"security-banner"},e.createElement(rn,null),e.createElement("div",null,"Messages are end-to-end encrypted. No one outside of this chat can read or listen to them.")),E?e.createElement(Dn,null):s.length===0?e.createElement(et,{title:l?"No matches":"No messages yet",subtitle:l?"Try a different phrase.":"Send a message to start the chat."}):s.map(H=>H.type==="day"?e.createElement("div",{key:H.id,className:"day-separator"},H.label):e.createElement(Bn,{key:H.id,message:H.message,query:l.trim(),onPreviewImage:ne})),y&&!l&&!E?e.createElement(Rn,null):null,!E&&ae(a)?e.createElement("div",{className:"blocked-notice",role:"note"},a.blockedByOther?"You cannot message this account.":"You blocked this account. Unblock to send messages."):null),e.createElement(Pn,{value:L,onChange:C,onSend:v,onEmoji:u,onAttach:T,inputRef:m,disabled:ae(a)}),e.createElement(Ln,{open:N,recents:A,onSelect:R,onClose:$}))}function On({currentUser:a=le,initialChats:s=qa,initialMessages:l=Ka}){const d={...le,...a&&typeof a=="object"?a:{}},p=Array.isArray(s)?s:[],g=l&&typeof l=="object"?l:{},v=c.useMemo(()=>Qa(),[]),L=!!(v.conversationId||v.recipientId),C=c.useRef(!L),[u,T]=c.useState("chats"),[N,A]=c.useState(p),[R,$]=c.useState(g),[m,y]=c.useState(null),[E,Y]=c.useState(v.recipientId?{id:v.recipientId,name:v.recipientName||"Business"}:null),[Q,J]=c.useState(""),[G,ne]=c.useState(""),[Le,re]=c.useState(!1),[oe,ce]=c.useState(""),[ke,ie]=c.useState(!1),[H,qt]=c.useState(()=>{var t,n,r;if(typeof window>"u")return((t=De[0])==null?void 0:t.emojis)||[];try{const o=window.localStorage.getItem(Ut);return o?JSON.parse(o):((n=De[0])==null?void 0:n.emojis)||[]}catch{return((r=De[0])==null?void 0:r.emojis)||[]}}),[st,ge]=c.useState(!1),[Kt,Wt]=c.useState(!1),[Un,lt]=c.useState(null),[rt,je]=c.useState(!1),[Jt,ot]=c.useState(!1),[Z,ct]=c.useState(null),[it,Ce]=c.useState([]),[Oe,$e]=c.useState([]),[Ue,mt]=c.useState(!1),[X,Fe]=c.useState(null),[Qt,Ve]=c.useState(!1),[we,Se]=c.useState(""),[dt,Ie]=c.useState(""),[me,_e]=c.useState(null),[V,He]=c.useState(null),[ut,ft]=c.useState(!1),[Gt,Te]=c.useState(null),[xe,ht]=c.useState({sessionId:"",sessionCsrf:"",userId:"",realtimeToken:""}),[pt,vt]=c.useState(d),[de,Et]=c.useState({open:!1,title:"",message:"",confirmLabel:"Delete",onConfirm:null}),[ue,gt]=c.useState({open:!1,title:"",message:"",confirmLabel:"Confirm",onConfirm:null}),yt=c.useRef(null),ye=c.useRef(null),ze=c.useRef(null),be=c.useRef(null),se=c.useRef(null),ee=c.useRef(null),O=c.useRef({lastSentAt:0,lastValue:!1,idleTimer:null}),D=xe.sessionId,P=xe.sessionCsrf,U=xe.userId,Ye=xe.realtimeToken,x=!!(D&&P&&U),k=N.find(t=>t.id===m)||null,Xt=c.useMemo(()=>Ga(E),[E]),F=k||Xt,Ae=c.useMemo(()=>N.filter(t=>!t.archived),[N]),Ne=c.useMemo(()=>N.filter(t=>t.archived),[N]),ea=c.useMemo(()=>{const t=new Map;return it.forEach(n=>{n!=null&&n.id&&t.set(n.id,{id:n.id,name:n.name||"Unknown",blockedAt:n.blockedAt||"",color:n.color||"#3b82f6"})}),Array.from(t.values())},[it]),ta=c.useMemo(()=>{const t=Q.trim().toLowerCase();return t?Ne.filter(n=>n.name.toLowerCase().includes(t)||(n.lastMessage||"").toLowerCase().includes(t)):Ne},[Ne,Q]),aa=c.useMemo(()=>{const t=Q.trim().toLowerCase();return t?Ae.filter(n=>n.name.toLowerCase().includes(t)||(n.lastMessage||"").toLowerCase().includes(t)):Ae},[Ae,Q]),Be=m?R[m]||[]:[],Ze=c.useMemo(()=>{const t=G.trim().toLowerCase();return t?Be.filter(n=>n.text.toLowerCase().includes(t)):Be},[Be,G]),na=c.useMemo(()=>tn(Ze),[Ze]),sa=!!(m&&Gt===m),bt=()=>{ee.current&&(window.clearTimeout(ee.current),ee.current=null),O.current.idleTimer&&(window.clearTimeout(O.current.idleTimer),O.current.idleTimer=null)},Me=async(t,{force:n=!1}={})=>{const r=se.current;if(!r||!U)return;const o=!!t,i=Date.now(),h=O.current;if(!(!n&&h.lastValue===o&&i-h.lastSentAt<600)){h.lastValue=o,h.lastSentAt=i;try{await r.send({type:"broadcast",event:"typing",payload:{isTyping:o,userId:String(U)}})}catch{}}};c.useEffect(()=>{let t=!1;return(async()=>{if(!m||!U||!Ye||!x){ge(!1);return}try{const r=await Pa();if(!r||t)return;r.realtime.setAuth(Ye);const o=se.current;if(o)try{await o.unsubscribe()}catch{}se.current=null,bt(),O.current.lastValue=!1;const i=r.channel(`conversation:${m}`,{config:{presence:{key:`chat:${String(U)}`}}});i.on("broadcast",{event:"typing"},({payload:h})=>{const S=String((h==null?void 0:h.userId)||"");if(!S||S===String(U))return;const b=!!(h!=null&&h.isTyping);ge(b),ee.current&&(window.clearTimeout(ee.current),ee.current=null),b&&(ee.current=window.setTimeout(()=>{ge(!1),ee.current=null},3e3))}),i.subscribe(async h=>{if(!(t||h!=="SUBSCRIBED"))try{await i.track({userId:String(U),at:new Date().toISOString()})}catch{}}),se.current=i}catch{t||ge(!1)}})(),()=>{t=!0;const r=se.current;if(se.current=null,r)try{r.unsubscribe()}catch{}bt(),O.current.lastValue=!1,ge(!1)}},[m,x,U,Ye]),c.useEffect(()=>{if(!m||!U||!se.current)return;const t=oe.trim().length>0,n=Date.now(),r=O.current;t!==r.lastValue&&n-r.lastSentAt>600&&Me(t,{force:!0}),r.idleTimer&&(window.clearTimeout(r.idleTimer),r.idleTimer=null),t&&(r.idleTimer=window.setTimeout(()=>{O.current.idleTimer=null,Me(!1,{force:!0})},2e3))},[oe,m,U]),c.useEffect(()=>{if(!m||G.trim())return;const t=yt.current;t&&requestAnimationFrame(()=>{t.scrollTo({top:t.scrollHeight,behavior:"smooth"})})},[m,Be.length,st,G]),c.useEffect(()=>{m||ie(!1)},[m]),c.useEffect(()=>{He(null)},[m]),c.useEffect(()=>{(!m||!x)&&Te(null)},[m,x]),c.useEffect(()=>()=>{be.current&&clearTimeout(be.current)},[]),c.useEffect(()=>{if(!(typeof window>"u"))try{window.localStorage.setItem(Ut,JSON.stringify(H))}catch{}},[H]);const f=t=>{lt(t),be.current&&clearTimeout(be.current),be.current=setTimeout(()=>lt(null),2400)},la=t=>{if(!t||typeof t!="object")return;const n=typeof t.attachmentUrl=="string"?t.attachmentUrl.trim():"",r=typeof t.attachmentType=="string"?t.attachmentType.toLowerCase():"",o=!!t.attachmentIsImage||r.startsWith("image/");if(!n||!o)return;const i=typeof t.attachmentName=="string"&&t.attachmentName?t.attachmentName:"photo";He({url:n,name:i,messageId:typeof t.id=="string"?t.id:""})},ra=()=>{He(null)},oa=async()=>{if(!(V!=null&&V.url))return;const t=V.name||"photo";try{const n=await fetch(V.url);if(!n.ok)throw new Error("download_failed");const r=await n.blob(),o=window.URL.createObjectURL(r),i=document.createElement("a");i.href=o,i.download=t,document.body.appendChild(i),i.click(),i.remove(),window.URL.revokeObjectURL(o),f("Image saved.")}catch{const n=document.createElement("a");n.href=V.url,n.target="_blank",n.rel="noreferrer",n.click(),f("Could not save directly. Opened image in a new tab.")}},ca=()=>{if(!k){f("No chat selected.");return}_e(k),Se(""),Ie(V!=null&&V.name?`Photo attachment: ${V.name}`:"Photo attachment"),Ve(!0)};c.useEffect(()=>{if(!m||!x)return;let t=!1;Te(m);const n=async({silent:o=!1}={})=>{try{const{messages:i,chatPatch:h}=await La({sessionId:D,sessionCsrf:P,conversationId:m,currentUserId:U});if(t)return;$(S=>({...S,[m]:i})),A(S=>S.map(b=>b.id===m?{...b,...h||{},unread:0}:b));try{await ja({sessionId:D,sessionCsrf:P,conversationId:m})}catch{}}catch(i){!t&&!o&&f((i==null?void 0:i.message)||"Failed to load chat messages.")}finally{t||Te(i=>i===m?null:i)}};n();const r=window.setInterval(()=>{n({silent:!0})},5e3);return()=>{t=!0,window.clearInterval(r)}},[m,x,D,P,U]);const ia=()=>{if(!m&&!(E!=null&&E.id)){f("Select a chat to add emojis.");return}ie(t=>!t)},ma=()=>ie(!1),da=t=>{t&&(qt(n=>[t,...n.filter(o=>o!==t)].slice(0,24)),ce(n=>{const{nextValue:r,caret:o}=sn(n,t,ye.current);return requestAnimationFrame(()=>{ye.current&&(ye.current.focus(),ye.current.setSelectionRange(o,o))}),r}))},ua=t=>{if(!t){f("No chat selected.");return}ct(t),ot(!0)},qe=()=>{ot(!1),ct(null)},fa=(t,n)=>{const r=N.find(b=>b.id===t),o=(r==null?void 0:r.otherPartyId)||t;if(!o)return;const i=n||new Date().toISOString(),h=(r==null?void 0:r.name)||"Unknown",S=(r==null?void 0:r.color)||"#3b82f6";Ce(b=>{const w=b.filter(I=>I.id!==o);return[{id:o,name:h,blockedAt:i,color:S},...w]})},Nt=({accountId:t,conversationId:n=""})=>{const r=typeof t=="string"?t.trim():"",o=typeof n=="string"?n.trim():"";A(i=>i.map(h=>{const S=!!o&&h.id===o,b=!!r&&h.otherPartyId===r;if(!S&&!b)return h;const w=!!h.blockedByOther;return{...h,blocked:!1,blockedByMe:!1,hasBlockingRelationship:w,blockedAt:void 0}})),r&&Ce(i=>i.filter(h=>h.id!==r))},kt=async t=>{if(!t)return!1;if(x)try{await $a({sessionId:D,sessionCsrf:P,conversationId:t})}catch(r){return f((r==null?void 0:r.message)||"Failed to block account."),!1}const n=new Date().toISOString();return A(r=>r.map(o=>o.id===t?{...o,blocked:!0,blockedByMe:!0,hasBlockingRelationship:!0,blockedAt:n}:o)),fa(t,n),m===t&&y(null),f("Chat blocked."),!0},ha=async t=>{if(!t)return!1;const n=N.find(o=>o.id===t),r=(n==null?void 0:n.otherPartyId)||"";if(x)try{await Pt({sessionId:D,sessionCsrf:P,conversationId:t||void 0,recipientId:r||void 0})}catch(o){return f((o==null?void 0:o.message)||"Failed to unblock account."),!1}return Nt({accountId:r,conversationId:t}),f("Account unblocked."),!0},pa=async t=>{const n=typeof t=="string"?t.trim():"";if(!n)return!1;const r=N.find(i=>i.otherPartyId===n),o=(r==null?void 0:r.id)||"";if(x)try{await Pt({sessionId:D,sessionCsrf:P,conversationId:o||void 0,recipientId:n})}catch(i){return f((i==null?void 0:i.message)||"Failed to unblock account."),!1}return Nt({accountId:n,conversationId:o}),f("Account unblocked."),!0},va=async(t,n={})=>{if(!t)return!1;const r=n.clearActive!==!1,o=n.toast!==!1;if(x)try{await Ha({sessionId:D,sessionCsrf:P,conversationId:t})}catch(i){return f((i==null?void 0:i.message)||"Failed to archive chat."),!1}return A(i=>i.map(h=>h.id===t?{...h,archived:!0,archivedAt:new Date().toISOString()}:h)),r&&m===t&&y(null),o&&f("Chat archived."),!0},Ct=async(t,n={})=>{if(!t)return!1;const r=n.clearActive===!0,o=n.toast!==!1;if(x)try{await za({sessionId:D,sessionCsrf:P,conversationId:t})}catch(i){return f((i==null?void 0:i.message)||"Failed to restore chat."),!1}return A(i=>i.map(h=>h.id===t?{...h,archived:!1,archivedAt:void 0}:h)),r&&m===t&&y(null),o&&f("Chat restored from archive."),!0},Ea=t=>{t&&(Fe(t),mt(!0))},wt=()=>{mt(!1),Fe(null)},Ke=t=>{t&&(_e(t),Se(""),Ie(""),Ve(!0))},St=()=>{Ve(!1),_e(null),Se(""),Ie("")},ga=async()=>{var o;if(!me||!we)return;if(!x){f("Session missing or expired. Please log in again.");return}const t=((o=jt.find(i=>i.value===we))==null?void 0:o.label)||we,n=dt.trim(),r=n?`${t} - ${n}`:t;try{await Ua({sessionId:D,sessionCsrf:P,conversationId:me.id,recipientId:me.otherPartyId,reason:r});try{const i=await Rt({sessionId:D,sessionCsrf:P});$e(i)}catch{}St(),f("Report sent.")}catch(i){f((i==null?void 0:i.message)||"Failed to submit report.")}},ya=({title:t,message:n,confirmLabel:r,onConfirm:o})=>{gt({open:!0,title:t,message:n,confirmLabel:r,onConfirm:o})},We=()=>{gt(t=>({...t,open:!1}))},ba=async(t,n,r={})=>{const o=!!(r!=null&&r.silent);if(ut)return!1;const i=t.trim(),h=n.trim();if(!i||!h)return o||f("Session credentials missing. Please log in again."),!1;ft(!0);try{const S=await Va({sessionId:i,sessionCsrf:h}),{chats:b,blockedAccounts:w,reports:I,currentUser:M}=await _a({sessionId:i,sessionCsrf:h});ht({sessionId:i,sessionCsrf:h,userId:S.userId,realtimeToken:S.token||""}),vt(M?{...le,...M}:{...le,...d}),A(b),Ce(w),$({}),$e(I);let B=null,he=null;if(!C.current){if(v.conversationId){const q=b.find(K=>K.id===v.conversationId);q&&(B=q.id)}if(!B&&v.recipientId){const q=b.find(K=>K.otherPartyId===v.recipientId);q?B=q.id:he={id:v.recipientId,name:v.recipientName||"Business"}}C.current=!0}return Y(he),y(B),je(!1),J(""),ne(""),re(!1),T("chats"),!o&&b.length===0?f("Connected. No chats found."):o||f(`Connected. Loaded ${b.length} chat${b.length===1?"":"s"}.`),!0}catch(S){return o||f((S==null?void 0:S.message)||"Failed to restore your session."),!1}finally{ft(!1)}};c.useEffect(()=>{let t=!1;return(async()=>{if(x)return;const r=Wa();if(!r){t||f("Session missing or expired. Please log in again.");return}await ba(r.sessionId,r.sessionCsrf,{silent:!0})||t||f("Session missing or expired. Please log in again.")})(),()=>{t=!0}},[]);const fe=({title:t,message:n,confirmLabel:r="Delete",onConfirm:o})=>{Et({open:!0,title:t,message:n,confirmLabel:r,onConfirm:o})},te=()=>{Et(t=>({...t,open:!1}))},Na=async(t,n={})=>{n.unarchive&&!await Ct(t,{clearActive:!1,toast:!0})||(y(t),Y(null),x&&Te(t),je(!1),n.keepSection||T("chats"),A(r=>r.map(o=>o.id===t?{...o,unread:0}:o)),re(!1),ne(""))},It=(t,n,r)=>{$(o=>{const i=o[t]||[];return{...o,[t]:i.map(h=>h.id===n?{...h,status:r}:h)}})},ka=async()=>{const t=oe.trim(),n=m||"",r=n?"":(E==null?void 0:E.id)||"",o=(k==null?void 0:k.name)||(E==null?void 0:E.name)||v.recipientName||"Business",i=(k==null?void 0:k.color)||"#3b82f6";if(!t||!!!(n||r))return;if(ae(F)){f(F!=null&&F.blockedByOther?"You cannot message this account.":"Unblock this account to send messages.");return}if(x){try{const b=await Oa({sessionId:D,sessionCsrf:P,conversationId:n||void 0,recipientId:r||void 0,content:t}),w=Dt(b==null?void 0:b.data,U),I=(typeof w.chatId=="string"?w.chatId.trim():"")||n;if(!I)throw new Error("Failed to resolve conversation ID.");$(M=>({...M,[I]:[...M[I]||[],w]})),ce(""),A(M=>{const B=w.timestamp||new Date().toISOString();if(!M.find(_=>_.id===I))return[{id:I,name:o,firstName:"",lastName:"",suburb:"",city:"",province:"",streetAddress:"",accountSince:"",accountType:"Business",lastMessage:w.text||t,lastTime:B,unread:0,online:!1,presence:"offline",color:i,archived:!1,blocked:!1,blockedByMe:!1,blockedByOther:!1,hasBlockingRelationship:!1,otherPartyId:r||(E==null?void 0:E.id)||""},...M];const q=M.map(_=>_.id===I?{..._,lastMessage:w.text||t,lastTime:w.timestamp||B,unread:0}:_),K=q.find(_=>_.id===I),Re=q.filter(_=>_.id!==I);return K?[K,...Re]:q}),y(I),Y(null),O.current.idleTimer&&(window.clearTimeout(O.current.idleTimer),O.current.idleTimer=null),O.current.lastValue=!1,Me(!1,{force:!0})}catch(b){f((b==null?void 0:b.message)||"Failed to send message.")}return}if(!n){f("Session missing or expired. Please log in again.");return}const S={id:`m-${Date.now()}`,chatId:n,sender:"me",text:t,timestamp:new Date().toISOString(),status:"sent"};$(b=>({...b,[n]:[...b[n]||[],S]})),ce(""),A(b=>{const w=b.map(B=>B.id===n?{...B,lastMessage:t,lastTime:S.timestamp,unread:0}:B),I=w.find(B=>B.id===n),M=w.filter(B=>B.id!==n);return I?[I,...M]:w}),setTimeout(()=>It(n,S.id,"delivered"),900),setTimeout(()=>It(n,S.id,"read"),2e3),O.current.idleTimer&&(window.clearTimeout(O.current.idleTimer),O.current.idleTimer=null),O.current.lastValue=!1,Me(!1,{force:!0})},Ca=()=>{if(!m&&!(E!=null&&E.id)){f("Select a chat first.");return}if(!x){f("Session missing or expired. Please log in again.");return}if(ae(F)){f(F!=null&&F.blockedByOther?"You cannot message this account.":"Unblock this account to send messages.");return}ze.current&&ze.current.click()},wa=async t=>{var b;const n=t.target,r=(b=n==null?void 0:n.files)==null?void 0:b[0];if(n&&(n.value=""),!r)return;if(!m&&!(E!=null&&E.id)){f("Select a chat first.");return}if(!x){f("Session missing or expired. Please log in again.");return}if(ae(F)){f(F!=null&&F.blockedByOther?"You cannot message this account.":"Unblock this account to send messages.");return}const o=m||"",i=o?"":(E==null?void 0:E.id)||"",h=(k==null?void 0:k.name)||(E==null?void 0:E.name)||v.recipientName||"Business",S=(k==null?void 0:k.color)||"#3b82f6";try{const w=await Fa({sessionId:D,sessionCsrf:P,conversationId:o||void 0,recipientId:i||void 0,file:r}),I=Dt(w==null?void 0:w.data,U),M=(typeof I.chatId=="string"?I.chatId.trim():"")||o;if(!M)throw new Error("Failed to resolve conversation ID.");$(B=>({...B,[M]:[...B[M]||[],I]})),A(B=>{const he=I.timestamp||new Date().toISOString();if(!B.find(W=>W.id===M))return[{id:M,name:h,firstName:"",lastName:"",suburb:"",city:"",province:"",streetAddress:"",accountSince:"",accountType:"Business",lastMessage:I.text||r.name,lastTime:he,unread:0,online:!1,presence:"offline",color:S,archived:!1,blocked:!1,blockedByMe:!1,blockedByOther:!1,hasBlockingRelationship:!1,otherPartyId:i||(E==null?void 0:E.id)||""},...B];const K=B.map(W=>W.id===M?{...W,lastMessage:I.text||r.name,lastTime:I.timestamp||he,unread:0}:W),Re=K.find(W=>W.id===M),_=K.filter(W=>W.id!==M);return Re?[Re,..._]:K}),y(M),Y(null),f("Attachment sent.")}catch(w){f((w==null?void 0:w.message)||"Failed to send attachment.")}},Je=t=>{if(!Array.isArray(t)||t.length===0)return;const n=new Set(t.filter(Boolean));n.size&&(A(r=>r.filter(o=>!n.has(o.id))),$(r=>{const o={...r};return n.forEach(i=>{delete o[i]}),o}),m&&n.has(m)&&y(null))},Qe=async(t,n={})=>{const r=typeof t=="string"?t.trim():"";if(!r)return!1;const o=n.toast!==!1;if(x)try{await Lt({sessionId:D,sessionCsrf:P,conversationId:r})}catch(i){return f((i==null?void 0:i.message)||"Failed to delete chat."),!1}return Je([r]),o&&f("Chat deleted."),!0},Tt=async()=>{const t=N.map(o=>o.id).filter(Boolean);if(t.length===0)return f("No chats to delete."),!1;if(!x)return Je(t),f("All chats deleted."),!0;const n=[];for(const o of t)try{await Lt({sessionId:D,sessionCsrf:P,conversationId:o}),n.push(o)}catch{}n.length>0&&Je(n);const r=t.length-n.length;return n.length===0?(f("Failed to delete chats."),!1):r===0?(f("All chats deleted."),!0):(f(`Deleted ${n.length} chat${n.length===1?"":"s"}. ${r} failed.`),!1)},Sa=t=>{$(n=>({...n,[t]:[]})),A(n=>n.map(r=>r.id===t?{...r,lastMessage:"No messages yet",lastTime:"",unread:0}:r))},Ia=()=>{if(m){Sa(m),f("Cleared current chat.");return}const t={};N.forEach(n=>{t[n.id]=[]}),$(t),A(n=>n.map(r=>({...r,lastMessage:"No messages yet",lastTime:"",unread:0}))),f("Cleared all chats.")},Ta=t=>{if(t==="profile"){k&&ua(k);return}if(t==="close"){y(null),Y(null),je(!0),re(!1),ne(""),f("Chat closed.");return}if(t==="block"){if(!k)return;kt(k.id);return}if(t==="delete"){fe(k?{title:`Delete chat with ${pe(k)}?`,message:"This removes the chat from your list.",onConfirm:()=>{te(),Qe(k.id)}}:{title:"Delete all chats?",message:"This removes every chat from your list.",onConfirm:()=>{te(),Tt()}});return}if(t==="clear"){const n=k?`Clear chat with ${k.name}?`:"Clear all chats?";ya({title:n,message:k?"This clears the messages in this chat.":"This clears the messages in every chat.",confirmLabel:"Clear",onConfirm:()=>{We(),Ia()}});return}t==="report"&&k&&Ke(k)},xa=()=>{re(t=>{const n=!t;return n||ne(""),n})},Aa=async(t,n)=>{if(n==="archive"){await va(t,{clearActive:!0,toast:!0});return}if(n==="unarchive"){await Ct(t,{clearActive:z,toast:!0});return}if(n==="delete"){const r=N.find(o=>o.id===t);fe({title:r?`Delete chat with ${pe(r)}?`:"Delete chat?",message:"This removes the chat from your list.",onConfirm:()=>{te(),Qe(t)}});return}if(n==="report"){const r=N.find(o=>o.id===t);Ke(r)}},Ba=t=>{pa(t)},z=u==="archive",xt=u==="block",At=u==="profile",Bt=u==="reports",Ge=!!V,Mt=Ge||At||xt||Bt,Ma=ut;return c.useEffect(()=>{u!=="chats"&&u!=="archive"&&ie(!1)},[u]),c.useEffect(()=>{if(!z||rt)return;if(Ne.length===0){y(null);return}const t=N.find(n=>n.id===m);t&&!t.archived&&y(null)},[z,Ne,N,m,rt]),c.useEffect(()=>{if(z)return;const t=N.find(n=>n.id===m);t&&t.archived&&y(null)},[z,N,m,Ae]),c.useEffect(()=>{if(!x||u!=="block")return;let t=!1;return(async()=>{try{const n=await Ra({sessionId:D,sessionCsrf:P});t||Ce(n)}catch{}})(),()=>{t=!0}},[x,u,D,P]),c.useEffect(()=>{if(!x||u!=="reports")return;let t=!1;return(async()=>{try{const n=await Rt({sessionId:D,sessionCsrf:P});t||$e(n)}catch{}})(),()=>{t=!0}},[x,u,D,P]),c.useEffect(()=>{if(!Ue||!(X!=null&&X.id))return;const t=Oe.find(n=>n.id===X.id);if(!t){wt();return}Fe(t)},[Ue,X==null?void 0:X.id,Oe]),e.createElement("div",{className:"desktop-stage"},e.createElement("div",{className:"desktop-window"},e.createElement("div",{className:`desktop-content chp-desktop${Ge?" preview-only":Mt?" section-only":""}`},Ge?null:e.createElement("aside",{className:"icon-rail"},e.createElement("nav",{className:"rail-nav","aria-label":"Primary"},[{key:"home",label:"Home",icon:hn},{key:"chats",label:"Chats",icon:on},{key:"archive",label:"Archive",icon:pn},{key:"block",label:"Block",icon:ve},{key:"reports",label:"Reports",icon:zt},{key:"profile",label:"Profile",icon:vn}].map(t=>{const n=t.icon;return e.createElement("button",{key:t.key,className:`rail-btn ${u===t.key?"active":""}`,type:"button",onClick:()=>{if(T(t.key),t.key==="home"){window.location.href="homepage.html";return}},"aria-label":t.label},e.createElement("span",{className:"rail-icon"},e.createElement(n,null)),e.createElement("span",null,t.label))})),e.createElement("div",{className:"rail-footer"},e.createElement("button",{className:`rail-btn danger ${u==="logout"?"active":""}`,type:"button",onClick:()=>{T("logout"),fe({title:"Log out?",message:"Are you sure you want to log out?",confirmLabel:"Log out",onConfirm:()=>{te(),Ja(),ht({sessionId:"",sessionCsrf:"",userId:"",realtimeToken:""}),vt({...le,...d}),f("Logged out.")}})},"aria-label":"Logout"},e.createElement("span",{className:"rail-icon"},e.createElement(En,null)),e.createElement("span",null,"Logout")))),Mt?null:e.createElement("aside",{className:"sidebar"},z?e.createElement(e.Fragment,null,e.createElement("div",{className:"archive-heading"},e.createElement("h2",null,"Achieved Chats")),e.createElement("div",{className:"archive-description muted"},"Archived conversations stored here.")):e.createElement("div",{className:"sidebar-header"},e.createElement("div",{className:"sidebar-title"},e.createElement("div",{className:"sidebar-brand"},e.createElement("img",{src:Da,alt:"CompareHubPrices"}))),e.createElement("div",{className:"sidebar-actions-row"},e.createElement("button",{className:"icon-btn",type:"button","aria-label":"Delete all chats",onClick:()=>{fe({title:"Delete all chats?",message:"This removes every chat from your list.",onConfirm:()=>{te(),Tt()}})}},e.createElement(Yt,null)))),e.createElement(An,{chats:z?ta:aa,searchValue:Q,onSearchChange:J,activeChatId:m,onOpenChat:t=>Na(t,{keepSection:z}),onMenuAction:Aa,emptyTitle:z?"No archived chats":void 0,emptySubtitle:z?"Archived conversations will appear here.":void 0,showSearch:!z})),e.createElement("section",{className:"chat-panel"},At?e.createElement(wn,{currentUser:pt}):xt?e.createElement(Sn,{chats:ea,onUnblock:Ba}):Bt?e.createElement(In,{reports:Oe,onOpenReport:Ea}):e.createElement(jn,{chat:F,groupedMessages:na,searchValue:G,showSearch:Le,onToggleSearch:xa,onSearchChange:ne,onSend:ka,composerValue:oe,onComposerChange:ce,onEmoji:ia,onAttach:Ca,emojiOpen:ke,emojiRecents:H,onEmojiSelect:da,onEmojiClose:ma,composerRef:ye,typing:st,conversationLoading:sa,messageListRef:yt,matchCount:Ze.length,onMenuAction:Ta,attachmentPreview:V,onOpenAttachmentPreview:la,onCloseAttachmentPreview:ra,onSaveAttachmentPreview:oa,onReportAttachmentPreview:ca})))),Ma?e.createElement(Cn,null):null,e.createElement(Nn,{open:Kt,onClose:()=>Wt(!1),currentUser:pt}),e.createElement(kn,{open:Jt,onClose:qe,chat:Z,onDelete:()=>{Z&&fe({title:`Delete chat with ${pe(Z)}?`,message:"This removes the chat from your list.",onConfirm:async()=>{te(),await Qe(Z.id)&&qe()}})},onBlock:()=>{(async()=>{if(!Z)return;(Z.blocked?await ha(Z.id):await kt(Z.id))&&qe()})()},onReport:()=>{Z&&Ke(Z)}}),e.createElement(Tn,{open:Ue,report:X,onClose:wt}),e.createElement(xn,{open:Qt,onClose:St,reasons:jt,value:we,onChange:Se,details:dt,onDetailsChange:Ie,onSubmit:ga,targetName:me==null?void 0:me.name}),e.createElement(bn,{open:de.open,title:de.title,message:de.message,confirmLabel:de.confirmLabel,onConfirm:()=>{de.onConfirm?de.onConfirm():te()},onCancel:te}),e.createElement(yn,{open:ue.open,title:ue.title,message:ue.message,confirmLabel:ue.confirmLabel,onConfirm:()=>{ue.onConfirm?ue.onConfirm():We()},onCancel:We}),e.createElement("input",{ref:ze,type:"file",accept:".pdf,image/png,image/jpeg,image/webp,video/mp4,video/webm,video/quicktime,.mov,.m4v",onChange:wa,style:{display:"none"}}))}const $n=Za(document.getElementById("root"));$n.render(e.createElement(e.StrictMode,null,e.createElement(On,null)));
