import{r as m,f as ga,a as kt,R as e,l as ya,g as ba,b as ka,m as Na,s as Ca,c as Nt,j as Ct,o as wa,d as Sa,e as Ta,h as Ia,i as Aa,k as xa,u as Ra,p as wt,n as Ma,q as Ba}from"./emojiSearch-Cr0HF65V.js";const Ce={name:"",firstName:"",lastName:"",status:"",about:"",email:"",phone:"",suburb:"",city:"",province:"",accountSince:""},Da=[],La={},St=[{value:"spam",label:"Spam"},{value:"harassment",label:"Harassment"},{value:"scam",label:"Scam"},{value:"other",label:"Other"}];function Pa(){if(typeof document>"u")return null;const a=Tt("standard_session_id"),n=Tt("standard_csrf_token");return!a||!n?null:{sessionId:a,sessionCsrf:n}}function de(){typeof document>"u"||(It("standard_session_id"),It("standard_csrf_token"))}function Tt(a){var n,r;if(!a||typeof document>"u")return"";try{const f=`; ${document.cookie}`.split(`; ${a}=`);return f.length!==2?"":((r=(n=f.pop())==null?void 0:n.split(";").shift())==null?void 0:r.trim())||""}catch{return""}}function It(a){var r;const n=typeof window<"u"&&((r=window.location)==null?void 0:r.protocol)==="https:"?"; Secure":"";document.cookie=`${a}=; path=/; max-age=0; SameSite=Lax${n}`}function ja(){var i,f;if(typeof window>"u")return"";const a=(f=(i=document.body)==null?void 0:i.dataset)==null?void 0:f.standardLoginHref,n=typeof a=="string"?a.trim():"";return n||((window.location.pathname||"").includes("/comparehubprices/")?"/comparehubprices/login.html":"/login.html")}async function He(){if(typeof window>"u")return!1;const a=ja();if(!a)return!1;const n=window.location.pathname||"";if(n.endsWith("/login.html")||n==="/login.html")return!1;try{if(!(await fetch(a,{method:"HEAD",credentials:"include"})).ok)return!1}catch{return!1}const r=`${window.location.pathname||"/chat-hub/"}${window.location.search||""}${window.location.hash||""}`,i=a.includes("?")?"&":"?";return window.location.replace(`${a}${i}redirect=${encodeURIComponent(r)}`),!0}async function $a(a,n){if(typeof window>"u")return!0;const r=window.standardAuth;if(!r||typeof r.getUserInfo!="function")return!0;try{const i=await r.getUserInfo({sessionId:a,csrfToken:n});return!!(i!=null&&i.success)}catch{return!1}}const At="chp_recent_emojis",Ne=[{id:"recent",name:"Recent",icon:'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>',emojis:["ğŸ˜‚","â¤ï¸","ğŸ‘","ğŸ”¥","ğŸ˜Š","ğŸ™","ğŸ¥º","ğŸ¤£"]},{id:"smileys",name:"Smileys & Emotion",icon:'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M8 14s1.5 2 4 2 4-2 4-2"></path><line x1="9" y1="9" x2="9.01" y2="9"></line><line x1="15" y1="9" x2="15.01" y2="9"></line></svg>',emojis:["ğŸ˜€","ğŸ˜ƒ","ğŸ˜„","ğŸ˜","ğŸ˜†","ğŸ˜…","ğŸ˜‚","ğŸ¤£","ğŸ˜Š","ğŸ˜‡","ğŸ™‚","ğŸ™ƒ","ğŸ˜‰","ğŸ˜Œ","ğŸ˜","ğŸ¥°","ğŸ˜˜","ğŸ˜—","ğŸ˜™","ğŸ˜š","ğŸ˜‹","ğŸ˜›","ğŸ˜","ğŸ˜œ","ğŸ¤ª","ğŸ¤¨","ğŸ§","ğŸ¤“","ğŸ˜","ğŸ¤©","ğŸ¥³","ğŸ˜","ğŸ˜’","ğŸ˜","ğŸ˜”","ğŸ˜Ÿ","ğŸ˜•","ğŸ™","â˜¹ï¸","ğŸ˜£","ğŸ˜–","ğŸ˜«","ğŸ˜©","ğŸ¥º","ğŸ˜¢","ğŸ˜­","ğŸ˜¤","ğŸ˜ ","ğŸ˜¡","ğŸ¤¬","ğŸ¤¯","ğŸ˜³","ğŸ¥µ","ğŸ¥¶","ğŸ˜±","ğŸ˜¨","ğŸ˜°","ğŸ˜¥","ğŸ˜“","ğŸ¤—","ğŸ¤”","ğŸ¤­","ğŸ¤«","ğŸ¤¥","ğŸ˜¶","ğŸ˜","ğŸ˜‘","ğŸ˜¬","ğŸ™„","ğŸ˜¯","ğŸ˜¦","ğŸ˜§","ğŸ˜®","ğŸ˜²","ğŸ¥±","ğŸ˜´","ğŸ¤¤","ğŸ˜ª","ğŸ˜µ","ğŸ¤","ğŸ¥´","ğŸ¤¢","ğŸ¤®","ğŸ¤§","ğŸ˜·","ğŸ¤’","ğŸ¤•","ğŸ¤‘","ğŸ¤ ","ğŸ˜ˆ","ğŸ‘¿","ğŸ‘¹","ğŸ‘º","ğŸ¤¡","ğŸ’©","ğŸ‘»","ğŸ’€","â˜ ï¸","ğŸ‘½","ğŸ‘¾","ğŸ¤–","ğŸƒ"]},{id:"people",name:"People & Body",icon:'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 11V6a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v5"></path><path d="M14 10V4a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v10"></path><path d="M10 10.5V6a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v8"></path><path d="M18 8a2 2 0 1 1 4 0v6a8 8 0 0 1-8 8h-2c-2.8 0-4.5-.86-5.99-2.34l-3.6-3.6a2 2 0 0 1 2.83-2.82L7 15"></path></svg>',emojis:["ğŸ‘‹","ğŸ¤š","ğŸ–ï¸","âœ‹","ğŸ––","ğŸ‘Œ","ğŸ¤","âœŒï¸","ğŸ¤","ğŸ¤Ÿ","ğŸ¤˜","ğŸ¤™","ğŸ‘ˆ","ğŸ‘‰","ğŸ‘†","ğŸ–•","ğŸ‘‡","â˜ï¸","ğŸ‘","ğŸ‘","âœŠ","ğŸ‘Š","ğŸ¤›","ğŸ¤œ","ğŸ‘","ğŸ™Œ","ğŸ‘","ğŸ¤²","ğŸ¤","ğŸ™","âœï¸","ğŸ’…","ğŸ¤³","ğŸ’ª","ğŸ¦¾","ğŸ¦µ","ğŸ¦¿","ğŸ¦¶","ğŸ‘‚","ğŸ¦»","ğŸ‘ƒ","ğŸ§ ","ğŸ¦·","ğŸ¦´","ğŸ‘€","ğŸ‘ï¸","ğŸ‘…","ğŸ‘„","ğŸ‘¶","ğŸ§’","ğŸ‘¦","ğŸ‘§","ğŸ§‘","ğŸ‘±","ğŸ‘¨","ğŸ§”","ğŸ‘©","ğŸ§“","ğŸ‘´","ğŸ‘µ","ğŸ‘¨â€âš•ï¸","ğŸ‘©â€âš•ï¸","ğŸ‘¨â€ğŸ“","ğŸ‘©â€ğŸ“","ğŸ‘¨â€ğŸ«","ğŸ‘©â€ğŸ«","ğŸ‘¨â€âš–ï¸","ğŸ‘©â€âš–ï¸","ğŸ‘¨â€ğŸŒ¾","ğŸ‘©â€ğŸŒ¾","ğŸ‘¨â€ğŸ³","ğŸ‘©â€ğŸ³","ğŸ‘¨â€ğŸ”§","ğŸ‘©â€ğŸ”§","ğŸ‘¨â€ğŸ­","ğŸ‘©â€ğŸ­","ğŸ‘¨â€ğŸ’¼","ğŸ‘©â€ğŸ’¼","ğŸ‘¨â€ğŸ”¬","ğŸ‘©â€ğŸ”¬","ğŸ‘¨â€ğŸ’»","ğŸ‘©â€ğŸ’»","ğŸ‘¨â€ğŸ¤","ğŸ‘©â€ğŸ¤","ğŸ‘¨â€ğŸ¨","ğŸ‘©â€ğŸ¨","ğŸ‘¨â€âœˆï¸","ğŸ‘©â€âœˆï¸","ğŸ‘¨â€ğŸš€","ğŸ‘©â€ğŸš€","ğŸ‘¨â€ğŸš’","ğŸ‘©â€ğŸš’","ğŸ‘®","ğŸ•µï¸","ğŸ’‚","ğŸ‘·","ğŸ¤´","ğŸ‘¸","ğŸ‘³","ğŸ‘²","ğŸ§•","ğŸ¤µ","ğŸ‘°"]},{id:"nature",name:"Animals & Nature",icon:'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10Z"></path><path d="M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12"></path></svg>',emojis:["ğŸ¶","ğŸ±","ğŸ­","ğŸ¹","ğŸ°","ğŸ¦Š","ğŸ»","ğŸ¼","ğŸ»â€â„ï¸","ğŸ¨","ğŸ¯","ğŸ¦","ğŸ®","ğŸ·","ğŸ½","ğŸ¸","ğŸµ","ğŸ™ˆ","ğŸ™‰","ğŸ™Š","ğŸ’","ğŸ”","ğŸ§","ğŸ¦","ğŸ¤","ğŸ£","ğŸ¥","ğŸ¦†","ğŸ¦¢","ğŸ¦‰","ğŸ¦©","ğŸ¦š","ğŸ¦œ","ğŸ¸","ğŸŠ","ğŸ¢","ğŸ¦","ğŸ","ğŸ²","ğŸ‰","ğŸ¦•","ğŸ¦–","ğŸ³","ğŸ‹","ğŸ¬","ğŸ¦­","ğŸŸ","ğŸ ","ğŸ¡","ğŸ¦ˆ","ğŸ™","ğŸš","ğŸŒ","ğŸ¦‹","ğŸ›","ğŸœ","ğŸ","ğŸ","ğŸ¦—","ğŸ•·ï¸","ğŸ•¸ï¸","ğŸ¦‚","ğŸ¦Ÿ","ğŸ¦ ","ğŸ’","ğŸŒ¸","ğŸ’®","ğŸµï¸","ğŸŒ¹","ğŸ¥€","ğŸŒº","ğŸŒ»","ğŸŒ¼","ğŸŒ·","ğŸŒ±","ğŸª´","ğŸŒ²","ğŸŒ³","ğŸŒ´","ğŸŒµ","ğŸŒ¾","ğŸŒ¿","â˜˜ï¸","ğŸ€","ğŸ","ğŸ‚","ğŸƒ"]},{id:"food",name:"Food & Drink",icon:'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 2v20"></path><path d="M15 3v10"></path><path d="M15 17v5"></path><path d="M15 3c-1.1 0-2 .9-2 2h0c0 1.1.9 2 2 2h0c1.1 0 2-.9 2-2h0c0-1.1-.9-2-2-2Z"></path><path d="M15 17c-1.1 0-2 .9-2 2h0c0 1.1.9 2 2 2h0c1.1 0 2-.9 2-2h0c0-1.1-.9-2-2-2Z"></path><path d="M9 3v10"></path><path d="M9 17v5"></path><path d="M9 3c-1.1 0-2 .9-2 2h0c0 1.1.9 2 2 2h0c1.1 0 2-.9 2-2h0c0-1.1-.9-2-2-2Z"></path><path d="M9 17c-1.1 0-2 .9-2 2h0c0 1.1.9 2 2 2h0c1.1 0 2-.9 2-2h0c0-1.1-.9-2-2-2Z"></path></svg>',emojis:["ğŸ","ğŸ","ğŸ","ğŸŠ","ğŸ‹","ğŸŒ","ğŸ‰","ğŸ‡","ğŸ“","ğŸ«","ğŸˆ","ğŸ’","ğŸ‘","ğŸ¥­","ğŸ","ğŸ¥¥","ğŸ¥","ğŸ…","ğŸ†","ğŸ¥‘","ğŸ¥¦","ğŸ¥¬","ğŸ¥’","ğŸŒ¶ï¸","ğŸŒ½","ğŸ¥•","ğŸ«’","ğŸ§„","ğŸ§…","ğŸ„","ğŸ¥œ","ğŸ«˜","ğŸŒ°","ğŸ","ğŸ¥","ğŸ¥–","ğŸ«“","ğŸ¥¨","ğŸ¥¯","ğŸ¥","ğŸ§‡","ğŸ§€","ğŸ–","ğŸ—","ğŸ¥©","ğŸ¥“","ğŸ”","ğŸŸ","ğŸ•","ğŸŒ­","ğŸ¥ª","ğŸŒ®","ğŸŒ¯","ğŸ«”","ğŸ¥™","ğŸ§†","ğŸ¥š","ğŸ³","ğŸ¥˜","ğŸ²","ğŸ¥£","ğŸ¥—","ğŸ¿","ğŸ§ˆ","ğŸ§‚","ğŸ¥«","ğŸ±","ğŸ˜","ğŸ™","ğŸš","ğŸ›","ğŸœ","ğŸ","ğŸ ","ğŸ¢","ğŸ£","ğŸ¤","ğŸ¥","ğŸ¥®","ğŸ¡","ğŸ¥Ÿ","ğŸ¥ ","ğŸ¥¡","ğŸ¦€","ğŸ¦","ğŸ¦","ğŸ¦‘","ğŸ¦ª","ğŸ¦","ğŸ§","ğŸ¨","ğŸ©","ğŸª","ğŸ‚","ğŸ°","ğŸ§","ğŸ¥§","ğŸ«","ğŸ¬","ğŸ­","ğŸ®","ğŸ¯","ğŸ¼","ğŸ¥›","â˜•","ğŸ«–","ğŸµ","ğŸ¶","ğŸ¾","ğŸ·","ğŸ¸","ğŸ¹","ğŸº","ğŸ»","ğŸ¥‚","ğŸ¥ƒ","ğŸ¥¤","ğŸ§‹","ğŸ§ƒ","ğŸ§‰","ğŸ§Š","ğŸ¥¢","ğŸ½ï¸","ğŸ´","ğŸ¥„"]},{id:"travel",name:"Travel & Places",icon:'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>',emojis:["ğŸš—","ğŸš•","ğŸš™","ğŸšŒ","ğŸš","ğŸï¸","ğŸš“","ğŸš‘","ğŸš’","ğŸš","ğŸ›»","ğŸšš","ğŸš›","ğŸšœ","ğŸ›µ","ğŸï¸","ğŸ›º","ğŸš²","ğŸ›´","ğŸ›¹","ğŸš","ğŸ›¤ï¸","ğŸ›©ï¸","âœˆï¸","ğŸ›«","ğŸ›¬","ğŸ›°ï¸","ğŸš€","ğŸ›¸","ğŸš","ğŸ›¶","â›µ","ğŸš¤","ğŸ›³ï¸","â›´ï¸","ğŸš¢","âš“","â›½","ğŸš§","ğŸš¦","ğŸš¥","ğŸ—ºï¸","ğŸ—¿","ğŸ—½","ğŸ—¼","ğŸ°","ğŸ¯","ğŸŸï¸","ğŸ¡","ğŸ¢","ğŸ ","â›²","â›±ï¸","ğŸ–ï¸","ğŸï¸","ğŸœï¸","ğŸŒ‹","â›°ï¸","ğŸ”ï¸","ğŸ—»","ğŸ•ï¸","â›º","ğŸ ","ğŸ¡","ğŸ¢","ğŸ£","ğŸ¤","ğŸ¥","ğŸ¦","ğŸ¨","ğŸ©","ğŸª","ğŸ«","ğŸ¬","ğŸ­","ğŸ™ï¸","ğŸŒ†","ğŸŒ‡","ğŸŒƒ","ğŸŒ‰","ğŸŒŒ","â™¨ï¸","ğŸŒ","ğŸŒ","ğŸŒ","ğŸŒ","ğŸŒ‘","ğŸŒ’","ğŸŒ“","ğŸŒ”","ğŸŒ•","ğŸŒ–","ğŸŒ—","ğŸŒ˜","ğŸŒ™","ğŸŒš","ğŸŒ","ğŸª","ğŸŒŸ","â­","âœ¨","ğŸŒ ","â˜€ï¸","ğŸŒ¤ï¸","â›…","ğŸŒ¥ï¸","â˜ï¸","ğŸŒ¦ï¸","ğŸŒ§ï¸","â›ˆï¸","ğŸŒ©ï¸","ğŸŒ¨ï¸","â„ï¸","â˜ƒï¸","â›„","ğŸŒ¬ï¸","ğŸ’¨","ğŸŒªï¸","ğŸŒ«ï¸","ğŸŒˆ","â˜”","ğŸ’§","ğŸ’¦","ğŸŒŠ"]},{id:"objects",name:"Objects",icon:'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path><polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline><line x1="12" y1="22.08" x2="12" y2="12"></line></svg>',emojis:["âŒš","ğŸ“±","ğŸ“²","ğŸ’»","âŒ¨ï¸","ğŸ–¥ï¸","ğŸ–¨ï¸","ğŸ–±ï¸","ğŸ–²ï¸","ğŸ•¹ï¸","ğŸ—œï¸","ğŸ’½","ğŸ’¾","ğŸ’¿","ğŸ“€","ğŸ“¼","ğŸ“·","ğŸ“¸","ğŸ“¹","ğŸ¥","ğŸ“½ï¸","ğŸï¸","ğŸ“","â˜ï¸","ğŸ“Ÿ","ğŸ“ ","ğŸ“º","ğŸ“»","ğŸ™ï¸","ğŸšï¸","ğŸ›ï¸","ğŸ§­","â±ï¸","â²ï¸","â°","ğŸ•°ï¸","âŒ›","â³","ğŸ”‹","ğŸ”Œ","ğŸ’¡","ğŸ”¦","ğŸ•¯ï¸","ğŸª”","ğŸ—‘ï¸","ğŸ›¢ï¸","ğŸ’¸","ğŸ’µ","ğŸ’´","ğŸ’¶","ğŸ’·","ğŸ’°","ğŸ’³","ğŸ’","âš–ï¸","ğŸªœ","ğŸ§°","ğŸª›","ğŸ”§","ğŸ”¨","âš’ï¸","ğŸ› ï¸","â›ï¸","ğŸª“","ğŸ”©","âš™ï¸","ğŸª—","ğŸ§±","â›“ï¸","ğŸ§²","âš—ï¸","ğŸ”­","ğŸ”¬","ğŸ•³ï¸","ğŸ©¹","ğŸ©º","ğŸ’Š","ğŸ’‰","ğŸ©¸","ğŸ§¬","ğŸ§¼","ğŸª ","ğŸ§½","ğŸª£","ğŸª‘","ğŸ§¹","ğŸ§º","ğŸ§»","ğŸ§´","ğŸ§¼","ğŸª¥","ğŸª’","ğŸ§µ","ğŸ§¶","ğŸªœ","ğŸ”‘","ğŸ—ï¸","ğŸ”¨","ğŸ”«","ğŸ›¡ï¸","ğŸ¹","ğŸ—¡ï¸","âš”ï¸","ğŸ’£","ğŸ§¨","ğŸš¬","âš°ï¸","ğŸª¦","âš±ï¸","ğŸº","ğŸ”®","ğŸ“¿","ğŸ§¿","ğŸ’ˆ"]},{id:"symbols",name:"Symbols",icon:'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 12h2"></path><path d="M12 11v2"></path><circle cx="12" cy="12" r="10"></circle></svg>',emojis:["â¤ï¸","ğŸ§¡","ğŸ’›","ğŸ’š","ğŸ’™","ğŸ’œ","ğŸ–¤","ğŸ¤","ğŸ¤","ğŸ’”","â£ï¸","ğŸ’•","ğŸ’","ğŸ’“","ğŸ’—","ğŸ’–","ğŸ’˜","ğŸ’","ğŸ’Ÿ","â˜®ï¸","âœï¸","â˜ªï¸","ğŸ•‰ï¸","â˜¸ï¸","âœ¡ï¸","ğŸ”¯","ğŸ•","â˜¯ï¸","â˜¦ï¸","ğŸ›","â›","â™ˆ","â™‰","â™Š","â™‹","â™Œ","â™","â™","â™","â™","â™‘","â™’","â™“","ğŸ†”","âš›ï¸","ğŸ‰‘","â˜¢ï¸","â˜£ï¸","ğŸ“´","ğŸ“³","ğŸˆ¶","ğŸˆš","ğŸˆ¸","ğŸˆº","ğŸˆ·ï¸","âœ´ï¸","ğŸ†š","ğŸ’®","ğŸ‰","ãŠ™ï¸","ãŠ—ï¸","ğŸˆ´","ğŸˆµ","ğŸˆ¹","ğŸˆ²","ğŸ…°ï¸","ğŸ…±ï¸","ğŸ†","ğŸ†‘","ğŸ…¾ï¸","ğŸ†˜","âŒ","â­•","ğŸ›‘","â›”","ğŸ“›","ğŸš«","ğŸ’¯","ğŸ’¢","â™¨ï¸","ğŸš·","ğŸš¯","ğŸš³","ğŸš±","ğŸ”","ğŸ“µ","ğŸš­","â—","â•","â“","â”","â€¼ï¸","â‰ï¸","ğŸ”…","ğŸ”†","âš ï¸","ğŸš¸","ğŸ”±","âšœï¸","ğŸ”°","â™»ï¸","âœ…","ğŸˆ¯","ğŸ’¹","â‡ï¸","âœ³ï¸","â","ğŸŒ","ğŸ’ ","â“‚ï¸","ğŸŒ€","ğŸ’¤","ğŸ§","ğŸš¾","â™¿","ğŸ…¿ï¸","ğŸ›—","ğŸˆ³","ğŸˆ‚ï¸","ğŸ›‚","ğŸ›ƒ","ğŸ›„","ğŸ›…"]}];function le(a){if(!a)return"";const n=a.split(" ").filter(Boolean),r=n[0]?n[0][0]:"",i=n.length>1?n[n.length-1][0]:"";return(r+i).toUpperCase()}function ne(a){return!a||typeof a!="object"||a.blockedByOther?"User unavailable":a.name||"Unknown"}function Z(a){return!!(a&&(a.blocked||a.blockedByOther))}function Rt(a){if(!a)return"";const n=new Date(a);return Number.isNaN(n.getTime())?"":n.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}function Oa(a){if(!a)return"";const n=new Date(a);return Number.isNaN(n.getTime())?"":n.toLocaleDateString([],{month:"short",day:"numeric"})}function We(a){if(!a)return"";const n=new Date(a);return Number.isNaN(n.getTime())?"":n.toLocaleString([],{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}function Mt(a){const n=String(a||"").trim();return n?n.split(/[_\s-]+/).filter(Boolean).map(r=>r.charAt(0).toUpperCase()+r.slice(1).toLowerCase()).join(" "):"Status unavailable"}function Bt(a){const n=String(a||"").trim().toLowerCase();return n==="resolved"||n==="closed"||n==="complete"||n==="completed"||n==="done"?"success":n==="rejected"||n==="dismissed"||n==="denied"?"danger":n==="open"||n==="pending"||n==="in_review"||n==="in review"||n==="under_review"||n==="under review"?"warning":""}function xt(a,n){return a.getFullYear()===n.getFullYear()&&a.getMonth()===n.getMonth()&&a.getDate()===n.getDate()}function Ua(a){const n=new Date(a);if(Number.isNaN(n.getTime()))return"";const r=new Date,i=new Date;return i.setDate(r.getDate()-1),xt(n,r)?"Today":xt(n,i)?"Yesterday":n.toLocaleDateString([],{month:"short",day:"numeric"})}function Fa(a){const n=[];let r="";return a.forEach(i=>{const f=i.timestamp.slice(0,10);f!==r&&(n.push({type:"day",id:`day-${f}`,label:Ua(i.timestamp)}),r=f),n.push({type:"message",id:i.id,message:i})}),n}function Va(a){return a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function _a(a,n){if(!n)return a;const r=Va(n);return a.split(new RegExp(`(${r})`,"ig")).map((f,b)=>f.toLowerCase()===n.toLowerCase()?e.createElement("mark",{key:b,className:"msg-highlight"},f):e.createElement("span",{key:b},f))}function za(a,n,r){const i=(r==null?void 0:r.selectionStart)??a.length,f=(r==null?void 0:r.selectionEnd)??i;return{nextValue:a.slice(0,i)+n+a.slice(f),caret:i+n.length}}function Ze(a,n,r){m.useEffect(()=>{if(!r)return;const i=f=>{!a.current||a.current.contains(f.target)||n()};return document.addEventListener("mousedown",i),document.addEventListener("touchstart",i),()=>{document.removeEventListener("mousedown",i),document.removeEventListener("touchstart",i)}},[a,n,r])}function M({children:a,size:n=20,className:r}){return e.createElement("svg",{className:r,width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.8",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true"},a)}const Ha=a=>e.createElement(M,{...a},e.createElement("circle",{cx:"12",cy:"5",r:"1.6",fill:"currentColor",stroke:"none"}),e.createElement("circle",{cx:"12",cy:"12",r:"1.6",fill:"currentColor",stroke:"none"}),e.createElement("circle",{cx:"12",cy:"19",r:"1.6",fill:"currentColor",stroke:"none"})),qe=a=>e.createElement(M,{...a},e.createElement("circle",{cx:"11",cy:"11",r:"6.5"}),e.createElement("line",{x1:"16.5",y1:"16.5",x2:"21",y2:"21"})),Wa=a=>e.createElement(M,{...a},e.createElement("rect",{x:"5",y:"11",width:"14",height:"9",rx:"2"}),e.createElement("path",{d:"M8 11V8a4 4 0 0 1 8 0v3"})),Ya=a=>e.createElement(M,{...a},e.createElement("path",{d:"M6 18l-2.5 3.5V6.5A2.5 2.5 0 0 1 6 4h12a2.5 2.5 0 0 1 2.5 2.5V14A2.5 2.5 0 0 1 18 16.5H7.8L6 18Z"})),Za=a=>e.createElement(M,{...a},e.createElement("path",{d:"M3 12l17-7-7 17-2-6-8-4Z"})),qa=a=>e.createElement(M,{...a},e.createElement("circle",{cx:"12",cy:"12",r:"9"}),e.createElement("circle",{cx:"9",cy:"10",r:"1",fill:"currentColor",stroke:"none"}),e.createElement("circle",{cx:"15",cy:"10",r:"1",fill:"currentColor",stroke:"none"}),e.createElement("path",{d:"M8 15c1.2 1.3 2.6 2 4 2s2.8-.7 4-2"})),Ka=a=>e.createElement(M,{...a},e.createElement("path",{d:"M7.5 12.5l6.8-6.8a3 3 0 0 1 4.3 4.3l-7.5 7.5a4.5 4.5 0 0 1-6.4-6.4l7.2-7.2"})),Ja=a=>e.createElement(M,{...a},e.createElement("polyline",{points:"5 12 9 16 19 6"})),Qa=a=>e.createElement(M,{...a},e.createElement("polyline",{points:"2 12 6 16 12 10"}),e.createElement("polyline",{points:"8 12 12 16 22 6"})),Ga=a=>e.createElement(M,{...a},e.createElement("path",{d:"M4 11.5 12 4l8 7.5"}),e.createElement("path",{d:"M6 10.5V20h12v-9.5"})),Xa=a=>e.createElement(M,{...a},e.createElement("rect",{x:"4",y:"4",width:"16",height:"5"}),e.createElement("rect",{x:"5",y:"9",width:"14",height:"11"}),e.createElement("line",{x1:"9",y1:"13",x2:"15",y2:"13"})),Dt=a=>e.createElement(M,{...a},e.createElement("path",{d:"M5 4v16"}),e.createElement("path",{d:"M5 4h12l-2.2 4L17 12H5"})),se=a=>e.createElement(M,{...a},e.createElement("circle",{cx:"12",cy:"12",r:"9"}),e.createElement("line",{x1:"7",y1:"17",x2:"17",y2:"7"})),en=a=>e.createElement(M,{...a},e.createElement("circle",{cx:"12",cy:"8",r:"3.2"}),e.createElement("path",{d:"M4.5 19.5c1.9-3 4.5-4.5 7.5-4.5s5.6 1.5 7.5 4.5"})),Lt=a=>e.createElement(M,{...a},e.createElement("path",{d:"M4 7h16"}),e.createElement("path",{d:"M9 7V5h6v2"}),e.createElement("path",{d:"M7 7l1 12h8l1-12"}),e.createElement("path",{d:"M10 11v6"}),e.createElement("path",{d:"M14 11v6"})),tn=a=>e.createElement(M,{...a},e.createElement("path",{d:"M9 4h-4v16h4"}),e.createElement("path",{d:"M16 12H7"}),e.createElement("path",{d:"M13 9l3 3-3 3"})),we=a=>e.createElement(M,{...a},e.createElement("line",{x1:"5",y1:"5",x2:"19",y2:"19"}),e.createElement("line",{x1:"19",y1:"5",x2:"5",y2:"19"}));function Pt({ariaLabel:a,items:n}){const[r,i]=m.useState(!1),f=m.useRef(null);return Ze(f,()=>i(!1),r),e.createElement("div",{className:"menu-wrap",ref:f},e.createElement("button",{className:"icon-btn","aria-label":a,"aria-haspopup":"menu","aria-expanded":r,onClick:()=>i(b=>!b),type:"button"},e.createElement(Ha,null)),r?e.createElement("div",{className:"dropdown",role:"menu"},n.map(b=>e.createElement("button",{key:b.label,className:"dropdown-item",role:"menuitem",type:"button",onClick:()=>{i(!1),b.onSelect()}},b.label))):null)}function an({status:a}){if(!a)return null;if(a==="sent")return e.createElement(Ja,{className:"status-icon"});const n=a==="read"?"status-icon read":"status-icon";return e.createElement(Qa,{className:n})}function nn({open:a,title:n,message:r,confirmLabel:i,onConfirm:f,onCancel:b}){return a?e.createElement("div",{className:"panel-backdrop",role:"dialog","aria-modal":"true","aria-label":n},e.createElement("div",{className:"confirm-dialog"},e.createElement("h3",null,n),e.createElement("p",null,r),e.createElement("div",{className:"confirm-actions"},e.createElement("button",{className:"ghost-btn",type:"button",onClick:b},"Cancel"),e.createElement("button",{className:"primary-btn",type:"button",onClick:f},i)))):null}function sn({open:a,title:n,message:r,confirmLabel:i="Delete",onConfirm:f,onCancel:b}){return a?e.createElement("div",{className:"panel-backdrop",role:"dialog","aria-modal":"true","aria-label":n},e.createElement("div",{className:"confirm-dialog"},e.createElement("h3",null,n),e.createElement("p",null,r),e.createElement("div",{className:"confirm-actions"},e.createElement("button",{className:"ghost-btn",type:"button",onClick:b},"Cancel"),e.createElement("button",{className:"primary-btn",type:"button",onClick:f},i)))):null}function ln({open:a,onClose:n,currentUser:r}){if(!a)return null;const i={...Ce,...r&&typeof r=="object"?r:{}},f=i.name||"User";return e.createElement("div",{className:"panel-backdrop",role:"dialog","aria-modal":"true","aria-label":"Profile panel"},e.createElement("div",{className:"profile-panel"},e.createElement("div",{className:"panel-header"},e.createElement("h2",null,"Profile"),e.createElement("button",{className:"icon-btn","aria-label":"Close profile",onClick:n,type:"button"},e.createElement(we,null))),e.createElement("div",{className:"profile-hero"},e.createElement("div",{className:"avatar large",style:{backgroundColor:"#2f9e8f"}},le(f)),e.createElement("div",null,e.createElement("h3",null,f))),e.createElement("div",{className:"profile-section"},e.createElement("h4",null,"Details"),e.createElement("p",null,"First name: ",i.firstName||"-"),e.createElement("p",null,"Family name: ",i.lastName||"-"),e.createElement("p",null,"Suburb: ",i.suburb||"-"),e.createElement("p",null,"City: ",i.city||"-"),e.createElement("p",null,"Province: ",i.province||"-"),e.createElement("p",null,"Account since: ",i.accountSince||"-"))))}function rn({open:a,onClose:n,chat:r,onDelete:i,onBlock:f,onReport:b}){if(!a||!r)return null;const v=!!r.blockedByOther,I=ne(r),E=r.name?r.name.split(" ").filter(Boolean):[],p=E[0]||"",A=E.slice(1).join(" "),w=v?"-":r.firstName||p||"-",d=v?"-":r.lastName||A||"-",N=v?"-":r.suburb||"-",j=v?"-":r.city||"-",_=v?"-":r.province||"-",g=v?"-":r.accountSince||"-",k=v?"-":r.accountType||"Standard";return e.createElement("div",{className:"panel-backdrop",role:"dialog","aria-modal":"true","aria-label":"Chat profile"},e.createElement("div",{className:"profile-panel"},e.createElement("div",{className:"panel-header"},e.createElement("h2",null,"Chat Profile"),e.createElement("button",{className:"icon-btn","aria-label":"Close profile",onClick:n,type:"button"},e.createElement(we,null))),e.createElement("div",{className:"profile-hero"},e.createElement("div",{className:"avatar large",style:{backgroundColor:r.color}},Z(r)?e.createElement(se,{className:"avatar-blocked-icon",size:18}):le(I)),e.createElement("div",null,e.createElement("h3",null,I))),e.createElement("div",{className:"profile-section"},e.createElement("h4",null,"Details"),e.createElement("p",null,"First name: ",w),e.createElement("p",null,"Family name: ",d),e.createElement("p",null,"Suburb: ",N),e.createElement("p",null,"City: ",j),e.createElement("p",null,"Province: ",_),e.createElement("p",null,"Account since: ",g),e.createElement("p",null,"Account type: ",k)),e.createElement("div",{className:"profile-section"},e.createElement("h4",null,"Actions"),e.createElement("div",{className:"profile-action-row"},e.createElement("button",{className:"profile-btn danger",type:"button",onClick:i},e.createElement(Lt,null),"Delete"),v?null:e.createElement(e.Fragment,null,e.createElement("button",{className:"profile-btn warn",type:"button",onClick:f},e.createElement(se,null),r.blocked?"Unblock":"Block"),e.createElement("button",{className:"profile-btn",type:"button",onClick:b},e.createElement(Dt,null),"Report"))))))}function Ye({title:a,subtitle:n}){return e.createElement("div",{className:"empty-state"},e.createElement("h3",null,a),e.createElement("p",null,n))}function on(){const a=Array.from({length:7}),n=Array.from({length:5});return e.createElement("div",{className:"chat-loading-overlay desktop",role:"status","aria-live":"polite"},e.createElement("div",{className:"chat-loading-desktop-shell"},e.createElement("aside",{className:"chat-loading-desktop-sidebar"},e.createElement("div",{className:"chat-loading-desktop-header"},e.createElement("div",{className:"chat-loading-sk chat-loading-desktop-logo"}),e.createElement("div",{className:"chat-loading-sk chat-loading-desktop-circle"})),e.createElement("div",{className:"chat-loading-desktop-search"},e.createElement("div",{className:"chat-loading-sk chat-loading-desktop-search-box"})),e.createElement("div",{className:"chat-loading-desktop-list"},a.map((r,i)=>e.createElement("div",{className:"chat-loading-desktop-thread",key:i},e.createElement("div",{className:"chat-loading-sk chat-loading-desktop-avatar"}),e.createElement("div",{className:"chat-loading-desktop-thread-meta"},e.createElement("div",{className:"chat-loading-sk chat-loading-desktop-line lg"}),e.createElement("div",{className:"chat-loading-sk chat-loading-desktop-line sm"})),e.createElement("div",{className:"chat-loading-sk chat-loading-desktop-time"}))))),e.createElement("section",{className:"chat-loading-desktop-chat"},e.createElement("div",{className:"chat-loading-desktop-chat-header"},e.createElement("div",{className:"chat-loading-desktop-chat-user"},e.createElement("div",{className:"chat-loading-sk chat-loading-desktop-avatar"}),e.createElement("div",{className:"chat-loading-desktop-thread-meta"},e.createElement("div",{className:"chat-loading-sk chat-loading-desktop-line lg"}),e.createElement("div",{className:"chat-loading-sk chat-loading-desktop-line sm"}))),e.createElement("div",{className:"chat-loading-desktop-chat-actions"},e.createElement("div",{className:"chat-loading-sk chat-loading-desktop-circle"}),e.createElement("div",{className:"chat-loading-sk chat-loading-desktop-circle"}),e.createElement("div",{className:"chat-loading-sk chat-loading-desktop-circle"}))),e.createElement("div",{className:"chat-loading-desktop-messages"},e.createElement("div",{className:"chat-loading-sk chat-loading-desktop-day"}),n.map((r,i)=>e.createElement("div",{className:`chat-loading-desktop-bubble-row ${i%2?"me":"them"}`,key:i},e.createElement("div",{className:"chat-loading-desktop-bubble"},e.createElement("div",{className:"chat-loading-sk chat-loading-desktop-line lg"}),e.createElement("div",{className:"chat-loading-sk chat-loading-desktop-line sm"}),e.createElement("div",{className:"chat-loading-sk chat-loading-desktop-meta"}))))),e.createElement("div",{className:"chat-loading-desktop-composer"},e.createElement("div",{className:"chat-loading-sk chat-loading-desktop-circle"}),e.createElement("div",{className:"chat-loading-sk chat-loading-desktop-circle"}),e.createElement("div",{className:"chat-loading-sk chat-loading-desktop-input"}),e.createElement("div",{className:"chat-loading-sk chat-loading-desktop-circle"})))))}function Ke({title:a,subtitle:n,children:r}){return e.createElement("div",{className:"section-panel"},e.createElement("div",{className:"section-header"},e.createElement("div",null,e.createElement("h2",null,a),n?e.createElement("p",{className:"muted"},n):null)),e.createElement("div",{className:"section-card"},r))}function cn({currentUser:a}){const n={...Ce,...a&&typeof a=="object"?a:{}},r=n.name||"User";return e.createElement(Ke,{title:"My Profile",subtitle:""},e.createElement("div",{className:"profile-card"},e.createElement("div",{className:"profile-card-hero"},e.createElement("div",{className:"avatar large",style:{backgroundColor:"#0f766e"}},le(r)),e.createElement("div",null,e.createElement("h3",null,r))),e.createElement("div",{className:"profile-section"},e.createElement("h4",null,"Details"),e.createElement("p",null,"First name: ",n.firstName||"-"),e.createElement("p",null,"Family name: ",n.lastName||"-"),e.createElement("p",null,"Suburb: ",n.suburb||"-"),e.createElement("p",null,"City: ",n.city||"-"),e.createElement("p",null,"Province: ",n.province||"-"),e.createElement("p",null,"Account since: ",n.accountSince||"-")),e.createElement("div",{className:"profile-actions"},e.createElement("button",{className:"manage-profile-btn",type:"button","data-link":"manage-profile"},"Manage Profile"))))}function mn({chats:a,onUnblock:n}){return e.createElement(Ke,{title:"Blocked Accounts",subtitle:"People and businesses you blocked."},a.length===0?e.createElement("div",{className:"section-empty"},"No blocked accounts."):e.createElement("div",{className:"section-list"},a.map(r=>e.createElement("div",{key:r.id,className:"section-item"},e.createElement("div",{className:"section-item-info"},e.createElement("div",{className:"avatar",style:{backgroundColor:r.color}},e.createElement(se,{className:"avatar-blocked-icon",size:16})),e.createElement("div",{className:"section-item-text"},e.createElement("div",{className:"section-item-name"},r.name))),e.createElement("div",{className:"section-item-meta"},e.createElement("span",{className:"section-tag danger"},"Blocked"),e.createElement("span",null,Oa(r.blockedAt||r.lastTime)),e.createElement("button",{className:"section-action",type:"button",onClick:()=>n(r.id)},"Unblock"))))))}function dn({reports:a,onOpenReport:n}){return e.createElement(Ke,{title:"Reports",subtitle:"Reports you submitted."},a.length===0?e.createElement("div",{className:"section-empty"},"No reports found."):e.createElement("div",{className:"section-list"},a.map(r=>e.createElement("div",{key:r.id,className:"section-item"},e.createElement("div",{className:"section-item-info"},e.createElement("div",{className:"avatar",style:{backgroundColor:r.color||"#3b5bdb"}},le(r.name)),e.createElement("div",{className:"section-item-text"},e.createElement("div",{className:"section-item-name"},r.name),e.createElement("div",{className:"section-item-sub"},r.context||"No reason provided."))),e.createElement("div",{className:"section-item-meta"},e.createElement("span",{className:`section-tag ${Bt(r.status)}`},Mt(r.status)),e.createElement("span",null,We(r.createdAt)||"Date unavailable"),e.createElement("button",{className:"section-action",type:"button",onClick:()=>n(r)},"View report"))))))}function un({open:a,report:n,onClose:r}){return!a||!n?null:e.createElement("div",{className:"panel-backdrop",role:"dialog","aria-modal":"true","aria-label":"Report details"},e.createElement("div",{className:"report-details-dialog"},e.createElement("div",{className:"report-details-header"},e.createElement("div",null,e.createElement("div",{className:"report-details-title"},"Report details"),e.createElement("div",{className:"report-sub"},"Submitted information from your report.")),e.createElement("button",{type:"button",className:"report-details-close",onClick:r,"aria-label":"Close report details"},e.createElement(we,{size:18}))),e.createElement("div",{className:"report-details-grid"},e.createElement("div",{className:"report-details-field"},e.createElement("div",{className:"report-details-label"},"Reported account"),e.createElement("div",{className:"report-details-value"},n.name||"Unknown")),e.createElement("div",{className:"report-details-field"},e.createElement("div",{className:"report-details-label"},"Status"),e.createElement("div",{className:`section-tag ${Bt(n.status)}`},Mt(n.status))),e.createElement("div",{className:"report-details-field"},e.createElement("div",{className:"report-details-label"},"Sent"),e.createElement("div",{className:"report-details-value"},We(n.createdAt)||"Not available")),e.createElement("div",{className:"report-details-field"},e.createElement("div",{className:"report-details-label"},"Admin reply time"),e.createElement("div",{className:"report-details-value"},We(n.adminReplyAt)||"Not available"))),e.createElement("div",{className:"report-details-field"},e.createElement("div",{className:"report-details-label"},"Reason"),e.createElement("div",{className:"report-details-value report-details-reason"},n.context||"No reason provided.")),e.createElement("div",{className:"report-details-field"},e.createElement("div",{className:"report-details-label"},"Admin reply"),e.createElement("div",{className:"report-details-value report-details-reason"},n.adminReply||"No admin reply yet."))))}function fn({open:a,onClose:n,reasons:r,value:i,onChange:f,details:b,onDetailsChange:v,onSubmit:I,targetName:E}){const[p,A]=m.useState(!1),w=m.useRef(null),d=r.find(N=>N.value===i);return Ze(w,()=>A(!1),p),m.useEffect(()=>{a||A(!1)},[a]),a?e.createElement("div",{className:"panel-backdrop",role:"dialog","aria-modal":"true","aria-label":"Report"},e.createElement("div",{className:"report-dialog"},e.createElement("div",{className:"report-title"},"Quick report"),e.createElement("div",{className:"report-sub"},"Select a reason for reporting ",E||"this chat","."),e.createElement("div",{className:`report-select${p?" active":""}`,ref:w},e.createElement("button",{className:"report-select__trigger",type:"button",onClick:()=>A(N=>!N),"aria-haspopup":"listbox","aria-expanded":p},e.createElement("span",null,d?d.label:"Choose a reason"),e.createElement("span",{className:"report-select__caret"},"Ã¢â€“Â¾")),e.createElement("div",{className:"report-select__options",role:"listbox"},r.map(N=>e.createElement("button",{key:N.value,type:"button",className:`report-select__option${i===N.value?" selected":""}`,onClick:()=>{f(N.value),A(!1)},role:"option","aria-selected":i===N.value},N.label)))),e.createElement("textarea",{className:"report-textarea",placeholder:"Optional details",value:b,onChange:N=>v(N.target.value)}),e.createElement("div",{className:"report-actions"},e.createElement("button",{className:"ghost-btn",type:"button",onClick:n},"Cancel"),e.createElement("button",{className:"primary-btn",type:"button",onClick:I,disabled:!i},"Report")))):null}function pn({chats:a,searchValue:n,onSearchChange:r,activeChatId:i,onOpenChat:f,onMenuAction:b,emptyTitle:v="No chats yet",emptySubtitle:I="Start a new chat to compare prices.",showSearch:E=!0}){return e.createElement("div",{className:"chat-list-screen"},E?e.createElement("div",{className:"search-bar"},e.createElement(qe,{className:"search-icon"}),e.createElement("input",{type:"search",value:n,onChange:p=>r(p.target.value),placeholder:"Search chats or messages","aria-label":"Search chats"})):null,e.createElement("div",{className:"chat-list",role:"list"},a.length===0?e.createElement(Ye,{title:v,subtitle:I}):a.map(p=>{const A=ne(p),w=[{label:p.archived?"Unarchive chat":"Archive chat",onSelect:()=>b(p.id,p.archived?"unarchive":"archive")},{label:"Delete chat",onSelect:()=>b(p.id,"delete")},{label:"Report",onSelect:()=>b(p.id,"report")}];return e.createElement("div",{key:p.id,className:`chat-item ${i===p.id?"active":""}`,role:"listitem"},e.createElement("button",{className:"chat-open",onClick:()=>f(p.id),type:"button","aria-label":`Open chat with ${A}`},e.createElement("div",{className:"chat-avatar"},e.createElement("div",{className:"avatar",style:{backgroundColor:p.color}},Z(p)?e.createElement(se,{className:"avatar-blocked-icon",size:16}):le(p.name)),p.online?e.createElement("span",{className:"status-dot","aria-hidden":"true"}):null),e.createElement("div",{className:"chat-body"},e.createElement("div",{className:"chat-row"},e.createElement("span",{className:"chat-name"},A),e.createElement("span",{className:"chat-time"},Rt(p.lastTime))),e.createElement("div",{className:"chat-row chat-preview"},e.createElement("span",{className:"chat-message"},p.lastMessage?p.lastMessage:"No messages yet"),e.createElement("span",{className:"chat-flags"},p.unread>0?e.createElement("span",{className:"chat-unread"},p.unread):null)))),e.createElement(Pt,{ariaLabel:"Chat options",items:w}))})))}function hn({message:a,query:n,onPreviewImage:r}){const i=a.sender==="me",f=typeof a.attachmentUrl=="string"?a.attachmentUrl:"",b=typeof a.attachmentType=="string"?a.attachmentType.toLowerCase():"",v=typeof a.attachmentName=="string"&&a.attachmentName?a.attachmentName:"Attachment",I=!!a.attachmentIsImage||b.startsWith("image/"),E=!!a.attachmentIsVideo||b.startsWith("video/"),p=typeof a.text=="string"&&a.text.trim().length>0,A={width:"100%",maxWidth:"260px",borderRadius:"10px",display:"block",marginBottom:p?"8px":"0"};return e.createElement("div",{className:`message-row ${i?"me":"them"}`},e.createElement("div",{className:`message-bubble ${i?"outgoing":"incoming"}`},f?e.createElement("div",{className:"message-attachment"},I?e.createElement("button",{className:"message-image-trigger",type:"button",onClick:()=>{r&&r(a)},"aria-label":`Preview ${v}`},e.createElement("img",{src:f,alt:v,loading:"lazy",style:A})):E?e.createElement("video",{controls:!0,preload:"metadata",style:A},e.createElement("source",{src:f,type:b||void 0})):e.createElement("a",{href:f,target:"_blank",rel:"noreferrer"},"Open attachment")):null,p?e.createElement("div",{className:"message-text"},_a(a.text,n)):null,e.createElement("div",{className:"message-meta"},e.createElement("span",null,Rt(a.timestamp)),i?e.createElement(an,{status:a.status}):null)))}function vn({preview:a,onClose:n,onSave:r,onReport:i}){return a?e.createElement("div",{className:"attachment-preview-panel",role:"region","aria-label":"Photo preview"},e.createElement("div",{className:"attachment-preview-head"},e.createElement("div",{className:"attachment-preview-title"},"Photo preview"),e.createElement("button",{className:"icon-btn",type:"button",onClick:n,"aria-label":"Close preview"},e.createElement(we,null))),e.createElement("div",{className:"attachment-preview-stage"},e.createElement("img",{src:a.url,alt:a.name||"Image preview",loading:"eager"})),e.createElement("div",{className:"attachment-preview-meta"},a.name||"Image"),e.createElement("div",{className:"attachment-preview-actions"},e.createElement("button",{className:"primary-btn",type:"button",onClick:r},"Save"),e.createElement("button",{className:"ghost-btn",type:"button",onClick:i},"Report Photo"))):null}function En(){return e.createElement("div",{className:"message-row them"},e.createElement("div",{className:"typing-bubble"},e.createElement("span",{className:"typing-label"},"typing"),e.createElement("div",{className:"typing-dots","aria-hidden":"true"},e.createElement("span",null),e.createElement("span",null),e.createElement("span",null))))}function gn(){const a=[!1,!0,!1,!0,!1];return e.createElement("div",{className:"conversation-loading",role:"status","aria-live":"polite","aria-label":"Loading messages"},a.map((n,r)=>e.createElement("div",{key:r,className:`conversation-loading-row ${n?"me":"them"}`},e.createElement("div",{className:"conversation-loading-bubble"},e.createElement("div",{className:"chat-loading-sk conversation-loading-line lg"}),e.createElement("div",{className:"chat-loading-sk conversation-loading-line md"}),e.createElement("div",{className:"chat-loading-sk conversation-loading-line sm"})))))}function yn({value:a,onChange:n,onSend:r,onEmoji:i,onAttach:f,inputRef:b,disabled:v=!1}){const I=E=>{E.key==="Enter"&&!E.shiftKey&&(E.preventDefault(),!v&&a.trim()&&r())};return e.createElement("div",{className:"composer"},e.createElement("div",{className:"composer-actions"},e.createElement("button",{className:"icon-btn",type:"button",onClick:i,"aria-label":"Emoji",disabled:v},e.createElement(qa,null)),e.createElement("button",{className:"icon-btn",type:"button",onClick:f,"aria-label":"Attach",disabled:v},e.createElement(Ka,null))),e.createElement("textarea",{ref:b,rows:1,value:a,onChange:E=>n(E.target.value),onKeyDown:I,placeholder:v?"Unblock to send messages":"Type a message","aria-label":"Message input",disabled:v}),e.createElement("button",{className:"send-btn",type:"button",onClick:r,disabled:v||!a.trim(),"aria-label":"Send message"},e.createElement(Za,null)))}function bn({open:a,recents:n,onSelect:r,onClose:i}){const[f,b]=m.useState(""),[v,I]=m.useState("recent"),E=m.useRef(null),p=m.useRef(null),A=m.useRef({});Ze(p,i,a);const w=m.useMemo(()=>{const g=Ne.map(k=>k.id==="recent"?{...k,emojis:n}:k);return Ma(g,f)},[n,f]);m.useEffect(()=>{var k;if(!a)return;const g=((k=w[0])==null?void 0:k.id)||"recent";I(g),E.current&&(E.current.scrollTop=0)},[a,f,w]);const d=()=>{const g=E.current;if(!g)return;let k=v;w.forEach(z=>{const O=A.current[z.id];O&&g.scrollTop>=O.offsetTop-40&&(k=z.id)}),k!==v&&I(k)},N=g=>{const k=A.current[g];k&&(k.scrollIntoView({behavior:"smooth",block:"start"}),I(g))},j=g=>{r(g)},_=g=>{switch(g){case"recent":return"ğŸ•˜";case"smileys":return"ğŸ˜„";case"people":return"ğŸ‘‹";case"nature":return"ğŸŒ¿";case"food":return"ğŸ”";case"travel":return"ğŸ—ºï¸";case"symbols":return"â¤ï¸";default:return"ğŸ™‚"}};return a?e.createElement("div",{className:"emoji-popover","aria-live":"polite"},e.createElement("div",{className:"emoji-picker fade-in",ref:p},e.createElement("div",{className:"picker-header"},e.createElement("div",{className:"search-container"},e.createElement(qe,{className:"search-icon"}),e.createElement("input",{type:"search",className:"search-input",placeholder:"Search emojis...",value:f,onChange:g=>b(g.target.value),"aria-label":"Search emojis"})),e.createElement("div",{className:"category-tabs",role:"tablist"},w.map(g=>e.createElement("button",{key:g.id,type:"button",className:`category-tab ${v===g.id?"active":""}`,onClick:()=>N(g.id),"aria-label":g.name,"aria-pressed":v===g.id},e.createElement("span",{"aria-hidden":"true"},_(g.id)))))),e.createElement("div",{className:"emoji-list",onScroll:d,ref:E},w.length===0?e.createElement("div",{className:"emoji-empty"},"No emojis found."):w.map(g=>e.createElement("div",{key:g.id,className:"category-section",ref:k=>{A.current[g.id]=k}},e.createElement("div",{className:"category-title"},g.name),e.createElement("div",{className:"emoji-grid"},g.emojis.map((k,z)=>e.createElement("button",{key:`${g.id}-${z}`,type:"button",className:"emoji-item",onClick:()=>j(k),"aria-label":"Emoji"},k)))))))):null}function kn({chat:a,groupedMessages:n,searchValue:r,showSearch:i,onToggleSearch:f,onSearchChange:b,onSend:v,composerValue:I,onComposerChange:E,onEmoji:p,onAttach:A,emojiOpen:w,emojiRecents:d,onEmojiSelect:N,onEmojiClose:j,composerRef:_,typing:g,conversationLoading:k,messageListRef:z,matchCount:O,onMenuAction:U,attachmentPreview:q,onOpenAttachmentPreview:Se,onCloseAttachmentPreview:G,onSaveAttachmentPreview:re,onReportAttachmentPreview:Te}){if(!a)return e.createElement("div",{className:"conversation empty-view"},e.createElement(Ye,{title:"Select a chat",subtitle:"Choose a conversation to see messages and compare prices."}));if(q)return e.createElement("div",{className:"conversation attachment-only-view"},e.createElement(vn,{preview:q,onClose:G,onSave:re,onReport:Te}));const ue=ne(a),K=[{label:"View profile",onSelect:()=>U("profile")},{label:"Close chat",onSelect:()=>U("close")},{label:"Delete chat",onSelect:()=>U("delete")},{label:"Block",onSelect:()=>U("block")},{label:"Report",onSelect:()=>U("report")}];return e.createElement("div",{className:"conversation"},e.createElement("div",{className:"conversation-header"},e.createElement("div",{className:"conversation-title"},e.createElement("div",{className:"avatar",style:{backgroundColor:a.color}},Z(a)?e.createElement(se,{className:"avatar-blocked-icon",size:16}):le(a.name)),e.createElement("div",{className:"conversation-title-text"},e.createElement("div",{className:"conversation-name"},ue),e.createElement("div",{className:"conversation-status"},g?e.createElement("span",null,"Typing..."):e.createElement(e.Fragment,null,a.online?e.createElement("span",{className:"presence-dot"}):null,e.createElement("span",null,a.online?"online":a.presence))))),e.createElement("div",{className:"conversation-actions"},e.createElement(Pt,{ariaLabel:"Conversation menu",items:K}))),i?e.createElement("div",{className:"conversation-search"},e.createElement(qe,{className:"search-icon"}),e.createElement("input",{type:"search",value:r,onChange:V=>b(V.target.value),placeholder:"Search in conversation","aria-label":"Search within conversation"}),r?e.createElement("span",{className:"search-count"},O," match",O===1?"":"es"):null):null,e.createElement("div",{className:"conversation-scroll",ref:z},e.createElement("div",{className:"security-banner"},e.createElement(Wa,null),e.createElement("div",null,"Messages are end-to-end encrypted. No one outside of this chat can read or listen to them.")),k?e.createElement(gn,null):n.length===0?e.createElement(Ye,{title:r?"No matches":"No messages yet",subtitle:r?"Try a different phrase.":"Send a message to start the chat."}):n.map(V=>V.type==="day"?e.createElement("div",{key:V.id,className:"day-separator"},V.label):e.createElement(hn,{key:V.id,message:V.message,query:r.trim(),onPreviewImage:Se})),g&&!r&&!k?e.createElement(En,null):null,!k&&Z(a)?e.createElement("div",{className:"blocked-notice",role:"note"},a.blockedByOther?"You cannot message this account.":"You blocked this account. Unblock to send messages."):null),e.createElement(yn,{value:I,onChange:E,onSend:v,onEmoji:p,onAttach:A,inputRef:_,disabled:Z(a)}),e.createElement(bn,{open:w,recents:d,onSelect:N,onClose:j}))}function Nn({currentUser:a=Ce,initialChats:n=Da,initialMessages:r=La}){const i={...Ce,...a&&typeof a=="object"?a:{}},f=Array.isArray(n)?n:[],b=r&&typeof r=="object"?r:{},[v,I]=m.useState("chats"),[E,p]=m.useState(f),[A,w]=m.useState(b),[d,N]=m.useState(null),[j,_]=m.useState(""),[g,k]=m.useState(""),[z,O]=m.useState(!1),[U,q]=m.useState(""),[Se,G]=m.useState(!1),[re,Te]=m.useState(()=>{var t,s,l;if(typeof window>"u")return((t=Ne[0])==null?void 0:t.emojis)||[];try{const o=window.localStorage.getItem(At);return o?JSON.parse(o):((s=Ne[0])==null?void 0:s.emojis)||[]}catch{return((l=Ne[0])==null?void 0:l.emojis)||[]}}),[ue,K]=m.useState(!1),[V,jt]=m.useState(!1),[wn,Je]=m.useState(null),[Qe,Ie]=m.useState(!1),[$t,Ge]=m.useState(!1),[F,Xe]=m.useState(null),[et,fe]=m.useState([]),[Ae,xe]=m.useState([]),[Re,tt]=m.useState(!1),[H,Me]=m.useState(null),[Ot,Be]=m.useState(!1),[pe,he]=m.useState(""),[at,ve]=m.useState(""),[X,De]=m.useState(null),[P,Le]=m.useState(null),[nt,st]=m.useState(!1),[Ut,Ee]=m.useState(null),[ge,lt]=m.useState({sessionId:"",sessionCsrf:"",userId:"",realtimeToken:""}),[ee,rt]=m.useState({open:!1,title:"",message:"",confirmLabel:"Delete",onConfirm:null}),[te,ot]=m.useState({open:!1,title:"",message:"",confirmLabel:"Confirm",onConfirm:null}),ct=m.useRef(null),oe=m.useRef(null),Pe=m.useRef(null),ce=m.useRef(null),J=m.useRef(null),W=m.useRef(null),B=m.useRef({lastSentAt:0,lastValue:!1,idleTimer:null}),x=ge.sessionId,R=ge.sessionCsrf,L=ge.userId,je=ge.realtimeToken,S=!!(x&&R&&L),C=E.find(t=>t.id===d)||null,ye=m.useMemo(()=>E.filter(t=>!t.archived),[E]),ie=m.useMemo(()=>E.filter(t=>t.archived),[E]),Ft=m.useMemo(()=>{const t=new Map;return et.forEach(s=>{s!=null&&s.id&&t.set(s.id,{id:s.id,name:s.name||"Unknown",blockedAt:s.blockedAt||"",color:s.color||"#3b82f6"})}),Array.from(t.values())},[et]),Vt=m.useMemo(()=>{const t=j.trim().toLowerCase();return t?ie.filter(s=>s.name.toLowerCase().includes(t)||(s.lastMessage||"").toLowerCase().includes(t)):ie},[ie,j]),_t=m.useMemo(()=>{const t=j.trim().toLowerCase();return t?ye.filter(s=>s.name.toLowerCase().includes(t)||(s.lastMessage||"").toLowerCase().includes(t)):ye},[ye,j]),be=C?A[d]||[]:[],$e=m.useMemo(()=>{const t=g.trim().toLowerCase();return t?be.filter(s=>s.text.toLowerCase().includes(t)):be},[be,g]),zt=m.useMemo(()=>Fa($e),[$e]),Ht=!!(d&&Ut===d),it=()=>{W.current&&(window.clearTimeout(W.current),W.current=null),B.current.idleTimer&&(window.clearTimeout(B.current.idleTimer),B.current.idleTimer=null)},ke=async(t,{force:s=!1}={})=>{const l=J.current;if(!l||!L)return;const o=!!t,c=Date.now(),u=B.current;if(!(!s&&u.lastValue===o&&c-u.lastSentAt<600)){u.lastValue=o,u.lastSentAt=c;try{await l.send({type:"broadcast",event:"typing",payload:{isTyping:o,userId:String(L)}})}catch{}}};m.useEffect(()=>{let t=!1;return(async()=>{if(!d||!L||!je||!S){K(!1);return}try{const l=await ba();if(!l||t)return;l.realtime.setAuth(je);const o=J.current;if(o)try{await o.unsubscribe()}catch{}J.current=null,it(),B.current.lastValue=!1;const c=l.channel(`conversation:${d}`,{config:{presence:{key:`chat:${String(L)}`}}});c.on("broadcast",{event:"typing"},({payload:u})=>{const y=String((u==null?void 0:u.userId)||"");if(!y||y===String(L))return;const T=!!(u!=null&&u.isTyping);K(T),W.current&&(window.clearTimeout(W.current),W.current=null),T&&(W.current=window.setTimeout(()=>{K(!1),W.current=null},3e3))}),c.subscribe(async u=>{if(!(t||u!=="SUBSCRIBED"))try{await c.track({userId:String(L),at:new Date().toISOString()})}catch{}}),J.current=c}catch{t||K(!1)}})(),()=>{t=!0;const l=J.current;if(J.current=null,l)try{l.unsubscribe()}catch{}it(),B.current.lastValue=!1,K(!1)}},[d,S,L,je]),m.useEffect(()=>{if(!d||!L||!J.current)return;const t=U.trim().length>0,s=Date.now(),l=B.current;t!==l.lastValue&&s-l.lastSentAt>600&&ke(t,{force:!0}),l.idleTimer&&(window.clearTimeout(l.idleTimer),l.idleTimer=null),t&&(l.idleTimer=window.setTimeout(()=>{B.current.idleTimer=null,ke(!1,{force:!0})},2e3))},[U,d,L]),m.useEffect(()=>{if(!d||g.trim())return;const t=ct.current;t&&requestAnimationFrame(()=>{t.scrollTo({top:t.scrollHeight,behavior:"smooth"})})},[d,be.length,ue,g]),m.useEffect(()=>{d||G(!1)},[d]),m.useEffect(()=>{Le(null)},[d]),m.useEffect(()=>{(!d||!S)&&Ee(null)},[d,S]),m.useEffect(()=>()=>{ce.current&&clearTimeout(ce.current)},[]),m.useEffect(()=>{if(!(typeof window>"u"))try{window.localStorage.setItem(At,JSON.stringify(re))}catch{}},[re]);const h=t=>{Je(t),ce.current&&clearTimeout(ce.current),ce.current=setTimeout(()=>Je(null),2400)},Wt=t=>{if(!t||typeof t!="object")return;const s=typeof t.attachmentUrl=="string"?t.attachmentUrl.trim():"",l=typeof t.attachmentType=="string"?t.attachmentType.toLowerCase():"",o=!!t.attachmentIsImage||l.startsWith("image/");if(!s||!o)return;const c=typeof t.attachmentName=="string"&&t.attachmentName?t.attachmentName:"photo";Le({url:s,name:c,messageId:typeof t.id=="string"?t.id:""})},Yt=()=>{Le(null)},Zt=async()=>{if(!(P!=null&&P.url))return;const t=P.name||"photo";try{const s=await fetch(P.url);if(!s.ok)throw new Error("download_failed");const l=await s.blob(),o=window.URL.createObjectURL(l),c=document.createElement("a");c.href=o,c.download=t,document.body.appendChild(c),c.click(),c.remove(),window.URL.revokeObjectURL(o),h("Image saved.")}catch{const s=document.createElement("a");s.href=P.url,s.target="_blank",s.rel="noreferrer",s.click(),h("Could not save directly. Opened image in a new tab.")}},qt=()=>{if(!C){h("No chat selected.");return}De(C),he(""),ve(P!=null&&P.name?`Photo attachment: ${P.name}`:"Photo attachment"),Be(!0)};m.useEffect(()=>{if(!d||!S)return;let t=!1;Ee(d);const s=async({silent:o=!1}={})=>{try{const{messages:c,chatPatch:u}=await ka({sessionId:x,sessionCsrf:R,conversationId:d,currentUserId:L});if(t)return;w(y=>({...y,[d]:c})),p(y=>y.map(T=>T.id===d?{...T,...u||{},unread:0}:T));try{await Na({sessionId:x,sessionCsrf:R,conversationId:d})}catch{}}catch(c){!t&&!o&&h((c==null?void 0:c.message)||"Failed to load chat messages.")}finally{t||Ee(c=>c===d?null:c)}};s();const l=window.setInterval(()=>{s({silent:!0})},5e3);return()=>{t=!0,window.clearInterval(l)}},[d,S,x,R,L]);const Kt=()=>{if(!d){h("Select a chat to add emojis.");return}G(t=>!t)},Jt=()=>G(!1),Qt=t=>{t&&(Te(s=>[t,...s.filter(o=>o!==t)].slice(0,24)),q(s=>{const{nextValue:l,caret:o}=za(s,t,oe.current);return requestAnimationFrame(()=>{oe.current&&(oe.current.focus(),oe.current.setSelectionRange(o,o))}),l}))},Gt=t=>{if(!t){h("No chat selected.");return}Xe(t),Ge(!0)},Oe=()=>{Ge(!1),Xe(null)},Xt=(t,s)=>{const l=E.find(T=>T.id===t),o=(l==null?void 0:l.otherPartyId)||t;if(!o)return;const c=s||new Date().toISOString(),u=(l==null?void 0:l.name)||"Unknown",y=(l==null?void 0:l.color)||"#3b82f6";fe(T=>{const D=T.filter(me=>me.id!==o);return[{id:o,name:u,blockedAt:c,color:y},...D]})},mt=({accountId:t,conversationId:s=""})=>{const l=typeof t=="string"?t.trim():"",o=typeof s=="string"?s.trim():"";p(c=>c.map(u=>{const y=!!o&&u.id===o,T=!!l&&u.otherPartyId===l;if(!y&&!T)return u;const D=!!u.blockedByOther;return{...u,blocked:!1,blockedByMe:!1,hasBlockingRelationship:D,blockedAt:void 0}})),l&&fe(c=>c.filter(u=>u.id!==l))},dt=async t=>{if(!t)return!1;if(S)try{await wa({sessionId:x,sessionCsrf:R,conversationId:t})}catch(l){return h((l==null?void 0:l.message)||"Failed to block account."),!1}const s=new Date().toISOString();return p(l=>l.map(o=>o.id===t?{...o,blocked:!0,blockedByMe:!0,hasBlockingRelationship:!0,blockedAt:s}:o)),Xt(t,s),d===t&&N(null),h("Chat blocked."),!0},ea=async t=>{if(!t)return!1;const s=E.find(o=>o.id===t),l=(s==null?void 0:s.otherPartyId)||"";if(S)try{await Ct({sessionId:x,sessionCsrf:R,conversationId:t||void 0,recipientId:l||void 0})}catch(o){return h((o==null?void 0:o.message)||"Failed to unblock account."),!1}return mt({accountId:l,conversationId:t}),h("Account unblocked."),!0},ta=async t=>{const s=typeof t=="string"?t.trim():"";if(!s)return!1;const l=E.find(c=>c.otherPartyId===s),o=(l==null?void 0:l.id)||"";if(S)try{await Ct({sessionId:x,sessionCsrf:R,conversationId:o||void 0,recipientId:s})}catch(c){return h((c==null?void 0:c.message)||"Failed to unblock account."),!1}return mt({accountId:s,conversationId:o}),h("Account unblocked."),!0},aa=async(t,s={})=>{if(!t)return!1;const l=s.clearActive!==!1,o=s.toast!==!1;if(S)try{await xa({sessionId:x,sessionCsrf:R,conversationId:t})}catch(c){return h((c==null?void 0:c.message)||"Failed to archive chat."),!1}return p(c=>c.map(u=>u.id===t?{...u,archived:!0,archivedAt:new Date().toISOString()}:u)),l&&d===t&&N(null),o&&h("Chat archived."),!0},ut=async(t,s={})=>{if(!t)return!1;const l=s.clearActive===!0,o=s.toast!==!1;if(S)try{await Ra({sessionId:x,sessionCsrf:R,conversationId:t})}catch(c){return h((c==null?void 0:c.message)||"Failed to restore chat."),!1}return p(c=>c.map(u=>u.id===t?{...u,archived:!1,archivedAt:void 0}:u)),l&&d===t&&N(null),o&&h("Chat restored from archive."),!0},na=t=>{t&&(Me(t),tt(!0))},ft=()=>{tt(!1),Me(null)},Ue=t=>{t&&(De(t),he(""),ve(""),Be(!0))},pt=()=>{Be(!1),De(null),he(""),ve("")},sa=async()=>{var o;if(!X||!pe)return;if(!S){h("Session missing or expired. Please log in again.");return}const t=((o=St.find(c=>c.value===pe))==null?void 0:o.label)||pe,s=at.trim(),l=s?`${t} - ${s}`:t;try{await Sa({sessionId:x,sessionCsrf:R,conversationId:X.id,recipientId:X.otherPartyId,reason:l});try{const c=await kt({sessionId:x,sessionCsrf:R});xe(c)}catch{}pt(),h("Report sent.")}catch(c){h((c==null?void 0:c.message)||"Failed to submit report.")}},la=({title:t,message:s,confirmLabel:l,onConfirm:o})=>{ot({open:!0,title:t,message:s,confirmLabel:l,onConfirm:o})},Fe=()=>{ot(t=>({...t,open:!1}))},ra=async(t,s,l={})=>{const o=!!(l!=null&&l.silent);if(nt)return!1;const c=t.trim(),u=s.trim();if(!c||!u)return o||h("Session credentials missing. Please log in again."),!1;st(!0);try{const y=await Ia({sessionId:c,sessionCsrf:u}),{chats:T,blockedAccounts:D,reports:me}=await Aa({sessionId:c,sessionCsrf:u});return lt({sessionId:c,sessionCsrf:u,userId:y.userId,realtimeToken:y.token||""}),p(T),fe(D),w({}),xe(me),N(null),Ie(!1),_(""),k(""),O(!1),I("chats"),!o&&T.length===0?h("Connected. No chats found."):o||h(`Connected. Loaded ${T.length} chat${T.length===1?"":"s"}.`),!0}catch(y){return o?de():h((y==null?void 0:y.message)||"Failed to restore your session."),!1}finally{st(!1)}};m.useEffect(()=>{let t=!1;return(async()=>{if(S)return;const l=Pa();if(!l){de(),t||await He()||h("Session missing or expired. Please log in again.");return}if(!await $a(l.sessionId,l.sessionCsrf)){de(),t||await He()||h("Session missing or expired. Please log in again.");return}await ra(l.sessionId,l.sessionCsrf,{silent:!0})||(de(),t||await He()||h("Session missing or expired. Please log in again."))})(),()=>{t=!0}},[]);const ae=({title:t,message:s,confirmLabel:l="Delete",onConfirm:o})=>{rt({open:!0,title:t,message:s,confirmLabel:l,onConfirm:o})},Y=()=>{rt(t=>({...t,open:!1}))},oa=async(t,s={})=>{s.unarchive&&!await ut(t,{clearActive:!1,toast:!0})||(N(t),S&&Ee(t),Ie(!1),s.keepSection||I("chats"),p(l=>l.map(o=>o.id===t?{...o,unread:0}:o)),O(!1),k(""))},ht=(t,s,l)=>{w(o=>{const c=o[t]||[];return{...o,[t]:c.map(u=>u.id===s?{...u,status:l}:u)}})},ca=async()=>{const t=U.trim();if(!t||!d)return;if(Z(C)){h(C!=null&&C.blockedByOther?"You cannot message this account.":"Unblock this account to send messages.");return}if(S){try{const l=await Ca({sessionId:x,sessionCsrf:R,conversationId:d,content:t}),o=Nt(l==null?void 0:l.data,L);w(c=>({...c,[d]:[...c[d]||[],o]})),q(""),p(c=>{const u=c.map(D=>D.id===d?{...D,lastMessage:o.text||t,lastTime:o.timestamp||new Date().toISOString(),unread:0}:D),y=u.find(D=>D.id===d),T=u.filter(D=>D.id!==d);return y?[y,...T]:u}),B.current.idleTimer&&(window.clearTimeout(B.current.idleTimer),B.current.idleTimer=null),B.current.lastValue=!1,ke(!1,{force:!0})}catch(l){h((l==null?void 0:l.message)||"Failed to send message.")}return}const s={id:`m-${Date.now()}`,chatId:d,sender:"me",text:t,timestamp:new Date().toISOString(),status:"sent"};w(l=>({...l,[d]:[...l[d]||[],s]})),q(""),p(l=>{const o=l.map(y=>y.id===d?{...y,lastMessage:t,lastTime:s.timestamp,unread:0}:y),c=o.find(y=>y.id===d),u=o.filter(y=>y.id!==d);return c?[c,...u]:o}),setTimeout(()=>ht(d,s.id,"delivered"),900),setTimeout(()=>ht(d,s.id,"read"),2e3),B.current.idleTimer&&(window.clearTimeout(B.current.idleTimer),B.current.idleTimer=null),B.current.lastValue=!1,ke(!1,{force:!0})},ia=()=>{if(!d){h("Select a chat first.");return}if(!S){h("Session missing or expired. Please log in again.");return}if(Z(C)){h(C!=null&&C.blockedByOther?"You cannot message this account.":"Unblock this account to send messages.");return}Pe.current&&Pe.current.click()},ma=async t=>{var o;const s=t.target,l=(o=s==null?void 0:s.files)==null?void 0:o[0];if(s&&(s.value=""),!!l){if(!d){h("Select a chat first.");return}if(!S){h("Session missing or expired. Please log in again.");return}if(Z(C)){h(C!=null&&C.blockedByOther?"You cannot message this account.":"Unblock this account to send messages.");return}try{const c=await Ta({sessionId:x,sessionCsrf:R,conversationId:d,file:l}),u=Nt(c==null?void 0:c.data,L);w(y=>({...y,[d]:[...y[d]||[],u]})),p(y=>{const T=y.map(Q=>Q.id===d?{...Q,lastMessage:u.text||l.name,lastTime:u.timestamp||new Date().toISOString(),unread:0}:Q),D=T.find(Q=>Q.id===d),me=T.filter(Q=>Q.id!==d);return D?[D,...me]:T}),h("Attachment sent.")}catch(c){h((c==null?void 0:c.message)||"Failed to send attachment.")}}},Ve=t=>{if(!Array.isArray(t)||t.length===0)return;const s=new Set(t.filter(Boolean));s.size&&(p(l=>l.filter(o=>!s.has(o.id))),w(l=>{const o={...l};return s.forEach(c=>{delete o[c]}),o}),d&&s.has(d)&&N(null))},_e=async(t,s={})=>{const l=typeof t=="string"?t.trim():"";if(!l)return!1;const o=s.toast!==!1;if(S)try{await wt({sessionId:x,sessionCsrf:R,conversationId:l})}catch(c){return h((c==null?void 0:c.message)||"Failed to delete chat."),!1}return Ve([l]),o&&h("Chat deleted."),!0},vt=async()=>{const t=E.map(o=>o.id).filter(Boolean);if(t.length===0)return h("No chats to delete."),!1;if(!S)return Ve(t),h("All chats deleted."),!0;const s=[];for(const o of t)try{await wt({sessionId:x,sessionCsrf:R,conversationId:o}),s.push(o)}catch{}s.length>0&&Ve(s);const l=t.length-s.length;return s.length===0?(h("Failed to delete chats."),!1):l===0?(h("All chats deleted."),!0):(h(`Deleted ${s.length} chat${s.length===1?"":"s"}. ${l} failed.`),!1)},da=t=>{w(s=>({...s,[t]:[]})),p(s=>s.map(l=>l.id===t?{...l,lastMessage:"No messages yet",lastTime:"",unread:0}:l))},ua=()=>{if(d){da(d),h("Cleared current chat.");return}const t={};E.forEach(s=>{t[s.id]=[]}),w(t),p(s=>s.map(l=>({...l,lastMessage:"No messages yet",lastTime:"",unread:0}))),h("Cleared all chats.")},fa=t=>{if(t==="profile"){Gt(C);return}if(t==="close"){N(null),Ie(!0),O(!1),k(""),h("Chat closed.");return}if(t==="block"){if(!C)return;dt(C.id);return}if(t==="delete"){ae(C?{title:`Delete chat with ${ne(C)}?`,message:"This removes the chat from your list.",onConfirm:()=>{Y(),_e(C.id)}}:{title:"Delete all chats?",message:"This removes every chat from your list.",onConfirm:()=>{Y(),vt()}});return}if(t==="clear"){const s=C?`Clear chat with ${C.name}?`:"Clear all chats?";la({title:s,message:C?"This clears the messages in this chat.":"This clears the messages in every chat.",confirmLabel:"Clear",onConfirm:()=>{Fe(),ua()}});return}t==="report"&&Ue(C)},pa=()=>{O(t=>{const s=!t;return s||k(""),s})},ha=async(t,s)=>{if(s==="archive"){await aa(t,{clearActive:!0,toast:!0});return}if(s==="unarchive"){await ut(t,{clearActive:$,toast:!0});return}if(s==="delete"){const l=E.find(o=>o.id===t);ae({title:l?`Delete chat with ${ne(l)}?`:"Delete chat?",message:"This removes the chat from your list.",onConfirm:()=>{Y(),_e(t)}});return}if(s==="report"){const l=E.find(o=>o.id===t);Ue(l)}},va=t=>{ta(t)},$=v==="archive",Et=v==="block",gt=v==="profile",yt=v==="reports",ze=!!P,bt=ze||gt||Et||yt,Ea=nt;return m.useEffect(()=>{v!=="chats"&&v!=="archive"&&G(!1)},[v]),m.useEffect(()=>{if(!$||Qe)return;if(ie.length===0){N(null);return}const t=E.find(s=>s.id===d);t&&!t.archived&&N(null)},[$,ie,E,d,Qe]),m.useEffect(()=>{if($)return;const t=E.find(s=>s.id===d);t&&t.archived&&N(null)},[$,E,d,ye]),m.useEffect(()=>{if(!S||v!=="block")return;let t=!1;return(async()=>{try{const s=await ga({sessionId:x,sessionCsrf:R});t||fe(s)}catch{}})(),()=>{t=!0}},[S,v,x,R]),m.useEffect(()=>{if(!S||v!=="reports")return;let t=!1;return(async()=>{try{const s=await kt({sessionId:x,sessionCsrf:R});t||xe(s)}catch{}})(),()=>{t=!0}},[S,v,x,R]),m.useEffect(()=>{if(!Re||!(H!=null&&H.id))return;const t=Ae.find(s=>s.id===H.id);if(!t){ft();return}Me(t)},[Re,H==null?void 0:H.id,Ae]),e.createElement("div",{className:"desktop-stage"},e.createElement("div",{className:"desktop-window"},e.createElement("div",{className:`desktop-content chp-desktop${ze?" preview-only":bt?" section-only":""}`},ze?null:e.createElement("aside",{className:"icon-rail"},e.createElement("nav",{className:"rail-nav","aria-label":"Primary"},[{key:"home",label:"Home",icon:Ga},{key:"chats",label:"Chats",icon:Ya},{key:"archive",label:"Archive",icon:Xa},{key:"block",label:"Block",icon:se},{key:"reports",label:"Reports",icon:Dt},{key:"profile",label:"Profile",icon:en}].map(t=>{const s=t.icon;return e.createElement("button",{key:t.key,className:`rail-btn ${v===t.key?"active":""}`,type:"button",onClick:()=>{if(I(t.key),t.key==="home"){window.location.href="homepage.html";return}},"aria-label":t.label},e.createElement("span",{className:"rail-icon"},e.createElement(s,null)),e.createElement("span",null,t.label))})),e.createElement("div",{className:"rail-footer"},e.createElement("button",{className:`rail-btn danger ${v==="logout"?"active":""}`,type:"button",onClick:()=>{I("logout"),ae({title:"Log out?",message:"Are you sure you want to log out?",confirmLabel:"Log out",onConfirm:()=>{Y(),de(),lt({sessionId:"",sessionCsrf:"",userId:"",realtimeToken:""}),h("Logged out.")}})},"aria-label":"Logout"},e.createElement("span",{className:"rail-icon"},e.createElement(tn,null)),e.createElement("span",null,"Logout")))),bt?null:e.createElement("aside",{className:"sidebar"},$?e.createElement(e.Fragment,null,e.createElement("div",{className:"archive-heading"},e.createElement("h2",null,"Achieved Chats")),e.createElement("div",{className:"archive-description muted"},"Archived conversations stored here.")):e.createElement("div",{className:"sidebar-header"},e.createElement("div",{className:"sidebar-title"},e.createElement("div",{className:"sidebar-brand"},e.createElement("img",{src:ya,alt:"CompareHubPrices"}))),e.createElement("div",{className:"sidebar-actions-row"},e.createElement("button",{className:"icon-btn",type:"button","aria-label":"Delete all chats",onClick:()=>{ae({title:"Delete all chats?",message:"This removes every chat from your list.",onConfirm:()=>{Y(),vt()}})}},e.createElement(Lt,null)))),e.createElement(pn,{chats:$?Vt:_t,searchValue:j,onSearchChange:_,activeChatId:d,onOpenChat:t=>oa(t,{keepSection:$}),onMenuAction:ha,emptyTitle:$?"No archived chats":void 0,emptySubtitle:$?"Archived conversations will appear here.":void 0,showSearch:!$})),e.createElement("section",{className:"chat-panel"},gt?e.createElement(cn,{currentUser:i}):Et?e.createElement(mn,{chats:Ft,onUnblock:va}):yt?e.createElement(dn,{reports:Ae,onOpenReport:na}):e.createElement(kn,{chat:C,groupedMessages:zt,searchValue:g,showSearch:z,onToggleSearch:pa,onSearchChange:k,onSend:ca,composerValue:U,onComposerChange:q,onEmoji:Kt,onAttach:ia,emojiOpen:Se,emojiRecents:re,onEmojiSelect:Qt,onEmojiClose:Jt,composerRef:oe,typing:ue,conversationLoading:Ht,messageListRef:ct,matchCount:$e.length,onMenuAction:fa,attachmentPreview:P,onOpenAttachmentPreview:Wt,onCloseAttachmentPreview:Yt,onSaveAttachmentPreview:Zt,onReportAttachmentPreview:qt})))),Ea?e.createElement(on,null):null,e.createElement(ln,{open:V,onClose:()=>jt(!1),currentUser:i}),e.createElement(rn,{open:$t,onClose:Oe,chat:F,onDelete:()=>{F&&ae({title:`Delete chat with ${ne(F)}?`,message:"This removes the chat from your list.",onConfirm:async()=>{Y(),await _e(F.id)&&Oe()}})},onBlock:()=>{(async()=>{if(!F)return;(F.blocked?await ea(F.id):await dt(F.id))&&Oe()})()},onReport:()=>{F&&Ue(F)}}),e.createElement(un,{open:Re,report:H,onClose:ft}),e.createElement(fn,{open:Ot,onClose:pt,reasons:St,value:pe,onChange:he,details:at,onDetailsChange:ve,onSubmit:sa,targetName:X==null?void 0:X.name}),e.createElement(sn,{open:ee.open,title:ee.title,message:ee.message,confirmLabel:ee.confirmLabel,onConfirm:()=>{ee.onConfirm?ee.onConfirm():Y()},onCancel:Y}),e.createElement(nn,{open:te.open,title:te.title,message:te.message,confirmLabel:te.confirmLabel,onConfirm:()=>{te.onConfirm?te.onConfirm():Fe()},onCancel:Fe}),e.createElement("input",{ref:Pe,type:"file",accept:".pdf,image/png,image/jpeg,image/webp,video/mp4,video/webm,video/quicktime,.mov,.m4v",onChange:ma,style:{display:"none"}}))}const Cn=Ba(document.getElementById("root"));Cn.render(e.createElement(e.StrictMode,null,e.createElement(Nn,null)));
