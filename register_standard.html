<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Standard Registration</title>
  <link rel="stylesheet" href="assets/fontawesome-6.0.0/css/all.css" />
  <style>
    :root {
      --bg: #f4f6fb;
      --card: #ffffff;
      --text: #0f172a;
      --muted: #64748b;
      --border: #e2e8f0;
      --primary: #2563eb;
      --primary-soft: rgba(37, 99, 235, 0.12);
      --danger: #dc2626;
      --success: #16a34a;
      --shadow: 0 18px 40px rgba(15, 23, 42, 0.08);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background: var(--bg) url("assets/images/background.png") center / cover no-repeat fixed;
      color: var(--text);
    }

    .page {
      min-height: 100vh;
      display: grid;
      place-items: center;
      padding: 40px 16px 64px;
    }

    .card {
      width: min(720px, 96vw);
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 22px;
      padding: 28px;
      box-shadow: var(--shadow);
    }

    .header {
      text-align: center;
      margin-bottom: 20px;
      display: grid;
      gap: 6px;
      justify-items: center;
    }

    .logo-img {
      height: 120px;
      width: auto;
      max-width: 220px;
      object-fit: contain;
    }

    .header h1 {
      margin: 0;
      font-size: 1.2rem;
      font-weight: 700;
    }

    .header p {
      margin: 0;
      font-size: 0.85rem;
      color: var(--muted);
    }

    form {
      display: grid;
      gap: 18px;
    }

    .section-card {
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 16px;
      display: grid;
      gap: 12px;
      background: #fff;
    }

    .field-grid {
      display: grid;
      gap: 14px;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    }

    label {
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--text);
      display: block;
      margin-bottom: 6px;
    }

    .label-row {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      flex-wrap: nowrap;
      line-height: 1;
    }

    .label-row label {
      margin-bottom: 0;
    }

    .label-divider {
      color: var(--muted);
      font-weight: 600;
      line-height: 1;
    }

    .label-note {
      font-size: 0.7rem;
      color: var(--muted);
      margin-left: 4px;
    }

    .mini-toggle {
      border: 1px solid var(--border);
      background: var(--primary);
      color: #fff;
      font-size: 0.7rem;
      padding: 2px 8px;
      line-height: 1.1;
      border-radius: 999px;
      cursor: pointer;
      transition: border-color 0.2s, color 0.2s, background 0.2s;
    }

    .mini-toggle.active {
      border-color: var(--primary);
      background: #1d4ed8;
      color: #fff;
    }

    input,
    textarea {
      width: 100%;
      padding: 12px 14px;
      border: 1px solid var(--border);
      border-radius: 12px;
      font-size: 0.95rem;
      outline: none;
      transition: border-color 0.2s, box-shadow 0.2s;
      background: #fff;
      font-family: inherit;
    }

    input:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 4px var(--primary-soft);
    }

    .input-field {
      position: relative;
    }

    .custom-select {
      position: relative;
    }

    .custom-select-trigger {
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      padding: 12px 14px;
      border: 1px solid var(--border);
      border-radius: 12px;
      background: #fff;
      font-size: 0.95rem;
      font-family: inherit;
      font-weight: 500;
      color: var(--text);
      cursor: pointer;
      transition: border-color 0.2s, box-shadow 0.2s;
    }

    .custom-select-trigger:focus-visible {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 4px var(--primary-soft);
    }

    .custom-select-panel {
      position: absolute;
      left: 0;
      right: 0;
      top: calc(100% + 8px);
      background: #fff;
      border: 1px solid var(--border);
      border-radius: 12px;
      box-shadow: var(--shadow);
      padding: 6px;
      display: none;
      z-index: 20;
    }

    .custom-select-panel.open {
      display: grid;
      gap: 4px;
    }

    .custom-option {
      border: none;
      background: transparent;
      text-align: left;
      padding: 10px 12px;
      border-radius: 10px;
      font-size: 0.9rem;
      font-weight: 500;
      cursor: pointer;
      color: var(--text);
    }

    .custom-option:hover,
    .custom-option.selected {
      background: var(--primary-soft);
      color: var(--primary);
    }

    .toggle-password {
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--muted);
      cursor: pointer;
      width: 26px;
      height: 26px;
      display: grid;
      place-items: center;
      border-radius: 50%;
      background: #fff;
      box-shadow: 0 0 0 1px var(--border);
    }

    input.has-toggle {
      padding-right: 44px;
    }

    .requirements {
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 14px;
      background: #f8fafc;
      display: grid;
      gap: 8px;
      font-size: 0.9rem;
    }

    .requirements .title {
      font-weight: 600;
      color: var(--text);
    }

    .requirement {
      display: flex;
      align-items: center;
      gap: 10px;
      color: var(--muted);
    }

    .req-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: #e2e8f0;
      border: 1px solid #cbd5f5;
      flex-shrink: 0;
    }

    .requirement.valid {
      color: var(--success);
    }

    .requirement.valid .req-dot {
      background: var(--success);
      border-color: var(--success);
    }

    .requirement.invalid {
      color: var(--danger);
    }

    .requirement.invalid .req-dot {
      background: var(--danger);
      border-color: var(--danger);
    }

    .strength {
      display: grid;
      gap: 8px;
    }

    .strength-bar {
      height: 8px;
      border-radius: 999px;
      background: #e2e8f0;
      overflow: hidden;
    }

    .strength-bar span {
      display: block;
      height: 100%;
      width: 0;
      background: var(--danger);
      transition: width 0.2s ease, background 0.2s ease;
    }

    .strength-label {
      font-size: 0.85rem;
      color: var(--muted);
    }

    .checkbox-row {
      display: flex;
      gap: 10px;
      align-items: flex-start;
      font-size: 0.85rem;
      color: var(--muted);
    }

    .checkbox-row input {
      width: auto;
      margin-top: 2px;
    }

    .actions {
      display: grid;
      gap: 12px;
    }

    .btn-primary {
      border: none;
      padding: 12px 18px;
      border-radius: 12px;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      background: var(--primary);
      color: #fff;
    }

    .btn-link {
      border: none;
      background: none;
      color: var(--muted);
      font-size: 0.85rem;
      cursor: pointer;
      text-decoration: underline;
    }

    .footer-note {
      font-size: 0.85rem;
      color: var(--muted);
      text-align: center;
    }

    .form-alert {
      display: none;
      padding: 12px 14px;
      border-radius: 10px;
      font-size: 0.9rem;
      border: 1px solid transparent;
      margin-bottom: 16px;
      text-align: center;
    }

    .form-alert.show {
      display: block;
    }

    .form-alert.error {
      background: rgba(239, 68, 68, 0.08);
      border-color: rgba(239, 68, 68, 0.35);
      color: #991b1b;
    }

    .form-alert.success {
      background: rgba(34, 197, 94, 0.08);
      border-color: rgba(34, 197, 94, 0.35);
      color: #065f46;
    }

    .google-row {
      display: flex;
      justify-content: center;
    }

    .gsi-material-button {
      -moz-user-select: none;
      -webkit-user-select: none;
      -ms-user-select: none;
      -webkit-appearance: none;
      background-color: #ffffff;
      background-image: none;
      border: 1px solid #747775;
      -webkit-border-radius: 20px;
      border-radius: 20px;
      -webkit-box-sizing: border-box;
      box-sizing: border-box;
      color: #1f1f1f;
      cursor: pointer;
      font-family: "Roboto", Arial, sans-serif;
      font-size: 14px;
      height: 40px;
      letter-spacing: 0.25px;
      outline: none;
      overflow: hidden;
      padding: 0 12px;
      position: relative;
      text-align: center;
      -webkit-transition: background-color .218s, border-color .218s, box-shadow .218s;
      transition: background-color .218s, border-color .218s, box-shadow .218s;
      vertical-align: middle;
      white-space: nowrap;
      width: auto;
      max-width: 400px;
      min-width: min-content;
    }

    .gsi-material-button .gsi-material-button-icon {
      height: 20px;
      margin-right: 10px;
      min-width: 20px;
      width: 20px;
    }

    .gsi-material-button .gsi-material-button-content-wrapper {
      -webkit-align-items: center;
      align-items: center;
      display: flex;
      -webkit-flex-direction: row;
      flex-direction: row;
      -webkit-flex-wrap: nowrap;
      flex-wrap: nowrap;
      height: 100%;
      justify-content: space-between;
      position: relative;
      width: 100%;
    }

    .gsi-material-button .gsi-material-button-contents {
      -webkit-flex-grow: 1;
      flex-grow: 1;
      font-family: "Roboto", Arial, sans-serif;
      font-weight: 500;
      overflow: hidden;
      text-overflow: ellipsis;
      vertical-align: top;
    }

    .gsi-material-button .gsi-material-button-state {
      -webkit-transition: opacity .218s;
      transition: opacity .218s;
      bottom: 0;
      left: 0;
      opacity: 0;
      position: absolute;
      right: 0;
      top: 0;
    }

    .gsi-material-button:disabled {
      cursor: default;
      background-color: #ffffff61;
      border-color: #1f1f1f1f;
    }

    .gsi-material-button:disabled .gsi-material-button-contents {
      opacity: 38%;
    }

    .gsi-material-button:disabled .gsi-material-button-icon {
      opacity: 38%;
    }

    .gsi-material-button:not(:disabled):active .gsi-material-button-state,
    .gsi-material-button:not(:disabled):focus .gsi-material-button-state {
      background-color: #303030;
      opacity: 12%;
    }

    .gsi-material-button:not(:disabled):hover {
      -webkit-box-shadow: 0 1px 2px 0 rgba(60, 64, 67, .30), 0 1px 3px 1px rgba(60, 64, 67, .15);
      box-shadow: 0 1px 2px 0 rgba(60, 64, 67, .30), 0 1px 3px 1px rgba(60, 64, 67, .15);
    }

    .gsi-material-button:not(:disabled):hover .gsi-material-button-state {
      background-color: #303030;
      opacity: 8%;
    }

    .verify-section {
      display: none;
      margin-top: 8px;
      text-align: center;
      gap: 16px;
    }

    .verify-section.active {
      display: grid;
    }

    .verify-section h2 {
      margin: 0 0 6px;
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--text);
    }

    .verify-section p {
      margin: 0;
      font-size: 0.85rem;
      color: var(--muted);
    }

    .otp-grid {
      display: grid;
      grid-template-columns: repeat(6, 44px);
      gap: 10px;
      justify-content: center;
    }

    .otp-box {
      width: 44px;
      height: 52px;
      border: 1px solid var(--border);
      border-radius: 12px;
      background: #fff;
      text-align: center;
      font-size: 1.2rem;
      font-weight: 600;
      color: var(--text);
      transition: 0.2s;
    }

    .otp-box:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 4px var(--primary-soft);
    }

    .verify-actions {
      display: grid;
      gap: 12px;
    }

    .is-hidden {
      display: none !important;
    }

    @media (max-width: 768px) {
      .page {
        padding: 24px 12px 40px;
      }

      .card {
        width: 100%;
        padding: 20px;
        border-radius: 18px;
      }

      .logo-img {
        height: 105px;
        max-width: 200px;
      }

      .header h1 {
        font-size: 1rem;
      }

      .header p {
        font-size: 0.8rem;
      }

      .field-grid {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 480px) {
      .page {
        place-items: start;
        padding: 20px 10px 32px;
      }

      .card {
        width: 100%;
        padding: 16px;
        border-radius: 16px;
      }

      .otp-grid {
        grid-template-columns: repeat(6, 36px);
        gap: 6px;
      }

      .otp-box {
        width: 36px;
        height: 46px;
      }

      .google-row {
        width: 100%;
      }

      .gsi-material-button {
        width: 100%;
        max-width: none;
        justify-content: center;
      }

      .verify-actions button,
      .actions button {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="page">
    <div class="card">
      <div class="header">
        <img src="assets/logo/logo-clean.png" alt="CompareHubPrices" class="logo-img" />
        <h1>Create your account</h1>
        <p>Join CompareHubPrices and save your favorite listings.</p>
      </div>

      <div class="form-alert" id="formAlert" role="alert" aria-live="polite"></div>
      <form id="standardRegisterForm" autocomplete="off">
        <div class="field-grid">
          <div>
            <label for="firstName">First name</label>
            <input id="firstName" type="text" placeholder="" required autocomplete="off" />
          </div>
          <div>
            <label for="lastName">Last name</label>
            <input id="lastName" type="text" placeholder="" required autocomplete="off" />
          </div>
          <div>
            <label for="email">Email address</label>
            <input id="email" type="email" placeholder="you@email.com" required autocomplete="off" />
          </div>
        </div>

        <div class="field-grid">
          <div>
            <div class="label-row">
              <label id="suburbLabel" for="suburb">Suburb</label>
              <span class="label-divider">/</span>
              <button type="button" class="mini-toggle" id="placeToggle">Village</button>
              <span class="label-note">press to change</span>
            </div>
            <input id="suburb" type="text" placeholder="" required autocomplete="off" />
            <input type="hidden" id="placeType" value="suburb" />
          </div>
          <div>
            <label for="town">Town</label>
            <input id="town" type="text" placeholder="" required autocomplete="off" />
          </div>
          <div>
            <label for="province">Province</label>
            <div class="custom-select" id="provinceSelect">
              <input type="hidden" id="province" required />
              <button type="button" class="custom-select-trigger" aria-haspopup="listbox" aria-expanded="false">
                <span class="trigger-text">Select province</span>
                <span class="chevron">â–¾</span>
              </button>
              <div class="custom-select-panel" role="listbox" aria-hidden="true">
                <button type="button" class="custom-option" role="option" data-value="Eastern Cape">Eastern Cape</button>
                <button type="button" class="custom-option" role="option" data-value="Free State">Free State</button>
                <button type="button" class="custom-option" role="option" data-value="Gauteng">Gauteng</button>
                <button type="button" class="custom-option" role="option" data-value="KwaZulu-Natal">KwaZulu-Natal</button>
                <button type="button" class="custom-option" role="option" data-value="Limpopo">Limpopo</button>
                <button type="button" class="custom-option" role="option" data-value="Mpumalanga">Mpumalanga</button>
                <button type="button" class="custom-option" role="option" data-value="Northern Cape">Northern Cape</button>
                <button type="button" class="custom-option" role="option" data-value="North West">North West</button>
                <button type="button" class="custom-option" role="option" data-value="Western Cape">Western Cape</button>
              </div>
            </div>
          </div>
        </div>

        <div class="field-grid">
          <div>
            <label for="password">Password</label>
            <div class="input-field">
              <input id="password" class="has-toggle" type="password" placeholder="Create a password" required autocomplete="new-password" />
              <i class="fas fa-eye toggle-password" data-toggle="password"></i>
            </div>
          </div>
          <div>
            <label for="confirmPassword">Confirm password</label>
            <div class="input-field">
              <input id="confirmPassword" class="has-toggle" type="password" placeholder="Repeat password" required autocomplete="new-password" />
              <i class="fas fa-eye toggle-password" data-toggle="confirmPassword"></i>
            </div>
          </div>
        </div>

        <div class="requirements" id="passwordRequirements">
          <div class="strength">
            <div class="strength-bar"><span id="strengthBar"></span></div>
            <div class="strength-label" id="strengthLabel">Password strength: --</div>
          </div>
          <div class="title">Password must contain:</div>
          <div class="requirement" data-rule="length"><span class="req-dot"></span>At least 8 characters</div>
          <div class="requirement" data-rule="uppercase"><span class="req-dot"></span>One uppercase letter</div>
          <div class="requirement" data-rule="lowercase"><span class="req-dot"></span>One lowercase letter</div>
          <div class="requirement" data-rule="number"><span class="req-dot"></span>One number</div>
          <div class="requirement" data-rule="special"><span class="req-dot"></span>One special character</div>
          <div class="requirement" data-rule="match"><span class="req-dot"></span>Passwords match</div>
        </div>

        <div class="section-card">
          <label class="checkbox-row">
            <input type="checkbox" required />
            <span>I agree to the Terms of Service and Privacy Policy.</span>
          </label>
        </div>

        <div class="actions">
          <button class="btn-primary" type="submit">Create account</button>
        </div>

        <div class="google-row">
          <button class="gsi-material-button">
            <div class="gsi-material-button-state"></div>
            <div class="gsi-material-button-content-wrapper">
              <div class="gsi-material-button-icon">
                <svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" xmlns:xlink="http://www.w3.org/1999/xlink" style="display: block;">
                  <path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"></path>
                  <path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"></path>
                  <path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"></path>
                  <path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"></path>
                  <path fill="none" d="M0 0h48v48H0z"></path>
                </svg>
              </div>
              <span class="gsi-material-button-contents">Sign up with Google</span>
              <span style="display: none;">Sign up with Google</span>
            </div>
          </button>
        </div>

        <div class="footer-note">
          Already have an account? <a href="login.html">Sign in here</a>
        </div>
      </form>

      <div class="verify-section" id="verifySection">
        <div>
          <h2>Verify your account</h2>
          <p>OTP has been sent to <span id="verifyEmail">your email</span>.</p>
        </div>

        <div class="otp-grid" id="otpGrid" role="group" aria-label="Verification code">
          <input type="text" class="otp-box" inputmode="numeric" maxlength="1" aria-label="Digit 1" autocomplete="off" />
          <input type="text" class="otp-box" inputmode="numeric" maxlength="1" aria-label="Digit 2" autocomplete="off" />
          <input type="text" class="otp-box" inputmode="numeric" maxlength="1" aria-label="Digit 3" autocomplete="off" />
          <input type="text" class="otp-box" inputmode="numeric" maxlength="1" aria-label="Digit 4" autocomplete="off" />
          <input type="text" class="otp-box" inputmode="numeric" maxlength="1" aria-label="Digit 5" autocomplete="off" />
          <input type="text" class="otp-box" inputmode="numeric" maxlength="1" aria-label="Digit 6" autocomplete="off" />
        </div>

        <div class="verify-actions" id="verifyActions">
          <button class="btn-primary" type="button" id="verifyAccountBtn">Verify account</button>
          <button class="btn-link" type="button" id="resendOtpBtn">Resend code</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="assets/scripts/standard-auth.js"></script>
  <script>
    const passwordInput = document.getElementById('password');
    const confirmPasswordInput = document.getElementById('confirmPassword');
    const strengthBar = document.getElementById('strengthBar');
    const strengthLabel = document.getElementById('strengthLabel');

    function updateRequirement(rule, valid) {
      const row = document.querySelector(`.requirement[data-rule="${rule}"]`);
      if (!row) return;
      row.classList.toggle('valid', valid);
      row.classList.toggle('invalid', !valid);
    }

    function evaluatePassword() {
      const pwd = passwordInput.value || '';
      const confirm = confirmPasswordInput.value || '';

      const rules = {
        length: pwd.length >= 8,
        uppercase: /[A-Z]/.test(pwd),
        lowercase: /[a-z]/.test(pwd),
        number: /[0-9]/.test(pwd),
        special: /[^A-Za-z0-9]/.test(pwd),
        match: pwd.length > 0 && pwd === confirm,
      };

      updateRequirement('length', rules.length);
      updateRequirement('uppercase', rules.uppercase);
      updateRequirement('lowercase', rules.lowercase);
      updateRequirement('number', rules.number);
      updateRequirement('special', rules.special);
      updateRequirement('match', rules.match);

      let score = 0;
      Object.values(rules).forEach((ok) => {
        if (ok) score += 1;
      });

      const strengthPct = Math.round((score / 6) * 100);
      if (strengthBar) {
        strengthBar.style.width = `${strengthPct}%`;
      }

      let label = 'Too weak';
      let color = '#dc2626';
      if (score >= 5) {
        label = 'Great';
        color = '#16a34a';
      } else if (score >= 4) {
        label = 'Strong';
        color = '#22c55e';
      } else if (score >= 3) {
        label = 'Fair';
        color = '#f59e0b';
      } else if (score >= 2) {
        label = 'Weak';
        color = '#f97316';
      }

      if (strengthBar) strengthBar.style.background = color;
      if (strengthLabel) strengthLabel.textContent = `Password strength: ${label}`;
    }

    passwordInput.addEventListener('input', evaluatePassword);
    confirmPasswordInput.addEventListener('input', evaluatePassword);

    const initCustomSelect = (selectId) => {
      const select = document.getElementById(selectId);
      if (!select) return;

      const trigger = select.querySelector('.custom-select-trigger');
      const panel = select.querySelector('.custom-select-panel');
      const options = Array.from(select.querySelectorAll('.custom-option'));
      const hiddenInput = select.querySelector('input[type="hidden"]');

      const closeSelect = () => {
        panel.classList.remove('open');
        trigger.setAttribute('aria-expanded', 'false');
        panel.setAttribute('aria-hidden', 'true');
      };

      trigger.addEventListener('click', (event) => {
        event.stopPropagation();
        const isOpen = panel.classList.toggle('open');
        trigger.setAttribute('aria-expanded', String(isOpen));
        panel.setAttribute('aria-hidden', String(!isOpen));
      });

      options.forEach((option) => {
        option.addEventListener('click', () => {
          const value = option.dataset.value || option.textContent.trim();
          hiddenInput.value = value;
          trigger.querySelector('.trigger-text').textContent = value;
          options.forEach((opt) => opt.classList.remove('selected'));
          option.classList.add('selected');
          closeSelect();
        });
      });

      document.addEventListener('click', (event) => {
        if (!select.contains(event.target)) {
          closeSelect();
        }
      });
    };

    initCustomSelect('provinceSelect');

    document.querySelectorAll('.toggle-password').forEach((toggle) => {
      toggle.addEventListener('click', () => {
        const targetId = toggle.dataset.toggle;
        const input = document.getElementById(targetId);
        if (!input) return;
        input.type = input.type === 'password' ? 'text' : 'password';
        toggle.classList.toggle('fa-eye');
        toggle.classList.toggle('fa-eye-slash');
      });
    });

    const suburbLabel = document.getElementById('suburbLabel');
    const placeToggle = document.getElementById('placeToggle');
    const suburbInput = document.getElementById('suburb');
    const placeTypeInput = document.getElementById('placeType');

    if (suburbLabel && placeToggle && suburbInput && placeTypeInput) {
      let isVillage = false;

      const updatePlace = () => {
        if (isVillage) {
          suburbLabel.textContent = 'Village';
          placeToggle.textContent = 'Suburb';
          suburbInput.placeholder = '';
          placeTypeInput.value = 'village';
          placeToggle.classList.add('active');
        } else {
          suburbLabel.textContent = 'Suburb';
          placeToggle.textContent = 'Village';
          suburbInput.placeholder = '';
          placeTypeInput.value = 'suburb';
          placeToggle.classList.remove('active');
        }
      };

      placeToggle.addEventListener('click', () => {
        isVillage = !isVillage;
        updatePlace();
      });

      updatePlace();
    }

    const standardForm = document.getElementById('standardRegisterForm');
    const verifySection = document.getElementById('verifySection');
    const verifyEmail = document.getElementById('verifyEmail');
    const formAlert = document.getElementById('formAlert');
    const emailInput = document.getElementById('email');
    const townInput = document.getElementById('town');
    const otpInputs = Array.from(document.querySelectorAll('.otp-box'));
    const otpGrid = document.getElementById('otpGrid');
    const verifyActions = document.getElementById('verifyActions');
    const verifyAccountBtn = document.getElementById('verifyAccountBtn');
    const resendOtpBtn = document.getElementById('resendOtpBtn');

    const SUPABASE_URL = 'https://gttsyowogmdzwqitaskr.supabase.co';
    const SUPABASE_ANON_KEY =
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imd0dHN5b3dvZ21kendxaXRhc2tyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg4NzY2NzQsImV4cCI6MjA4NDQ1MjY3NH0.p3QDWmk2LgkGE082CJWkIthSeerYFhajHxiQFqklaZk';
    const REGISTRATION_API_URL = `${SUPABASE_URL}/functions/v1/standard_account_registration`;
    const supabaseClient = window.supabase?.createClient
      ? window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY)
      : null;
    const HOME_REDIRECT = 'home_main.html';
    let pendingLogin = null;

    const attemptAutoLogin = async ({ email, password }) => {
      if (!supabaseClient?.auth?.signInWithPassword) {
        return { success: false, error: 'Auto login not available.' };
      }
      const { data, error } = await supabaseClient.auth.signInWithPassword({
        email,
        password,
      });
      if (error) {
        return { success: false, error: error.message || 'Auto login failed.' };
      }
      if (data?.session) {
        return { success: true };
      }
      return { success: false, error: 'Auto login failed.' };
    };

    const showAlert = (message, type = 'error') => {
      if (!formAlert) return;
      formAlert.textContent = message;
      formAlert.className = `form-alert show ${type}`;
    };

    const clearAlert = () => {
      if (!formAlert) return;
      formAlert.textContent = '';
      formAlert.className = 'form-alert';
    };

    const readJsonSafe = async (response) => {
      const text = await response.text().catch(() => '');
      if (!text) return {};
      try {
        return JSON.parse(text);
      } catch {
        return { error: text };
      }
    };

    const setVerifyEmail = (value) => {
      if (!verifyEmail) return;
      const clean = (value || '').trim();
      verifyEmail.textContent = clean || 'your email';
    };

    if (verifyEmail) {
      const params = new URLSearchParams(window.location.search);
      const emailParam = (params.get('email') || '').trim();
      if (emailParam) {
        setVerifyEmail(emailParam);
      }
    }

    if (standardForm) {
      standardForm.addEventListener('submit', async (event) => {
        event.preventDefault();
        clearAlert();
        evaluatePassword();
        if (!standardForm.checkValidity()) {
          standardForm.reportValidity();
          return;
        }
        const provinceValue = document.getElementById('province')?.value?.trim();
        if (!provinceValue) {
          showAlert('Please select a province.');
          document.querySelector('#provinceSelect .custom-select-trigger')?.focus();
          return;
        }
        const submitBtn = standardForm.querySelector('button[type="submit"]');
        if (submitBtn) submitBtn.disabled = true;

        try {
          const firstName = document.getElementById('firstName')?.value.trim();
          const lastName = document.getElementById('lastName')?.value.trim();
          const email = emailInput?.value.trim();
          const password = document.getElementById('password')?.value;
          const confirmPassword = document.getElementById('confirmPassword')?.value;
          const suburbValue = suburbInput?.value.trim();
          const placeType = placeTypeInput?.value || 'suburb';
          const town = townInput?.value.trim();
          const province = provinceValue;

          if (!email) {
            throw new Error('Email is required.');
          }
          if (password !== confirmPassword) {
            throw new Error('Passwords do not match.');
          }

          const suburb = placeType === 'suburb' ? suburbValue : '';
          const village = placeType === 'village' ? suburbValue : '';

          const response = await fetch(REGISTRATION_API_URL, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              apikey: SUPABASE_ANON_KEY,
              Authorization: `Bearer ${SUPABASE_ANON_KEY}`,
            },
            body: JSON.stringify({
              email,
              password,
              firstName,
              lastName,
              province,
              town,
              suburb,
              village,
            }),
          });

          const result = await readJsonSafe(response);
          if (!response.ok) {
            throw new Error(result?.error || result?.message || 'Registration failed.');
          }

          pendingLogin = { email, password };
          setVerifyEmail(email);
          standardForm.classList.add('is-hidden');
          if (verifySection) {
            verifySection.classList.add('active');
          }
          if (otpGrid) otpGrid.classList.remove('is-hidden');
          if (verifyActions) verifyActions.classList.remove('is-hidden');
          if (otpInputs.length) {
            otpInputs[0].focus();
          }
          showAlert('Registration successful. Enter the OTP to verify your account.', 'success');
        } catch (err) {
          showAlert(err?.message || 'Registration failed.');
        } finally {
          if (submitBtn) submitBtn.disabled = false;
        }
      });
    }

    const getOtpValue = () => otpInputs.map((input) => input.value.trim()).join('');

    if (verifyAccountBtn) {
      verifyAccountBtn.addEventListener('click', async () => {
        clearAlert();
        const email = emailInput?.value.trim();
        const token = getOtpValue();

        if (!email || !token) {
          showAlert('Email and verification code are required.');
          return;
        }
        if (!supabaseClient?.auth?.verifyOtp) {
          showAlert('Verification is not available on this page.');
          return;
        }

        verifyAccountBtn.disabled = true;
        try {
          const { error } = await supabaseClient.auth.verifyOtp({
            email,
            token,
            type: 'signup',
          });
          if (error) throw error;
          if (!window.standardAuth?.login) {
            throw new Error('Auto login is not available.');
          }
          const loginEmail = pendingLogin?.email || email;
          const loginPassword = pendingLogin?.password || '';
          if (!loginPassword) {
            throw new Error('Missing password for auto login.');
          }
          showAlert('Email verified. Logging you in...', 'success');
          await window.standardAuth.login({
            email: loginEmail,
            password: loginPassword,
            redirectTo: HOME_REDIRECT,
          });
        } catch (err) {
          showAlert(err?.message || 'Verification failed.');
        } finally {
          verifyAccountBtn.disabled = false;
        }
      });
    }

    if (resendOtpBtn) {
      resendOtpBtn.addEventListener('click', async () => {
        clearAlert();
        const email = emailInput?.value.trim();
        if (!email) {
          showAlert('Please enter your email first.');
          return;
        }
        if (!supabaseClient?.auth?.resend) {
          showAlert('Resend is not available on this page.');
          return;
        }

        resendOtpBtn.disabled = true;
        try {
          const { error } = await supabaseClient.auth.resend({
            type: 'signup',
            email,
          });
          if (error) throw error;
          showAlert('Verification code resent. Check your email.', 'success');
        } catch (err) {
          showAlert(err?.message || 'Failed to resend code.');
        } finally {
          resendOtpBtn.disabled = false;
        }
      });
    }

    if (otpInputs.length) {
      otpInputs.forEach((input, index) => {
        input.addEventListener('input', (event) => {
          const value = event.target.value.replace(/\\D/g, '');
          event.target.value = value;
          if (value && index < otpInputs.length - 1) {
            otpInputs[index + 1].focus();
          }
        });

        input.addEventListener('keydown', (event) => {
          if (event.key === 'Backspace' && !event.target.value && index > 0) {
            otpInputs[index - 1].focus();
          }
        });

        input.addEventListener('paste', (event) => {
          const paste = (event.clipboardData || window.clipboardData).getData('text');
          if (!paste) return;
          const digits = paste.replace(/\\D/g, '').slice(0, otpInputs.length);
          if (!digits) return;
          event.preventDefault();
          digits.split('').forEach((digit, i) => {
            otpInputs[i].value = digit;
          });
          otpInputs[Math.min(digits.length, otpInputs.length - 1)].focus();
        });
      });
    }
  </script>
</body>
</html>
