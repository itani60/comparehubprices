<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customer Messages - CompareHubPrices Business</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #22c55e;
            /* Green for Business */
            --primary-dark: #16a34a;
            --secondary: #64748b;
            --bg-light: #f8fafc;
            --white: #ffffff;
            --border: #e2e8f0;
            --text-dark: #1e293b;
            --text-gray: #64748b;
            --shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Outfit', sans-serif;
        }

        body {
            background-color: var(--bg-light);
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        header {
            background: var(--white);
            padding: 1rem 2rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-weight: 700;
            font-size: 1.25rem;
            color: var(--text-dark);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .logo span {
            color: var(--primary);
        }

        .nav-link {
            color: var(--text-gray);
            text-decoration: none;
            font-weight: 500;
            margin-left: 1.5rem;
            transition: color 0.2s;
        }

        .nav-link:hover {
            color: var(--primary);
        }

        /* Main Chat Container */
        .chat-container {
            flex: 1;
            display: flex;
            overflow: hidden;
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
        }

        /* Sidebar */
        .sidebar {
            width: 350px;
            background: var(--white);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
        }

        .sidebar-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border);
        }

        .sidebar-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-dark);
        }

        .conversation-list {
            flex: 1;
            overflow-y: auto;
        }

        .conversation-item {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--border);
            cursor: pointer;
            transition: background 0.2s;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .conversation-item:hover {
            background-color: var(--bg-light);
        }

        .conversation-item.active {
            background-color: #f0fdf4;
            border-left: 4px solid var(--primary);
        }

        .avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background-color: #f1f5f9;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: var(--text-gray);
            object-fit: cover;
            flex-shrink: 0;
        }

        .conv-info {
            flex: 1;
            min-width: 0;
        }

        .conv-name {
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 0.25rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .conv-preview {
            font-size: 0.875rem;
            color: var(--text-gray);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .conv-time {
            font-size: 0.75rem;
            color: #94a3b8;
            margin-left: auto;
        }

        /* Chat Area */
        .chat-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            background-color: #fff;
        }

        .chat-header {
            padding: 1rem 2rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 1rem;
            background: var(--white);
        }

        .chat-header h3 {
            font-size: 1.125rem;
            font-weight: 600;
        }

        .messages-list {
            flex: 1;
            overflow-y: auto;
            padding: 2rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            background-color: #f8fafc;
        }

        .message-bubble {
            max-width: 60%;
            padding: 1rem;
            border-radius: 1rem;
            position: relative;
            font-size: 0.95rem;
            line-height: 1.5;
        }

        .message-sent {
            align-self: flex-end;
            background-color: var(--primary);
            color: white;
            border-bottom-right-radius: 0.25rem;
        }

        .message-received {
            align-self: flex-start;
            background-color: white;
            border: 1px solid var(--border);
            color: var(--text-dark);
            border-bottom-left-radius: 0.25rem;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
        }

        .message-time {
            font-size: 0.7rem;
            margin-top: 0.5rem;
            opacity: 0.8;
            text-align: right;
        }

        /* Input Area */
        .input-area {
            padding: 1.5rem;
            background: var(--white);
            border-top: 1px solid var(--border);
            display: flex;
            gap: 1rem;
        }

        .message-input {
            flex: 1;
            padding: 1rem;
            border: 1px solid var(--border);
            border-radius: 0.75rem;
            outline: none;
            transition: border-color 0.2s;
            resize: none;
            height: 56px;
            font-family: inherit;
        }

        .message-input:focus {
            border-color: var(--primary);
        }

        .send-btn {
            padding: 0 1.5rem;
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }

        .send-btn:hover {
            background-color: var(--primary-dark);
        }

        .send-btn:disabled {
            background-color: var(--secondary);
            cursor: not-allowed;
        }

        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: var(--text-gray);
        }
    </style>
</head>

<body>

    <header>
        <a href="business-dashboard.html" class="logo">CompareHubPrices <span>Business</span></a>
        <nav>
            <a href="business-dashboard.html" class="nav-link">Dashboard</a>
            <a href="#" class="nav-link" id="logoutBtn">Logout</a>
        </nav>
    </header>

    <div class="chat-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h2 class="sidebar-title">Inbox</h2>
            </div>
            <div class="conversation-list" id="conversationList">
                <div style="padding: 2rem; text-align: center; color: #94a3b8;">Loading customers...</div>
            </div>
        </aside>

        <!-- Main Chat Area -->
        <main class="chat-area">
            <div id="chatInterface" style="display: none; height: 100%; flex-direction: column;">
                <div class="chat-header">
                    <img src="" alt="" class="avatar" id="headerAvatar">
                    <div>
                        <h3 id="headerName">Customer Name</h3>
                        <span id="chatStatus" style="font-size: 0.8rem; color: #64748b;">Customer</span>
                    </div>
                </div>

                <div class="messages-list" id="messagesList">
                    <!-- Messages loaded here -->
                </div>

                <div class="input-area">
                    <textarea class="message-input" id="messageInput" placeholder="Reply to customer..."></textarea>
                    <button class="send-btn" id="sendBtn">Send</button>
                </div>
            </div>

            <div id="emptyState" class="empty-state">
                <div style="font-size: 3rem; margin-bottom: 1rem;">üì©</div>
                <h3>Customer Messages</h3>
                <p>Select a conversation to reply to your customers</p>
            </div>
        </main>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/cookies-js@1.2.1/dist/cookies.min.js"></script>
    <script>
        const API_URL = 'https://gttsyowogmdzwqitaskr.supabase.co/functions/v1/chat-system';
        const SESSION_ID = Cookies.get('business_session_id');

        // Supabase Config
        const SUPABASE_URL = 'https://gttsyowogmdzwqitaskr.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imd0dHN5b3dvZ21kendxaXRhc2tyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg4NzY2NzQsImV4cCI6MjA4NDQ1MjY3NH0.p3QDWmk2LgkGE082CJWkIthSeerYFhajHxiQFqklaZk';

        // Initialize Supabase Client
        const supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        let currentConversationId = null;
        let realtimeToken = null;
        let activeChannel = null;
        let typingTimeout = null;
        let myUserId = null;

        // --- Init ---
        async function init() {
            if (!SESSION_ID) {
                window.location.href = 'business_login.html';
                return;
            }

            try {
                // 1. Get Realtime Token
                const tokenRes = await fetch(`${API_URL}?action=get_realtime_token`, {
                    headers: { 'x-access-token': SESSION_ID }
                });

                if (!tokenRes.ok) {
                    if (tokenRes.status === 401) {
                        window.location.href = 'business_login.html';
                        return;
                    }
                    console.error('Failed to get realtime token');
                }

                const tokenData = await tokenRes.json();
                if (tokenData.success) {
                    realtimeToken = tokenData.token;

                    // Decode user ID
                    const payload = JSON.parse(atob(realtimeToken.split('.')[1]));
                    myUserId = payload.sub;

                    // Set Auth
                    supabaseClient.realtime.setAuth(realtimeToken);
                }

                // 2. Load Conversations
                await loadConversations();

                // Poll for conversation list updates (sidebar)
                setInterval(loadConversations, 10000);

            } catch (e) {
                console.error('Init error:', e);
            }
        }

        let allConversations = [];

        // --- Load Conversations ---
        async function loadConversations() {
            try {
                const res = await fetch(API_URL, {
                    headers: { 'x-access-token': SESSION_ID }
                });
                const data = await res.json();

                if (data.success) {
                    allConversations = data.conversations; // Store globally
                    renderConversations(data.conversations);
                }
            } catch (e) {
                console.error('Error loading chats:', e);
            }
        }

        function renderConversations(conversations) {
            const list = document.getElementById('conversationList');

            if (conversations.length === 0) {
                list.innerHTML = '<div style="padding: 2rem; text-align: center; color: #94a3b8;">No messages yet.</div>';
                return;
            }

            const html = conversations.map(conv => `
                <div class="conversation-item ${conv.id === currentConversationId ? 'active' : ''}" onclick="selectConversation('${conv.id}')">
                    <img src="${conv.other_party.image || 'https://ui-avatars.com/api/?name=' + conv.other_party.name}" class="avatar">
                    <div class="conv-info">
                        <div style="display:flex; justify-content:space-between;">
                            <div class="conv-name">${conv.other_party.name}</div>
                            <div class="conv-time">${formatTime(conv.last_message_at)}</div>
                        </div>
                        <div class="conv-preview">${conv.last_message_preview || 'New message'}</div>
                    </div>
                </div>
            `).join('');

            if (list.innerHTML !== html) list.innerHTML = html;
        }

        let currentLastSeen = null;

        // --- Select Chat ---
        window.selectConversation = async (id) => {
            const conv = allConversations.find(c => c.id === id);
            if (!conv) {
                console.error("Conversation not found locally", id);
                return;
            }

            const name = conv.other_party.name;
            const image = conv.other_party.image;
            const lastSeen = conv.other_party.last_seen;
            const isBlocked = conv.other_party.is_blocked;

            if (currentConversationId === id) return;

            currentConversationId = id;
            currentLastSeen = lastSeen;
            document.getElementById('emptyState').style.display = 'none';
            document.getElementById('chatInterface').style.display = 'flex';

            // Update Header
            document.getElementById('headerName').innerText = name;
            document.getElementById('headerAvatar').src = image || `https://ui-avatars.com/api/?name=${name}`;

            // Handle Blocked State
            toggleBlockedUI(isBlocked);

            // Load Messages
            await loadMessages();

            // Subscribe Realtime
            subscribeToConversation(id);

            // Mark as read
            markAsRead(id);
        };

        function formatLastSeen(isoString) {
            const date = new Date(isoString);
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.round(diffMs / 60000);
            const diffHours = Math.round(diffMs / 3600000);

            if (diffMins < 1) return 'Just now';
            if (diffMins < 60) return `${diffMins} min ago`;
            if (diffHours < 24) return `${diffHours} hour${diffHours > 1 ? 's' : ''} ago`;
            if (diffHours < 48) return 'Yesterday';
            return date.toLocaleDateString();
        }

        // --- Realtime Subscription ---
        function subscribeToConversation(conversationId) {
            if (activeChannel) {
                supabaseClient.removeChannel(activeChannel);
            }

            const channel = supabaseClient.channel(`conversation:${conversationId}`);

            channel
                .on('postgres_changes', {
                    event: 'INSERT',
                    schema: 'public',
                    table: 'messages',
                    filter: `conversation_id=eq.${conversationId}`
                }, (payload) => {
                    handleNewMessage(payload.new);
                })
                .on('broadcast', { event: 'typing' }, (payload) => {
                    if (payload.userId !== myUserId) {
                        showTypingIndicator();
                    }
                })
                .on('presence', { event: 'sync' }, () => {
                    const state = channel.presenceState();
                    const others = Object.values(state).flat().filter(u => u.user_id !== myUserId);
                    updateOnlineStatus(others.length > 0);
                })
                .subscribe((status) => {
                    if (status === 'SUBSCRIBED') {
                        channel.track({ user_id: myUserId, online_at: new Date().toISOString() });
                    }
                });

            activeChannel = channel;
        }

        function handleNewMessage(msg) {
            renderMessages([msg], true);
            markAsRead(currentConversationId);
        }

        function updateOnlineStatus(isOnline) {
            const statusSpan = document.getElementById('chatStatus');
            if (!statusSpan) return;

            const conv = allConversations.find(c => c.id === currentConversationId);

            if (!conv) {
                statusSpan.innerText = '';
                return;
            }

            // Robust check: Flag OR Name fallback
            const isBlocked = (conv.other_party && conv.other_party.is_blocked) ||
                (conv.other_party && conv.other_party.name && conv.other_party.name.includes('CompareHubPrices'));

            if (isBlocked) {
                statusSpan.innerText = '';
                statusSpan.style.color = '#94a3b8';
                return;
            }

            if (isOnline) {
                statusSpan.innerText = 'Online';
                statusSpan.style.color = '#22c55e';
            } else {
                statusSpan.innerText = 'Offline';
                statusSpan.style.color = '#94a3b8';
            }
        }

        // --- Typing Indicator ---
        const typingLabel = document.createElement('div');
        typingLabel.id = 'typingIndicator';
        typingLabel.style.cssText = 'font-size: 0.8rem; color: #94a3b8; font-style: italic; display: none; margin-left: 60px; margin-bottom: 10px;';
        typingLabel.innerText = 'Typing...';
        document.getElementById('messagesList').after(typingLabel);

        let hideTypingTimer;
        function showTypingIndicator() {
            const indicator = document.getElementById('typingIndicator');
            indicator.style.display = 'block';
            clearTimeout(hideTypingTimer);
            hideTypingTimer = setTimeout(() => {
                indicator.style.display = 'none';
            }, 3000);
        }

        document.getElementById('messageInput').addEventListener('input', () => {
            if (activeChannel && currentConversationId) {
                activeChannel.send({
                    type: 'broadcast',
                    event: 'typing',
                    payload: { userId: myUserId }
                });
            }
        });

        // --- Load Messages ---
        async function loadMessages() {
            if (!currentConversationId) return;

            try {
                const res = await fetch(`${API_URL}?conversationId=${currentConversationId}`, {
                    headers: { 'x-access-token': SESSION_ID }
                });
                const data = await res.json();

                if (data.success) {
                    renderMessages(data.messages);
                }
            } catch (e) {
                console.error('Error loading messages:', e);
            }
        }

        // --- Delete / Clear Logic ---
        async function deleteMessage(messageId, elementId) {
            if (!confirm('Delete this message for you?')) return;

            try {
                const res = await fetch(`${API_URL}?messageId=${messageId}`, {
                    method: 'DELETE',
                    headers: { 'x-access-token': SESSION_ID }
                });

                if (res.ok) {
                    const el = document.getElementById(elementId);
                    if (el) el.remove();
                }
            } catch (e) {
                console.error('Delete error', e);
            }
        }

        async function clearCurrentConversation() {
            if (!currentConversationId) return;
            if (!confirm('Clear entire chat history? This cannot be undone.')) return;

            try {
                const res = await fetch(`${API_URL}?conversationId=${currentConversationId}`, {
                    method: 'DELETE',
                    headers: { 'x-access-token': SESSION_ID }
                });

                if (res.ok) {
                    document.getElementById('messagesList').innerHTML = '<div style="text-align:center; color:#999; margin-top:20px;">Chat cleared.</div>';
                    loadConversations();
                }
            } catch (e) {
                console.error('Clear chat error', e);
            }
        }

        // Add Clear & Options Buttons to header if not exists
        if (!document.getElementById('chatActionsContainer')) {
            const header = document.querySelector('.chat-header');

            // Container for right-side actions
            const container = document.createElement('div');
            container.id = 'chatActionsContainer';
            container.style.cssText = 'margin-left:auto; display:flex; gap:10px; align-items:center; position:relative;';

            // Clear Button
            const btnClear = document.createElement('button');
            btnClear.id = 'clearChatBtn';
            btnClear.innerHTML = 'üóëÔ∏è';
            btnClear.title = 'Clear Chat History';
            btnClear.style.cssText = 'background:none; border:none; font-size:1.2rem; cursor:pointer; opacity:0.6; transition:opacity 0.2s;';
            btnClear.onmouseover = () => btnClear.style.opacity = '1';
            btnClear.onmouseout = () => btnClear.style.opacity = '0.6';
            btnClear.onclick = clearCurrentConversation;

            // Options Button (Three dots)
            const btnOptions = document.createElement('button');
            btnOptions.id = 'chatOptionsBtn';
            btnOptions.innerHTML = '‚ãÆ';
            btnOptions.title = 'More Options';
            btnOptions.style.cssText = 'background:none; border:none; font-size:1.5rem; cursor:pointer; opacity:0.6; padding: 0 5px;';
            btnOptions.onclick = toggleChatOptions;

            // Dropdown Menu
            const dropdown = document.createElement('div');
            dropdown.id = 'chatOptionsMenu';
            dropdown.style.cssText = 'display:none; position:absolute; right:0; top:120%; background:white; border:1px solid #e2e8f0; border-radius:0.5rem; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1); width:160px; z-index:100; overflow:hidden;';
            dropdown.innerHTML = `
                <div onclick="reportUser()" style="padding:10px 15px; cursor:pointer; font-size:0.9rem; color:#475569; transition:background 0.2s;" onmouseover="this.style.backgroundColor='#f8fafc'" onmouseout="this.style.backgroundColor='transparent'">‚ö†Ô∏è Report Customer</div>
                <div onclick="blockUser()" style="padding:10px 15px; cursor:pointer; font-size:0.9rem; color:#ef4444; transition:background 0.2s;" onmouseover="this.style.backgroundColor='#fef2f2'" onmouseout="this.style.backgroundColor='transparent'">Df Block Customer</div>
            `;

            container.appendChild(btnClear);
            container.appendChild(btnOptions);
            container.appendChild(dropdown);
            header.appendChild(container);

            // Close dropdown when clicking outside
            document.addEventListener('click', (e) => {
                if (!container.contains(e.target)) {
                    dropdown.style.display = 'none';
                }
            });
        }

        function toggleChatOptions() {
            const menu = document.getElementById('chatOptionsMenu');
            menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
        }

        async function reportUser() {
            if (!currentConversationId) return;
            const reason = prompt("Why are you reporting this customer?");
            if (!reason) return;

            try {
                const res = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'x-access-token': SESSION_ID },
                    body: JSON.stringify({
                        conversationId: currentConversationId,
                        action: 'report',
                        reason: reason
                    })
                });

                const data = await res.json();
                if (res.ok) {
                    alert('Report submitted.');
                } else {
                    alert('Error: ' + (data.error || 'Unknown error'));
                }
            } catch (e) {
                console.error('Report error:', e);
            }
            toggleChatOptions();
        }

        async function blockUser() {
            if (!currentConversationId) return;
            if (!confirm("Are you sure you want to block this customer?")) return;

            try {
                const res = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'x-access-token': SESSION_ID },
                    body: JSON.stringify({
                        conversationId: currentConversationId,
                        action: 'block'
                    })
                });

                const data = await res.json();
                if (res.ok) {
                    alert('Customer blocked.');
                    toggleBlockedUI(true);
                } else {
                    alert('Error: ' + (data.error || 'Unknown error'));
                }
            } catch (e) {
                console.error('Block error:', e);
            }
            toggleChatOptions();
        }

        function toggleBlockedUI(isBlocked) {
            const input = document.getElementById('messageInput');
            const sendBtn = document.getElementById('sendBtn');

  
            const conv = allConversations.find(c => c.id === currentConversationId);
            if (conv && conv.other_party) conv.other_party.is_blocked = isBlocked;

            if (isBlocked) {
                input.disabled = true;
                input.placeholder = "You cannot reply to this conversation.";
                input.value = "";
                sendBtn.disabled = true;
                sendBtn.style.backgroundColor = "#ccc";
                updateOnlineStatus(false);
            } else {
                input.disabled = false;
                input.placeholder = "Reply to customer...";
                sendBtn.disabled = false;
                sendBtn.style.backgroundColor = "";
            }
        }

        function renderMessages(messages, append = false) {
            const list = document.getElementById('messagesList');

            const html = messages.map(msg => {
                const isMe = msg.sender_id === myUserId || (msg.sender_type === 'business');
                const uniqueId = `msg-${msg.id}`;

                const deleteBtn = isMe ? `<span onclick="deleteMessage('${msg.id}', '${uniqueId}')" style="cursor:pointer; margin-left:5px; opacity:0.5; font-size:0.8rem;" title="Delete">üóëÔ∏è</span>` : '';

                return `
                    <div id="${uniqueId}" class="message-bubble ${isMe ? 'message-sent' : 'message-received'}">
                        ${msg.content}
                        <div class="message-time" style="color: ${isMe ? 'rgba(255,255,255,0.8)' : '#94a3b8'}; display:flex; justify-content:space-between; align-items:center;">
                            <span>${formatTime(msg.created_at)}</span>
                            ${deleteBtn}
                        </div>
                    </div>
                `;
            }).join('');

            if (append) {
                list.insertAdjacentHTML('beforeend', html);
            } else {
                list.innerHTML = html;
            }

            list.scrollTop = list.scrollHeight;
        }

        // --- Send Message ---
        document.getElementById('sendBtn').addEventListener('click', sendMessage);
        document.getElementById('messageInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        async function sendMessage() {
            const input = document.getElementById('messageInput');
            const content = input.value.trim();
            if (!content || !currentConversationId) return;

            input.value = '';

            try {
                const res = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'x-access-token': SESSION_ID },
                    body: JSON.stringify({
                        conversationId: currentConversationId,
                        content: content
                    })
                });

                // If success, Realtime will append. fallback: re-load if realtime fails
                if (res.ok) {
                    loadConversations();
                }
            } catch (e) {
                alert('Failed to send');
            }
        }

        async function markAsRead(convId) {
            fetch(API_URL, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json', 'x-access-token': SESSION_ID },
                body: JSON.stringify({ conversationId: convId })
            });
        }

        function formatTime(isoString) {
            const date = new Date(isoString);
            return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        }

        document.getElementById('logoutBtn').addEventListener('click', () => {
            Cookies.expire('business_session_id');
            window.location.href = 'business_login.html';
        });

        init();
    </script>
</body>

</html>